// 
// 
// 类型:
// 
// <Module>
// <PrivateImplementationDetails>
// Achievement
// AchievementButton
// AchievementCheck
// AchievementGoodie
// AchievementGroup
// AchievementGroupAsset
// AchievementGroupLibrary
// AchievementLibrary
// AchievementPopup
// AchievementWindow
// ActionExtensions
// ActionFormatCounterOptionAsset
// ActionLibrary
// ActionOptionAsset
// Actor
// ActorAnimation
// ActorAnimationLoader
// ActorAnimationSequences
// ActorAsset
// ActorAssetElementPlace
// ActorAssetFilter
// ActorAssetLibrary
// ActorAssetWindow
// ActorAvatar
// ActorAvatarData
// ActorBag
// ActorBagExtensions
// ActorColorEffect
// ActorContainer
// ActorDamageEffectData
// ActorData
// ActorDataObsolete
// ActorDebugAnimationElement
// ActorDebugAssetElement
// ActorDebugAssetsComponent
// ActorDirection
// ActorEquipment
// ActorEquipmentSlot
// ActorGender
// ActorGetSprite
// ActorGetSprites
// ActorHighlightEffectData
// ActorIdleLoopSound
// ActorJob
// ActorJobLibrary
// ActorManager
// ActorMove
// ActorRenderData
// ActorSelectedContainerEquipment
// ActorSelectedContainerStatus
// ActorSelectedContainerTraits
// ActorSelectedElementBase`2
// ActorSelectedMetaBanners
// ActorSex
// ActorSimpleComponent
// ActorSize
// ActorTextureSubAsset
// ActorTrait
// ActorTraitButton
// ActorTraitEditorButton
// ActorTraitGroupAsset
// ActorTraitGroupElement
// ActorTraitGroupLibrary
// ActorTraitLibrary
// ActorTraitsContainer
// ActorTraitsEditor
// ActorVisibleDataArray
// AdButtonTimer
// AdLoadingButton
// AdLoadingButtonState
// AfterHatchFromEggAction
// AIHistoryElement
// AIHistoryElementDecision
// AiSystemActor
// AiSystemCity
// AISystemDebug
// AiSystemKingdom
// AiSystemTester
// AiSystem`5
// Alliance
// AllianceBanner
// AllianceBannersContainer`3
// AllianceCustomizeWindow
// AllianceData
// AllianceElement
// AllianceKingdomsContainer
// AllianceListComponent
// AllianceListElement
// AllianceManager
// AllianceStatsElement
// AllianceType
// AllianceWindow
// Analytics
// AnchorPresets
// AngleAnimationTarget
// AnimationContainerUnit
// AnimationDataBoat
// AnimationFrameData
// AnimationHelper
// AnimPlayType
// Ant
// AntimatterBombEffect
// AotTypeEnforcer
// ApplyAttackState
// ArchitectMood
// ArchitectMoodAction
// ArchitectMoodButton
// ArchitectMoodLibrary
// ArchitectTab
// ArchitectureAsset
// ArchitectureLibrary
// ArmiesColorsLibrary
// Army
// ArmyData
// ArmyManager
// ArrayExtensions
// Asset
// AssetLibrary`1
// AssetManager
// AssetModLoader
// AssetsDebugManager
// AttackAction
// AttackData
// AttackDataResult
// AttackType
// AugmentationButtonClickAction
// AugmentationButton`1
// AugmentationCategory`3
// AugmentationEditorButton`2
// AugmentationsEditor`7
// AugmentationUnlockedAction
// Auth
// AuthButton
// AuthorButton
// AutoCivilization
// AutoSaveData
// AutoSaveElement
// AutoSaveHelper
// AutoSaveManager
// AutoSavesWindow
// AutoTesterBot
// AvatarCombineHandItem
// AvatarEffect
// AvatarsCombineDataContainer
// AvatarsCombineDataElement
// AvgStats
// AxonElement
// BabyHelper
// BabyMaker
// BackButtonHider
// BannerAsset
// BannerBase
// BannerGeneric`2
// BaseActionActor
// BaseActorComponent
// BaseAnimatedObject
// BaseAssetElementPlace`2
// BaseAssetLibrary
// BaseAugmentationAsset
// BaseAugmentationsEditor
// BaseBuildingComponent
// BaseCallback
// BaseCategoryAsset
// BaseCategoryLibrary`1
// BaseDebugAnimationElement`1
// BaseDebugAssetElement`1
// BaseDebugAssetsComponent`3
// BaseDebugAssetWindow`2
// BaseEffect
// BaseEffectController
// BaseEmptyListMono
// BaseLibraryWithUnlockables`1
// BaseMapObject
// BaseMapObjectSimple
// BaseModule
// BaseObjectData
// BaseSimObject
// BaseStatAsset
// BaseStats
// BaseStatsContainer
// BaseStatsExtension
// BaseStatsHelper
// BaseStatsLibrary
// BaseSystemData
// BaseSystemManager
// BaseTraitGroupAsset
// BaseTraitLibrary`1
// BaseTrait`1
// BaseUnlockableAsset
// BaseWorldAgeElement
// BaseWorldObject
// BatchActors
// BatchBuildings
// Batch`1
// BattleContainer
// BattleKeeperManager
// Beehive
// BehActorBuildingTarget
// BehActorChangeHappiness
// BehActorCheckZoneTarget
// BehActorGiveTax
// BehActorRandomJump
// BehActorReverseFlip
// BehActorUsableBuildingTarget
// BehAddAggroForBehTarget
// BehAddHappiness
// BehAffectDreams
// BehaviourActionBase`1
// BehaviourActionCity
// BehaviourActionKingdom
// BehaviourActionTester
// BehaviourActorCondition
// BehaviourBaseCondition`1
// BehaviourCityCondition
// BehaviourElementAI
// BehaviourKingdomCondition
// BehaviourTaskBase`1
// BehaviourTaskCity
// BehaviourTaskKingdom
// BehaviourTaskTester
// BehaviourTesterCondition
// BehBoatCheckExistence
// BehChangeCityActorCulture
// BehChangeCityActorLanguage
// BehChangeCityActorReligion
// BehChangeKingdomCulture
// BehChangeKingdomLanguage
// BehChangeKingdomReligion
// BehCheckBuddingReproduction
// BehCheckCanRepairEquipment
// BehCheckCuriosityTile
// BehCheckDivineReproduction
// BehCheckEnemyNotNear
// BehCheckFissionReproduction
// BehCheckHasMoneyForCityFood
// BehCheckHasResources
// BehCheckParthenogenesisReproduction
// BehCheckPlot
// BehCheckPlotBase
// BehCheckPlotIsOk
// BehCheckPlotProgress
// BehCheckReproductionBasics
// BehCheckSoulBorneReproduction
// BehCheckSporeReproduction
// BehCheckStartCivilization
// BehCheckVegetativeReproduction
// BehChildFindRandomFamilyParent
// BehCityActorGetRandomBorderTile
// BehClaimZoneForCityActorBorder
// BehClanChiefCheckMembersToBanish
// BehClanChiefCheckMembersToKill
// BehCopyAggro
// BehDecideWhereToPoop
// BehDecideWhereToSleep
// BehDoTalk
// BehFamilyCheckMembers
// BehFindHouse
// BehFindLover
// BehFindRandomFarTile
// BehFindRandomFrontTileNearHouse
// BehFindRandomTileAroundHouse
// BehFindRandomTileNearBuildingTarget
// BehFindRaycastTileForBuildingTarget
// BehFindTantrumTarget
// BehFindTargetToStealFrom
// BehFinishReading
// BehFinishSinging
// BehFinishTalk
// BehGenerateLootFromHouse
// BehGetDamaged
// BehKingCheckNewCityFoundation
// BehLaunchFireworks
// BehMadnessRandomEmotion
// BehMakeDecision
// BehPoopInside
// BehPoopOutside
// BehRandomSocializeTopic
// BehReflection
// BehRepairEquipment
// BehSexualReproductionTry
// BehSocializeStartCheck
// BehSocializeTalk
// BehSpawnCityBorderEffect
// BehSpawnHmmEffect
// BehSpawnPlotProgressEffect
// BehStealFromTarget
// BehTryFindTargetWithStatusNearby
// BehTryNewPlot
// BehTrySleep
// BehTryToEatCityFood
// BehTryToRead
// BehTryToSocialize
// Bench
// Benchmark
// BenchmarkBlacklist
// BenchmarkDist
// BenchmarkFieldAccess
// BenchmarkGroup
// BenchmarkGroupID
// BenchmarkLoops
// BenchmarkObjects
// BenchmarkShuffle
// BenchmarkSprites
// BenchmarkStructLoops
// BenchObject
// BenchTest1
// BenchTest2
// BiomeAsset
// BiomeLibrary
// BiomeTag
// Blacklist
// BlacklistTest
// BlacklistTest10
// BlacklistTest11
// BlacklistTest12
// BlacklistTest13
// BlacklistTest2
// BlacklistTest3
// BlacklistTest4
// BlacklistTest5
// BlacklistTest6
// BlacklistTest7
// BlacklistTest8
// BlacklistTest9
// BlacklistTools
// Boat
// BoatState
// Book
// BookData
// BookManager
// BookRateCalc
// BookReadAction
// BookRequirementCheck
// BooksContainer
// BooksElement
// BooksHandler
// BooksNoItems
// BookTraitAction
// BookTypeAsset
// BookTypeLibrary
// Boulder
// BoulderCharge
// BoxPreview
// BoxState
// Brush
// BrushData
// BrushGenerateAction
// BrushGroup
// BrushLibrary
// BrushPixelData
// BrushPixelDataConverter
// BrushSelectButton
// BrushSizesButton
// BrushWindow
// Building
// BuildingActions
// BuildingAnimationData
// BuildingAnimationState
// BuildingAsset
// BuildingAssetElementPlace
// BuildingAssetWindow
// BuildingBiomeFoodProducer
// BuildingColorPixel
// BuildingContainer
// BuildingCreepHUB
// BuildingCreepWorker
// BuildingData
// BuildingDebugAnimationElement
// BuildingDebugAnimationVariation
// BuildingDebugAssetElement
// BuildingDebugAssetsComponent
// BuildingEffectSpawnDrop
// BuildingFruitGrowth
// BuildingFundament
// BuildingHelper
// BuildingLibrary
// BuildingList
// BuildingManager
// BuildingMapIcon
// BuildingMonolith
// BuildingOverrideMainSprite
// BuildingOverrideMainSprites
// BuildingOwnershipState
// BuildingRenderData
// BuildingRendererSettings
// BuildingSmokeEffect
// BuildingSpreadBiome
// BuildingSprites
// BuildingState
// BuildingStepAction
// BuildingTower
// BuildingTweenExtension
// BuildingTweenScaleHelper
// BuildingType
// BuildingWaypoint
// BuildingWaypointAlienMold
// BuildingWaypointComputer
// BuildingWaypointGoldenEgg
// BuildingWaypointHarp
// BuildingZonesSystem
// BuildOrder
// BuildOrderLibrary
// BuildPlacingType
// BurnedTilesLayer
// ButtonAnimation
// ButtonClickMaptemplate
// ButtonDestroyer
// ButtonEmail
// ButtonEvent
// ButtonExtensions
// ButtonGraphCategory
// ButtonGraphListCompare
// ButtonGraphScale
// ButtonGraphScalePlusMinus
// ButtonGraphScaleType
// ButtonPremium
// ButtonResource
// ButtonSfx
// ButtonSocial
// ButtonsViewer
// ButtonTipLoader
// ButtonTooltipLoader
// ButtonTranslate
// ButtonTrigger
// ButtonTwitter
// ButtonUtil
// ButtonVersionUpdate
// ButtonVote
// ButtonWebsite
// ButtonWorldnet
// CameraRender
// CancelButton
// CancelSelectedUnitButton
// CanvasMain
// CanvasNotch
// CapturingZonesCalculator
// CastEntity
// CastTarget
// CategoryData
// CenterTipCaller
// ChainElement
// ChangeTextInHindi
// Character
// Chromosome
// ChromosomeClickEvent
// ChromosomeData
// ChromosomeElement
// ChromosomeTypeAsset
// ChromosomeTypeLibrary
// ChunkObjectContainer
// CircleIconShaderMod
// CitiesManager
// CitizenJobAsset
// CitizenJobCondition
// CitizenJobLibrary
// CitizenJobs
// City
// CityBanner
// CityBehBorderShrink
// CityBehCheckFarms
// CityBuildingIcons
// CityBuildingPlacement
// CityBuildOrderAsset
// CityData
// CityElement
// CityElementNeutralHandler
// CityEquipment
// CityJobLibrary
// CityLayoutTilePlacement
// CityLeaderElement
// CityListComponent
// CityListElement
// CityLoyaltyElement
// CityMetaBanners
// CityPlaceFinder
// CityResources
// CitySortableElement
// CityStatsElement
// CityStatus
// CityStorageSlot
// CityTasksData
// CityWindow
// CityZoneAbandon
// CityZoneGrowth
// CityZoneHelper
// CityZoneWorkerBase
// Clan
// ClanBanner
// ClanBannerLibrary
// ClanChiefElement
// ClanColorsLibrary
// ClanCustomizeWindow
// ClanData
// ClanElement
// ClanListComponent
// ClanListElement
// ClanManager
// ClanMembersContainer
// ClanStatsElement
// ClanTrait
// ClanTraitButton
// ClanTraitEditorButton
// ClanTraitGroupAsset
// ClanTraitGroupElement
// ClanTraitGroupLibrary
// ClanTraitLibrary
// ClanTraitsContainer
// ClanTraitsEditor
// ClanWindow
// ClickActionCallerAttribute
// ClickPowerActionCallerAttribute
// ClickQuitTheGame
// Cloud
// CloudAction
// CloudAsset
// CloudLibrary
// ColorArray
// ColorAsset
// ColorElement
// ColorLibrary
// ColorStyleAsset
// ColorStyleLibrary
// ColorTool
// ColorToolElement
// ColorType
// CombatAction
// CombatActionActor
// CombatActionActorTargetPosition
// CombatActionAsset
// CombatActionCheckStart
// CombatActionHolder
// CombatActionLibrary
// CombatActionPool
// CombatActionProjectile
// CommunicationAsset
// CommunicationLibrary
// CommunicationTopicAsset
// CommunicationTopicLibrary
// ComponentListBase`4
// Config
// ConsoleHelper
// ConsonantSeparator
// ConstantineConventer
// ConstructionCost
// ConstructionPlacement
// ContainerItemColor
// ControllableUnit
// ConwayLife
// ConwayType
// CoreSystemManager`2
// CoreSystemObject`1
// CornerAye
// CoroutineHelper
// CorruptedTreeObject
// CorruptedTreesManager
// CountUpOnClick
// CrabArm
// CrabBody
// CrabLeg
// CrabLegJoint
// CrabLegLimbPoint
// CrabLimb
// CrabLimbGroup
// CrabLimbItem
// CrabLimbState
// Crabzilla
// CreepWorkerMovementType
// CrowdinSettings
// CubeNode
// CubeNodeAssetData
// CubeNodeConnection
// CubeOverview
// Culture
// CultureBanner
// CultureBannerLibrary
// CultureBookButton
// CultureColorsLibrary
// CultureCustomizeWindow
// CultureData
// CultureElement
// CultureListComponent
// CultureListElement
// CultureManager
// CultureStatsElement
// CultureTrait
// CultureTraitButton
// CultureTraitEditorButton
// CultureTraitGroupAsset
// CultureTraitGroupElement
// CultureTraitGroupLibrary
// CultureTraitLibrary
// CultureTraitsContainer
// CultureTraitsEditor
// CultureWindow
// CursedSacrifice
// CursorSpeed
// CursorTooltipHelper
// CustomButtonSwitch
// CustomDataContainerConverter
// CustomDataContainer`1
// CustomizeWindow
// CustomJsonArrayWriter
// CustomTextureAtlas
// Date
// DeadAnimation
// DeadKingdom
// DebugActorsSpeed
// DebugAnimatedVariation
// DebugAnimationVariation
// DebugAvatarsWindow
// DebugButton
// DebugConfig
// DebugHighlight
// DebugHighlightContainer
// DebugIconOptionAction
// DebugKingdomButton
// DebugKingdomFoes
// DebugLayer
// DebugLayerCursor
// DebugLayerType
// DebugLocales
// DebugMemory
// DebugMessage
// DebugMessageFly
// DebugMusicBoxData
// DebugOption
// DebugTextGroupSystem
// DebugTool
// DebugToolAsset
// DebugToolAssetAction
// DebugToolLibrary
// DebugToolState
// DebugToolTextElement
// DebugToolType
// DebugToolUpdateDelegate
// DebugUiDrag
// DebugVariables
// DebugWorldText
// DebugZonesTool
// DecisionAction
// DecisionActionWeight
// DecisionAsset
// DecisionHelper
// DecisionsLibrary
// DelayedAction
// DelayedActionsManager
// DelegateConverter
// DelegateExtensions
// DeleteMapQueue
// DeleteWorldButton
// DepthGeneratorType
// Derp
// DictionaryExtensions
// DictionaryPool`2
// DiplomacyHelpers
// DiplomacyHelpersRebellion
// DiplomacyManager
// DiplomacyRelation
// DiplomacyRelationData
// DiplomacyState
// DisasterAction
// DisasterAsset
// DisasterLibrary
// DisasterType
// DiscordTracker
// DiscountData
// Discounts
// DivineLightState
// Docks
// DownloadCounterMapQueue
// DraggableLayoutElement
// Dragon
// DragonAsset
// DragonAssetContainer
// DragonState
// DragOrderContainer
// DragOrderElement
// DragSnapElement
// Drop
// DropAsset
// DropManager
// DropsAction
// DropsLibrary
// DropType
// DynamicActorSpriteCreatorUI
// DynamicColorPixelTool
// DynamicSpriteCreator
// DynamicSprites
// DynamicSpritesAsset
// DynamicSpritesConfig
// DynamicSpritesLibrary
// Earthquake
// EarthquakeType
// EasterEggBanner
// EditorHelper
// EffectAction
// EffectActionVector
// EffectAsset
// EffectDataRain
// EffectDivineLight
// EffectDragParticlesManager
// EffectFlyingY
// EffectHearts
// EffectInfinityCoin
// EffectParticlesCursor
// EffectParticlesCursorDelegate
// EffectsCamera
// EffectsLibrary
// Encryption
// EnemiesFinder
// EnemyFinderContainer
// EnemyFinderData
// EnumExtensions
// EnvironmentAction
// Epoch
// EquipmentAsset
// EquipmentBanner
// EquipmentButton
// EquipmentEditor
// EquipmentEditorButton
// EquipmentGrid
// EquipmentGroupElement
// EquipmentType
// ErrorWindow
// ExceptionHelpers
// ExitAction
// ExplosionChecker
// ExplosionFlash
// ExplosionMemoryData
// ExplosionsEffects
// FadeInOutAnimation
// FadeOutDelayed
// FamiliesColorsLibrary
// FamiliesNoItems
// Family
// FamilyBanner
// FamilyCustomizeWindow
// FamilyData
// FamilyElement
// FamilyListComponent
// FamilyListElement
// FamilyManager
// FamilyMembersContainer
// FamilyOriginElement
// FamilyParentsMode
// FamilysBannerLibrary
// FamilyStatsElement
// FamilyWindow
// FaveWorldButton
// FavoriteItemListComponent
// FavoriteItemListElement
// FavoriteItemSpriteSwitcher
// Favorites
// FavoriteUnitSpriteSwitcher
// FavoriteWorld
// FieldInfoExtensions
// FieldInfoList
// FieldInfoListItem
// Finder
// FingerTarget
// FireLayer
// Fireworks
// FlexibleOneRowGrid
// FloraSize
// FloraType
// FmodAction
// FontGetter
// ForcedFontStyle
// ForgotPasswordButton
// FPS
// FSoundTimer
// GameLanguageAsset
// GameLanguageData
// GameLanguageLibrary
// GameLoadedEvent
// GameObjectExtensions
// GameObjectZSorter
// GameplayReportData
// GameplayReportGenerator
// GameProgress
// GameProgressData
// GameStats
// GameStatsData
// GenderCount
// GeneAsset
// GeneAssetClickEvent
// GeneButton
// GeneDirection
// GeneEditor
// GeneLibrary
// GeneratedRoom
// GenerateLLMPrompt
// GeneratorTarget
// GeneratorTool
// GenericBannerLibrary
// GenericCustomizeWindow`3
// GenericTest
// GenericType
// GenomePart
// GetCurrentOnomasticsData
// GetEffectSprite
// GetEffectSpriteCount
// GetEffectSpritePosition
// GetEffectSpritePositionUI
// GetEffectSpriteRotationZ
// GetEffectSpriteRotationZUI
// GetEffectSpriteUI
// GetHitAction
// GetListOfObjectsFunc`4
// GetNextJobID
// Globals
// GlobusPreview
// GlowParticles
// GodFinger
// GodPower
// GoogleInterstitialAd
// GoogleMobileAdsLoader
// GoogleRewardAd
// GPGSIds
// GraphCategoriesContainer
// GraphCategoryGroup
// GraphCompareMetaObject
// GraphCompareMetaSelector
// GraphCompareWindow
// GraphController
// GraphHelpers
// GraphMetaType
// GraphTextTimeScale
// GraphTimeAsset
// GraphTimeLibrary
// GraphTimeScale
// GraphTimeScaleContainer
// GraphyCaller
// GreyGooLayer
// GroupSpriteObject
// GrowTypeSelector
// HandRendererTexturePreloader
// HappinessAsset
// HappinessBarIcon
// HappinessDelegateCalc
// HappinessHelper
// HappinessHistory
// HappinessLibrary
// HashSetActor
// HashSetBuilding
// HashSetExtensions
// HashSetMapRegion
// HashSetPool`1
// HashSetRegionLink
// HashSetTileZone
// HashSetWorldTile
// HeaderContainer
// Heat
// HeatRayEffect
// HelpButton
// HindiCorrector
// HistoryDataAsset
// HistoryDataLibrary
// HistoryGroupAsset
// HistoryGroupLibrary
// HistoryHud
// HistoryHudItem
// HorizontalToolbarArrow
// HotkeyAction
// HotkeyAsset
// HotkeyLibrary
// HotkeysLocalized
// HoveringBgIconManager
// HoveringBGIconsGetter
// HoveringIcon
// HoverState
// IAnimationFrames
// IAugmentationsEditor
// IAugmentationsWindow`1
// IBanner
// IBaseMetaBanners
// IBaseMono
// IBooksWindow
// IceTower
// IComponentList
// IconClickRotator
// IconGetter
// IconOutline
// IconRotationAnimation
// ICoreObject
// IDescription2Asset
// IDescriptionAsset
// IDraggable
// IEquipmentEditor
// IEquipmentWindow
// IHandRenderer
// IInterestingPeopleWindow
// ILibraryWithUnlockables
// IllustrationFadeIn
// ILoadable`1
// ILocalizedAsset
// ImageRotator
// IMetaObject
// IMetaWindow
// IMetaWithFamiliesWindow
// ImpulseReachResult
// IMultiLocalesAsset
// InAppManager
// InfoText
// InitAds
// InitLibraries
// InitStuff
// InputHelpers
// InsultStringGenerator
// InterestingPeopleElement
// InterestingPeopleTab
// IntExtensions
// IOSCheckTracking
// IPlotsEditor
// IPlotsWindow
// IRefreshElement
// IRichTracker
// IronSourceInterstitialAd
// IronSourceMobileAdsLoader
// IronSourceRewardAd
// IScrollWindowShowEvent
// IShakable
// IShouldRefreshWindow
// ISkipLocaleAsset
// IslandsCalculator
// IStatsElement
// Item
// ItemAsset
// ItemAssetLibrary`1
// ItemCrafting
// ItemData
// ItemGroupAsset
// ItemGroupLibrary
// ItemInHand
// ItemLibrary
// ItemManager
// ItemModAsset
// ItemModifierLibrary
// ItemRendering
// ItemTools
// ItemWindow
// ITraitsEditor`1
// ITraitsOwner`1
// ITraitWindow`2
// IWorldBoxAd
// JobAction
// JobAsset`2
// JobCityAsset
// JobConst
// JobManagerActors
// JobManagerBase`2
// JobManagerBuildings
// JobTesterAsset
// JobType
// JobUpdater
// Job`1
// JsonHelper
// KarpenkosPromo
// KeyValueField
// Kingdom
// KingdomAlliesContainer
// KingdomAsset
// KingdomBanner
// KingdomBannerLibrary
// KingdomCapitalElement
// KingdomCheckCache
// KingdomCitiesContainer
// KingdomColorsLibrary
// KingdomCustomizeWindow
// KingdomData
// KingdomDiplomacyContainer`3
// KingdomElement
// KingdomJob
// KingdomJobLibrary
// KingdomKingElement
// KingdomLibrary
// KingdomListComponent
// KingdomListElement
// KingdomManager
// KingdomMetaBanners
// KingdomOpinion
// KingdomStatsElement
// KingdomTrait
// KingdomTraitButton
// KingdomTraitEditorButton
// KingdomTraitGroupAsset
// KingdomTraitGroupElement
// KingdomTraitGroupLibrary
// KingdomTraitLibrary
// KingdomTraitsContainer
// KingdomTraitsEditor
// KingdomWarsContainer
// KingdomWindow
// KnowledgeAsset
// KnowledgeButtonLoader
// KnowledgeElement
// KnowledgeLibrary
// KnowledgeWindow
// Language
// LanguageBanner
// LanguageBannerLibrary
// LanguageCustomizeWindow
// LanguageData
// LanguageElement
// LanguageListComponent
// LanguageListElement
// LanguageManager
// LanguagesColorsLibrary
// LanguageStatsElement
// LanguageTrait
// LanguageTraitButton
// LanguageTraitEditorButton
// LanguageTraitGroupAsset
// LanguageTraitGroupElement
// LanguageTraitGroupLibrary
// LanguageTraitLibrary
// LanguageTraitsContainer
// LanguageTraitsEditor
// LanguageWindow
// LavaHelper
// LavaLayer
// LavaRenderer
// LegendaryBG
// LevelPreviewButton
// LibraryGetter
// LibraryMaterials
// LibraryWindow
// LightBlobData
// LightRenderer
// LinkDirection
// List
// ListAccessHelper
// ListComponentSetter
// ListElementPrefabGetter
// ListExtensions
// ListItemsFilter
// ListPoolExtensions
// ListPool`1
// ListSorters
// ListWindow
// ListWindowAsset
// ListWindowLibrary
// ListWindowStatistics
// LivingIcon
// LoadingScreen
// LoadingScreenOut
// LoadingScreenSheepAnimation
// LoadWorldButton
// LocaleGetter
// LocaleGroupAsset
// LocaleGroupChecker
// LocaleGroupLibrary
// LocalizationButton
// LocalizedText
// LocalizedTextManager
// LocalizedTextPrice
// LocusClickEvent
// LocusDot
// LocusElement
// LocusType
// LogHandler
// LogHandlerInit
// Login
// LoginData
// LogItem
// LogoButton
// LogText
// LongExtension
// LongJsonConverter
// LongListJsonConverter
// LongTextLoader
// LoyaltyAsset
// LoyaltyCalculator
// LoyaltyDelegateCalc
// LoyaltyLibrary
// Magnet
// MagnetThrow
// Map
// MapAction
// MapBorder
// MapBox
// MapChunk
// MapChunkManager
// MapDescription
// MapEdges
// MapGenerator
// MapGenSettingsAsset
// MapGenSettingsDelegate
// MapGenSettingsDelegateBool
// MapGenSettingsDelegateGet
// MapGenSettingsDelegateSet
// MapGenSettingsDelegateSwitch
// MapGenSettingsLibrary
// MapGenTemplate
// MapGenTemplateLibrary
// MapGenValues
// MapId
// MapLayer
// MapLoaderAction
// MapLoaderContainer
// MapMetaData
// MapName
// MapObjectType
// MapPreviewImage
// MapRegion
// MapShowMeta
// MapSizeAsset
// MapSizeLibrary
// MapSizeTextUpdater
// MapStats
// MapTag
// MapTagButton
// MapTagType
// MapTagWindow
// MapUploader
// MapUploadingWindow
// MapUploadReadyWindow
// MaskAutoEnabler
// MB
// MetaBanner
// MetaBannerElement
// MetaCheckUnitWindowAction
// MetaCustomization
// MetaCustomizationAsset
// MetaCustomizationColorLibrary
// MetaCustomizationComponent
// MetaCustomizationCounter
// MetaCustomizationLibrary
// MetaCustomizationOptionGet
// MetaCustomizationOptionSet
// MetaDialogueElement
// MetaGetter
// MetaHelper
// MetaIdGetter
// MetaIncreaseRenown
// MetaNeedsAndDialogueElement
// MetaNeedsElementBase
// MetaNeedsElementUnit
// MetaObjectCounter`2
// MetaObjectData
// MetaObjectWithTraits`2
// MetaObject`1
// MetaSelectedGetter
// MetaSelectedSetter
// MetaSpriteSwitcher
// MetaStatAction
// MetaSwitchButton
// MetaSwitchManager
// MetaSystemManager`2
// MetaTextReportAction
// MetaTextReportAsset
// MetaTextReportHelper
// MetaTextReportLibrary
// MetaTooltipShowAction
// MetaType
// MetaTypeAction
// MetaTypeAsset
// MetaTypeExtensions
// MetaTypeHistoryAction
// MetaTypeLibrary
// MetaTypeListAction
// MetaTypeListHasAction
// MetaTypeListPoolAction
// MetaUnitSetMetaForWindow
// MetaZoneClickAction
// MetaZoneDrawAction
// MetaZoneDynamicAction
// MetaZoneHighlightAction
// MetaZoneTooltipAction
// Meteorite
// MiniBench
// MinMax
// ModLoader
// MonthAsset
// MonthLibrary
// MoodAsset
// MoodLibrary
// MouseCursor
// MouseHoldAnimation
// MoveCamera
// MultiBannerPool
// MultiStackPool`1
// MusicAsset
// MusicAssetDelegate
// MusicBox
// MusicBoxContainerCivs
// MusicBoxContainerTiles
// MusicBoxContainerUnits
// MusicBoxDebug
// MusicBoxIdle
// MusicBoxLibrary
// MusicLayerPriority
// MusicState
// NameGenerator
// NameGeneratorAsset
// NameGeneratorCheck
// NameGeneratorChecks
// NameGeneratorFinalizer
// NameGeneratorLibrary
// NameGeneratorReplacer
// NameGeneratorReplacerKingdom
// NameGeneratorReplacers
// NameGeneratorTests
// NameInput
// NameplateAction
// NameplateAsset
// NameplateBase
// NameplateLibrary
// NameplateManager
// NameplateText
// NameSetAsset
// NameSetsLibrary
// NanoObject
// NanoObjectExtensions
// NapalmFlash
// NerveImpulseElement
// NeuralLayerAsset
// NeuralLayerAssetExtensions
// NeuralLayerLibrary
// NeuroLayer
// NeuronElement
// NeuronsOverview
// NotchMover
// NucleobaseHelper
// Nucleus
// NukeFlash
// NullableLongJsonConverter
// NullableLongListJsonConverter
// ObjectContainerAction`1
// ObjectContainer`1
// ObjectPoolGenericMono`1
// OnChange
// OnKnowledgeIconClick
// OnlineStats
// OnomasticsActionUpdate
// OnomasticsAsset
// OnomasticsAssetButton
// OnomasticsAssetType
// OnomasticsButtonAction
// OnomasticsCache
// OnomasticsCheckDelegate
// OnomasticsData
// OnomasticsDataGroup
// OnomasticsDropdown
// OnomasticsEvolutionAsset
// OnomasticsEvolutionLibrary
// OnomasticsEvolver
// OnomasticsLibrary
// OnomasticsNameMakerDelegate
// OnomasticsReplacerDelegate
// OnomasticsReportGenerator
// OnomasticsTab
// OnWorldLoadAction
// OpinionAsset
// OpinionDelegateCalc
// OpinionLibrary
// OptionAsset
// OptionBool
// OptionButton
// OptionsLibrary
// OptionType
// OrderedContractResolver
// ParallelHelper
// PassableZoneChecker
// PatchLogLoader
// PathFinderResult
// PathfinderTools
// PathFindingVisualiser
// PauseButton
// PerlinReplaceContainer
// PerlinReplaceOption
// PersonalityAsset
// PersonalityLibrary
// PhenotypeAsset
// PhenotypeLibrary
// PivotPresets
// Pixel
// PixelBag
// PixelBagManager
// PixelDetector
// PixelFlashEffects
// PlatformRemover
// PlayCounterMapQueue
// PlayerConfig
// PlayerConfigData
// PlayerControl
// PlayerNameInput
// PlayerOptionAction
// PlayerOptionData
// PlayInterstitialAd
// Plot
// PlotAction
// PlotActorDelegate
// PlotActorPlotDelegate
// PlotAsset
// PlotBanner
// PlotButton
// PlotCategoryAsset
// PlotCategoryLibrary
// PlotCheckerDelegate
// PlotData
// PlotDescription
// PlotEditorButton
// PlotElement
// PlotGroupElement
// PlotIconData
// PlotListComponent
// PlotListElement
// PlotManager
// PlotMembers
// PlotsEditor
// PlotsLibrary
// PlotStart
// PlotState
// PlotTryToStart
// PlotWindow
// Poop
// PopulationPyramidController
// PopulationPyramidItem
// PopulationPyramidRow
// PossessionActionMode
// PossessionModeButton
// PossessionUI
// PossessionUnitInfo
// PowerAction
// PowerActionType
// PowerActionWithID
// PowerButton
// PowerButtonClickAction
// PowerButtonSelector
// PowerButtonType
// PowerClockButton
// PowerLibrary
// PowerRank
// PowersTab
// PowerTabAction
// PowerTabActionCheck
// PowerTabAsset
// PowerTabController
// PowerTabGetter
// PowerTabLibrary
// PowerToggleAction
// PowerTracker
// PreciseLocale
// PrefabLibrary
// PrefabUnitElement
// PreloadHelpers
// PremiumElementsChecker
// PremiumUnlockAnimation
// PremiumWindow
// PreviewHelper
// PreviewUploader
// PrintLibrary
// PrintStep
// PrintTemplate
// ProfessionAsset
// ProfessionLibrary
// Projectile
// ProjectileAsset
// ProjectileData
// ProjectileLibrary
// ProjectileManager
// ProjectileState
// QualityChanger
// QuantumSprite
// QuantumSpriteAnimated
// QuantumSpriteArrows
// QuantumSpriteAsset
// QuantumSpriteCacheData
// QuantumSpriteCreate
// QuantumSpriteGroupSystem
// QuantumSpriteLibrary
// QuantumSpriteManager
// QuantumSpriteUpdater
// QuantumSpriteWithText
// QueueItem
// RainState
// RainSwitcherButton
// RandomArrayEnumerator`1
// RandomListEnumerator`1
// Randy
// Rarity
// RarityAsset
// RarityExtensions
// RarityLibrary
// RateCounter
// RateCounterData
// RateUsChecker
// RateUsRemover
// RectExtensions
// RectTransformExtensions
// RegionLink
// RegionLinkHashes
// RegionPathFinder
// RegionsContainer
// Register
// RegisterButton
// RegisterDetails
// RegisterQueue
// RegisterUsername
// Religion
// ReligionBanner
// ReligionBannerLibrary
// ReligionColorsLibrary
// ReligionCustomizeWindow
// ReligionData
// ReligionElement
// ReligionListComponent
// ReligionListElement
// ReligionManager
// ReligionStatsElement
// ReligionTrait
// ReligionTraitButton
// ReligionTraitEditorButton
// ReligionTraitGroupAsset
// ReligionTraitGroupElement
// ReligionTraitGroupLibrary
// ReligionTraitLibrary
// ReligionTraitsContainer
// ReligionTraitsEditor
// ReligionWindow
// RenderEffectCheck
// ReplacerAchievements
// ReplacerTutorialBear
// ReplacerWorldLawIllustration
// ReplacerWorldLawsCursed
// ReportMapQueue
// ReproductiveStrategy
// RequestHelper
// RequireCondition
// ResizeAction
// ResizeUIAction
// ResolutionDropdown
// ResourceAsset
// ResourceContainer
// ResourceEatAction
// ResourceLibrary
// ResourceThrowData
// ResourceThrowManager
// ResType
// RewardAnimation
// RewardAnimationState
// RewardedAds
// RewardedPower
// RewardPowerWindow
// RewardTester
// RewardUI
// RewardWindowController
// RoadGenerator
// RoadsCalculator
// RotateOnHover
// RotationDirection
// RulerEntry
// RunningIcon
// RunningIconCallback
// RunningIcons
// S3Manager
// Santa
// SantaAnimation
// SaveConverter
// SaveCustomData
// SavedMap
// SaveFileToImage
// SaveManager
// SaveSlotManager
// SaveSlotWindow
// SaveWindowIcons
// SaveWorldButton
// ScrollableButton
// ScrollableSlider
// ScrollRectExtended
// ScrollWindow
// ScrollWindowAction
// ScrollWindowNameAction
// SelectedKingdom
// SelectedMeta
// SelectedNano
// SelectedObjects
// SelectedUnit
// SelectedUnitClearEvent
// SelectedUnitRefresher`1
// SelectedUnitTab
// SemanticVersion
// SettingsWindow
// Sfx
// ShadowEditor
// ShadowEnabler
// SignalAction
// SignalAsset
// SignalBanCheckAction
// SignalLibrary
// SignalManager
// SignButton
// SignoutButton
// SimGlobalAsset
// SimGlobals
// SimObjectsZones
// SimpleMod
// SimSystemManager`2
// SingleAction`2
// SliderEndedEvent
// SliderExtended
// SliderPointerDownEvent
// SlotButtonCallback
// SlotDrawAmount
// Smoke
// SmoothLoader
// SocialType
// SortButton
// SortButtonAction
// SortButtonClearAction
// SortButtonContainer
// SortButtonState
// SortingTab
// SoundController
// SparkEffect
// SpawnEffect
// SpectateUnit
// SpellAsset
// SpellHolder
// SpellLibrary
// SplitPathStatus
// Spores
// SpriteAnimation
// SpriteAnimationSimple
// SpriteElement
// SpriteGetter
// SpriteGroupSystem`1
// SpritePool
// SpriteSet
// SpriteShadow
// SpriteSortingHelper
// SpriteSwitcher
// SpriteTextureLoader
// StackEffects
// StackPool`1
// StatBar
// StatBarUpdated
// StatIconDarkToggle
// StatisticsAsset
// StatisticsLibrary
// StatisticsLongAction
// StatisticsRows
// StatisticsStringAction
// StatsHelper
// StatsIcon
// StatsIconContainer
// StatsRowsContainer
// StatsWindow
// StatTool
// Status
// StatusAsset
// StatusData
// StatusEffectButton
// StatusLibrary
// StatusManager
// StatusParticle
// StatusTier
// SteamAchievements
// SteamSDK
// SteamTracker
// StorageBooks
// StringBuilderPool
// StringExtension
// Subspecies
// SubspeciesActorBirthTraits
// SubspeciesBanner
// SubspeciesBannerLibrary
// SubspeciesBirthTraitsEditor
// SubspeciesColorsLibrary
// SubspeciesCustomizeWindow
// SubspeciesData
// SubspeciesElement
// SubspeciesListComponent
// SubspeciesListElement
// SubspeciesListFilter
// SubspeciesListWindow
// SubspeciesManager
// SubspeciesStatsElement
// SubspeciesTrait
// SubspeciesTraitButton
// SubspeciesTraitEditorButton
// SubspeciesTraitGroupAsset
// SubspeciesTraitGroupElement
// SubspeciesTraitGroupLibrary
// SubspeciesTraitLibrary
// SubspeciesTraitsContainer
// SubspeciesTraitsEditor
// SubspeciesWindow
// SuccessionTool
// SwitchButton
// SwitchWindowsAction
// SystemManager`2
// TabbedWindow
// TabHideAction
// TabShowAction
// TabToggle
// TabToggleAction
// TabToggleClearAction
// TabToggleContainer
// TabTogglesGroup
// TabToggleState
// TagButton
// TaskContainer`2
// TaskExtensions
// TaskSwitchAction
// TemperatureMod
// TempLinkStruct
// TerraformLibrary
// TerraformOptions
// TestActorGameObject
// TestActorSimpleObject
// TestEnum
// Tester
// TesterBehChangeWorldLaw
// TesterBehChangeWorldSpeed
// TesterBehCheckWorld
// TesterBehClearFavorites
// TesterBehClearWindowTest
// TesterBehClickRandomButton
// TesterBehCloseWindows
// TesterBehCopyCurrentLanguage
// TesterBehCullMobs
// TesterBehCullUnits
// TesterBehDestroySimObjects
// TesterBehEndAutoTester
// TesterBehEndJobTest
// TesterBehFillWorld
// TesterBehFindTileForCity
// TesterBehGenerateMap
// TesterBehLoadWorld
// TesterBehLog
// TesterBehOpenNextWindow
// TesterBehOpenWindow
// TesterBehOpenWindowTab
// TesterBehPause
// TesterBehPickRandomRace
// TesterBehRandomMetaSwitch
// TesterBehRandomWindowTab
// TesterBehRequire
// TesterBehRequireGroundRatio
// TesterBehRequireUnits
// TesterBehResetSeeds
// TesterBehResetTweens
// TesterBehRestartJobTest
// TesterBehRestartTask
// TesterBehSaveWorldIfEmpty
// TesterBehScreenshotFolder
// TesterBehScreenshotTooltips
// TesterBehScreenshotWindow
// TesterBehScrollWindow
// TesterBehSelectRandomMetaObjects
// TesterBehSetNextLanguage
// TesterBehSetResolution
// TesterBehSetupWindowTest
// TesterBehShutdown
// TesterBehSpawnPower
// TesterBehSpawnPowerActor
// TesterBehSpawnRandomBoat
// TesterBehSpawnRandomBomb
// TesterBehSpawnRandomBuilding
// TesterBehSpawnRandomCivUnit
// TesterBehSpawnRandomKingdomUnit
// TesterBehSpawnRandomPower
// TesterBehSpawnRandomSpecialUnit
// TesterBehSpawnRandomUnit
// TesterBehSpawnRandomZombie
// TesterBehSuperDamageToUnits
// TesterBehTaskLibrary
// TesterBehWait
// TesterBehWaitFor
// TesterBehWaitForYear
// TesterBehWaitYears
// TesterJobLibrary
// TesterMutateActorStatus
// TesterMutateActorTraits
// TesterMutateSubspeciesGenes
// TesterMutateSubspeciesTraits
// TestingCB
// TestingEvent
// TestingEventType
// TestMaps
// TestStage
// TextExtension
// TextSortingLayer
// Texture2DStorage
// TextureExtensions
// TextureRotator
// TextureScale
// ThreadHelper
// ThunderFlash
// TileActionLibrary
// TileDirection
// TileEffect
// TileEffectAsset
// TileEffectsLibrary
// TileIsland
// TileLayerType
// TileLibrary
// TileLibraryMain`1
// TileManager
// TilemapExtended
// TileRank
// TileSprites
// TileStepAction
// TileType
// TileTypeBase
// TileZIndexes
// TileZone
// TimelineInfo
// TipButton
// TipStatus
// ToggleButton
// ToggleButtonAction
// ToggleButtonSelectAction
// ToggleIcon
// ToggleObjects
// ToggleRainStateAction
// ToolbarArrow
// ToolbarButtons
// ToolBenchmarkData
// Toolbox
// Tooltip
// TooltipAction
// TooltipActorEquipmentsRow
// TooltipActorTraitsRow
// TooltipAsset
// TooltipClanTraitsRow
// TooltipCultureTraitsRow
// TooltipData
// TooltipDataGetter
// TooltipDebugHelper
// TooltipDirection
// TooltipIconsRow
// TooltipItemsRow`1
// TooltipKingdomTraitsRow
// TooltipLanguageTraitsRow
// TooltipLibrary
// TooltipModContainerInfo
// TooltipOpinionInfo
// TooltipOutlineItem
// TooltipReligionTraitsRow
// TooltipScreenshotState
// TooltipShowAction
// TooltipSpeciesSpawnTraitsRow
// TooltipSubspeciesTraitsRow
// TooltipTraitsRow`1
// TopicCheck
// TopicPotFill
// TopPremiumButtonMover
// TopTileLibrary
// TopTileType
// TornadoEffect
// TouchCamera
// TouchPossessionController
// TownPlans
// TrailerModeSettings
// TrailerMonolith
// TraitButton`1
// TraitEditorButton`2
// TraitGroupElement`3
// TraitsContainer`2
// TraitsEditor`5
// TraitsGrid
// TraitTools
// TraitType
// TransformExtensions
// Tutorial
// TutorialPage
// TweenedColoredText
// TweenExtensions
// TypeExtensions
// UFO
// UiActionElement
// UiAutoTesterButton
// UiButtonHoverAnimation
// UiCityEquipment
// UICityResources
// UiCreature
// UiDebugButton
// UiDebugButtonBatchSize
// UiDebugWindow
// UiGameStat
// UiGameStats
// UiInputCounter
// UiMover
// UiPanelInfo
// UiSizeDropdown
// UiUnitAvatarElement
// UiWindowStretch
// UiWorldAgeInfo
// UnfoldAction
// UnfoldButton
// UnfoldCheck
// UnitAvatarLoader
// UnitBarsElement
// UnitCityElement
// UnitElement
// UnitEquipmentContainer
// UnitFamilyOriginElement
// UnitGenealogyElement
// UnitHandToolAsset
// UnitHandToolLibrary
// UnitHealthBarElement
// UnitHouseElement
// UnitLayer
// UnitLoverElement
// UnitMetaBanners
// UnitProfession
// UnitSelectionEffect
// UnitSpawner
// UnitSpiteConstructorDebug
// UnitSpriteAnimationData
// UnitSpriteConstructorAtlas
// UnitStatsElement
// UnitStatusContainer
// UnitTextManager
// UnitTextPhrases
// UnitTextureAtlasID
// UnitWindow
// UnitySourceGeneratedAssemblyMonoScriptTypes_v1
// UnsafeCollectionPool`2
// UnsafeListPool`1
// UploadedMapDeleteManager
// UploadedMapDeleteProgressWindow
// UploadedMapDownloadCounter
// UploadedMapPlayCounter
// UploadedMapReportManager
// UploadedMapReportWindow
// UploadManager
// UploadMapQueue
// UserForgotPasswordWindow
// UserLoginWindow
// Username
// UserRegisterWindow
// UserSubscriptionWindow
// UtilityBasedDecisionSystem
// ValueHolder
// VegetationType
// VersionCallbacks
// VersionCheck
// VersionText
// VersionTextUpdater
// VertArrow
// VerticalToolbarArrow
// ViewRainfall
// ViewTemperature
// VortexAction
// VortexSwitchHelper
// VowelSeparator
// VS
// WallFrameContainer
// WallHelper
// War
// WarAttackersContainer
// WarBanner
// WarBannersContainer
// WarData
// WarDefendersContainer
// WarElement
// WarListComponent
// WarListElement
// WarManager
// WarStatsElement
// WarTooltipBannersContainer
// WarTypeAsset
// WarTypeLibrary
// WarWindow
// WarWinner
// WarWinnerExtensions
// WeaponType
// Wheat
// WhooshState
// WildKingdomsManager
// WindowAsset
// WindowBackground
// WindowFavorites
// WindowHeader
// WindowHistory
// WindowHistoryData
// WindowKeyboardHighlighter
// WindowLibrary
// WindowListBaseActor
// WindowListBase`3
// WindowListElementBaseActor
// WindowListElementBase`2
// WindowMetaElementBase
// WindowMetaElement`2
// WindowMetaGeneric`2
// WindowMetaTab
// WindowMetaTabButtonsContainer
// WindowMetaTabEvent
// WindowPreloader
// WindowPremiumRestoreHelper
// WindowStats
// WindowToolbar
// WindowWelcome
// WorkshopAchievements
// WorkshopEmptyListWindow
// WorkshopHelpers
// WorkshopInfoIcons
// WorkshopMapData
// WorkshopMapElement
// WorkshopMapListWindow
// WorkshopMapMetaData
// WorkshopMaps
// WorkshopOpenSteamWorkshop
// WorkshopPlayMap
// WorkshopUploadingWorldWindow
// WorkshopUploadProgress
// WorkshopUploadWorldButton
// World
// WorldAction
// WorldActionTrait
// WorldAgeAction
// WorldAgeAsset
// WorldAgeButton
// WorldAgeEffects
// WorldAgeElementAction
// WorldAgeLibrary
// WorldAgeManager
// WorldAgesParticles
// WorldAgesWindow
// WorldAgeWheel
// WorldAgeWheelPiece
// WorldBehaviour
// WorldBehaviourAction
// WorldBehaviourActionBiomes
// WorldBehaviourActionBurnedTiles
// WorldBehaviourActionCreepBiomass
// WorldBehaviourActionCreepDecay
// WorldBehaviourActionErosion
// WorldBehaviourActionFire
// WorldBehaviourActionInferno
// WorldBehaviourActionLava
// WorldBehaviourActions
// WorldBehaviourActionSingularity
// WorldBehaviourActionSwampAnimation
// WorldBehaviourAsset
// WorldBehaviourClouds
// WorldBehaviourLibrary
// WorldBehaviourOcean
// WorldBehaviourTileEffects
// WorldBehaviourTilesRunner
// WorldBehaviourTilesTemperatureFreeze
// WorldBehaviourTilesTemperatureFreezeWaves
// WorldBehaviourTilesTemperatureUnFreeze
// WorldBehaviourUnitTemperatures
// WorldButton
// WorldConstructionState
// WorldElement
// WorldLanguagesWindow
// WorldLawAsset
// WorldLawCategory
// WorldLawElement
// WorldLawGroupAsset
// WorldLawGroupLibrary
// WorldLawLibrary
// WorldLaws
// WorldLawsCursedStar
// WorldLawsCursedStars
// WorldLawsEditor
// WorldLawsTextInsult
// WorldLawsWindow
// WorldLayer
// WorldLayerEdges
// WorldListByTag
// WorldListWindow
// WorldLoader
// WorldLog
// WorldLogAsset
// WorldLogElement
// WorldLogLibrary
// WorldLogMessage
// WorldLogMessageExtensions
// WorldLogTextFormatter
// WorldLogWindow
// WorldNetVersion
// WorldNetWindow
// WorldObject
// WorldStats
// WorldStatsTabs
// WorldStatus
// WorldTemplateButton
// WorldTemplatesWindow
// WorldTile
// WorldTileContainer
// WorldTileData
// WorldTileDataStruct
// WorldTilemap
// WorldTileZoneBorder
// WorldTimer
// WorldTimeScaleAsset
// WorldTimeScaleLibrary
// WorldTip
// WorldWindow
// XtwitterText
// ZoneCalculator
// ZoneCamera
// ZoneConnection
// ZoneData
// ZoneFlash
// ZoneMetaData
// ZoneMetaDataVisualizer


using System;
using System.Collections.Generic;
using System.Runtime.CompilerServices;
using System.Threading.Tasks;
using ai;
using ai.behaviours;
using db;
using DG.Tweening;
using EpPathFinding.cs;
using life.taxi;
using tools.debug;
using UnityEngine;
using WorldBoxConsole;

// Token: 0x02000012 RID: 18
public class MapBox : MonoBehaviour
{
    // Token: 0x17000002 RID: 2
    // (get) Token: 0x06000048 RID: 72 RVA: 0x00004FAF File Offset: 0x000031AF
    internal LibraryMaterials library_materials
    {
        get
        {
            return LibraryMaterials.instance;
        }
    }

    // Token: 0x17000003 RID: 3
    // (get) Token: 0x06000049 RID: 73 RVA: 0x00004FB6 File Offset: 0x000031B6
    // (set) Token: 0x0600004A RID: 74 RVA: 0x00004FBE File Offset: 0x000031BE
    internal Camera camera { get; private set; }

    // Token: 0x17000004 RID: 4
    // (get) Token: 0x0600004B RID: 75 RVA: 0x00004FC7 File Offset: 0x000031C7
    // (set) Token: 0x0600004C RID: 76 RVA: 0x00004FCF File Offset: 0x000031CF
    internal MoveCamera move_camera { get; private set; }

    // Token: 0x17000005 RID: 5
    // (get) Token: 0x0600004D RID: 77 RVA: 0x00004FD8 File Offset: 0x000031D8
    // (set) Token: 0x0600004E RID: 78 RVA: 0x00004FE0 File Offset: 0x000031E0
    internal ZoneCamera zone_camera { get; private set; }

    // Token: 0x0600004F RID: 79 RVA: 0x00004FEC File Offset: 0x000031EC
    private void Awake()
    {
        MapBox.instance = this;
        this.player_control = new PlayerControl();
        this.parallel_options = new ParallelOptions
        {
            CancellationToken = base.destroyCancellationToken
        };
        this.auto_tester = Object.FindFirstObjectByType<AutoTesterBot>(FindObjectsInactive.Include);
        this.save_manager = base.GetComponentInChildren<SaveManager>();
        this.game_stats = base.GetComponentInChildren<GameStats>();
        this.tilemap = base.GetComponentInChildren<WorldTilemap>();
        this._map_border = base.GetComponentInChildren<MapBorder>();
        this.stack_effects = base.GetComponentInChildren<StackEffects>();
        this.resource_throw_manager = new ResourceThrowManager();
        this.heat_ray_fx = base.GetComponentInChildren<HeatRayEffect>();
        this.fx_divine_light = base.GetComponentInChildren<EffectDivineLight>();
        this.particles_fire = base.transform.Find("Particles Fire").GetComponent<GlowParticles>();
        this.particles_smoke = base.transform.Find("Particles Smoke").GetComponent<GlowParticles>();
        this._shake_camera = GameObject.Find("CameraShake").transform;
        Transform mainCanvas = GameObject.Find("Canvas Container Main").transform;
        this.canvas = mainCanvas.FindRecursive("Canvas - UI/General").GetComponent<Canvas>();
        this.transition_screen = mainCanvas.GetComponentInChildren<LoadingScreen>(true);
        this.console = mainCanvas.GetComponentInChildren<Console>(true);
        this.nameplate_manager = mainCanvas.GetComponentInChildren<NameplateManager>(true);
        this.tutorial = mainCanvas.GetComponentInChildren<Tutorial>(true);
        this.selected_buttons = mainCanvas.GetComponentInChildren<PowerButtonSelector>();
        MapBox.cursor_speed = new CursorSpeed();
        this._signal_manager = new SignalManager();
        this.joys = GameObject.Find("Joys");
        this.joys.gameObject.SetActive(false);
        this.magnet = new Magnet();
        this.islands_calculator = new IslandsCalculator();
        this.sim_object_zones = new SimObjectsZones();
        this._world_log = new WorldLog();
        this.quality_changer = base.GetComponent<QualityChanger>();
        this.transform_units = base.transform.FindRecursive("Units");
        this.stack_effects.create();
        this.tiles_dirty = new HashSet<WorldTile>();
        this.tiles_list = new WorldTile[0];
        this.tile_manager = new TileManager();
        this.drop_manager = new DropManager(base.transform.Find("Drops"));
        this._list_meta_main_managers.Add(this.subspecies = new SubspeciesManager());
        this._list_meta_main_managers.Add(this.families = new FamilyManager());
        this._list_meta_main_managers.Add(this.armies = new ArmyManager());
        this._list_meta_main_managers.Add(this.languages = new LanguageManager());
        this._list_meta_main_managers.Add(this.religions = new ReligionManager());
        this._list_meta_main_managers.Add(this.cities = new CitiesManager());
        this._list_meta_main_managers.Add(this.clans = new ClanManager());
        this._list_meta_main_managers.Add(this.alliances = new AllianceManager());
        this._list_meta_main_managers.Add(this.kingdoms = new KingdomManager());
        this._list_meta_main_managers.Add(this.kingdoms_wild = new WildKingdomsManager());
        this._list_meta_main_managers.Add(this.cultures = new CultureManager());
        this._list_meta_main_managers.Add(this.plots = new PlotManager());
        this._list_meta_main_managers.Add(this.wars = new WarManager());
        this._list_meta_main_managers.Add(this.items = new ItemManager());
        this._list_meta_other_managers.Add(this.books = new BookManager());
        this._list_meta_other_managers.Add(this.diplomacy = new DiplomacyManager());
        this._list_meta_other_managers.Add(this.projectiles = new ProjectileManager());
        this._list_meta_other_managers.Add(this.statuses = new StatusManager());
        this._list_sim_objects_managers.Add(this.units = new ActorManager());
        this._list_sim_objects_managers.Add(this.buildings = new BuildingManager());
        this.list_all_sim_managers.AddRange(this._list_sim_objects_managers);
        this.list_all_sim_managers.AddRange(this._list_meta_main_managers);
        this.list_all_sim_managers.AddRange(this._list_meta_other_managers);
        this.heat = new Heat();
        this.wind_direction = new Vector2(-0.1f, 0.2f);
        this.era_manager = new WorldAgeManager();
        this.delayed_actions_manager = new DelayedActionsManager();
        AssetManager.world_behaviours.createManagers();
        base.gameObject.AddOrGetComponent<MusicBox>();
        DOTween.SetTweensCapacity(1000, 100);
    }

    // Token: 0x06000050 RID: 80 RVA: 0x000054AC File Offset: 0x000036AC
    private void Start()
    {
        Application.lowMemory += AutoSaveManager.OnLowMemory;
        Application.lowMemory += PlayerConfig.turnOffAssetsPreloading;
        PlayerConfig.instance.start();
        this.explosion_checker = new ExplosionChecker();
        this.camera = Camera.main;
        this.move_camera = this.camera.GetComponent<MoveCamera>();
        this._initiated = true;
        this._map_layers = new List<MapLayer>();
        this._map_modules = new List<BaseModule>();
        this._map_layers.Add(this.world_layer = base.GetComponentInChildren<WorldLayer>());
        this._map_layers.Add(this.world_layer_edges = base.GetComponentInChildren<WorldLayerEdges>());
        this._world_layer_switch_effect = base.gameObject.transform.Find("world_layer_back").GetComponent<SpriteRenderer>();
        this._map_layers.Add(this.unit_layer = base.GetComponentInChildren<UnitLayer>());
        this._map_layers.Add(this.zone_calculator = base.GetComponentInChildren<ZoneCalculator>());
        this._map_layers.Add(this.burned_layer = base.GetComponentInChildren<BurnedTilesLayer>());
        this._map_layers.Add(this.explosion_layer = base.GetComponentInChildren<ExplosionsEffects>());
        this._map_layers.Add(this.conway_layer = base.GetComponentInChildren<ConwayLife>());
        this._map_layers.Add(this.fire_layer = base.GetComponentInChildren<FireLayer>());
        this._map_layers.Add(this._lava_layer = base.GetComponentInChildren<LavaLayer>());
        this._map_layers.Add(this._debug_layer = base.GetComponentInChildren<DebugLayer>());
        this._map_layers.Add(base.GetComponentInChildren<DebugLayerCursor>());
        this._map_layers.Add(this.path_finding_visualiser = base.GetComponentInChildren<PathFindingVisualiser>());
        this._map_layers.Add(this.flash_effects = base.GetComponentInChildren<PixelFlashEffects>());
        this._map_modules.Add(this.roads_calculator = base.GetComponentInChildren<RoadsCalculator>());
        this._map_modules.Add(this.grey_goo_layer = base.GetComponentInChildren<GreyGooLayer>());
        this.map_chunk_manager = new MapChunkManager();
        this.zone_camera = new ZoneCamera();
        if (Config.isComputer || Config.isEditor)
        {
            GameObject tPrefab = (GameObject)Resources.Load("effects/PrefabUnitSelectionEffect");
            this._unit_select_effect = Object.Instantiate<GameObject>(tPrefab, base.gameObject.transform).GetComponent<UnitSelectionEffect>();
            this._unit_select_effect.create();
        }
        this.addNewSystem(this._debug_text_group_system = new GameObject().AddComponent<DebugTextGroupSystem>());
        foreach (SpriteGroupSystem<GroupSpriteObject> spriteGroupSystem in this._list_systems)
        {
            spriteGroupSystem.create();
        }
    }

    // Token: 0x06000051 RID: 81 RVA: 0x00005798 File Offset: 0x00003998
    private void addNewSystem(SpriteGroupSystem<GroupSpriteObject> pSystem)
    {
        this._list_systems.Add(pSystem);
        pSystem.transform.parent = base.transform;
    }

    // Token: 0x06000052 RID: 82 RVA: 0x000057B7 File Offset: 0x000039B7
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public bool isGameplayControlsLocked()
    {
        return ScrollWindow.isWindowActive() || ScrollWindow.isAnimationActive() || RewardedAds.isShowing();
    }

    // Token: 0x06000053 RID: 83 RVA: 0x000057CE File Offset: 0x000039CE
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public bool isWindowOnScreen()
    {
        return ScrollWindow.isWindowActive() || ScrollWindow.isAnimationActive();
    }

    // Token: 0x06000054 RID: 84 RVA: 0x000057E0 File Offset: 0x000039E0
    internal bool calcPath(WorldTile pFrom, WorldTile pTargetTile, List<WorldTile> pSavePath)
    {
        pSavePath.Clear();
        StaticGrid tGrid = this._search_grid_ground;
        HeuristicMode tHeuristicMode = HeuristicMode.MANHATTAN;
        float tWeight = 2f;
        DiagonalMovement tDiagonalMovement;
        if (this.pathfinding_param.ocean)
        {
            tDiagonalMovement = DiagonalMovement.OnlyWhenNoObstacles;
        }
        else
        {
            if (this.pathfinding_param.limit)
            {
            }
            tDiagonalMovement = DiagonalMovement.Always;
        }
        int tMaxOpenList = -1;
        if (this.pathfinding_param.roads)
        {
            tWeight = 1f;
            tDiagonalMovement = DiagonalMovement.Never;
            tHeuristicMode = HeuristicMode.EUCLIDEAN;
        }
        tGrid.Reset();
        if (!pFrom.isSameIsland(pTargetTile) && !this.pathfinding_param.ocean)
        {
            pSavePath.Add(pFrom);
            pSavePath.Add(pTargetTile);
            this.path_finding_visualiser.showPath(tGrid, pSavePath);
            return true;
        }
        GridPos tStartPos = new GridPos(pFrom.pos.x, pFrom.pos.y);
        GridPos tEndPos = new GridPos(pTargetTile.pos.x, pTargetTile.pos.y);
        this.pathfinding_param.setGrid(tGrid, tStartPos, tEndPos);
        this.pathfinding_param.DiagonalMovement = tDiagonalMovement;
        this.pathfinding_param.SetHeuristic(tHeuristicMode);
        this.pathfinding_param.max_open_list = tMaxOpenList;
        this.pathfinding_param.weight = tWeight;
        AStarFinder.FindPath(this.pathfinding_param, pSavePath);
        this.path_finding_visualiser.showPath(tGrid, pSavePath);
        return pSavePath.Count != 0;
    }

    // Token: 0x06000055 RID: 85 RVA: 0x00005934 File Offset: 0x00003B34
    public void startTheGame(bool pForceGenerate = false)
    {
        LogText.log("MapBox", "startTheGame", "st");
        Randy.fullReset();
        Config.game_loaded = true;
        Config.current_brush = "circ_5";
        if (Config.isMobile)
        {
            PlayInterstitialAd.setActive(true);
        }
        Config.LOAD_TIME_CREATE = Time.realtimeSinceStartup;
        if (pForceGenerate || Config.load_new_map)
        {
            this.generateNewMap();
        }
        else if (Config.load_random_test_map)
        {
            TestMaps.loadNextMap();
        }
        else if (Config.load_dragon)
        {
            SaveManager.loadMapFromResources("mapTemplates/map_dragon");
        }
        else if (Config.load_save_on_start)
        {
            this._first_gen = false;
            string tPath = SaveManager.getSlotSavePath(Config.load_save_on_start_slot);
            this.save_manager.loadWorld(tPath, false);
        }
        else if (Config.load_save_from_path)
        {
            SaveManager.loadMapFromResources(Config.load_test_save_path);
        }
        else if (Config.load_test_map)
        {
            DebugMap.makeDebugMap();
        }
        else
        {
            string day = "";
            try
            {
                day = DateTime.Now.ToString("MM/dd");
            }
            catch (Exception)
            {
                day = "";
            }
            if (day == "04/01")
            {
                SaveManager.loadMapFromResources("mapTemplates/map_april_fools");
            }
            else if (FavoriteWorld.hasFavoriteWorldSet(true))
            {
                int favorite_world = PlayerConfig.instance.data.favorite_world;
                FavoriteWorld.cacheSaveSlotID(favorite_world);
                FavoriteWorld.clearFavoriteWorld();
                this._first_gen = false;
                string tPath2 = SaveManager.getSlotSavePath(favorite_world);
                this.save_manager.loadWorld(tPath2, false);
            }
            else if (this.game_stats.data.gameLaunches <= 3L)
            {
                SaveManager.loadMapFromResources("mapTemplates/map_dragon");
            }
            else
            {
                this.generateNewMap();
                SmoothLoader.add(delegate
                {
                    this.buildings.addBuilding("volcano", this.GetTile(MapBox.width / 2, MapBox.height / 2), false, false, BuildPlacingType.New);
                }, "add_volcano", false, 0.001f, false);
                SmoothLoader.add(delegate
                {
                    WorldTile topLeft = this.GetTile(0, MapBox.height - 1);
                    WorldTile topRight = this.GetTile(MapBox.width - 1, MapBox.height - 1);
                    WorldTile bottomLeft = this.GetTile(0, 0);
                    WorldTile bottomRight = this.GetTile(MapBox.width - 1, 0);
                    this.units.spawnNewUnit("angle", topLeft, false, false, 6f, null, false).data.setName("DAB");
                    this.units.spawnNewUnit("angle", topRight, false, false, 6f, null, false).data.setName("ABC");
                    this.units.spawnNewUnit("angle", bottomLeft, false, false, 6f, null, false).data.setName("BCD");
                    this.units.spawnNewUnit("angle", bottomRight, false, false, 6f, null, false).data.setName("CDA");
                }, "spawn_angles", false, 0.001f, false);
            }
        }
        SmoothLoader.add(new MapLoaderAction(this.addLastStep), "Prepare Game Launch", false, 0.001f, false);
    }

    // Token: 0x06000056 RID: 86 RVA: 0x00005B1C File Offset: 0x00003D1C
    private void addLastStep()
    {
        SmoothLoader.add(delegate
        {
            Config.LOAD_TIME_GENERATE = Time.realtimeSinceStartup;
            base.GetComponent<SpriteRenderer>().enabled = true;
            this.nameplate_manager.gameObject.SetActive(true);
            FavoriteWorld.restoreCachedFavoriteWorldOnSuccess();
            if (!Config.disable_startup_window)
            {
                if (PlayerConfig.instance.data.tutorialFinished || Config.disable_tutorial)
                {
                    ScrollWindow.get("welcome").forceShow();
                }
                else
                {
                    this.tutorial.startTutorial();
                }
            }
            PremiumElementsChecker.checkElements();
            MonoBehaviour.print("LOAD TIME INIT: " + Config.LOAD_TIME_INIT.ToString());
            MonoBehaviour.print("LOAD TIME CREATE: " + (Config.LOAD_TIME_CREATE - Config.LOAD_TIME_INIT).ToString());
            MonoBehaviour.print("LOAD TIME GENERATE: " + (Config.LOAD_TIME_GENERATE - Config.LOAD_TIME_CREATE).ToString());
            LogText.log("MapBox", "startTheGame", "en");
        }, "Start the Game", false, 0.001f, true);
    }

    // Token: 0x06000057 RID: 87 RVA: 0x00005B3B File Offset: 0x00003D3B
    private void afterLoadEvent()
    {
        Debug.Log("afterLoadEvent--------------------------");
        PremiumElementsChecker.checkElements();
    }

    // Token: 0x06000058 RID: 88 RVA: 0x00005B4C File Offset: 0x00003D4C
    internal void centerCamera()
    {
        Vector3 tVec = this.camera.transform.position;
        tVec.x = (float)(MapBox.width / 2);
        tVec.y = (float)(MapBox.height / 2);
        this.camera.transform.position = tVec;
        this.move_camera.resetZoom();
    }

    // Token: 0x06000059 RID: 89 RVA: 0x00005BA4 File Offset: 0x00003DA4
    private void resetTiles()
    {
        StaticGrid search_grid_ground = this._search_grid_ground;
        if (search_grid_ground != null)
        {
            search_grid_ground.Reset();
        }
        WorldTile[] array = this.tiles_list;
        for (int i = 0; i < array.Length; i++)
        {
            array[i].clear();
        }
        this.tiles_dirty.Clear();
        this.tilemap.clear();
    }

    // Token: 0x0600005A RID: 90 RVA: 0x00005BF8 File Offset: 0x00003DF8
    private void clearTiles()
    {
        StaticGrid search_grid_ground = this._search_grid_ground;
        if (search_grid_ground != null)
        {
            search_grid_ground.Dispose();
        }
        this._search_grid_ground = null;
        this.zone_calculator.clean();
        this.map_chunk_manager.clean();
        WorldTile[] array = this.tiles_list;
        for (int k = 0; k < array.Length; k++)
        {
            array[k].Dispose();
        }
        this.tiles_list = new WorldTile[0];
        for (int i = 0; i < MapBox.width; i++)
        {
            for (int j = 0; j < MapBox.height; j++)
            {
                this.tiles_map[i, j] = null;
            }
        }
        this.tiles_map = null;
        this.tiles_dirty.Clear();
        this.tilemap.clear();
    }

    // Token: 0x0600005B RID: 91 RVA: 0x00005CA8 File Offset: 0x00003EA8
    private void createTiles()
    {
        SmoothLoader.add(delegate
        {
            this.tiles_list = new WorldTile[MapBox.width * MapBox.height];
            this.tiles_map = new WorldTile[MapBox.width, MapBox.height];
            GeneratorTool.Setup(this.tiles_map);
        }, "Prepare Tiles", false, 0.001f, false);
        SmoothLoader.add(delegate
        {
            MapBox._tile_id = 0;
            for (int y = 0; y < MapBox.height; y++)
            {
                for (int x = 0; x < MapBox.width; x++)
                {
                    WorldTile tTile = new WorldTile(x, y, MapBox._tile_id);
                    this._search_grid_ground.SetTileNode(x, y, tTile);
                    this.tiles_map[x, y] = tTile;
                    this.tiles_list[MapBox._tile_id] = tTile;
                    MapBox._tile_id++;
                }
            }
        }, "Create Tiles (" + (MapBox.height * MapBox.width).ToString() + ")", true, 0.001f, false);
        SmoothLoader.add(delegate
        {
            int num = this.tiles_list.Length;
        }, "Create Neighbours [" + (MapBox.height * MapBox.width).ToString() + "] (1/3)", true, 0.001f, false);
        SmoothLoader.add(delegate
        {
            int tCount = this.tiles_list.Length;
            for (int i = 0; i < tCount; i++)
            {
                this.tiles_list[i].resetNeighbourLists();
            }
        }, "Create Neighbours [" + (MapBox.height * MapBox.width).ToString() + "] (2/3)", true, 0.001f, false);
        SmoothLoader.add(delegate
        {
            GeneratorTool.GenerateTileNeighbours(this.tiles_list);
        }, "Create Neighbours [" + (MapBox.height * MapBox.width).ToString() + "] (3/3)", true, 0.001f, false);
        SmoothLoader.add(delegate
        {
            this.zone_calculator.generate();
            WorldBehaviourActionFire.prepare();
        }, "Create Zones", true, 0.001f, false);
        SmoothLoader.add(delegate
        {
            this.map_chunk_manager.prepare();
        }, "Create Chunks", true, 0.001f, false);
    }

    // Token: 0x0600005C RID: 92 RVA: 0x00005DF4 File Offset: 0x00003FF4
    public static AttackDataResult newAttack(AttackData pData)
    {
        if (pData.hit_tile == null)
        {
            return new AttackDataResult(ApplyAttackState.Continue, -1L);
        }
        int tTargets = pData.targets;
        AttackDataResult tAttackResult = new AttackDataResult(ApplyAttackState.Continue, -1L);
        if (pData.target != null)
        {
            tAttackResult = MapBox.checkAttackFor(pData, pData.target);
            ApplyAttackState state = tAttackResult.state;
            if (state != ApplyAttackState.Hit)
            {
                if (state - ApplyAttackState.Block <= 1)
                {
                    return tAttackResult;
                }
            }
            else
            {
                tTargets--;
            }
            if (tTargets == 0)
            {
                return tAttackResult;
            }
        }
        if (tTargets == 0)
        {
            return tAttackResult;
        }
        List<BaseSimObject> tList = EnemiesFinder.findEnemiesFrom(pData.hit_tile, pData.kingdom, 0).list;
        if (tList == null)
        {
            return tAttackResult;
        }
        foreach (BaseSimObject tObject in tList.LoopRandom<BaseSimObject>())
        {
            if (tObject != pData.target)
            {
                if (tTargets == 0)
                {
                    break;
                }
                tAttackResult = MapBox.checkAttackFor(pData, tObject);
                ApplyAttackState state = tAttackResult.state;
                if (state != ApplyAttackState.Hit)
                {
                    if (state - ApplyAttackState.Block <= 1)
                    {
                        return tAttackResult;
                    }
                }
                else
                {
                    tTargets--;
                }
            }
        }
        return tAttackResult;
    }

    // Token: 0x0600005D RID: 93 RVA: 0x00005EF4 File Offset: 0x000040F4
    public static AttackDataResult checkAttackFor(AttackData pData, BaseSimObject pTargetToCheck)
    {
        if (pTargetToCheck.isRekt())
        {
            return AttackDataResult.Continue;
        }
        if (pData.initiator.isRekt())
        {
            return AttackDataResult.Continue;
        }
        if (pTargetToCheck == pData.initiator)
        {
            return AttackDataResult.Continue;
        }
        if (!pData.initiator.canAttackTarget(pTargetToCheck, true))
        {
            return AttackDataResult.Continue;
        }
        if (pTargetToCheck.isActor() && pTargetToCheck.hasStatus("dodge"))
        {
            return AttackDataResult.Continue;
        }
        Vector3 tTargetCurrentPosition = pTargetToCheck.current_position;
        float num = Toolbox.SquaredDist(tTargetCurrentPosition.x, tTargetCurrentPosition.y + pTargetToCheck.getHeight(), pData.hit_position.x, pData.hit_position.y + pData.hit_position.z);
        float tRange = pData.area_of_effect + pTargetToCheck.stats["size"];
        tRange *= tRange;
        if (num < tRange)
        {
            Vector3.MoveTowards(pData.hit_position, tTargetCurrentPosition, pTargetToCheck.stats["size"] * 0.9f).y += pTargetToCheck.getHeight();
            AttackDataResult attackDataResult = MapBox.applyAttack(pData, pTargetToCheck);
            if (attackDataResult.state == ApplyAttackState.Hit)
            {
                Vector3 tEffectPos = pData.hit_position;
                tEffectPos.y += tEffectPos.z;
                if (pData.critical)
                {
                    EffectsLibrary.spawnAt("fx_hit_critical", tEffectPos, 0.1f);
                    return attackDataResult;
                }
                EffectsLibrary.spawnAt("fx_hit", tEffectPos, 0.1f);
            }
            return attackDataResult;
        }
        return AttackDataResult.Miss;
    }

    // Token: 0x0600005E RID: 94 RVA: 0x00006058 File Offset: 0x00004258
    private static AttackDataResult applyAttack(AttackData pData, BaseSimObject pTargetToCheck)
    {
        bool tIsTargetActor = pTargetToCheck.isActor();
        Actor tTargetActor = pTargetToCheck.a;
        ProjectileAsset tProjectileAsset = null;
        if (pData.is_projectile)
        {
            tProjectileAsset = AssetManager.projectiles.get(pData.projectile_id);
        }
        if (tIsTargetActor && ControllableUnit.isControllingUnit(tTargetActor) && tTargetActor.hasMeleeAttack() && tTargetActor.isJustAttacked())
        {
            CombatActionLibrary.combat_action_deflect.action_actor(pTargetToCheck.a, pData, 0f, 0f);
            return new AttackDataResult(ApplyAttackState.Deflect, pTargetToCheck.a.data.id);
        }
        CombatActionAsset tCombatAsset;
        if (tIsTargetActor && tTargetActor.tryToUseAdvancedCombatAction(tTargetActor.getCombatActionPool(CombatActionPool.BEFORE_HIT_DEFLECT), null, out tCombatAsset))
        {
            tCombatAsset.action_actor(pTargetToCheck.a, pData, 0f, 0f);
            return new AttackDataResult(ApplyAttackState.Deflect, pTargetToCheck.a.data.id);
        }
        bool tCanBeBlocked = false;
        if (tProjectileAsset != null && tProjectileAsset.can_be_blocked)
        {
            tCanBeBlocked = true;
        }
        if (tCanBeBlocked && tIsTargetActor && tTargetActor.tryToUseAdvancedCombatAction(tTargetActor.getCombatActionPool(CombatActionPool.BEFORE_HIT_BLOCK), null, out tCombatAsset))
        {
            tCombatAsset.action_actor(pTargetToCheck.a, pData, 0f, 0f);
            return AttackDataResult.Block;
        }
        if (tIsTargetActor && tTargetActor.tryToUseAdvancedCombatAction(tTargetActor.getCombatActionPool(CombatActionPool.BEFORE_HIT), null, out tCombatAsset))
        {
            tCombatAsset.action_actor(tTargetActor, pData, 0f, 0f);
            return AttackDataResult.Continue;
        }
        int tDamage = (int)Randy.randomFloat(pData.damage_range * (float)pData.damage, (float)pData.damage);
        if (pData.critical)
        {
            tDamage *= pData.critical_damage_multiplier;
        }
        if (pData.initiator.isActor() && pTargetToCheck.isAlive())
        {
            pData.initiator.a.addExperience(2);
        }
        float pDamage = (float)tDamage;
        bool pFlash = true;
        AttackType attack_type = pData.attack_type;
        BaseSimObject initiator = pData.initiator;
        bool metallic_weapon = pData.metallic_weapon;
        pTargetToCheck.getHit(pDamage, pFlash, attack_type, initiator, pData.skip_shake, metallic_weapon, true);
        if (!pTargetToCheck.hasHealth())
        {
            ActorTool.applyForceToUnit(pData, pTargetToCheck, 1f, false);
        }
        else
        {
            ActorTool.applyForceToUnit(pData, pTargetToCheck, 0.5f, true);
        }
        if (pData.initiator.isActor())
        {
            pData.initiator.a.attackTargetActions(pTargetToCheck, pData.hit_tile);
        }
        if (tIsTargetActor && pData.initiator.isActor() && !pTargetToCheck.hasHealth() && pData.initiator.a.needsFood() && pData.initiator.a.subspecies.diet_meat && tTargetActor.asset.source_meat)
        {
            pData.initiator.a.addNutritionFromEating(70, true, false);
            pData.initiator.a.countConsumed();
        }
        return AttackDataResult.Hit;
    }

    // Token: 0x0600005F RID: 95 RVA: 0x000062E6 File Offset: 0x000044E6
    public void clearArchitectMood()
    {
        this._cached_architect_mood = null;
    }

    // Token: 0x06000060 RID: 96 RVA: 0x000062F0 File Offset: 0x000044F0
    public void clearWorld()
    {
        this.clearArchitectMood();
        MapBox.current_world_seed_id++;
        DBInserter.Lock();
        this.tile_manager.clear();
        CursedSacrifice.reset();
        LogText.log("MapBox", "clearWorld", "st");
        AutoTesterBot autoTesterBot = this.auto_tester;
        if (autoTesterBot != null)
        {
            autoTesterBot.clearWorld();
        }
        Analytics.worldLoading();
        SelectedUnit.clear();
        ControllableUnit.clear(true);
        DBManager.clearAndClose();
        this.explosion_checker.clear();
        BattleKeeperManager.clear();
        ZoneMetaDataVisualizer.clear();
        Finder.clear();
        this._debug_layer.clear();
        this.selected_buttons.unselectAll();
        this.player_control.clear();
        MusicBox.clearAllSounds();
        this.clearFrameCaches();
        EnemiesFinder.disposeAll();
        TaxiManager.clear();
        this.islands_calculator.clear();
        RegionLinkHashes.clear();
        this.nameplate_manager.clear();
        this.map_chunk_manager.clearAll();
        this.islands_calculator.clear();
        this.quality_changer.reset();
        this.tilemap.clear();
        this.zone_camera.clear();
        Config.paused = false;
        if (DebugConfig.isOn(DebugOption.PauseOnStart))
        {
            Config.paused = true;
        }
        this.selected_buttons.checkToggleIcons();
        this.heat.clear();
        this.era_manager.clear();
        this.delayed_actions_manager.clear();
        foreach (TileType tileType in AssetManager.tiles.list)
        {
            tileType.hashsetClear();
        }
        foreach (TopTileType topTileType in AssetManager.top_tiles.list)
        {
            topTileType.hashsetClear();
        }
        foreach (WorldBehaviourAsset worldBehaviourAsset in AssetManager.world_behaviours.list)
        {
            worldBehaviourAsset.manager.clear();
        }
        WildKingdomsManager.neutral.clearListCities();
        AutoSaveManager.resetAutoSaveTimer();
        AssetManager.actor_library.clear();
        AssetManager.buildings.clear();
        BehaviourActionActor.clear();
        this.city_zone_helper.clear();
        this.region_path_finder.clear();
        Toolbox.clearAll();
        this.drop_manager.clear();
        this.armies.clear();
        foreach (BaseSystemManager baseSystemManager in this.list_all_sim_managers)
        {
            baseSystemManager.clear();
        }
        this.particles_fire.clear();
        this.particles_smoke.clear();
        this.stack_effects.clear();
        TornadoEffect.Clear();
        this.resource_throw_manager.clear();
        foreach (MapLayer mapLayer in this._map_layers)
        {
            mapLayer.clear();
        }
        foreach (BaseModule baseModule in this._map_modules)
        {
            baseModule.clear();
        }
        this.sim_object_zones.reset(true);
        this.resetTiles();
        this.world_layer_edges.clear();
        WorldBehaviourActionFire.clearFires();
        HistoryHud.instance.Clear();
        DBInserter.Unlock();
        DBManager.clearAndClose();
        LogText.log("MapBox", "clearWorld", "en");
    }

    // Token: 0x06000061 RID: 97 RVA: 0x000066A8 File Offset: 0x000048A8
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public WorldTile GetTile(int pX, int pY)
    {
        if (pX < 0 || pX >= MapBox.width || pY < 0 || pY >= MapBox.height)
        {
            return null;
        }
        return this.tiles_map[pX, pY];
    }

    // Token: 0x06000062 RID: 98 RVA: 0x000066D1 File Offset: 0x000048D1
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public WorldTile GetTileSimple(int pX, int pY)
    {
        return this.tiles_map[pX, pY];
    }

    // Token: 0x06000063 RID: 99 RVA: 0x000066E0 File Offset: 0x000048E0
    public void setMapSize(int pWidth, int pHeight)
    {
        Config.ZONE_AMOUNT_X = pWidth;
        Config.ZONE_AMOUNT_Y = pHeight;
        MapBox.width = Config.ZONE_AMOUNT_X * 64;
        MapBox.height = Config.ZONE_AMOUNT_Y * 64;
        int tTotalTiles = MapBox.width * MapBox.height;
        if (this.tiles_list.Length != tTotalTiles)
        {
            this.recreateSizes();
        }
    }

    // Token: 0x06000064 RID: 100 RVA: 0x00006730 File Offset: 0x00004930
    private void afterTransitionGeneration()
    {
        this.generateNewMap();
    }

    // Token: 0x06000065 RID: 101 RVA: 0x00006738 File Offset: 0x00004938
    public void clickGenerateNewMap()
    {
        this.transition_screen.startTransition(new LoadingScreen.TransitionAction(this.afterTransitionGeneration));
    }

    // Token: 0x06000066 RID: 102 RVA: 0x00006754 File Offset: 0x00004954
    public void generateNewMap()
    {
        if (!this._initiated)
        {
            return;
        }
        if (Config.show_console_on_start)
        {
            this.console.Toggle();
        }
        SmoothLoader.prepare();
        SmoothLoader.add(delegate
        {
            LogText.log("MapBox", "generateNewMap", "st");
            Analytics.worldLoading();
            if (this._first_gen)
            {
                Config.customMapSize = Config.customMapSizeDefault;
            }
            if (!this._first_gen)
            {
                AchievementLibrary.achievementCustomWorld.check(null, null, null);
            }
            this._first_gen = false;
            int tSize = MapSizeLibrary.getSize(Config.customMapSize);
            this.addClearWorld(tSize, tSize);
        }, "Generate New Map (1/3)", false, 0.001f, false);
        SmoothLoader.add(delegate
        {
            Config.ZONE_AMOUNT_Y = (Config.ZONE_AMOUNT_X = MapSizeLibrary.getSize(Config.customMapSize));
        }, "Generate New Map (2/3)", false, 0.001f, false);
        SmoothLoader.add(delegate
        {
            this.setMapSize(Config.ZONE_AMOUNT_X, Config.ZONE_AMOUNT_Y);
        }, "Generate New Map (3/3)", false, 0.001f, false);
        SmoothLoader.add(delegate
        {
            LogText.log("MapBox", "GenerateMap", "st");
            AssetManager.tiles.setListTo(DepthGeneratorType.Generator);
            this.world_laws = new WorldLaws();
            this.world_laws.init(true);
        }, "gen: World Laws", false, 0.001f, false);
        SmoothLoader.add(delegate
        {
            this.map_stats = new MapStats();
            this.map_stats.initNewWorld();
            Randy.resetSeed(Randy.randomInt(1, 555555555));
        }, "gen: Generating Name", false, 0.001f, false);
        if (!Config.disable_db)
        {
            SmoothLoader.add(delegate
            {
                DBManager.createDB();
            }, "Creating Stats DB", false, 0.001f, false);
            DBTables.createOrMigrateTablesLoader(true);
        }
        WindowPreloader.addWaitForWindowResources();
        SmoothLoader.add(delegate
        {
            this.era_manager.setDefaultAges();
        }, "gen: World Ages", false, 0.001f, false);
        SmoothLoader.add(delegate
        {
            MapGenerator.prepare();
            LogText.log("MapBox", "GenerateMap", "en");
        }, "Preparing Map", true, 0.001f, false);
        SmoothLoader.add(delegate
        {
            this.cleanUpWorld(true);
        }, "Cleaning Up The World", true, 0.001f, false);
        SmoothLoader.add(delegate
        {
            this.redrawTiles();
        }, "Drawing Up The World", true, 0.001f, false);
        SmoothLoader.add(delegate
        {
            this.preloadRenderedSprites();
        }, "Preload rendered sprites...", false, 0.2f, false);
        SmoothLoader.add(delegate
        {
            this.finishMakingWorld();
            LogText.log("MapBox", "generateNewMap", "en");
        }, "Tidying Up The World", true, 0.001f, false);
        SmoothLoader.add(delegate
        {
            this.lastGC();
        }, "Rewriting The World", true, 0.001f, false);
        this.addLoadAutoTester();
        this.addKillAllUnits();
        this.addLoadWorldCallbacks();
        SmoothLoader.add(delegate
        {
            this.finishingUpLoading();
        }, "Finishing up...", false, 0.2f, false);
    }

    // Token: 0x06000067 RID: 103 RVA: 0x00006974 File Offset: 0x00004B74
    public void finishingUpLoading()
    {
        CanvasMain.instance.setMainUiEnabled(true);
    }

    // Token: 0x06000068 RID: 104 RVA: 0x00006984 File Offset: 0x00004B84
    public void preloadRenderedSprites()
    {
        foreach (Actor actor in this.units)
        {
            actor.checkSpriteToRender();
        }
        foreach (Building building in this.buildings)
        {
            building.checkSpriteToRender();
        }
    }

    // Token: 0x06000069 RID: 105 RVA: 0x00006A0C File Offset: 0x00004C0C
    public void addUnloadResources()
    {
        this._load_counter++;
        if (this._load_counter <= 5)
        {
            return;
        }
        this._load_counter = 0;
        SmoothLoader.add(delegate
        {
            Resources.UnloadUnusedAssets();
        }, "UnloadUnusedAssets", true, 0.001f, false);
    }

    // Token: 0x0600006A RID: 106 RVA: 0x00006A68 File Offset: 0x00004C68
    public void addClearWorld(int pNextWidth, int pNextHeight)
    {
        SmoothLoader.add(delegate
        {
            LogText.log("MapBox", "clearWorld", "st");
            this.clearWorld();
            LogText.log("MapBox", "clearWorld", "en");
        }, "Clearing World", true, 0.001f, false);
        DebugMemory.addMemorySnapshot("clearWorld");
        int num = pNextWidth * 64;
        int tHeightInTiles = pNextHeight * 64;
        int tTotalTiles = num * tHeightInTiles;
        if (this.tiles_list.Length != tTotalTiles)
        {
            SmoothLoader.add(delegate
            {
                this.clearTiles();
            }, "Clean old Tiles", false, 0.001f, false);
            DebugMemory.addMemorySnapshot("clearTiles");
        }
    }

    // Token: 0x0600006B RID: 107 RVA: 0x00006ADA File Offset: 0x00004CDA
    public void addKillAllUnits()
    {
        if (DebugConfig.isOn(DebugOption.KillAllUnitsOnLoad))
        {
            SmoothLoader.add(delegate
            {
                foreach (Actor actor in this.units)
                {
                    actor.dieAndDestroy(AttackType.None);
                }
            }, "Killing All Units", true, 0.001f, false);
        }
    }

    // Token: 0x0600006C RID: 108 RVA: 0x00006B02 File Offset: 0x00004D02
    public void addLoadAutoTester()
    {
        if (DebugConfig.isOn(DebugOption.TesterLibs))
        {
            SmoothLoader.add(delegate
            {
                if (!string.IsNullOrEmpty(Config.auto_test_on_start))
                {
                    this.auto_tester.create(Config.auto_test_on_start);
                    this.auto_tester.gameObject.SetActive(true);
                }
            }, "Loading Auto Tester", true, 0.001f, false);
        }
    }

    // Token: 0x0600006D RID: 109 RVA: 0x00006B2D File Offset: 0x00004D2D
    public void addLoadWorldCallbacks()
    {
        SmoothLoader.add(delegate
        {
            Config.debug_worlds_loaded++;
            Action action = MapBox.on_world_loaded;
            if (action == null)
            {
                return;
            }
            action();
        }, "World Loaded", true, 0.001f, false);
    }

    // Token: 0x0600006E RID: 110 RVA: 0x00006B5F File Offset: 0x00004D5F
    private void generateMap(string pType = "islands")
    {
    }

    // Token: 0x0600006F RID: 111 RVA: 0x00006B64 File Offset: 0x00004D64
    public void cleanUpWorld(bool pSetChunksDirty = true)
    {
        MapGenerator.clear();
        this.updateDirtyMetaContainersAndCleanup();
        this.era_manager.prepare();
        if (pSetChunksDirty)
        {
            this.map_chunk_manager.allDirty();
            this.map_chunk_manager.update(0f, true);
        }
        foreach (City city in this.cities)
        {
            city.forceDoChecks();
        }
        this.allTilesDirty();
        this.centerCamera();
    }

    // Token: 0x06000070 RID: 112 RVA: 0x00006BF0 File Offset: 0x00004DF0
    public void redrawTiles()
    {
        this._meta_skip = true;
        if (MusicBox.new_world_on_start_played)
        {
            MusicBox.reserveFlag("new_world", true);
        }
        this.tilemap.redrawTiles(true);
    }

    // Token: 0x06000071 RID: 113 RVA: 0x00006C18 File Offset: 0x00004E18
    public void finishMakingWorld()
    {
        ToolbarButtons toolbarButtons = ToolbarButtons.instance;
        if (toolbarButtons != null)
        {
            toolbarButtons.resetBar();
        }
        this.game_stats.data.mapsCreated += 1L;
        AchievementLibrary.achievementGen5Worlds.check(null, null, null);
        AchievementLibrary.achievementGen50Worlds.check(null, null, null);
        AchievementLibrary.achievementGen100Worlds.check(null, null, null);
        Analytics.worldLoaded();
        Config.LAST_LOAD_TIME = Time.realtimeSinceStartup;
    }

    // Token: 0x06000072 RID: 114 RVA: 0x00006C84 File Offset: 0x00004E84
    public void lastGC()
    {
        Config.forceGC("finish making world", false);
    }

    // Token: 0x06000073 RID: 115 RVA: 0x00006C94 File Offset: 0x00004E94
    private void recreateSizes()
    {
        SmoothLoader.add(delegate
        {
            this._search_grid_ground = new StaticGrid(MapBox.width, MapBox.height, null);
        }, "Recreate Sizes (1/4)", false, 0.001f, false);
        SmoothLoader.add(delegate
        {
            this.createTiles();
        }, "Recreate Sizes (2/4)", false, 0.001f, false);
        SmoothLoader.add(delegate
        {
            this.tile_manager.setup(MapBox.width, MapBox.height, this.tiles_map);
        }, "Tile Manager", true, 0.001f, false);
        for (int i = 0; i < this._map_layers.Count; i++)
        {
            int j = i;
            SmoothLoader.add(delegate
            {
                this._map_layers[j].createTextureNew();
            }, string.Concat(new string[]
            {
                "Recreate Sizes (3/4) (",
                (i + 1).ToString(),
                "/",
                this._map_layers.Count.ToString(),
                ")"
            }), false, 0.001f, false);
        }
        SmoothLoader.add(delegate
        {
            if (Globals.TRAILER_MODE)
            {
                Object.Destroy(this._map_border.gameObject);
                return;
            }
            this._map_border.generateTexture();
        }, "Recreate Sizes (4/4)", false, 0.001f, false);
    }

    // Token: 0x06000074 RID: 116 RVA: 0x00006D9F File Offset: 0x00004F9F
    public Actor getActorNearCursor()
    {
        return ActionLibrary.getActorNearPos(MapBox.instance.getMousePos());
    }

    // Token: 0x06000075 RID: 117 RVA: 0x00006DB0 File Offset: 0x00004FB0
    public Vector2 getMousePos()
    {
        return this.player_control.getMousePos();
    }

    // Token: 0x06000076 RID: 118 RVA: 0x00006DBD File Offset: 0x00004FBD
    public WorldTile getMouseTilePos()
    {
        return this.player_control.getMouseTilePos();
    }

    // Token: 0x06000077 RID: 119 RVA: 0x00006DCA File Offset: 0x00004FCA
    public bool isPointerInGame()
    {
        return this.player_control.isPointerInGame();
    }

    // Token: 0x06000078 RID: 120 RVA: 0x00006DD7 File Offset: 0x00004FD7
    public bool isPointerInsideMapBounds()
    {
        return this.getMouseTilePos() != null;
    }

    // Token: 0x06000079 RID: 121 RVA: 0x00006DE2 File Offset: 0x00004FE2
    public bool isOverUI()
    {
        return this.player_control.isOverUI(true);
    }

    // Token: 0x0600007A RID: 122 RVA: 0x00006DF0 File Offset: 0x00004FF0
    public bool isTouchOverUI(Touch pTouch)
    {
        return this.player_control.isTouchOverUI(pTouch);
    }

    // Token: 0x0600007B RID: 123 RVA: 0x00006DFE File Offset: 0x00004FFE
    public static bool controlsLocked()
    {
        return PlayerControl.controlsLocked();
    }

    // Token: 0x0600007C RID: 124 RVA: 0x00006E05 File Offset: 0x00005005
    public static bool isControllingUnit()
    {
        return PlayerControl.isControllingUnit();
    }

    // Token: 0x0600007D RID: 125 RVA: 0x00006E0C File Offset: 0x0000500C
    public bool isBusyWithUI()
    {
        return this.player_control.isBusyWithUI();
    }

    // Token: 0x0600007E RID: 126 RVA: 0x00006E19 File Offset: 0x00005019
    public bool isActionHappening()
    {
        return this.player_control.isActionHappening();
    }

    // Token: 0x0600007F RID: 127 RVA: 0x00006E28 File Offset: 0x00005028
    public void loopWithBrush(WorldTile pCenterTile, BrushData pBrush, PowerAction pAction, GodPower pPower = null)
    {
        BrushPixelData[] tPos = pBrush.pos;
        int tLen = tPos.Length;
        for (int i = 0; i < tLen; i++)
        {
            BrushPixelData tPixelData = tPos[i];
            int tX = pCenterTile.x + tPixelData.x;
            int tY = pCenterTile.y + tPixelData.y;
            if (tX >= 0 && tX < MapBox.width && tY >= 0 && tY < MapBox.height)
            {
                WorldTile tTile = MapBox.instance.GetTileSimple(tX, tY);
                pAction(tTile, pPower);
            }
        }
    }

    // Token: 0x06000080 RID: 128 RVA: 0x00006EA9 File Offset: 0x000050A9
    public void highlightTilesBrush(WorldTile pCenterTile, BrushData pBrush, PowerAction pAction, GodPower pPower = null)
    {
        this.loopWithBrush(pCenterTile, pBrush, pAction, pPower);
    }

    // Token: 0x06000081 RID: 129 RVA: 0x00006EB6 File Offset: 0x000050B6
    public void loopWithBrushPowerForDropsFull(WorldTile pCenterTile, BrushData pBrush, PowerAction pAction, GodPower pPower = null)
    {
        this.loopWithBrush(pCenterTile, pBrush, pAction, pPower);
    }

    // Token: 0x06000082 RID: 130 RVA: 0x00006EC4 File Offset: 0x000050C4
    public void loopWithBrushPowerForDropsRandom(WorldTile pCenterTile, BrushData pBrush, PowerAction pAction, GodPower pPower = null)
    {
        BrushPixelData[] tPos = pBrush.pos;
        int tLen = tPos.Length;
        using (ListPool<WorldTile> tListPool = new ListPool<WorldTile>())
        {
            for (int i = 0; i < tLen; i++)
            {
                BrushPixelData tPixelData = tPos[i];
                int tX = pCenterTile.x + tPixelData.x;
                int tY = pCenterTile.y + tPixelData.y;
                if (tX >= 0 && tX < MapBox.width && tY >= 0 && tY < MapBox.height)
                {
                    WorldTile tTile = MapBox.instance.GetTileSimple(tX, tY);
                    tListPool.Add(tTile);
                }
            }
            int tTotalDrops = pBrush.drops;
            tListPool.Shuffle<WorldTile>();
            for (int j = 0; j < tTotalDrops; j++)
            {
                if (tListPool.Count == 0)
                {
                    break;
                }
                WorldTile tTile2 = tListPool.Pop<WorldTile>();
                pAction(tTile2, pPower);
            }
        }
    }

    // Token: 0x06000083 RID: 131 RVA: 0x00006FA8 File Offset: 0x000051A8
    public void loopWithBrush(WorldTile pCenterTile, BrushData pBrush, PowerActionWithID pAction, string pPowerID = null)
    {
        BrushPixelData[] tPos = pBrush.pos;
        int tLen = tPos.Length;
        for (int i = 0; i < tLen; i++)
        {
            BrushPixelData tPixelData = tPos[i];
            int tX = pCenterTile.x + tPixelData.x;
            int tY = pCenterTile.y + tPixelData.y;
            if (tX >= 0 && tX < MapBox.width && tY >= 0 && tY < MapBox.height)
            {
                WorldTile tTile = MapBox.instance.GetTileSimple(tX, tY);
                pAction(tTile, pPowerID);
            }
        }
    }

    // Token: 0x06000084 RID: 132 RVA: 0x0000702C File Offset: 0x0000522C
    public void checkCityZone(WorldTile pTile)
    {
        if (pTile.zone.city == null)
        {
            return;
        }
        bool tBuildingsFound = false;
        HashSet<Building> tSet = pTile.zone.getHashset(BuildingList.Civs);
        if (tSet != null)
        {
            using (HashSet<Building>.Enumerator enumerator = tSet.GetEnumerator())
            {
                while (enumerator.MoveNext())
                {
                    if (enumerator.Current.city == pTile.zone.city)
                    {
                        tBuildingsFound = true;
                        break;
                    }
                }
            }
        }
        if (!tBuildingsFound)
        {
            pTile.zone.city.removeZone(pTile.zone);
        }
    }

    // Token: 0x06000085 RID: 133 RVA: 0x000070C4 File Offset: 0x000052C4
    public static void spawnLightningBig(WorldTile pTile, float pScale = 0.25f, Actor pActor = null)
    {
        BaseEffect tEffect = EffectsLibrary.spawnAtTile("fx_lightning_big", pTile, pScale);
        if (tEffect == null)
        {
            return;
        }
        int tRadius = (int)(pScale * 25f);
        MapAction.checkLightningAction(pTile.pos, tRadius);
        MapAction.damageWorld(pTile, tRadius, AssetManager.terraform.get("lightning_power"), pActor);
        tEffect.sprite_renderer.flipX = Randy.randomBool();
        MapAction.checkSantaHit(pTile.pos, tRadius);
        MapAction.checkUFOHit(pTile.pos, tRadius, pActor);
        MapAction.checkTornadoHit(pTile.pos, tRadius);
    }

    // Token: 0x06000086 RID: 134 RVA: 0x0000714C File Offset: 0x0000534C
    public static void spawnLightningMedium(WorldTile pTile, float pScale = 0.25f, Actor pActor = null)
    {
        BaseEffect tEffect = EffectsLibrary.spawnAtTile("fx_lightning_medium", pTile, pScale);
        if (tEffect == null)
        {
            return;
        }
        int tRadius = (int)(pScale * 15f);
        MapAction.checkLightningAction(pTile.pos, tRadius);
        MapAction.damageWorld(pTile, tRadius, AssetManager.terraform.get("lightning_normal"), pActor);
        tEffect.sprite_renderer.flipX = Randy.randomBool();
        MapAction.checkTornadoHit(pTile.pos, tRadius);
    }

    // Token: 0x06000087 RID: 135 RVA: 0x000071B8 File Offset: 0x000053B8
    public static void spawnLightningSmall(WorldTile pTile, float pScale = 0.25f, Actor pActor = null)
    {
        BaseEffect tEffect = EffectsLibrary.spawnAtTile("fx_lightning_small", pTile, pScale);
        if (tEffect == null)
        {
            return;
        }
        int tRadius = (int)(pScale * 10f);
        MapAction.checkLightningAction(pTile.pos, tRadius);
        MapAction.damageWorld(pTile, tRadius, AssetManager.terraform.get("lightning_normal"), pActor);
        tEffect.sprite_renderer.flipX = Randy.randomBool();
        MapAction.checkTornadoHit(pTile.pos, tRadius);
    }

    // Token: 0x06000088 RID: 136 RVA: 0x00007224 File Offset: 0x00005424
    public void applyForceOnTile(WorldTile pTile, int pRad = 10, float pForceAmount = 1.5f, bool pForceOut = true, int pDamage = 0, string[] pIgnoreKingdoms = null, BaseSimObject pByWho = null, TerraformOptions pOptions = null, bool pChangeHappiness = false)
    {
        int tRad = pRad * pRad;
        foreach (Actor tActor in Finder.getUnitsFromChunk(pTile, 1, 0f, false))
        {
            if (tActor != ((pByWho != null) ? pByWho.a : null) && (float)Toolbox.SquaredDistTile(tActor.current_tile, pTile) <= (float)tRad && (pOptions == null || !tActor.asset.very_high_flyer || pOptions.applies_to_high_flyers))
            {
                if (pIgnoreKingdoms != null)
                {
                    bool continueNext = false;
                    for (int i = 0; i < pIgnoreKingdoms.Length; i++)
                    {
                        Kingdom tKingdom = this.kingdoms_wild.get(pIgnoreKingdoms[i]);
                        if (tActor.kingdom == tKingdom)
                        {
                            continueNext = true;
                            break;
                        }
                    }
                    if (continueNext)
                    {
                        continue;
                    }
                }
                tActor.makeStunned(4f);
                if (pChangeHappiness)
                {
                    tActor.changeHappiness("just_forced_power", 0);
                }
                if (tActor.asset.can_be_hurt_by_powers && pDamage > 0)
                {
                    AttackType tAttackType = AttackType.Other;
                    if (pOptions != null)
                    {
                        tAttackType = pOptions.attack_type;
                    }
                    tActor.getHit((float)pDamage, true, tAttackType, pByWho, true, false, true);
                }
                if (pForceAmount > 0f)
                {
                    if (pForceOut)
                    {
                        tActor.calculateForce((float)tActor.current_tile.x, (float)tActor.current_tile.y, (float)pTile.x, (float)pTile.y, pForceAmount, 0f, true);
                    }
                    else
                    {
                        tActor.calculateForce((float)pTile.x, (float)pTile.y, (float)tActor.current_tile.x, (float)tActor.current_tile.y, pForceAmount, 0f, true);
                    }
                }
            }
        }
    }

    // Token: 0x06000089 RID: 137 RVA: 0x000073D0 File Offset: 0x000055D0
    internal void stopAttacksFor(bool pMonsters)
    {
        foreach (Actor tActor in this.units)
        {
            if (tActor.has_attack_target && tActor.isEnemyTargetAlive() && (tActor.kingdom.asset.mobs || tActor.attack_target.kingdom.asset.mobs) == pMonsters)
            {
                tActor.cancelAllBeh();
            }
        }
    }

    // Token: 0x0600008A RID: 138 RVA: 0x0000745C File Offset: 0x0000565C
    public void allDirty()
    {
        for (int i = 0; i < this.tiles_list.Length; i++)
        {
            WorldTile tTile = this.tiles_list[i];
            this.tiles_dirty.Add(tTile);
            this.tilemap.addToQueueToRedraw(tTile);
        }
    }

    // Token: 0x0600008B RID: 139 RVA: 0x0000749E File Offset: 0x0000569E
    private void OnApplicationFocus(bool pFocus)
    {
        this.has_focus = pFocus;
    }

    // Token: 0x0600008C RID: 140 RVA: 0x000074A7 File Offset: 0x000056A7
    private void OnApplicationPause(bool pPause)
    {
        this.has_focus = !pPause;
    }

    // Token: 0x0600008D RID: 141 RVA: 0x000074B3 File Offset: 0x000056B3
    private void OnApplicationQuit()
    {
        DOTween.KillAll(false);
    }

    // Token: 0x0600008E RID: 142 RVA: 0x000074BC File Offset: 0x000056BC
    private void updateShake(float pElapsed)
    {
        if (this._shake_timer == 0f)
        {
            return;
        }
        if (this._shake_timer > 0f)
        {
            this._shake_timer -= pElapsed;
        }
        if (this._shake_timer <= 0f)
        {
            this._shake_timer = 0f;
            this._shake_camera.position = new Vector3(0f, 0f);
            return;
        }
        if (this._shake_interval_timer > 0f)
        {
            this._shake_interval_timer -= pElapsed;
            return;
        }
        this._shake_interval_timer = this._shake_interval;
        Vector3 tVec = default(Vector3);
        if (this._shake_x)
        {
            tVec.x = Randy.randomFloat(-this._shake_intensity, this._shake_intensity);
        }
        if (this._shake_y)
        {
            tVec.y = Randy.randomFloat(-this._shake_intensity, this._shake_intensity);
        }
        this._shake_camera.position = tVec;
    }

    // Token: 0x0600008F RID: 143 RVA: 0x000075A3 File Offset: 0x000057A3
    public void startShake(float pDuration = 0.3f, float pInterval = 0.01f, float pIntensity = 2f, bool pShakeX = false, bool pShakeY = true)
    {
        this._shake_timer = pDuration;
        this._shake_interval = pInterval;
        this._shake_intensity = pIntensity;
        this._shake_x = pShakeX;
        this._shake_y = pShakeY;
    }

    // Token: 0x06000090 RID: 144 RVA: 0x000075CC File Offset: 0x000057CC
    private void updateMapLayers(float pElapsed)
    {
        Bench.bench("map_layers", "game_total", false);
        this.heat.update(pElapsed);
        this.map_chunk_manager.update(pElapsed, false);
        for (int i = 0; i < this._map_layers.Count; i++)
        {
            this._map_layers[i].update(pElapsed);
        }
        for (int j = 0; j < this._map_modules.Count; j++)
        {
            this._map_modules[j].update(pElapsed);
        }
        Bench.benchEnd("map_layers", "game_total", false, 0L, false);
    }

    // Token: 0x06000091 RID: 145 RVA: 0x00007667 File Offset: 0x00005867
    public float calculateCurElapsed()
    {
        return Time.fixedDeltaTime * Config.time_scale_asset.multiplier;
    }

    // Token: 0x06000092 RID: 146 RVA: 0x00007679 File Offset: 0x00005879
    private void clearFrameCaches()
    {
    }

    // Token: 0x06000093 RID: 147 RVA: 0x0000767B File Offset: 0x0000587B
    private void LateUpdate()
    {
        this.player_control.clearLateUpdate();
    }

    // Token: 0x06000094 RID: 148 RVA: 0x00007688 File Offset: 0x00005888
    private void Update()
    {
        FPS.update();
        if (!Config.game_loaded)
        {
            return;
        }
        Config.parallel_jobs_updater = DebugConfig.isOn(DebugOption.ParallelJobsUpdater);
        Bench.bench_ai_enabled = DebugConfig.isOn(DebugOption.BenchAiEnabled);
        if (SmoothLoader.isLoading())
        {
            if (DebugConfig.isOn(DebugOption.GenerateNewMapOnMapLoadingError))
            {
                try
                {
                    SmoothLoader.update(Time.deltaTime);
                    return;
                }
                catch (Exception message)
                {
                    Debug.LogError(message);
                    this.generateNewMap();
                    return;
                }
            }
            SmoothLoader.update(Time.deltaTime);
            return;
        }
        Randy.nextSeed();
        Bench.bench("game_total", "main", false);
        Bench.bench("move_camera", "game_total", false);
        this.move_camera.update();
        Bench.benchEnd("move_camera", "game_total", false, 0L, false);
        Bench.bench("mapbox_update_1", "game_total", false);
        this.stack_effects.light_blobs.Clear();
        this._signal_manager.update();
        this.clearFrameCaches();
        Config.updateCrashMetadata();
        PlayerConfig.instance.update();
        Tooltip.checkClearAll();
        CursorTooltipHelper.update();
        this.delta_time = Time.fixedDeltaTime;
        this.game_stats.updateStats(this.delta_time);
        this._is_paused = Config.paused || ScrollWindow.isWindowActive() || RewardedAds.isShowing();
        Bench.benchEnd("mapbox_update_1", "game_total", false, 0L, false);
        Bench.bench("battle_keeper", "game_total", false);
        BattleKeeperManager.update(this.delta_time);
        Bench.benchEnd("battle_keeper", "game_total", false, 0L, false);
        this.elapsed = this.calculateCurElapsed();
        if (Config.fps_lock_30)
        {
            this.elapsed *= 2f;
        }
        MapBox.cursor_speed.update();
        Bench.bench("music_box", "game_total", false);
        MusicBox.inst.update(this.delta_time);
        Bench.benchEnd("music_box", "game_total", false, 0L, false);
        Bench.bench("auto_tester", "game_total", false);
        this.auto_tester.update(this.elapsed);
        Bench.benchEnd("auto_tester", "game_total", false, 0L, false);
        if (Config.isMobile)
        {
            if (RewardedAds.isShowing())
            {
                return;
            }
            if (PlayInterstitialAd.isShowing())
            {
                return;
            }
        }
        Bench.bench("auto_save", "game_total", false);
        AutoSaveManager.update();
        Bench.benchEnd("auto_save", "game_total", false, 0L, false);
        Bench.bench("send_to_sql", "game_total", false);
        DBInserter.executeCommandsAsync();
        Bench.benchEnd("send_to_sql", "game_total", false, 0L, false);
        this.checkMainSimulationUpdate();
        this.delayed_actions_manager.update(this.elapsed, this.delta_time);
        this.tilemap.update(this.elapsed);
        Bench.bench("update_shake", "game_total", false);
        this.updateShake(this.elapsed);
        Bench.benchEnd("update_shake", "game_total", false, 0L, false);
        Bench.bench("update_panel", "game_total", false);
        this.map_stats.updateStatsForPanel(this.delta_time);
        Bench.benchEnd("update_panel", "game_total", false, 0L, false);
        Bench.bench("quality_changer", "game_total", false);
        this.quality_changer.update();
        Bench.benchEnd("quality_changer", "game_total", false, 0L, false);
        this.updateTransitionEffect();
        Bench.bench("update_controls", "game_total", false);
        this.player_control.updateControls();
        Bench.benchEnd("update_controls", "game_total", false, 0L, false);
        Bench.bench("zone_camera", "game_total", false);
        this.zone_camera.update();
        Bench.benchEnd("zone_camera", "game_total", false, 0L, false);
        Bench.bench("unit_select_effect", "game_total", false);
        if (this._unit_select_effect != null)
        {
            this._unit_select_effect.update(this.elapsed);
        }
        Bench.benchEnd("unit_select_effect", "game_total", false, 0L, false);
        Bench.bench("nameplates", "game_total", false);
        this.nameplate_manager.update();
        Bench.benchEnd("nameplates", "game_total", false, 0L, false);
        if (Config.time_scale_asset.render_skip)
        {
            if (this._render_skip < 2)
            {
                this._render_skip++;
            }
            else
            {
                this._render_skip = 0;
                this.calculateVisibleObjects();
                this.renderStuff();
            }
        }
        else
        {
            this.calculateVisibleObjects();
            this.renderStuff();
        }
        Bench.bench("update_sprite_constructor", "game_total", false);
        this.updateDynamicSprites();
        Bench.benchEnd("update_sprite_constructor", "game_total", false, 0L, false);
        Bench.bench("light_renderer", "game_total", false);
        LightRenderer.instance.update(this.delta_time);
        Bench.benchEnd("light_renderer", "game_total", false, 0L, false);
        Bench.bench("update_finish", "game_total", false);
        this.updateFinish();
        Bench.benchEnd("update_finish", "game_total", false, 0L, false);
        Bench.bench("end_checks", "game_total", false);
        this.checkMinWindowSize();
        this.checkVersionCallbacks();
        Bench.update();
        Bench.benchEnd("end_checks", "game_total", false, 0L, false);
        this.checkAchievements();
        Bench.benchEnd("game_total", "main", false, 0L, false);
    }

    // Token: 0x06000095 RID: 149 RVA: 0x00007BDC File Offset: 0x00005DDC
    private void checkMainSimulationUpdate()
    {
        int tUpdatesPerFrame = (ScrollWindow.isWindowActive() ? 1 : Config.time_scale_asset.ticks);
        for (int i = 0; i < tUpdatesPerFrame; i++)
        {
            this.updateSimulation(this.elapsed);
        }
    }

    // Token: 0x06000096 RID: 150 RVA: 0x00007C18 File Offset: 0x00005E18
    private void updateTransitionEffect()
    {
        if (this._world_layer_switch_effect.color.a == 0f)
        {
            return;
        }
        Color tColor = this._world_layer_switch_effect.color;
        tColor.a -= this.delta_time * 0.1f;
        if (tColor.a < 0f)
        {
            tColor.a = 0f;
        }
        this._world_layer_switch_effect.color = tColor;
    }

    // Token: 0x06000097 RID: 151 RVA: 0x00007C85 File Offset: 0x00005E85
    private void checkAchievements()
    {
        if (Time.frameCount % 60 != 0)
        {
            return;
        }
        SignalManager.add(SignalLibrary.check_achievement_eternal_chaos, null);
        SignalManager.add(SignalLibrary.check_achievement_minefield, null);
        SignalManager.add(SignalLibrary.check_achievement_rain_tornado, null);
    }

    // Token: 0x06000098 RID: 152 RVA: 0x00007CB4 File Offset: 0x00005EB4
    private void updateSimulation(float pElapsed)
    {
        this.updateDirtyMetaContainersAndCleanup();
        this.explosion_checker.update(pElapsed);
        this.city_zone_helper.update(pElapsed);
        if (!this.isPaused())
        {
            this.updateTimerNutrition(pElapsed);
            Bench.bench("update_age", "game_total", false);
            this.map_stats.updateWorldTime(pElapsed);
            Bench.benchEnd("update_age", "game_total", false, 0L, false);
            Bench.bench("taxi", "game_total", false);
            TaxiManager.update(pElapsed);
            Bench.benchEnd("taxi", "game_total", false, 0L, false);
            Bench.bench("update_meta_history", "game_total", false);
            this.updateMetaHistory();
            Bench.benchEnd("update_meta_history", "game_total", false, 0L, false);
        }
        AnimationHelper.updateTime(pElapsed, this.delta_time);
        EnemiesFinder.clear();
        ControllableUnit.updateControllableUnit();
        this.updateMapLayers(pElapsed);
        this.updateCities(pElapsed);
        this.updateActors(pElapsed);
        this.updateBuildings(pElapsed);
        this.drop_manager.update(pElapsed);
        this.cultures.update(pElapsed);
        this.stack_effects.update(pElapsed);
        this.resource_throw_manager.update(pElapsed);
        this.updateWorldBehaviours(pElapsed);
        Bench.bench("army_manager", "game_total", false);
        this.armies.update(pElapsed);
        Bench.benchEnd("army_manager", "game_total", false, 0L, false);
        Bench.bench("kingdoms", "game_total", false);
        this.kingdoms.update(pElapsed);
        Bench.benchEnd("kingdoms", "game_total", false, 0L, false);
        Bench.bench("diplomacy", "game_total", false);
        this.diplomacy.update(pElapsed);
        Bench.benchEnd("diplomacy", "game_total", false, 0L, false);
        Bench.bench("subspecies", "game_total", false);
        this.subspecies.update(pElapsed);
        Bench.benchEnd("subspecies", "game_total", false, 0L, false);
        Bench.bench("plots", "game_total", false);
        this.plots.update(pElapsed);
        Bench.benchEnd("plots", "game_total", false, 0L, false);
        Bench.bench("clans", "game_total", false);
        this.clans.update(pElapsed);
        Bench.benchEnd("clans", "game_total", false, 0L, false);
        Bench.bench("alliances", "game_total", false);
        this.alliances.update(pElapsed);
        Bench.benchEnd("alliances", "game_total", false, 0L, false);
        Bench.bench("wars", "game_total", false);
        this.wars.update(pElapsed);
        Bench.benchEnd("wars", "game_total", false, 0L, false);
        Bench.bench("projectiles", "game_total", false);
        this.projectiles.update(pElapsed);
        Bench.benchEnd("projectiles", "game_total", false, 0L, false);
        Bench.bench("stasuses", "game_total", false);
        this.statuses.update(pElapsed);
        Bench.benchEnd("stasuses", "game_total", false, 0L, false);
        Bench.bench("era_manager", "game_total", false);
        this.era_manager.update(pElapsed);
        Bench.benchEnd("era_manager", "game_total", false, 0L, false);
    }

    // Token: 0x06000099 RID: 153 RVA: 0x00007FFC File Offset: 0x000061FC
    private void updateMetaHistory()
    {
        if (!Config.graphs)
        {
            return;
        }
        if (Config.disable_db)
        {
            return;
        }
        if (Date.getCurrentMonth() != 12)
        {
            return;
        }
        int tYearNow = Date.getCurrentYear();
        if (tYearNow == this.map_stats.history_current_year)
        {
            return;
        }
        this.map_stats.history_current_year = tYearNow;
        foreach (BaseSystemManager baseSystemManager in this.list_all_sim_managers)
        {
            baseSystemManager.startCollectHistoryData();
        }
        this.world_object.startCollectHistoryData();
        foreach (BaseSystemManager baseSystemManager2 in this.list_all_sim_managers)
        {
            baseSystemManager2.clearLastYearStats();
        }
        this.world_object.clearLastYearStats();
    }

    // Token: 0x0600009A RID: 154 RVA: 0x000080DC File Offset: 0x000062DC
    private void updateDirtyMetaContainersAndCleanup()
    {
        BuildingZonesSystem.update();
        this.checkSimManagerLists();
        this.units.checkContainer();
        this.buildings.checkContainer();
        this.sim_object_zones.update();
        Bench.bench("prepare_for_meta_checks", "game_total", false);
        this.units.prepareForMetaChecks();
        Bench.benchEnd("prepare_for_meta_checks", "game_total", false, 0L, false);
        Bench.bench("check_dirty_meta_units", "game_total", false);
        this.checkDirtyUnits();
        Bench.benchEnd("check_dirty_meta_units", "game_total", false, 0L, false);
        Bench.bench("check_dirty_meta_objects", "game_total", false);
        this.checkDirtyMetaObjects();
        Bench.benchEnd("check_dirty_meta_objects", "game_total", false, 0L, false);
        if (!this.isWindowOnScreen())
        {
            Bench.bench("check_meta_obj_destroy", "game_total", false);
            this.checkMetaObjectsDestroy();
            Bench.benchEnd("check_meta_obj_destroy", "game_total", false, 0L, false);
            Bench.bench("check_obj_destroy", "game_total", false);
            this.checkObjectsToDestroy();
            Bench.benchEnd("check_obj_destroy", "game_total", false, 0L, false);
        }
        this.checkSimManagerLists();
        Bench.bench("check_references_units", "game_total", false);
        this.checkEventUnitsDestroy();
        Bench.benchEnd("check_references_units", "game_total", false, 0L, false);
        Bench.bench("check_references_buildings", "game_total", false);
        this.checkEventBuildingsDestroy();
        Bench.benchEnd("check_references_buildings", "game_total", false, 0L, false);
        Bench.bench("check_references_houses", "game_total", false);
        this.checkEventHouses();
        Bench.benchEnd("check_references_houses", "game_total", false, 0L, false);
        Bench.bench("check_dirty_meta_objects_2", "game_total", false);
        this.checkDirtyMetaObjects();
        Bench.benchEnd("check_dirty_meta_objects_2", "game_total", false, 0L, false);
        Bench.bench("check_anything_changed", "game_total", false);
        this.checkAnyMetaAddedRemoved();
        Bench.benchEnd("check_anything_changed", "game_total", false, 0L, false);
    }

    // Token: 0x0600009B RID: 155 RVA: 0x000082D8 File Offset: 0x000064D8
    private void checkEventUnitsDestroy()
    {
        if (!this.units.event_destroy)
        {
            return;
        }
        this.units.event_destroy = false;
        foreach (Actor tActor in this.units)
        {
            if (tActor.beh_actor_target != null && !tActor.beh_actor_target.isAlive())
            {
                tActor.beh_actor_target = null;
            }
            if (tActor.attackedBy != null && !tActor.attackedBy.isAlive())
            {
                tActor.attackedBy = null;
            }
            if (tActor.hasLover() && !tActor.lover.isAlive())
            {
                tActor.lover.lover = null;
                tActor.lover = null;
            }
        }
        TaxiManager.removeDeadUnits();
    }

    // Token: 0x0600009C RID: 156 RVA: 0x000083A0 File Offset: 0x000065A0
    private void checkEventBuildingsDestroy()
    {
        if (!this.buildings.event_destroy)
        {
            return;
        }
        List<Actor> tUnitList = this.units.getSimpleList();
        for (int i = 0; i < tUnitList.Count; i++)
        {
            Actor tActor = tUnitList[i];
            if (tActor.beh_building_target != null && !tActor.beh_building_target.isAlive())
            {
                tActor.beh_building_target = null;
            }
            if (tActor.attackedBy != null && !tActor.attackedBy.isAlive())
            {
                tActor.attackedBy = null;
            }
        }
        this.buildings.event_destroy = false;
    }

    // Token: 0x0600009D RID: 157 RVA: 0x00008424 File Offset: 0x00006624
    private void checkEventHouses()
    {
        if (!this.buildings.event_houses)
        {
            return;
        }
        foreach (Building tBuilding in this.buildings.occupied_buildings)
        {
            tBuilding.residents.Clear();
            if (tBuilding.asset.docks)
            {
                tBuilding.component_docks.clearBoatCounter();
            }
        }
        List<Actor> tUnitList = this.units.getSimpleList();
        for (int i = 0; i < tUnitList.Count; i++)
        {
            Actor tActor = tUnitList[i];
            tActor.checkHomeBuilding();
            Building tHome = tActor.home_building;
            if (tHome != null)
            {
                if (tHome.asset.docks)
                {
                    tHome.component_docks.increaseBoatCounter(tActor);
                }
                else
                {
                    tHome.residents.Add(tActor.data.id);
                }
            }
            Building tInsideBuilding = tActor.inside_building;
            if (tInsideBuilding != null && (!tInsideBuilding.isUsable() || tInsideBuilding.isAbandoned()))
            {
                tActor.exitBuilding();
                tActor.cancelAllBeh();
            }
        }
        this.buildings.event_houses = false;
    }

    // Token: 0x0600009E RID: 158 RVA: 0x00008558 File Offset: 0x00006758
    private void debugHouses()
    {
        foreach (Building tBuilding in this.buildings)
        {
            if (!tBuilding.isUsable() && tBuilding.countResidents() > 0)
            {
                Debug.LogError("Building " + tBuilding.data.id.ToString() + " has residents but is not usable");
            }
            if (!tBuilding.asset.docks && tBuilding.countResidents() > tBuilding.asset.housing_slots)
            {
                Debug.LogError(string.Concat(new string[]
                {
                    tBuilding.asset.id,
                    " has more residents than housing ",
                    tBuilding.countResidents().ToString(),
                    "/",
                    tBuilding.asset.housing_slots.ToString()
                }));
            }
        }
    }

    // Token: 0x0600009F RID: 159 RVA: 0x00008650 File Offset: 0x00006850
    public void checkSimManagerLists()
    {
        for (int i = 0; i < this.list_all_sim_managers.Count; i++)
        {
            this.list_all_sim_managers[i].checkLists();
        }
    }

    // Token: 0x060000A0 RID: 160 RVA: 0x00008684 File Offset: 0x00006884
    private void checkDirtyUnits()
    {
        bool tDirtyUnits = false;
        int tCountDirtyUnits = 0;
        for (int i = 0; i < this._list_meta_main_managers.Count; i++)
        {
            if (this._list_meta_main_managers[i].isUnitsDirty())
            {
                tDirtyUnits = true;
                tCountDirtyUnits++;
            }
        }
        if (tDirtyUnits)
        {
            if (tCountDirtyUnits < 3)
            {
                this.subspecies.beginChecksUnits();
                this.families.beginChecksUnits();
                this.armies.beginChecksUnits();
                this.clans.beginChecksUnits();
                this.plots.beginChecksUnits();
                this.languages.beginChecksUnits();
                this.cultures.beginChecksUnits();
                this.religions.beginChecksUnits();
                this.cities.beginChecksUnits();
                this.kingdoms.beginChecksUnits();
                this.kingdoms_wild.beginChecksUnits();
                return;
            }
            Parallel.ForEach<BaseSystemManager>(this._list_meta_main_managers, this.parallel_options, delegate (BaseSystemManager pSystem)
            {
                pSystem.parallelDirtyUnitsCheck();
            });
        }
    }

    // Token: 0x060000A1 RID: 161 RVA: 0x0000877C File Offset: 0x0000697C
    private void checkDirtyMetaObjects()
    {
        this.kingdoms_wild.beginChecksBuildings();
        this.kingdoms.beginChecksBuildings();
        this.cities.beginChecksBuildings();
        this.kingdoms.beginChecksCities();
        this.religions.beginChecksKingdoms();
        this.religions.beginChecksCities();
        this.cultures.beginChecksKingdoms();
        this.cultures.beginChecksCities();
        this.languages.beginChecksKingdoms();
        this.languages.beginChecksCities();
    }

    // Token: 0x060000A2 RID: 162 RVA: 0x000087F8 File Offset: 0x000069F8
    private void checkAnyMetaAddedRemoved()
    {
        if (!BaseSystemManager.anything_changed)
        {
            return;
        }
        Config.selected_objects.RemoveWhere((NanoObject pNanoObject) => pNanoObject.isRekt());
        if (ScrollWindow.isWindowActive())
        {
            ScrollWindow.checkElements();
            if (!MetaSwitchManager.isAnimationActive())
            {
                MetaSwitchManager.checkAndRefresh();
            }
        }
        SpriteSwitcher.checkAllStates();
        BaseSystemManager.anything_changed = false;
    }

    // Token: 0x060000A3 RID: 163 RVA: 0x0000885C File Offset: 0x00006A5C
    private void checkMetaObjectsDestroy()
    {
        if (this._meta_skip)
        {
            this._meta_skip = false;
            return;
        }
        foreach (BaseSystemManager baseSystemManager in this._list_meta_main_managers)
        {
            baseSystemManager.checkDeadObjects();
        }
    }

    // Token: 0x060000A4 RID: 164 RVA: 0x000088BC File Offset: 0x00006ABC
    private void calculateVisibleObjects()
    {
        this.buildings.calculateVisibleBuildings();
        this.units.calculateVisibleActors();
    }

    // Token: 0x060000A5 RID: 165 RVA: 0x000088D4 File Offset: 0x00006AD4
    public void resetRedrawTimer()
    {
        this._redraw_timer = -1f;
    }

    // Token: 0x060000A6 RID: 166 RVA: 0x000088E4 File Offset: 0x00006AE4
    private void renderStuff()
    {
        QuantumSpriteManager.update();
        Bench.bench("redraw_mini_map", "game_total", false);
        if (this._redraw_timer > 0f)
        {
            this._redraw_timer -= Time.deltaTime;
        }
        else
        {
            this._redraw_timer = 0.001f;
            if (this.tiles_dirty.Count > 0)
            {
                this.redrawMiniMap(false);
            }
        }
        Bench.benchEnd("redraw_mini_map", "game_total", false, 0L, false);
        Bench.bench("redraw_tiles", "game_total", false);
        this.tilemap.redrawTiles(false);
        Bench.benchEnd("redraw_tiles", "game_total", false, 0L, false);
        Bench.bench("update_debug_texts", "game_total", false);
        this.updateDebugGroupSystem();
        Bench.benchEnd("update_debug_texts", "game_total", false, 0L, false);
    }

    // Token: 0x060000A7 RID: 167 RVA: 0x000089B8 File Offset: 0x00006BB8
    private void updateFinish()
    {
        if (this.timer_nutrition_decay <= 0f)
        {
            this.timer_nutrition_decay = SimGlobals.m.interval_nutrition_decay;
        }
    }

    // Token: 0x060000A8 RID: 168 RVA: 0x000089D7 File Offset: 0x00006BD7
    private void checkVersionCallbacks()
    {
        if (VersionCallbacks.timer > 0f)
        {
            VersionCallbacks.updateVC(this.elapsed);
        }
        if (Config.EVERYTHING_FIREWORKS)
        {
            this.spawnForcedFireworks();
        }
    }

    // Token: 0x060000A9 RID: 169 RVA: 0x00008A00 File Offset: 0x00006C00
    private void checkMinWindowSize()
    {
        if (!Screen.fullScreen)
        {
            if (Screen.width < 720)
            {
                Screen.SetResolution(720, Screen.height, false);
                return;
            }
            if (Screen.height < 480)
            {
                Screen.SetResolution(Screen.width, 480, false);
            }
        }
    }

    // Token: 0x060000AA RID: 170 RVA: 0x00008A4D File Offset: 0x00006C4D
    private void checkObjectsToDestroy()
    {
        this.buildings.checkObjectsToDestroy();
        this.units.checkObjectsToDestroy();
    }

    // Token: 0x060000AB RID: 171 RVA: 0x00008A68 File Offset: 0x00006C68
    private void updateWorldBehaviours(float pElapsed)
    {
        if (!DebugConfig.isOn(DebugOption.SystemWorldBehaviours))
        {
            return;
        }
        Bench.bench("world_beh", "game_total", false);
        List<WorldBehaviourAsset> tList = AssetManager.world_behaviours.list;
        for (int i = 0; i < tList.Count; i++)
        {
            WorldBehaviourAsset tAsset = tList[i];
            if (tAsset.enabled)
            {
                Bench.bench(tAsset.id, "world_beh", false);
                tAsset.manager.update(pElapsed);
                Bench.benchEnd(tAsset.id, "world_beh", false, 0L, false);
            }
        }
        Bench.benchEnd("world_beh", "game_total", false, 0L, false);
    }

    // Token: 0x060000AC RID: 172 RVA: 0x00008B03 File Offset: 0x00006D03
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public float getWorldTimeElapsedSince(double pTime)
    {
        return (float)(this.map_stats.world_time - pTime);
    }

    // Token: 0x060000AD RID: 173 RVA: 0x00008B13 File Offset: 0x00006D13
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public float getRealTimeElapsedSince(double pTime)
    {
        return (float)(this.getCurSessionTime() - pTime);
    }

    // Token: 0x060000AE RID: 174 RVA: 0x00008B1E File Offset: 0x00006D1E
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public double getCurWorldTime()
    {
        return this.map_stats.world_time;
    }

    // Token: 0x060000AF RID: 175 RVA: 0x00008B2B File Offset: 0x00006D2B
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public double getCurSessionTime()
    {
        return this.game_stats.data.gameTime;
    }

    // Token: 0x060000B0 RID: 176 RVA: 0x00008B3D File Offset: 0x00006D3D
    public void updateDynamicSprites()
    {
        AssetManager.dynamic_sprites_library.checkDirty();
    }

    // Token: 0x060000B1 RID: 177 RVA: 0x00008B49 File Offset: 0x00006D49
    public void updateDebugGroupSystem()
    {
        this._debug_text_group_system.update(this.elapsed);
    }

    // Token: 0x060000B2 RID: 178 RVA: 0x00008B5C File Offset: 0x00006D5C
    internal void updateTimerNutrition(float pElapsed)
    {
        if (this.timer_nutrition_decay > 0f)
        {
            this.timer_nutrition_decay -= pElapsed;
        }
    }

    // Token: 0x060000B3 RID: 179 RVA: 0x00008B7C File Offset: 0x00006D7C
    internal void updateObjectAge()
    {
        foreach (Actor actor in this.units)
        {
            actor.updateAge();
        }
        this.cities.updateAge();
        this.kingdoms.updateAge();
    }

    // Token: 0x060000B4 RID: 180 RVA: 0x00008BDC File Offset: 0x00006DDC
    private void updateCities(float pElapsed)
    {
        if (!DebugConfig.isOn(DebugOption.SystemUpdateCities))
        {
            return;
        }
        Bench.bench("cities", "game_total", false);
        this.cities.update(pElapsed);
        Bench.benchEnd("cities", "game_total", false, 0L, false);
    }

    // Token: 0x060000B5 RID: 181 RVA: 0x00008C19 File Offset: 0x00006E19
    private void updateBuildings(float pElapsed)
    {
        if (!DebugConfig.isOn(DebugOption.SystemUpdateBuildings))
        {
            return;
        }
        this.buildings.update(pElapsed);
    }

    // Token: 0x060000B6 RID: 182 RVA: 0x00008C31 File Offset: 0x00006E31
    private void updateActors(float pElapsed)
    {
        if (!DebugConfig.isOn(DebugOption.SystemUpdateUnits))
        {
            return;
        }
        this.units.update(pElapsed);
    }

    // Token: 0x060000B7 RID: 183 RVA: 0x00008C4C File Offset: 0x00006E4C
    private void allTilesDirty()
    {
        this.tiles_dirty.Clear();
        this.tilemap.clear();
        for (int i = 0; i < this.tiles_list.Length; i++)
        {
            WorldTile tTile = this.tiles_list[i];
            this.setTileDirty(tTile);
        }
    }

    // Token: 0x060000B8 RID: 184 RVA: 0x00008C92 File Offset: 0x00006E92
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public void redrawRenderedTile(WorldTile pTile)
    {
        pTile.last_rendered_tile_type = null;
        this.setTileDirty(pTile);
    }

    // Token: 0x060000B9 RID: 185 RVA: 0x00008CA4 File Offset: 0x00006EA4
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public void setTileDirty(WorldTile pTile)
    {
        pTile.updateStats();
        this.tiles_dirty.Add(pTile);
        if (this.tilemap.needsRedraw(pTile))
        {
            this.tilemap.addToQueueToRedraw(pTile);
            if (pTile.has_tile_up)
            {
                this.tilemap.addToQueueToRedraw(pTile.tile_up);
            }
            if (pTile.has_tile_down)
            {
                this.tilemap.addToQueueToRedraw(pTile.tile_down);
            }
            if (pTile.has_tile_left)
            {
                this.tilemap.addToQueueToRedraw(pTile.tile_left);
            }
            if (pTile.has_tile_right)
            {
                this.tilemap.addToQueueToRedraw(pTile.tile_right);
            }
        }
        this.world_layer_edges.addDirtyChunk(pTile.chunk);
        this.checkBehaviours(pTile);
    }

    // Token: 0x060000BA RID: 186 RVA: 0x00008D5A File Offset: 0x00006F5A
    internal void setZoomOrthographic(float pZoom)
    {
        this.quality_changer.setZoomOrthographic(pZoom);
    }

    // Token: 0x060000BB RID: 187 RVA: 0x00008D68 File Offset: 0x00006F68
    private void redrawMiniMap(bool pForce = false)
    {
        if (!DebugConfig.isOn(DebugOption.SystemRedrawMap))
        {
            return;
        }
        if (!MapBox.isRenderMiniMap() && !pForce)
        {
            return;
        }
        this.dirty_tiles_last = this.tiles_dirty.Count;
        foreach (WorldTile tTile in this.tiles_dirty)
        {
            this.updateDirtyTile(tTile);
        }
        this.world_layer_edges.redraw();
        this.tiles_dirty.Clear();
        this.world_layer.updatePixels();
    }

    // Token: 0x060000BC RID: 188 RVA: 0x00008E04 File Offset: 0x00007004
    internal void checkBehaviours(WorldTile pTile)
    {
        if (pTile.Type.explodable_timed)
        {
            this.explosion_layer.addTimedTnt(pTile);
        }
        if (pTile.Type.can_be_filled_with_ocean)
        {
            WorldBehaviourOcean.tiles.Add(pTile);
            return;
        }
        WorldBehaviourOcean.tiles.Remove(pTile);
    }

    // Token: 0x060000BD RID: 189 RVA: 0x00008E50 File Offset: 0x00007050
    private void updateDirtyTile(WorldTile pTile)
    {
        if (pTile.hasBuilding())
        {
            Color grey = Color.grey;
            if (!(pTile.building.getColorForMinimap(pTile) == Toolbox.clear))
            {
                this.world_layer.pixels[pTile.data.tile_id] = pTile.building.getColorForMinimap(pTile);
                return;
            }
        }
        this.world_layer.pixels[pTile.data.tile_id] = pTile.getColor();
    }

    // Token: 0x060000BE RID: 190 RVA: 0x00008ED6 File Offset: 0x000070D6
    public void followUnit(Actor pActor)
    {
        SelectedUnit.clear();
        this.move_camera.focusOnAndFollow(pActor, null, null);
    }

    // Token: 0x060000BF RID: 191 RVA: 0x00008EEC File Offset: 0x000070EC
    public void locateSelectedVillage()
    {
        City tCity = Config.selected_city;
        ScrollWindow.hideAllEvent(true);
        this.move_camera.focusOn(tCity.city_center);
    }

    // Token: 0x060000C0 RID: 192 RVA: 0x00008F1B File Offset: 0x0000711B
    public void locatePosition(Vector3 pVector)
    {
        if (this.isGameplayControlsLocked())
        {
            ScrollWindow.hideAllEvent(true);
        }
        this.move_camera.focusOn(pVector);
    }

    // Token: 0x060000C1 RID: 193 RVA: 0x00008F37 File Offset: 0x00007137
    public void locatePosition(Vector3 pVector, Action pFocusReachedCallback, Action pFocusCancelCallback)
    {
        if (this.isGameplayControlsLocked())
        {
            ScrollWindow.hideAllEvent(true);
        }
        this.move_camera.focusOn(pVector, pFocusReachedCallback, pFocusCancelCallback);
    }

    // Token: 0x060000C2 RID: 194 RVA: 0x00008F55 File Offset: 0x00007155
    public void locateAndFollow(Actor pActor, Action pFocusReachedCallback, Action pFocusCancelCallback)
    {
        if (this.isGameplayControlsLocked())
        {
            ScrollWindow.hideAllEvent(true);
        }
        this.move_camera.focusOnAndFollow(pActor, pFocusReachedCallback, pFocusCancelCallback);
    }

    // Token: 0x060000C3 RID: 195 RVA: 0x00008F73 File Offset: 0x00007173
    public bool isSelectedPower(string pPower)
    {
        return this.isAnyPowerSelected() && this.selected_power.id == pPower;
    }

    // Token: 0x060000C4 RID: 196 RVA: 0x00008F95 File Offset: 0x00007195
    public string getSelectedPowerID()
    {
        if (!this.isAnyPowerSelected())
        {
            return string.Empty;
        }
        return this.selected_power.id;
    }

    // Token: 0x17000006 RID: 6
    // (get) Token: 0x060000C5 RID: 197 RVA: 0x00008FB0 File Offset: 0x000071B0
    public GodPower selected_power
    {
        get
        {
            PowerButton selectedButton = this.selected_buttons.selectedButton;
            if (selectedButton == null)
            {
                return null;
            }
            return selectedButton.godPower;
        }
    }

    // Token: 0x060000C6 RID: 198 RVA: 0x00008FC8 File Offset: 0x000071C8
    public MouseHoldAnimation getSelectedPowerHoldAnimation()
    {
        if (!this.isAnyPowerSelected())
        {
            return MouseHoldAnimation.Default;
        }
        return this.getSelectedPowerAsset().mouse_hold_animation;
    }

    // Token: 0x060000C7 RID: 199 RVA: 0x00008FDF File Offset: 0x000071DF
    public bool canDragMap()
    {
        return !this.isAnyPowerSelected() || this.getSelectedPowerAsset().can_drag_map;
    }

    // Token: 0x060000C8 RID: 200 RVA: 0x00008FF6 File Offset: 0x000071F6
    public GodPower getSelectedPowerAsset()
    {
        if (!this.isAnyPowerSelected())
        {
            return null;
        }
        return AssetManager.powers.get(this.getSelectedPowerID());
    }

    // Token: 0x060000C9 RID: 201 RVA: 0x00009012 File Offset: 0x00007212
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public bool isAnyPowerSelected()
    {
        return this.selected_buttons.selectedButton != null;
    }

    // Token: 0x060000CA RID: 202 RVA: 0x00009025 File Offset: 0x00007225
    internal bool isPowerForceMapMode(MetaType pMode = MetaType.None)
    {
        return this.isAnyPowerSelected() && this.selected_power.force_map_mode == pMode;
    }

    // Token: 0x060000CB RID: 203 RVA: 0x0000903F File Offset: 0x0000723F
    internal MetaType getForcedMapMode()
    {
        if (!this.isAnyPowerSelected())
        {
            return MetaType.None;
        }
        return this.selected_power.force_map_mode;
    }

    // Token: 0x060000CC RID: 204 RVA: 0x00009056 File Offset: 0x00007256
    internal bool hasPowerForceMapMode()
    {
        return this.getForcedMapMode() > MetaType.None;
    }

    // Token: 0x060000CD RID: 205 RVA: 0x00009064 File Offset: 0x00007264
    public MetaType getCurrentBorderMode(bool pCheckOnlyOption = false)
    {
        MetaType tMode;
        if (this.showCultureZones(pCheckOnlyOption))
        {
            tMode = MetaType.Culture;
        }
        else if (this.showKingdomZones(pCheckOnlyOption))
        {
            tMode = MetaType.Kingdom;
        }
        else if (this.showClanZones(pCheckOnlyOption))
        {
            tMode = MetaType.Clan;
        }
        else if (this.showAllianceZones(pCheckOnlyOption))
        {
            tMode = MetaType.Alliance;
        }
        else if (this.showCityZones(pCheckOnlyOption))
        {
            tMode = MetaType.City;
        }
        else if (this.showSpeciesZones(pCheckOnlyOption))
        {
            tMode = MetaType.Subspecies;
        }
        else if (this.showFamiliesZones(pCheckOnlyOption))
        {
            tMode = MetaType.Family;
        }
        else if (this.showLanguagesZones(pCheckOnlyOption))
        {
            tMode = MetaType.Language;
        }
        else if (this.showReligionZones(pCheckOnlyOption))
        {
            tMode = MetaType.Religion;
        }
        else
        {
            tMode = MetaType.None;
        }
        return tMode;
    }

    // Token: 0x060000CE RID: 206 RVA: 0x000090EC File Offset: 0x000072EC
    public MetaTypeAsset getMapMetaAsset()
    {
        if (this.hasPowerForceMapMode())
        {
            return this.getForcedMapMode().getAsset();
        }
        for (int i = 0; i < AssetManager.meta_type_library.list.Count; i++)
        {
            MetaTypeAsset tAsset = AssetManager.meta_type_library.list[i];
            if (!string.IsNullOrEmpty(tAsset.option_id) && (PlayerConfig.optionBoolEnabled(tAsset.option_id) || this.isPowerForceMapMode(tAsset.map_mode)))
            {
                return tAsset;
            }
        }
        return null;
    }

    // Token: 0x060000CF RID: 207 RVA: 0x00009163 File Offset: 0x00007363
    internal bool showCityZones(bool pCheckOnlyOption = false)
    {
        return AssetManager.meta_type_library.city.isActive(pCheckOnlyOption);
    }

    // Token: 0x060000D0 RID: 208 RVA: 0x00009175 File Offset: 0x00007375
    internal bool showKingdomZones(bool pCheckOnlyOption = false)
    {
        return AssetManager.meta_type_library.kingdom.isActive(pCheckOnlyOption);
    }

    // Token: 0x060000D1 RID: 209 RVA: 0x00009187 File Offset: 0x00007387
    internal bool showClanZones(bool pCheckOnlyOption = false)
    {
        return AssetManager.meta_type_library.clan.isActive(pCheckOnlyOption);
    }

    // Token: 0x060000D2 RID: 210 RVA: 0x00009199 File Offset: 0x00007399
    internal bool showAllianceZones(bool pCheckOnlyOption = false)
    {
        return AssetManager.meta_type_library.alliance.isActive(pCheckOnlyOption);
    }

    // Token: 0x060000D3 RID: 211 RVA: 0x000091AB File Offset: 0x000073AB
    internal bool showCultureZones(bool pCheckOnlyOption = false)
    {
        return AssetManager.meta_type_library.culture.isActive(pCheckOnlyOption);
    }

    // Token: 0x060000D4 RID: 212 RVA: 0x000091BD File Offset: 0x000073BD
    internal bool showSpeciesZones(bool pCheckOnlyOption = false)
    {
        return AssetManager.meta_type_library.subspecies.isActive(pCheckOnlyOption);
    }

    // Token: 0x060000D5 RID: 213 RVA: 0x000091CF File Offset: 0x000073CF
    internal bool showFamiliesZones(bool pCheckOnlyOption = false)
    {
        return AssetManager.meta_type_library.family.isActive(pCheckOnlyOption);
    }

    // Token: 0x060000D6 RID: 214 RVA: 0x000091E1 File Offset: 0x000073E1
    internal bool showLanguagesZones(bool pCheckOnlyOption = false)
    {
        return AssetManager.meta_type_library.language.isActive(pCheckOnlyOption);
    }

    // Token: 0x060000D7 RID: 215 RVA: 0x000091F3 File Offset: 0x000073F3
    internal bool showReligionZones(bool pCheckOnlyOption = false)
    {
        return AssetManager.meta_type_library.religion.isActive(pCheckOnlyOption);
    }

    // Token: 0x060000D8 RID: 216 RVA: 0x00009205 File Offset: 0x00007405
    internal bool showMapNames()
    {
        return PlayerConfig.optionBoolEnabled("map_names") || this.hasPowerForceMapMode();
    }

    // Token: 0x060000D9 RID: 217 RVA: 0x0000921B File Offset: 0x0000741B
    public bool showMapZones()
    {
        return this.isMapZonesEnabled() || this.hasPowerForceMapMode();
    }

    // Token: 0x060000DA RID: 218 RVA: 0x0000922D File Offset: 0x0000742D
    public bool isMapZonesEnabled()
    {
        return PlayerConfig.optionBoolEnabled("map_layers");
    }

    // Token: 0x060000DB RID: 219 RVA: 0x00009239 File Offset: 0x00007439
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    internal bool isPaused()
    {
        return this._is_paused;
    }

    // Token: 0x060000DC RID: 220 RVA: 0x00009244 File Offset: 0x00007444
    internal void spawnCongratulationFireworks()
    {
        City tCity = this.cities.getRandom();
        if (tCity == null)
        {
            return;
        }
        Building tBuilding = Randy.getRandom<Building>(tCity.buildings);
        if (tBuilding == null)
        {
            return;
        }
        if (tBuilding.isUnderConstruction())
        {
            return;
        }
        EffectsLibrary.spawn("fx_fireworks", tBuilding.current_tile, null, null, 0f, -1f, -1f, null);
    }

    // Token: 0x060000DD RID: 221 RVA: 0x000092A0 File Offset: 0x000074A0
    internal void spawnForcedFireworks()
    {
        WorldTile tTile = Randy.getRandom<WorldTile>(this.tiles_list);
        PlayerConfig.dict["sound"].boolVal = true;
        EffectsLibrary.spawn("fx_fireworks", tTile, null, null, 0f, -1f, -1f, null);
    }

    // Token: 0x060000DE RID: 222 RVA: 0x000092EC File Offset: 0x000074EC
    public int getCivWorldPopulation()
    {
        int tUnits = 0;
        foreach (Actor actor in this.units)
        {
            if (actor.isSapient())
            {
                tUnits++;
            }
            if (actor.asset.is_boat)
            {
                tUnits++;
            }
        }
        return tUnits;
    }

    // Token: 0x060000DF RID: 223 RVA: 0x00009350 File Offset: 0x00007550
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public static bool isRenderMiniMap()
    {
        return MapBox.instance.quality_changer.isLowRes();
    }

    // Token: 0x060000E0 RID: 224 RVA: 0x00009361 File Offset: 0x00007561
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public static bool isRenderGameplay()
    {
        return !MapBox.instance.quality_changer.isLowRes();
    }

    // Token: 0x060000E1 RID: 225 RVA: 0x00009375 File Offset: 0x00007575
    internal static void aye()
    {
        CornerAye.instance.startAye();
    }

    // Token: 0x060000E2 RID: 226 RVA: 0x00009381 File Offset: 0x00007581
    public ArchitectMood getArchitectMood()
    {
        if (this._cached_architect_mood == null)
        {
            this._cached_architect_mood = this.map_stats.getArchitectMood();
        }
        return this._cached_architect_mood;
    }

    // Token: 0x060000E3 RID: 227 RVA: 0x000093A2 File Offset: 0x000075A2
    public Color getArchitectColor()
    {
        return this.getArchitectMood().getColor();
    }

    // Token: 0x04000035 RID: 53
    internal GameObject joys;

    // Token: 0x04000036 RID: 54
    public const float TRANSITION_EFFECT_ALPHA = 0.1f;

    // Token: 0x04000037 RID: 55
    public const float TRANSITION_EFFECT_ALPHA_SPEED = 0.1f;

    // Token: 0x04000038 RID: 56
    internal SaveManager save_manager;

    // Token: 0x04000039 RID: 57
    internal ResourceThrowManager resource_throw_manager;

    // Token: 0x0400003A RID: 58
    internal GameStats game_stats;

    // Token: 0x0400003B RID: 59
    internal WorldObject world_object = new WorldObject();

    // Token: 0x0400003C RID: 60
    internal MapStats map_stats = new MapStats();

    // Token: 0x0400003D RID: 61
    internal WorldLaws world_laws = new WorldLaws();

    // Token: 0x0400003E RID: 62
    internal Canvas canvas;

    // Token: 0x0400003F RID: 63
    public static MapBox instance;

    // Token: 0x04000040 RID: 64
    internal PowerButtonSelector selected_buttons;

    // Token: 0x04000041 RID: 65
    internal ParallelOptions parallel_options;

    // Token: 0x04000042 RID: 66
    public Transform drag_parent;

    // Token: 0x04000043 RID: 67
    public static int width;

    // Token: 0x04000044 RID: 68
    public static int height;

    // Token: 0x04000045 RID: 69
    public static int current_world_seed_id;

    // Token: 0x04000046 RID: 70
    internal WorldTile[,] tiles_map;

    // Token: 0x04000047 RID: 71
    internal WorldTile[] tiles_list;

    // Token: 0x04000048 RID: 72
    public readonly List<BaseSystemManager> list_all_sim_managers = new List<BaseSystemManager>();

    // Token: 0x04000049 RID: 73
    private readonly List<BaseSystemManager> _list_meta_other_managers = new List<BaseSystemManager>();

    // Token: 0x0400004A RID: 74
    private readonly List<BaseSystemManager> _list_meta_main_managers = new List<BaseSystemManager>();

    // Token: 0x0400004B RID: 75
    private readonly List<BaseSystemManager> _list_sim_objects_managers = new List<BaseSystemManager>();

    // Token: 0x0400004C RID: 76
    public ProjectileManager projectiles;

    // Token: 0x0400004D RID: 77
    public StatusManager statuses;

    // Token: 0x0400004E RID: 78
    public CitiesManager cities;

    // Token: 0x0400004F RID: 79
    public WarManager wars;

    // Token: 0x04000050 RID: 80
    public PlotManager plots;

    // Token: 0x04000051 RID: 81
    public AllianceManager alliances;

    // Token: 0x04000052 RID: 82
    public ClanManager clans;

    // Token: 0x04000053 RID: 83
    public KingdomManager kingdoms;

    // Token: 0x04000054 RID: 84
    public WildKingdomsManager kingdoms_wild;

    // Token: 0x04000055 RID: 85
    public CultureManager cultures;

    // Token: 0x04000056 RID: 86
    public BookManager books;

    // Token: 0x04000057 RID: 87
    public SubspeciesManager subspecies;

    // Token: 0x04000058 RID: 88
    public ReligionManager religions;

    // Token: 0x04000059 RID: 89
    public LanguageManager languages;

    // Token: 0x0400005A RID: 90
    public FamilyManager families;

    // Token: 0x0400005B RID: 91
    public ArmyManager armies;

    // Token: 0x0400005C RID: 92
    public ItemManager items;

    // Token: 0x0400005D RID: 93
    public DiplomacyManager diplomacy;

    // Token: 0x0400005E RID: 94
    public BuildingManager buildings;

    // Token: 0x0400005F RID: 95
    public ActorManager units;

    // Token: 0x04000060 RID: 96
    public TileManager tile_manager;

    // Token: 0x04000061 RID: 97
    internal WorldTilemap tilemap;

    // Token: 0x04000062 RID: 98
    private float _redraw_timer;

    // Token: 0x04000063 RID: 99
    private bool _initiated;

    // Token: 0x04000064 RID: 100
    private DebugLayer _debug_layer;

    // Token: 0x04000065 RID: 101
    internal readonly RegionPathFinder region_path_finder = new RegionPathFinder();

    // Token: 0x04000066 RID: 102
    internal LoadingScreen transition_screen;

    // Token: 0x04000067 RID: 103
    internal StackEffects stack_effects;

    // Token: 0x04000068 RID: 104
    public DropManager drop_manager;

    // Token: 0x04000069 RID: 105
    internal PathFindingVisualiser path_finding_visualiser;

    // Token: 0x0400006A RID: 106
    internal WorldLayer world_layer;

    // Token: 0x0400006B RID: 107
    internal SpriteRenderer _world_layer_switch_effect;

    // Token: 0x0400006C RID: 108
    internal WorldLayerEdges world_layer_edges;

    // Token: 0x0400006D RID: 109
    internal UnitLayer unit_layer;

    // Token: 0x0400006E RID: 110
    internal GreyGooLayer grey_goo_layer;

    // Token: 0x0400006F RID: 111
    internal FireLayer fire_layer;

    // Token: 0x04000070 RID: 112
    private LavaLayer _lava_layer;

    // Token: 0x04000071 RID: 113
    internal PixelFlashEffects flash_effects;

    // Token: 0x04000072 RID: 114
    internal IslandsCalculator islands_calculator;

    // Token: 0x04000073 RID: 115
    internal ZoneCalculator zone_calculator;

    // Token: 0x04000074 RID: 116
    internal RoadsCalculator roads_calculator;

    // Token: 0x04000075 RID: 117
    internal BurnedTilesLayer burned_layer;

    // Token: 0x04000076 RID: 118
    internal ExplosionsEffects explosion_layer;

    // Token: 0x04000077 RID: 119
    internal ConwayLife conway_layer;

    // Token: 0x04000078 RID: 120
    internal MapChunkManager map_chunk_manager;

    // Token: 0x04000079 RID: 121
    internal AutoCivilization civilization_maker;

    // Token: 0x0400007A RID: 122
    private List<MapLayer> _map_layers;

    // Token: 0x0400007B RID: 123
    private List<BaseModule> _map_modules;

    // Token: 0x0400007C RID: 124
    internal Earthquake earthquake_manager;

    // Token: 0x0400007D RID: 125
    public Vector2 wind_direction;

    // Token: 0x0400007E RID: 126
    private StaticGrid _search_grid_ground;

    // Token: 0x0400007F RID: 127
    internal HashSet<WorldTile> tiles_dirty;

    // Token: 0x04000080 RID: 128
    internal GlowParticles particles_fire;

    // Token: 0x04000081 RID: 129
    internal GlowParticles particles_smoke;

    // Token: 0x04000082 RID: 130
    internal NameplateManager nameplate_manager;

    // Token: 0x04000083 RID: 131
    internal Console console;

    // Token: 0x04000084 RID: 132
    internal bool has_focus = true;

    // Token: 0x04000085 RID: 133
    internal Heat heat;

    // Token: 0x04000086 RID: 134
    internal HeatRayEffect heat_ray_fx;

    // Token: 0x04000087 RID: 135
    internal EffectDivineLight fx_divine_light;

    // Token: 0x04000088 RID: 136
    private MapBorder _map_border;

    // Token: 0x04000089 RID: 137
    internal QualityChanger quality_changer;

    // Token: 0x0400008A RID: 138
    internal Transform transform_units;

    // Token: 0x0400008E RID: 142
    internal SimObjectsZones sim_object_zones;

    // Token: 0x0400008F RID: 143
    internal Tutorial tutorial;

    // Token: 0x04000090 RID: 144
    private WorldLog _world_log;

    // Token: 0x04000091 RID: 145
    internal Magnet magnet;

    // Token: 0x04000092 RID: 146
    internal float timer_nutrition_decay;

    // Token: 0x04000093 RID: 147
    internal AutoTesterBot auto_tester;

    // Token: 0x04000094 RID: 148
    private UnitSelectionEffect _unit_select_effect;

    // Token: 0x04000095 RID: 149
    private readonly List<SpriteGroupSystem<GroupSpriteObject>> _list_systems = new List<SpriteGroupSystem<GroupSpriteObject>>();

    // Token: 0x04000096 RID: 150
    public static CursorSpeed cursor_speed;

    // Token: 0x04000097 RID: 151
    private DebugTextGroupSystem _debug_text_group_system;

    // Token: 0x04000098 RID: 152
    private SignalManager _signal_manager;

    // Token: 0x04000099 RID: 153
    internal ExplosionChecker explosion_checker;

    // Token: 0x0400009A RID: 154
    internal WorldAgeManager era_manager;

    // Token: 0x0400009B RID: 155
    public DelayedActionsManager delayed_actions_manager;

    // Token: 0x0400009C RID: 156
    public PlayerControl player_control;

    // Token: 0x0400009D RID: 157
    private bool _first_gen = true;

    // Token: 0x0400009E RID: 158
    private int _load_counter;

    // Token: 0x0400009F RID: 159
    private float _shake_timer;

    // Token: 0x040000A0 RID: 160
    private float _shake_interval_timer;

    // Token: 0x040000A1 RID: 161
    private float _shake_intensity = 1f;

    // Token: 0x040000A2 RID: 162
    private float _shake_interval = 0.1f;

    // Token: 0x040000A3 RID: 163
    private bool _shake_x = true;

    // Token: 0x040000A4 RID: 164
    private bool _shake_y = true;

    // Token: 0x040000A5 RID: 165
    private Transform _shake_camera;

    // Token: 0x040000A6 RID: 166
    internal float elapsed;

    // Token: 0x040000A7 RID: 167
    internal float delta_time;

    // Token: 0x040000A8 RID: 168
    public readonly CityZoneHelper city_zone_helper = new CityZoneHelper();

    // Token: 0x040000A9 RID: 169
    internal static Action on_world_loaded;

    // Token: 0x040000AA RID: 170
    private static int _tile_id;

    // Token: 0x040000AB RID: 171
    internal readonly AStarParam pathfinding_param = new AStarParam();

    // Token: 0x040000AC RID: 172
    internal int dirty_tiles_last;

    // Token: 0x040000AD RID: 173
    private bool _is_paused;

    // Token: 0x040000AE RID: 174
    private int _render_skip;

    // Token: 0x040000AF RID: 175
    private bool _meta_skip = true;

    // Token: 0x040000B0 RID: 176
    private ArchitectMood _cached_architect_mood;
}
using System;
using System.Collections.Generic;
using UnityEngine;

// Token: 0x02000078 RID: 120
public static class SmoothLoader
{
    // Token: 0x06000444 RID: 1092 RVA: 0x0002CD78 File Offset: 0x0002AF78
    public static void prepare()
    {
        SmoothLoader._actions.Clear();
        SmoothLoader._index = 0;
        SmoothLoader._started = false;
        SmoothLoader.finish();
        SmoothLoader.latest_called_id = string.Empty;
        SmoothLoader.latest_time = string.Empty;
        PlayerConfig.checkSettings();
        PreloadHelpers.init();
        SmoothLoader.add(delegate
        {
            ScrollWindow.hideAllEvent(false);
            CanvasMain.instance.setMainUiEnabled(false);
        }, "Close windows", true, 0.01f, false);
        SmoothLoader.add(delegate
        {
            QuantumSpriteManager.hideAll();
        }, "Quantum Clean", true, 0.01f, false);
    }

    // Token: 0x06000445 RID: 1093 RVA: 0x0002CE20 File Offset: 0x0002B020
    public static void add(MapLoaderAction pAction, string pId, bool pSkipFrame = false, float pNewWaitTimerValue = 0.001f, bool pToEnd = false)
    {
        MapLoaderContainer tNewActionContainer = new MapLoaderContainer(pAction, pId, true, pNewWaitTimerValue);
        SmoothLoader._has_actions = true;
        if (SmoothLoader._started && !pToEnd)
        {
            if (pSkipFrame)
            {
                SmoothLoader._actions.Insert(SmoothLoader._index + 1 + SmoothLoader._added++, new MapLoaderContainer(new MapLoaderAction(SmoothLoader.skipFrame), "skipFrame", false, 0.001f));
            }
            SmoothLoader._actions.Insert(SmoothLoader._index + 1 + SmoothLoader._added++, tNewActionContainer);
            return;
        }
        if (pSkipFrame)
        {
            SmoothLoader._actions.Add(new MapLoaderContainer(new MapLoaderAction(SmoothLoader.skipFrame), "skipFrame", false, 0.001f));
        }
        SmoothLoader._actions.Add(tNewActionContainer);
    }

    // Token: 0x06000446 RID: 1094 RVA: 0x0002CEDC File Offset: 0x0002B0DC
    public static void setWaitTimer()
    {
        float tNewTimer = 0.001f;
        if (SmoothLoader._last_action != null)
        {
            tNewTimer = SmoothLoader._last_action.new_timer_value;
        }
        if (tNewTimer > SmoothLoader._current_timer)
        {
            SmoothLoader._current_timer = tNewTimer;
        }
    }

    // Token: 0x06000447 RID: 1095 RVA: 0x0002CF0F File Offset: 0x0002B10F
    public static void skipFrame()
    {
        SmoothLoader._skip_frame = true;
    }

    // Token: 0x06000448 RID: 1096 RVA: 0x0002CF17 File Offset: 0x0002B117
    public static bool isLoading()
    {
        return SmoothLoader._has_actions;
    }

    // Token: 0x06000449 RID: 1097 RVA: 0x0002CF1E File Offset: 0x0002B11E
    private static void finish()
    {
        SmoothLoader._last_action = null;
        SmoothLoader._has_actions = false;
    }

    // Token: 0x0600044A RID: 1098 RVA: 0x0002CF2C File Offset: 0x0002B12C
    public static void update(float pElapsed)
    {
        if (!SmoothLoader._has_actions)
        {
            return;
        }
        if (SmoothLoader._current_timer > 0f)
        {
            SmoothLoader._current_timer -= pElapsed;
            return;
        }
        if (SmoothLoader._actions.Count == 0)
        {
            SmoothLoader.finish();
            return;
        }
        if (SmoothLoader._last_i == SmoothLoader._index)
        {
            SmoothLoader.openConsole();
            SmoothLoader.finish();
            MapBox.instance.startTheGame(true);
            return;
        }
        SmoothLoader._last_i = SmoothLoader._index;
        SmoothLoader._skip_frame = false;
        float tStartTime = Time.realtimeSinceStartup;
        SmoothLoader.doActions();
        while (Time.realtimeSinceStartup - tStartTime < 0.1f && !SmoothLoader._skip_frame && SmoothLoader._actions.Count != 0)
        {
            SmoothLoader.doActions();
        }
        SmoothLoader.setWaitTimer();
    }

    // Token: 0x0600044B RID: 1099 RVA: 0x0002CFD6 File Offset: 0x0002B1D6
    private static void openConsole()
    {
        if (World.world != null && World.world.console != null && !SmoothLoader._toggled_console)
        {
            SmoothLoader._toggled_console = true;
            World.world.console.Show();
        }
    }

    // Token: 0x0600044C RID: 1100 RVA: 0x0002D014 File Offset: 0x0002B214
    private static void doActions()
    {
        if (!SmoothLoader._started)
        {
            Bench.bench("SmoothLoader", "loading", true);
        }
        SmoothLoader._started = true;
        SmoothLoader._added = 0;
        MapLoaderContainer mapLoaderContainer = SmoothLoader._actions[SmoothLoader._index];
        MapLoaderAction tAction = mapLoaderContainer.action;
        SmoothLoader._last_action = mapLoaderContainer;
        Bench.bench(mapLoaderContainer.id, "loading", true);
        tAction();
        Bench.benchEnd(mapLoaderContainer.id, "loading", false, 0L, true);
        SmoothLoader.setWaitTimer();
        SmoothLoader.checkDebugText();
        SmoothLoader._index++;
        if (SmoothLoader._index > SmoothLoader._actions.Count - 1)
        {
            SmoothLoader._actions.Clear();
            double tTotalBenchResult = Bench.benchEnd("SmoothLoader", "loading", false, 0L, true);
            if (SmoothLoader.logsEnabled)
            {
                int num = ++SmoothLoader._index;
                Debug.Log(SmoothLoader.fillRight(SmoothLoader.fillLeft(num.ToString(), 3, '0') + ": Loading finished", 40, ' ') + " = " + tTotalBenchResult.ToString("F4"));
            }
        }
    }

    // Token: 0x0600044D RID: 1101 RVA: 0x0002D128 File Offset: 0x0002B328
    private static void checkDebugText()
    {
        if (SmoothLoader._last_action == null)
        {
            return;
        }
        if (!SmoothLoader._last_action.debug_log)
        {
            return;
        }
        SmoothLoader.latest_time = Bench.getBenchResultAsDouble(SmoothLoader._last_action.id, "loading", false).ToString("F4");
        SmoothLoader.latest_called_id = SmoothLoader.fillLeft(SmoothLoader._index.ToString(), 3, '0') + ": " + SmoothLoader._last_action.id;
        if (SmoothLoader.logsEnabled)
        {
            string debugText = SmoothLoader.fillRight(SmoothLoader.latest_called_id, 40, ' ') + " = " + SmoothLoader.latest_time;
            double latest_result = Bench.getBenchResultAsDouble(SmoothLoader._last_action.id, "loading", false);
            if (latest_result > 1.0)
            {
                debugText = "<color=red>" + debugText + "</color>";
            }
            else if (latest_result > 0.5)
            {
                debugText = "<color=yellow>" + debugText + "</color>";
            }
            Debug.Log(debugText);
        }
    }

    // Token: 0x17000013 RID: 19
    // (get) Token: 0x0600044E RID: 1102 RVA: 0x0002D219 File Offset: 0x0002B419
    private static bool logsEnabled
    {
        get
        {
            return !Config.disable_loading_logs;
        }
    }

    // Token: 0x0600044F RID: 1103 RVA: 0x0002D223 File Offset: 0x0002B423
    private static string fillLeft(string pString, int pSize = 1, char pFill = ' ')
    {
        return Toolbox.fillLeft(pString, pSize, pFill);
    }

    // Token: 0x06000450 RID: 1104 RVA: 0x0002D22D File Offset: 0x0002B42D
    private static string fillRight(string pString, int pSize = 1, char pFill = ' ')
    {
        return Toolbox.fillRight(pString, pSize, pFill);
    }

    // Token: 0x04000376 RID: 886
    public const float DEFAULT_TIMER_VALUE = 0.001f;

    // Token: 0x04000377 RID: 887
    public const int MAX_LOG_LENGTH = 40;

    // Token: 0x04000378 RID: 888
    private static int _index = 0;

    // Token: 0x04000379 RID: 889
    private static float _current_timer = 0f;

    // Token: 0x0400037A RID: 890
    private static bool _skip_frame = false;

    // Token: 0x0400037B RID: 891
    private static int _added = 0;

    // Token: 0x0400037C RID: 892
    private static bool _started = false;

    // Token: 0x0400037D RID: 893
    private static bool _has_actions = false;

    // Token: 0x0400037E RID: 894
    private static List<MapLoaderContainer> _actions = new List<MapLoaderContainer>();

    // Token: 0x0400037F RID: 895
    public static string latest_called_id = string.Empty;

    // Token: 0x04000380 RID: 896
    public static string latest_time = string.Empty;

    // Token: 0x04000381 RID: 897
    private static MapLoaderContainer _last_action;

    // Token: 0x04000382 RID: 898
    private static bool _toggled_console = false;

    // Token: 0x04000383 RID: 899
    private static int _last_i = -1;
}
using System;
using System.Collections.Generic;
using System.Runtime.CompilerServices;
using Beebyte.Obfuscator;
using UnityEngine;
using UnityEngine.CrashReportHandler;

// Token: 0x020001BE RID: 446
[ObfuscateLiterals]
public class Config
{
    // Token: 0x17000060 RID: 96
    // (get) Token: 0x06000CFD RID: 3325 RVA: 0x000B7194 File Offset: 0x000B5394
    public static bool worldLoading
    {
        get
        {
            return SmoothLoader.isLoading();
        }
    }

    // Token: 0x17000061 RID: 97
    // (get) Token: 0x06000CFE RID: 3326 RVA: 0x000B719B File Offset: 0x000B539B
    // (set) Token: 0x06000CFF RID: 3327 RVA: 0x000B71A2 File Offset: 0x000B53A2
    public static bool paused
    {
        get
        {
            return Config._paused;
        }
        set
        {
            Config._paused = value;
        }
    }

    // Token: 0x17000062 RID: 98
    // (get) Token: 0x06000D01 RID: 3329 RVA: 0x000B71B2 File Offset: 0x000B53B2
    // (set) Token: 0x06000D00 RID: 3328 RVA: 0x000B71AA File Offset: 0x000B53AA
    public static bool hasPremium
    {
        [MethodImpl(MethodImplOptions.AggressiveInlining)]
        get
        {
            return !Config.editor_test_rewards_from_ads && Config._hpr;
        }
        set
        {
            Config._hpr = value;
        }
    }

    // Token: 0x17000063 RID: 99
    // (get) Token: 0x06000D02 RID: 3330 RVA: 0x000B71C2 File Offset: 0x000B53C2
    // (set) Token: 0x06000D03 RID: 3331 RVA: 0x000B71C9 File Offset: 0x000B53C9
    public static string current_brush
    {
        get
        {
            return Config._current_brush;
        }
        set
        {
            Config._current_brush = value;
            Config.current_brush_data = Brush.get(value);
        }
    }

    // Token: 0x17000064 RID: 100
    // (get) Token: 0x06000D04 RID: 3332 RVA: 0x000B71DC File Offset: 0x000B53DC
    // (set) Token: 0x06000D05 RID: 3333 RVA: 0x000B71E3 File Offset: 0x000B53E3
    public static BrushData current_brush_data { get; private set; }

    // Token: 0x06000D06 RID: 3334 RVA: 0x000B71EB File Offset: 0x000B53EB
    public static void setDraggingObject(IDraggable pGameObject)
    {
        Config.dragging_item_object = pGameObject;
        Config._dragging_item = true;
    }

    // Token: 0x06000D07 RID: 3335 RVA: 0x000B71F9 File Offset: 0x000B53F9
    public static bool isDraggingObject(IDraggable pGameObject)
    {
        return Config.dragging_item_object != null && Config.dragging_item_object == pGameObject;
    }

    // Token: 0x06000D08 RID: 3336 RVA: 0x000B720F File Offset: 0x000B540F
    public static IDraggable getDraggingObject()
    {
        return Config.dragging_item_object;
    }

    // Token: 0x06000D09 RID: 3337 RVA: 0x000B7216 File Offset: 0x000B5416
    public static void clearDraggingObject()
    {
        Config._dragging_item = false;
        Config.dragging_item_object = null;
    }

    // Token: 0x06000D0A RID: 3338 RVA: 0x000B7224 File Offset: 0x000B5424
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public static bool isDraggingItem()
    {
        return Config._dragging_item;
    }

    // Token: 0x17000065 RID: 101
    // (get) Token: 0x06000D0B RID: 3339 RVA: 0x000B722B File Offset: 0x000B542B
    public static bool joyControls
    {
        get
        {
            return false;
        }
    }

    // Token: 0x06000D0C RID: 3340 RVA: 0x000B722E File Offset: 0x000B542E
    public static void setWorldSpeed(WorldTimeScaleAsset pAsset, bool pUpdateDebug = true)
    {
        if (!pAsset.sonic && pUpdateDebug)
        {
            DebugConfig.setOption(DebugOption.SonicSpeed, false, false);
        }
        Config.time_scale_asset = pAsset;
    }

    // Token: 0x06000D0D RID: 3341 RVA: 0x000B724C File Offset: 0x000B544C
    public static void setWorldSpeed(string pID, bool pUpdateDebug = true)
    {
        Config.setWorldSpeed(AssetManager.time_scales.get(pID), pUpdateDebug);
    }

    // Token: 0x06000D0E RID: 3342 RVA: 0x000B725F File Offset: 0x000B545F
    public static void nextWorldSpeed(bool pCycle = false)
    {
        Config.setWorldSpeed(Config.time_scale_asset.getNext(pCycle), true);
    }

    // Token: 0x06000D0F RID: 3343 RVA: 0x000B7272 File Offset: 0x000B5472
    public static void prevWorldSpeed()
    {
        Config.setWorldSpeed(Config.time_scale_asset.getPrevious(false), true);
    }

    // Token: 0x06000D10 RID: 3344 RVA: 0x000B7285 File Offset: 0x000B5485
    public static void setPortrait(bool pValue)
    {
        if (pValue)
        {
            if (Screen.orientation != ScreenOrientation.Portrait)
            {
                Screen.orientation = ScreenOrientation.Portrait;
                World.world.camera.ResetAspect();
                return;
            }
        }
        else if (Screen.orientation != ScreenOrientation.LandscapeLeft)
        {
            Screen.orientation = ScreenOrientation.LandscapeLeft;
            World.world.camera.ResetAspect();
        }
    }

    // Token: 0x06000D11 RID: 3345 RVA: 0x000B72C5 File Offset: 0x000B54C5
    public static void enableAutoRotation(bool pValue)
    {
    }

    // Token: 0x06000D12 RID: 3346 RVA: 0x000B72C8 File Offset: 0x000B54C8
    public static bool skipCrashMetadata()
    {
        return Config.MODDED || Config.experimental_mode || !(Config.gen ?? true);
    }

    // Token: 0x06000D13 RID: 3347 RVA: 0x000B7304 File Offset: 0x000B5504
    [Skip]
    [SkipRename]
    [DoNotFake]
    public static void updateCrashMetadata()
    {
        if (!Config.game_loaded)
        {
            return;
        }
        if (SmoothLoader.isLoading())
        {
            return;
        }
        if (Config.skip)
        {
            return;
        }
        if (Config.timer > 0f)
        {
            Config.timer -= Time.fixedDeltaTime;
            return;
        }
        Config.timer = 30f;
        if (Config.skipCrashMetadata())
        {
            Config.skip = true;
            CrashReportHandler.enableCaptureExceptions = false;
            return;
        }
        CrashReportHandler.enableCaptureExceptions = false;
        try
        {
            if (!string.IsNullOrEmpty(Config.versionCodeText))
            {
                CrashReportHandler.SetUserMetadata("u_versionCodeText", Config.versionCodeText);
            }
            if (!string.IsNullOrEmpty(Config.gitCodeText))
            {
                CrashReportHandler.SetUserMetadata("u_gitCodeText", Config.gitCodeText);
            }
            CrashReportHandler.SetUserMetadata("c_MODDED", Config.MODDED.ToString());
            CrashReportHandler.SetUserMetadata("c_HAVE_PREMIUM", Config.hasPremium.ToString());
            CrashReportHandler.SetUserMetadata("c_game_speed", Config.time_scale_asset.id);
            CrashReportHandler.SetUserMetadata("c_sonic_speed", DebugConfig.isOn(DebugOption.SonicSpeed).ToString());
            CrashReportHandler.SetUserMetadata("c_show_map_names", World.world.showMapNames().ToString());
            if (DebugConfig.instance.debugButton.gameObject.activeSelf)
            {
                CrashReportHandler.SetUserMetadata("c_debug_button", "visible");
            }
            CrashReportHandler.SetUserMetadata("o_camera_lowRes", World.world.quality_changer.isLowRes().ToString());
            CrashReportHandler.SetUserMetadata("o_selected_power", World.world.getSelectedPowerID());
            CrashReportHandler.SetUserMetadata("c_map_mode", World.world.zone_calculator.getCurrentModeDebug().ToString());
            if (ScrollWindow.isWindowActive())
            {
                CrashReportHandler.SetUserMetadata("o_window_open", ScrollWindow.getCurrentWindow().screen_id);
            }
            else
            {
                CrashReportHandler.SetUserMetadata("o_window_open", "false");
            }
            string tPowerLog = "";
            for (int i = 0; i < Config._loggedSelectedPowers.Count; i++)
            {
                tPowerLog = tPowerLog + Config._loggedSelectedPowers[i] + ",";
            }
            CrashReportHandler.SetUserMetadata("o_power_history", tPowerLog);
            CrashReportHandler.SetUserMetadata("map_units", World.world.units.Count.ToString());
            CrashReportHandler.SetUserMetadata("map_buildings", World.world.buildings.Count.ToString());
            CrashReportHandler.SetUserMetadata("map_civ_kingdoms", World.world.kingdoms.Count.ToString());
            CrashReportHandler.SetUserMetadata("map_cultures", World.world.cultures.Count.ToString());
            CrashReportHandler.SetUserMetadata("map_layers", World.world.zone_calculator.zones.Count.ToString());
            CrashReportHandler.SetUserMetadata("map_chunks", World.world.map_chunk_manager.chunks.Length.ToString());
            CrashReportHandler.SetUserMetadata("map_drops_active", World.world.drop_manager.getActiveIndex().ToString());
            CrashReportHandler.SetUserMetadata("map_stackEffects_active", World.world.stack_effects.countActive().ToString());
            try
            {
                CrashReportHandler.SetUserMetadata("u_installMode", Application.installMode.ToString());
                CrashReportHandler.SetUserMetadata("u_sandboxType", Application.sandboxType.ToString());
                CrashReportHandler.SetUserMetadata("g_activeTier", Graphics.activeTier.ToString());
            }
            catch (Exception)
            {
            }
        }
        catch (Exception message)
        {
            Config.skip = true;
            Debug.LogError(message);
            throw;
        }
        CrashReportHandler.enableCaptureExceptions = true;
    }

    // Token: 0x06000D14 RID: 3348 RVA: 0x000B76C0 File Offset: 0x000B58C0
    public static void logSelectedPower(GodPower pPower)
    {
        if (Config._loggedSelectedPowers.Count > 5)
        {
            Config._loggedSelectedPowers.RemoveAt(0);
        }
        Config._loggedSelectedPowers.Add(pPower.id);
    }

    // Token: 0x06000D15 RID: 3349 RVA: 0x000B76EA File Offset: 0x000B58EA
    public static void scheduleGC(string pWhere, bool pUnloadResources = false)
    {
        Config._scheduledGC = true;
        if (pUnloadResources)
        {
            Config._scheduledGCUnload = true;
        }
    }

    // Token: 0x06000D16 RID: 3350 RVA: 0x000B76FB File Offset: 0x000B58FB
    public static void checkGC()
    {
        if (Config._scheduledGC)
        {
            Config.forceGC("scheduled", Config._scheduledGCUnload);
        }
    }

    // Token: 0x06000D17 RID: 3351 RVA: 0x000B7713 File Offset: 0x000B5913
    public static void forceGC(string pWhere, bool pUnloadResources = false)
    {
        if (pUnloadResources)
        {
            Resources.UnloadUnusedAssets();
            GC.Collect(1, GCCollectionMode.Optimized, false);
        }
        else
        {
            GC.Collect(0, GCCollectionMode.Optimized, false);
        }
        Config._scheduledGC = false;
        Config._scheduledGCUnload = false;
    }

    // Token: 0x17000066 RID: 102
    // (get) Token: 0x06000D18 RID: 3352 RVA: 0x000B773C File Offset: 0x000B593C
    public static string gs { get; } = "";

    // Token: 0x06000D19 RID: 3353 RVA: 0x000B7743 File Offset: 0x000B5943
    public static void fireworksCheck(bool pEnabled)
    {
        Config.EVERYTHING_FIREWORKS = pEnabled;
        PlayerConfig.instance.data.fireworksCheck2025 = pEnabled;
        PlayerConfig.saveData();
    }

    // Token: 0x06000D1A RID: 3354 RVA: 0x000B7760 File Offset: 0x000B5960
    public static void valCheck(bool pEnabled)
    {
        PlayerConfig.instance.data.valCheck2025 = pEnabled;
        PlayerConfig.saveData();
    }

    // Token: 0x06000D1B RID: 3355 RVA: 0x000B7777 File Offset: 0x000B5977
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public static void pCheck(bool value)
    {
        PlayerConfig.instance.data.pPossible2025 = value;
        PlayerConfig.saveData();
    }

    // Token: 0x06000D1C RID: 3356 RVA: 0x000B778E File Offset: 0x000B598E
    public static void magicCheck(bool pEnabled)
    {
        Config.EVERYTHING_MAGIC_COLOR = pEnabled;
        PlayerConfig.instance.data.magicCheck2025 = pEnabled;
        PlayerConfig.saveData();
    }

    // Token: 0x06000D1D RID: 3357 RVA: 0x000B77AB File Offset: 0x000B59AB
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public static void givePremium()
    {
        InAppManager.activatePrem(false);
    }

    // Token: 0x06000D1E RID: 3358 RVA: 0x000B77B3 File Offset: 0x000B59B3
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public static void removePremium()
    {
        Config.hasPremium = false;
        PlayerConfig.instance.data.premium = false;
        PlayerConfig.saveData();
        PremiumElementsChecker.checkElements();
    }

    // Token: 0x04000C67 RID: 3175
    public static bool parallel_jobs_updater = true;

    // Token: 0x04000C68 RID: 3176
    public static bool parallel_chunk_manager = true;

    // Token: 0x04000C69 RID: 3177
    public static string versionCodeText = string.Empty;

    // Token: 0x04000C6A RID: 3178
    public static string gitCodeText = string.Empty;

    // Token: 0x04000C6B RID: 3179
    public static string versionCodeDate = string.Empty;

    // Token: 0x04000C6C RID: 3180
    public static string iname = string.Empty;

    // Token: 0x04000C6D RID: 3181
    internal static bool? gen = null;

    // Token: 0x04000C6E RID: 3182
    public static string testStreamingAssets = "test";

    // Token: 0x04000C6F RID: 3183
    public static bool ui_main_hidden = false;

    // Token: 0x04000C70 RID: 3184
    public static int WORLD_SAVE_VERSION = 17;

    // Token: 0x04000C71 RID: 3185
    public static string current_map_template = "continent";

    // Token: 0x04000C72 RID: 3186
    public static string customMapSize = "standard";

    // Token: 0x04000C73 RID: 3187
    public static int customZoneX = 0;

    // Token: 0x04000C74 RID: 3188
    public static int customZoneY = 0;

    // Token: 0x04000C75 RID: 3189
    public static int customPerlinScale = 10;

    // Token: 0x04000C76 RID: 3190
    public static int customRandomShapes = 10;

    // Token: 0x04000C77 RID: 3191
    public static int customWaterLevel = 10;

    // Token: 0x04000C78 RID: 3192
    public static int ZONE_AMOUNT_X = 4;

    // Token: 0x04000C79 RID: 3193
    public static int ZONE_AMOUNT_Y = 4;

    // Token: 0x04000C7A RID: 3194
    public static string customMapSizeDefault = "standard";

    // Token: 0x04000C7B RID: 3195
    public static string maxMapSize = "iceberg";

    // Token: 0x04000C7C RID: 3196
    public static int ZONE_AMOUNT_X_DEFAULT = 3;

    // Token: 0x04000C7D RID: 3197
    public static int ZONE_AMOUNT_Y_DEFAULT = 4;

    // Token: 0x04000C7E RID: 3198
    public const int MAP_BLOCK_SIZE = 64;

    // Token: 0x04000C7F RID: 3199
    public const int CHUNK_SIZE = 16;

    // Token: 0x04000C80 RID: 3200
    public const int TILES_IN_CHUNK = 256;

    // Token: 0x04000C81 RID: 3201
    public const int CITY_ZONE_SIZE = 8;

    // Token: 0x04000C82 RID: 3202
    public const int CITY_ZONE_TILES = 64;

    // Token: 0x04000C83 RID: 3203
    public const int TILES_IN_REGION = 256;

    // Token: 0x04000C84 RID: 3204
    public const int PREVIEW_MAP_SIZE = 512;

    // Token: 0x04000C85 RID: 3205
    public static WorldTimeScaleAsset time_scale_asset = null;

    // Token: 0x04000C86 RID: 3206
    public static bool fps_lock_30 = false;

    // Token: 0x04000C87 RID: 3207
    public static bool MODDED = false;

    // Token: 0x04000C88 RID: 3208
    public static bool EVERYTHING_MAGIC_COLOR = false;

    // Token: 0x04000C89 RID: 3209
    public static bool EVERYTHING_FIREWORKS = false;

    // Token: 0x04000C8A RID: 3210
    private static bool _paused = false;

    // Token: 0x04000C8B RID: 3211
    public static bool lockGameControls = false;

    // Token: 0x04000C8C RID: 3212
    internal static string steam_name;

    // Token: 0x04000C8D RID: 3213
    internal static string steam_id;

    // Token: 0x04000C8E RID: 3214
    internal static bool steam_language_allow_detect = true;

    // Token: 0x04000C8F RID: 3215
    internal static string discordId;

    // Token: 0x04000C90 RID: 3216
    internal static string discordName;

    // Token: 0x04000C91 RID: 3217
    internal static string discordDiscriminator;

    // Token: 0x04000C92 RID: 3218
    public static bool testAds = false;

    // Token: 0x04000C93 RID: 3219
    public static bool firebaseInitiating = false;

    // Token: 0x04000C94 RID: 3220
    public static bool firebaseChecked = false;

    // Token: 0x04000C95 RID: 3221
    public static bool firebaseEnabled = true;

    // Token: 0x04000C96 RID: 3222
    public static bool authEnabled = false;

    // Token: 0x04000C97 RID: 3223
    public const string firebaseDatabaseURL = "https://worldbox-g.firebaseio.com/";

    // Token: 0x04000C98 RID: 3224
    public const string baseURL = "https://versions.superworldbox.com";

    // Token: 0x04000C99 RID: 3225
    public const string currencyURL = "https://currency.superworldbox.com";

    // Token: 0x04000C9A RID: 3226
    public static bool adsInitialized = false;

    // Token: 0x04000C9B RID: 3227
    public static bool disable_dispose_logs = true;

    // Token: 0x04000C9C RID: 3228
    public static bool disable_loading_logs = false;

    // Token: 0x04000C9D RID: 3229
    public static bool disable_discord = false;

    // Token: 0x04000C9E RID: 3230
    public static bool disable_steam = false;

    // Token: 0x04000C9F RID: 3231
    public static bool disable_db = false;

    // Token: 0x04000CA0 RID: 3232
    public static bool disable_startup_window = false;

    // Token: 0x04000CA1 RID: 3233
    public static bool disable_tutorial = false;

    // Token: 0x04000CA2 RID: 3234
    public static bool debug_log_meta_ranks = false;

    // Token: 0x04000CA3 RID: 3235
    public static string debug_last_selected_power_button;

    // Token: 0x04000CA4 RID: 3236
    public static string debug_last_window;

    // Token: 0x04000CA5 RID: 3237
    public static int debug_worlds_loaded;

    // Token: 0x04000CA6 RID: 3238
    public static WindowStats debug_window_stats;

    // Token: 0x04000CA7 RID: 3239
    public static bool load_random_test_map = false;

    // Token: 0x04000CA8 RID: 3240
    public static bool load_new_map = false;

    // Token: 0x04000CA9 RID: 3241
    public static bool load_dragon = false;

    // Token: 0x04000CAA RID: 3242
    public static bool load_save_on_start = false;

    // Token: 0x04000CAB RID: 3243
    public static bool load_save_from_path = false;

    // Token: 0x04000CAC RID: 3244
    public static string load_test_save_path = "";

    // Token: 0x04000CAD RID: 3245
    public static bool load_test_map = false;

    // Token: 0x04000CAE RID: 3246
    public static int load_save_on_start_slot = 1;

    // Token: 0x04000CAF RID: 3247
    public static string auto_test_on_start = null;

    // Token: 0x04000CB0 RID: 3248
    public static float LOAD_TIME_INIT = 0f;

    // Token: 0x04000CB1 RID: 3249
    public static float LOAD_TIME_CREATE = 0f;

    // Token: 0x04000CB2 RID: 3250
    public static float LOAD_TIME_GENERATE = 0f;

    // Token: 0x04000CB3 RID: 3251
    public static float LAST_LOAD_TIME = 0f;

    // Token: 0x04000CB4 RID: 3252
    public static bool editor_test_rewards_from_ads = false;

    // Token: 0x04000CB5 RID: 3253
    private static bool _hpr = false;

    // Token: 0x04000CB6 RID: 3254
    public static bool sprite_animations_on = true;

    // Token: 0x04000CB7 RID: 3255
    public static bool shadows_active = false;

    // Token: 0x04000CB8 RID: 3256
    public static bool tooltips_active = true;

    // Token: 0x04000CB9 RID: 3257
    public static bool preload_windows = true;

    // Token: 0x04000CBA RID: 3258
    public static bool preload_quantum_sprites = true;

    // Token: 0x04000CBB RID: 3259
    public static bool preload_buildings = true;

    // Token: 0x04000CBC RID: 3260
    public static bool preload_units = true;

    // Token: 0x04000CBD RID: 3261
    public static bool autosaves = true;

    // Token: 0x04000CBE RID: 3262
    public static bool graphs = true;

    // Token: 0x04000CBF RID: 3263
    public static bool experimental_mode = false;

    // Token: 0x04000CC0 RID: 3264
    public static bool wbb_confirmed = false;

    // Token: 0x04000CC1 RID: 3265
    public static bool full_screen = true;

    // Token: 0x04000CC2 RID: 3266
    public static bool firebase_available = false;

    // Token: 0x04000CC3 RID: 3267
    public static bool upload_available = false;

    // Token: 0x04000CC4 RID: 3268
    public static bool game_loaded = false;

    // Token: 0x04000CC5 RID: 3269
    public static bool show_console_on_start = false;

    // Token: 0x04000CC6 RID: 3270
    public static bool show_console_on_error = true;

    // Token: 0x04000CC7 RID: 3271
    public static bool editor_maxim = false;

    // Token: 0x04000CC8 RID: 3272
    public static bool editor_mastef = false;

    // Token: 0x04000CC9 RID: 3273
    public static bool editor_nikon = false;

    // Token: 0x04000CCA RID: 3274
    public static bool editor_devs = false;

    // Token: 0x04000CCB RID: 3275
    public static bool fmod_test_build = false;

    // Token: 0x04000CCC RID: 3276
    public static bool isEditor = false;

    // Token: 0x04000CCD RID: 3277
    public static bool isMobile = false;

    // Token: 0x04000CCE RID: 3278
    public static bool isIos = false;

    // Token: 0x04000CCF RID: 3279
    public static bool isAndroid = false;

    // Token: 0x04000CD0 RID: 3280
    public static bool isComputer = true;

    // Token: 0x04000CD1 RID: 3281
    public static bool greyGooDamaged = false;

    // Token: 0x04000CD2 RID: 3282
    public static GodPower power_to_unlock;

    // Token: 0x04000CD3 RID: 3283
    private static string _current_brush = "circ_5";

    // Token: 0x04000CD5 RID: 3285
    public static string selected_trait_editor = string.Empty;

    // Token: 0x04000CD6 RID: 3286
    public static Alliance selected_alliance;

    // Token: 0x04000CD7 RID: 3287
    public static Army selected_army;

    // Token: 0x04000CD8 RID: 3288
    public static City selected_city;

    // Token: 0x04000CD9 RID: 3289
    public static Clan selected_clan;

    // Token: 0x04000CDA RID: 3290
    public static Culture selected_culture;

    // Token: 0x04000CDB RID: 3291
    public static Family selected_family;

    // Token: 0x04000CDC RID: 3292
    public static Item selected_item;

    // Token: 0x04000CDD RID: 3293
    public static Kingdom selected_kingdom;

    // Token: 0x04000CDE RID: 3294
    public static Language selected_language;

    // Token: 0x04000CDF RID: 3295
    public static Plot selected_plot;

    // Token: 0x04000CE0 RID: 3296
    public static Religion selected_religion;

    // Token: 0x04000CE1 RID: 3297
    public static Subspecies selected_subspecies;

    // Token: 0x04000CE2 RID: 3298
    public static War selected_war;

    // Token: 0x04000CE3 RID: 3299
    public static readonly SelectedObjects selected_objects = new SelectedObjects();

    // Token: 0x04000CE4 RID: 3300
    private static bool _dragging_item = false;

    // Token: 0x04000CE5 RID: 3301
    public static IDraggable dragging_item_object = null;

    // Token: 0x04000CE6 RID: 3302
    public static Kingdom whisper_A;

    // Token: 0x04000CE7 RID: 3303
    public static Kingdom whisper_B;

    // Token: 0x04000CE8 RID: 3304
    public static Kingdom unity_A;

    // Token: 0x04000CE9 RID: 3305
    public static Kingdom unity_B;

    // Token: 0x04000CEA RID: 3306
    private static float timer = 30f;

    // Token: 0x04000CEB RID: 3307
    private static bool skip = false;

    // Token: 0x04000CEC RID: 3308
    private static List<string> _loggedSelectedPowers = new List<string>();

    // Token: 0x04000CED RID: 3309
    private static bool _scheduledGC = false;

    // Token: 0x04000CEE RID: 3310
    private static bool _scheduledGCUnload = false;

    // Token: 0x04000CEF RID: 3311
    public static string gv;
}
using System;
using System.Collections.Generic;
using System.Runtime.CompilerServices;
using ai;
using ai.behaviours;
using UnityEngine;

// Token: 0x020001EC RID: 492
public class Actor : BaseSimObject, ILoadable<ActorData>, ITraitsOwner<ActorTrait>, IEquatable<Actor>, IComparable<Actor>
{
    // Token: 0x17000087 RID: 135
    // (get) Token: 0x06000E92 RID: 3730 RVA: 0x000BF66B File Offset: 0x000BD86B
    public Queue<HappinessHistory> happiness_change_history
    {
        get
        {
            return this._last_happiness_history;
        }
    }

    // Token: 0x06000E93 RID: 3731 RVA: 0x000BF674 File Offset: 0x000BD874
    protected sealed override void setDefaultValues()
    {
        base.setDefaultValues();
        this.last_decision_id = string.Empty;
        this.is_inside_building = false;
        this.inside_building = null;
        this._state_adult = false;
        this._state_baby = false;
        this._state_egg = false;
        this.next_step_position = Globals.emptyVector;
        this.shake_offset = new Vector2(0f, 0f);
        this.move_jump_offset = new Vector2(0f, 0f);
        this.shake_horizontal = true;
        this.shake_vertical = true;
        this.shake_timer = 0f;
        this.shake_active = false;
        this.shake_volume = 0.1f;
        this._is_moving = false;
        this.is_visible = false;
        this.last_sprite_renderer_enabled = false;
        this.dirty_current_tile = true;
        this.split_path = SplitPathStatus.Normal;
        this.current_path_index = 0;
        this.current_path_global = null;
        this.actor_scale = 0f;
        this.target_scale = 0f;
        this.timer_action = 0f;
        this.timer_jump_animation = 0f;
        this.hitbox_bonus_height = 0f;
        this.velocity = default(Vector3);
        this.velocity_speed = 0f;
        this.under_forces = false;
        this._flying = false;
        this.is_in_magnet = false;
        this.attack_timer = 0f;
        this.s_type_attack = WeaponType.Melee;
        this.s_type_slash = string.Empty;
        this.dirty_sprite_main = true;
        this.cached_sprite_head = null;
        this.dirty_sprite_head = true;
        this._cached_sprite_item = null;
        this._cached_hand_renderer_asset = null;
        this.s_personality = null;
        this._action_wait_after_land = false;
        this.rotation_cooldown = 0f;
        this.target_angle = default(Vector3);
        this._timeout_targets = 0f;
        this._precalc_movement_speed_skips = 0;
        this.flip_angle = 0f;
        this.lastX = -10f;
        this.lastY = -10f;
        this._jump_time = 0f;
        this._death_timer_color_stage_1 = 1f;
        this._death_timer_alpha_stage_2 = 1f;
        this.color = Color.white;
        this.ate_last_item_id = string.Empty;
        this.timestamp_session_ate_food = 0.0;
        this.timestamp_tween_session_social = 0.0;
        this.timestamp_profession_set = 0.0;
        this._timestamp_augmentation_effects = 0.0;
        this.show_shadow = false;
        this._decision_cooldowns = Toolbox.checkArraySize<double>(this._decision_cooldowns, AssetManager.decisions_library.list.Count);
        this._decision_disabled = Toolbox.checkArraySize<bool>(this._decision_disabled, AssetManager.decisions_library.list.Count);
        this.decisions = Toolbox.checkArraySize<DecisionAsset>(this.decisions, AssetManager.decisions_library.list.Count);
    }

    // Token: 0x06000E94 RID: 3732 RVA: 0x000BF920 File Offset: 0x000BDB20
    public void setShowShadow(bool pShadow)
    {
        this.show_shadow = pShadow;
    }

    // Token: 0x17000088 RID: 136
    // (get) Token: 0x06000E95 RID: 3733 RVA: 0x000BF92C File Offset: 0x000BDB2C
    public string coloredName
    {
        get
        {
            if (this.data == null)
            {
                return "";
            }
            Kingdom kingdom = this.kingdom;
            if (((kingdom != null) ? kingdom.kingdomColor : null) != null)
            {
                return string.Concat(new string[]
                {
                    "<color=",
                    this.kingdom.kingdomColor.color_text,
                    ">",
                    this.getName(),
                    "</color>"
                });
            }
            return this.getName();
        }
    }

    // Token: 0x06000E96 RID: 3734 RVA: 0x000BF9A4 File Offset: 0x000BDBA4
    private void updateChildrenList(List<BaseActorComponent> pList, float pElapsed)
    {
        if (pList == null)
        {
            return;
        }
        for (int i = 0; i < pList.Count; i++)
        {
            pList[i].update(pElapsed);
        }
    }

    // Token: 0x06000E97 RID: 3735 RVA: 0x000BF9D4 File Offset: 0x000BDBD4
    private void updateChildrenListSimple(List<ActorSimpleComponent> pList, float pElapsed)
    {
        if (pList == null)
        {
            return;
        }
        for (int i = 0; i < pList.Count; i++)
        {
            pList[i].update(pElapsed);
        }
    }

    // Token: 0x06000E98 RID: 3736 RVA: 0x000BFA04 File Offset: 0x000BDC04
    public void setAsset(ActorAsset pAsset)
    {
        if (this.asset != null)
        {
            this.asset.units.Remove(this);
        }
        this.asset = pAsset;
        this.asset.units.Add(this);
        this.setStatsDirty();
        if (this.canUseItems() && !this.hasEquipment())
        {
            this.equipment = new ActorEquipment();
        }
    }

    // Token: 0x06000E99 RID: 3737 RVA: 0x000BFA68 File Offset: 0x000BDC68
    internal override void create()
    {
        base.create();
        if (this.ai == null)
        {
            this.ai = new AiSystemActor(this);
        }
        this.ai.jobs_library = AssetManager.job_actor;
        this.ai.task_library = AssetManager.tasks_actor;
        this.ai.nextJobDelegate = new GetNextJobID(this.getNextJob);
        this.ai.clearActionDelegate = new JobAction(this.clearBeh);
        this.ai.subscribeToTaskSwitch(new TaskSwitchAction(this.setItemSpriteRenderDirty));
        if (this.targets_to_ignore_timer == null)
        {
            this.targets_to_ignore_timer = new WorldTimer(3f, new Action(base.clearIgnoreTargets));
        }
        this._flying = this.asset.flying;
        this.setActorScale(this.asset.base_stats["scale"] * 0.6f);
        if (this.asset.finish_scale_on_creation)
        {
            this.target_scale = this.asset.base_stats["scale"];
            this.finishScale();
        }
        base.setObjectType(MapObjectType.Actor);
        this.setShowShadow(this.asset.shadow);
        if (this.asset.has_sound_idle_loop)
        {
            this.idle_loop_sound = new ActorIdleLoopSound(this.asset, this);
        }
        if (this.isHovering())
        {
            this.move_jump_offset.y = this.asset.hovering_min;
        }
        this.addChildren();
        if (this.asset.kingdom_id_wild.Contains("ants"))
        {
            AchievementLibrary.achievementAntWorld.check(null, null, null);
        }
        if (this.asset.kingdom_id_wild.Contains("monkey"))
        {
            AchievementLibrary.achievementPlanetOfTheApes.check(null, null, null);
        }
        if (this.asset.cancel_beh_on_land)
        {
            this.callbacks_landed = (BaseActionActor)Delegate.Combine(this.callbacks_landed, new BaseActionActor(this.checkLand));
        }
        this.callbacks_landed = (BaseActionActor)Delegate.Combine(this.callbacks_landed, new BaseActionActor(this.checkDeathOutsideMap));
        this.callbacks_on_death = (BaseActionActor)Delegate.Combine(this.callbacks_on_death, new BaseActionActor(this.playDeathSound));
        this.callbacks_magnet_update = (BaseActionActor)Delegate.Combine(this.callbacks_magnet_update, new BaseActionActor(this.actionMagnetAnimation));
    }

    // Token: 0x06000E9A RID: 3738 RVA: 0x000BFCB0 File Offset: 0x000BDEB0
    public bool canSeeTileBasedOnDirection(WorldTile pTile)
    {
        bool tHappenedOnLeft = this.isTileOnTheLeft(pTile);
        return this.is_looking_left == tHappenedOnLeft;
    }

    // Token: 0x06000E9B RID: 3739 RVA: 0x000BFCD4 File Offset: 0x000BDED4
    public void setParent1(Actor pActor, bool pIncreaseChildren = true)
    {
        this.data.parent_id_1 = pActor.data.id;
        if (pIncreaseChildren)
        {
            pActor.increaseChildren();
        }
    }

    // Token: 0x06000E9C RID: 3740 RVA: 0x000BFCF5 File Offset: 0x000BDEF5
    public void setParent2(Actor pActor, bool pIncreaseChildren = true)
    {
        this.data.parent_id_2 = pActor.data.id;
        if (pIncreaseChildren)
        {
            pActor.increaseChildren();
        }
    }

    // Token: 0x06000E9D RID: 3741 RVA: 0x000BFD18 File Offset: 0x000BDF18
    internal void setProfession(UnitProfession pType, bool pCancelBeh = true)
    {
        this._profession = pType;
        this.profession_asset = AssetManager.professions.get(pType);
        this.setStatsDirty();
        if (base.hasCity())
        {
            this.city.setCitizensDirty();
        }
        if (pCancelBeh)
        {
            this.cancelAllBeh();
        }
        this.timestamp_profession_set = World.world.getCurWorldTime();
        this.clearSprites();
    }

    // Token: 0x06000E9E RID: 3742 RVA: 0x000BFD78 File Offset: 0x000BDF78
    private void addChildren()
    {
        if (this.asset.avatar_prefab != string.Empty)
        {
            GameObject tPrefab = Resources.Load<GameObject>("actors/" + this.asset.avatar_prefab);
            this.avatar = Object.Instantiate<GameObject>(tPrefab, World.world.transform_units);
            if (this.avatar.HasComponent<SpriteAnimation>())
            {
                this.sprite_animation = this.avatar.GetComponent<SpriteAnimation>();
                this.batch.c_sprite_animations.Add(this);
            }
            if (this.avatar.HasComponent<Crabzilla>())
            {
                this.addChild(this.avatar.GetComponent<Crabzilla>());
            }
            if (this.avatar.HasComponent<GodFinger>())
            {
                this.addChild(this.avatar.GetComponent<GodFinger>());
            }
            if (this.avatar.HasComponent<Dragon>())
            {
                this.addChild(this.avatar.GetComponent<Dragon>());
            }
            if (this.avatar.HasComponent<UFO>())
            {
                this.addChild(this.avatar.GetComponent<UFO>());
            }
        }
        if (this.asset.is_boat)
        {
            this.addChildSimple(new Boat());
        }
        if (this.children_pre_behaviour != null || this.children_special != null)
        {
            this.batch.c_update_children.Add(this);
        }
    }

    // Token: 0x06000E9F RID: 3743 RVA: 0x000BFEB0 File Offset: 0x000BE0B0
    private void addChild(BaseActorComponent pObject)
    {
        if (this.children_special == null)
        {
            this.children_special = new List<BaseActorComponent>();
            this._dict_special = new Dictionary<Type, BaseActorComponent>();
        }
        Type tType = pObject.GetType();
        this.children_special.Add(pObject);
        this._dict_special.Add(tType, pObject);
        pObject.create(this);
    }

    // Token: 0x06000EA0 RID: 3744 RVA: 0x000BFF04 File Offset: 0x000BE104
    private void addChildSimple(ActorSimpleComponent pObject)
    {
        if (this.children_pre_behaviour == null)
        {
            this.children_pre_behaviour = new List<ActorSimpleComponent>();
            this.dict_pre_behaviour = new Dictionary<Type, ActorSimpleComponent>();
        }
        Type tType = pObject.GetType();
        this.children_pre_behaviour.Add(pObject);
        this.dict_pre_behaviour.Add(tType, pObject);
        pObject.create(this);
    }

    // Token: 0x06000EA1 RID: 3745 RVA: 0x000BFF58 File Offset: 0x000BE158
    public T getActorComponent<T>() where T : BaseActorComponent
    {
        if (this._dict_special == null)
        {
            return default(T);
        }
        BaseActorComponent tResult;
        if (this._dict_special.TryGetValue(typeof(T), out tResult))
        {
            return tResult as T;
        }
        return default(T);
    }

    // Token: 0x06000EA2 RID: 3746 RVA: 0x000BFFA8 File Offset: 0x000BE1A8
    public T getSimpleComponent<T>() where T : ActorSimpleComponent
    {
        ActorSimpleComponent tResult;
        if (this.dict_pre_behaviour.TryGetValue(typeof(T), out tResult))
        {
            return tResult as T;
        }
        return default(T);
    }

    // Token: 0x06000EA3 RID: 3747 RVA: 0x000BFFE3 File Offset: 0x000BE1E3
    private void playDeathSound(Actor pActor)
    {
        if (!this.asset.has_sound_death)
        {
            return;
        }
        MusicBox.playSound(this.asset.sound_death, this.current_tile, true, true);
    }

    // Token: 0x06000EA4 RID: 3748 RVA: 0x000C000B File Offset: 0x000BE20B
    public void playIdleSound()
    {
        if (!this.asset.has_sound_idle)
        {
            return;
        }
        MusicBox.playIdleSoundVisibleOnly(this.asset.sound_idle, this.current_tile);
    }

    // Token: 0x06000EA5 RID: 3749 RVA: 0x000C0034 File Offset: 0x000BE234
    public void startShake(float pTimer = 0.3f, float pVol = 0.1f, bool pHorizontal = true, bool pVertical = true)
    {
        this.shake_horizontal = pHorizontal;
        this.shake_vertical = pVertical;
        this.shake_timer = Mathf.Min(pTimer, this.asset.max_shake_timer);
        this.shake_volume = pVol;
        this.shake_active = true;
        this.batch.c_shake.Add(this);
    }

    // Token: 0x06000EA6 RID: 3750 RVA: 0x000C0088 File Offset: 0x000BE288
    public Vector3 getThrowStartPosition()
    {
        Vector3 tCurrentActorPos = this.cur_transform_position;
        Vector3 tActorScale = this.current_scale;
        Vector3 current_rotation = this.current_rotation;
        AnimationFrameData tFrameData = this.getAnimationFrameData();
        float tFrameDataPosX = 0f;
        float tFrameDataPosY = 0f;
        if (tFrameData != null)
        {
            tFrameDataPosX = tFrameData.pos_item.x;
            tFrameDataPosY = tFrameData.pos_item.y;
        }
        float tX = tCurrentActorPos.x + tFrameDataPosX * tActorScale.x;
        float tY = tCurrentActorPos.y + tFrameDataPosY * tActorScale.y;
        Vector3 tItemPosition = new Vector3(tX, tY, -0.01f);
        Vector3 tAngle = current_rotation;
        if (tAngle.y != 0f || tAngle.z != 0f)
        {
            Vector3 t_pivot = new Vector3(tCurrentActorPos.x, tCurrentActorPos.y, 0f);
            tItemPosition = Toolbox.RotatePointAroundPivot(ref tItemPosition, ref t_pivot, ref tAngle);
            tItemPosition.z = -0.01f;
        }
        return tItemPosition;
    }

    // Token: 0x06000EA7 RID: 3751 RVA: 0x000C015D File Offset: 0x000BE35D
    public void checkDefaultProfession()
    {
        this.setProfession(UnitProfession.Unit, false);
    }

    // Token: 0x06000EA8 RID: 3752 RVA: 0x000C0168 File Offset: 0x000BE368
    public void addAfterglowStatus()
    {
        float tAdjustedTimeout = (float)this.asset.months_breeding_timeout * 5f;
        base.addStatusEffect("afterglow", tAdjustedTimeout, true);
    }

    // Token: 0x06000EA9 RID: 3753 RVA: 0x000C0198 File Offset: 0x000BE398
    public void updateHover(float pElapsed)
    {
        if (!base.isAlive())
        {
            this.changeMoveJumpOffset(-pElapsed * 10f);
            return;
        }
        if (this.isOnGround())
        {
            this.changeMoveJumpOffset(-pElapsed * 3f);
        }
        else if (this.move_jump_offset.y < this.asset.hovering_min)
        {
            this.changeMoveJumpOffset(pElapsed * 3f);
            return;
        }
        if (this._hover_timer > 0f)
        {
            this._hover_timer -= pElapsed;
            return;
        }
        this._hover_timer = 1f + Randy.randomFloat(0f, 4f);
        if (World.world.isPaused())
        {
            return;
        }
        switch (this._hover_state)
        {
            case HoverState.Hover:
                if (Randy.randomBool())
                {
                    this._hover_state = HoverState.Down;
                    return;
                }
                this._hover_state = HoverState.Up;
                return;
            case HoverState.Up:
                this._hover_state = HoverState.Hover;
                if (this.move_jump_offset.y < this.asset.hovering_max)
                {
                    this.changeMoveJumpOffset(pElapsed * 3f);
                    return;
                }
                break;
            case HoverState.Down:
                this._hover_state = HoverState.Hover;
                if (this.move_jump_offset.y > this.asset.hovering_min)
                {
                    this.changeMoveJumpOffset(-pElapsed * 3f);
                }
                break;
            default:
                return;
        }
    }

    // Token: 0x06000EAA RID: 3754 RVA: 0x000C02CC File Offset: 0x000BE4CC
    public void updatePollinate(float pElapsed)
    {
        if (!base.isAlive())
        {
            return;
        }
        if (!this.is_moving)
        {
            BehaviourTaskActor task = this.ai.task;
            if (((task != null) ? task.id : null) == "pollinate")
            {
                this.setHoverState(HoverState.Down);
                this.changeMoveJumpOffset(-pElapsed * 3f);
                return;
            }
        }
        this.setHoverState(HoverState.Up);
        if (this.move_jump_offset.y < this.asset.hovering_max)
        {
            this.changeMoveJumpOffset(pElapsed * 3f);
        }
    }

    // Token: 0x06000EAB RID: 3755 RVA: 0x000C0350 File Offset: 0x000BE550
    private void checkCalibrateTargetPosition()
    {
        if (this.hasRangeAttack())
        {
            return;
        }
        if (this.beh_actor_target == null)
        {
            return;
        }
        BaseSimObject tTarget = this.beh_actor_target;
        if (this.hasTask() && this.ai.action != null && this.ai.action.calibrate_target_position && tTarget != null && tTarget.isActor())
        {
            Actor tActorTarget = this.beh_actor_target.a;
            float num = (float)Toolbox.SquaredDist(tActorTarget.current_tile.x, tActorTarget.current_tile.y, this.tile_target.x, this.tile_target.y);
            float tPositionDistance = this.ai.action.check_actor_target_position_distance * this.ai.action.check_actor_target_position_distance;
            if (num > tPositionDistance)
            {
                this.clearPathForCalibration();
                this.ai.action.startExecute(this);
            }
        }
    }

    // Token: 0x06000EAC RID: 3756 RVA: 0x000C042F File Offset: 0x000BE62F
    internal override bool addStatusEffect(StatusAsset pStatusAsset, float pOverrideTimer = 0f, bool pColorEffect = true)
    {
        if (pStatusAsset.affects_mind && this.hasTag("strong_mind"))
        {
            return false;
        }
        bool flag = base.addStatusEffect(pStatusAsset, pOverrideTimer, pColorEffect);
        if (flag && pColorEffect)
        {
            this.startColorEffect(ActorColorEffect.White);
        }
        return flag;
    }

    // Token: 0x06000EAD RID: 3757 RVA: 0x000C045D File Offset: 0x000BE65D
    public void setTargetAngleZ(float pValue)
    {
        this.target_angle.z = pValue;
    }

    // Token: 0x06000EAE RID: 3758 RVA: 0x000C046B File Offset: 0x000BE66B
    public void lookTowardsPosition(Vector2 pDirection)
    {
        if (!this.asset.can_flip)
        {
            return;
        }
        if (this.current_position.x < pDirection.x)
        {
            this.setFlip(true);
            return;
        }
        this.setFlip(false);
    }

    // Token: 0x06000EAF RID: 3759 RVA: 0x000C049D File Offset: 0x000BE69D
    public override void setStatsDirty()
    {
        if (base.isAlive())
        {
            this.batch.c_stats_dirty.Add(this);
        }
        base.setStatsDirty();
        this.setItemSpriteRenderDirty();
    }

    // Token: 0x06000EB0 RID: 3760 RVA: 0x000C04C4 File Offset: 0x000BE6C4
    private void checkRageDemon()
    {
        if (!WorldLawLibrary.world_law_disasters_other.isEnabled())
        {
            return;
        }
        if (this.canTurnIntoDemon() && World.world_era.era_disaster_rage_brings_demons)
        {
            if (this.hasTrait("blessed"))
            {
                return;
            }
            if (this.isFavorite())
            {
                return;
            }
            if (base.hasStatus("rage") && Randy.randomChance(0.1f))
            {
                ActionLibrary.turnIntoDemon(this, null);
            }
        }
    }

    // Token: 0x06000EB1 RID: 3761 RVA: 0x000C052C File Offset: 0x000BE72C
    internal void updateChangeScale(float pElapsed)
    {
        if (this.actor_scale == this.target_scale)
        {
            return;
        }
        if (this.actor_scale > this.target_scale)
        {
            this.setActorScale(this.actor_scale - 0.2f * pElapsed);
            if (this.actor_scale < this.target_scale)
            {
                this.setActorScale(this.target_scale);
                return;
            }
        }
        else
        {
            this.setActorScale(this.actor_scale + 0.2f * pElapsed);
            if (this.actor_scale > this.target_scale)
            {
                this.setActorScale(this.target_scale);
            }
        }
    }

    // Token: 0x06000EB2 RID: 3762 RVA: 0x000C05B4 File Offset: 0x000BE7B4
    internal void newCreature()
    {
        this.changeHappiness("just_born", 0);
        World.world.game_stats.data.creaturesCreated += 1L;
        World.world.map_stats.creaturesCreated += 1L;
        AchievementLibrary.achievement10000Creatures.check(null, null, null);
        this.generatePersonality();
        this.checkShouldBeEgg();
        this.event_full_stats = true;
        this.updateStats();
        this.event_full_stats = true;
        if (this.needsFood())
        {
            this.setNutrition(this.getMaxNutrition(), true);
        }
    }

    // Token: 0x06000EB3 RID: 3763 RVA: 0x000C0648 File Offset: 0x000BE848
    public override void Dispose()
    {
        WorldBehaviourUnitTemperatures.removeUnit(this);
        this.clearTraitCache();
        this.idle_loop_sound = null;
        this.checkSimpleComponentListDispose(this.children_pre_behaviour);
        this.checkComponentListDispose(this.children_special);
        this._profession = UnitProfession.Nothing;
        this.sprite_animation = null;
        this.lover = null;
        this.idle_loop_sound = null;
        this.scheduled_tile_target = null;
        this._last_main_sprite = null;
        this._last_colored_sprite = null;
        this._last_color_asset = null;
        this._last_topic_sprite = null;
        this.children_special = null;
        this._dict_special = null;
        this.children_pre_behaviour = null;
        this.dict_pre_behaviour = null;
        this.avatar = null;
        this.clearDecisions();
        if (this.hasSubspecies())
        {
            World.world.subspecies.unitDied(this.subspecies);
            this.subspecies = null;
        }
        if (this.hasCulture())
        {
            World.world.cultures.unitDied(this.culture);
            this.culture = null;
        }
        this.ai.reset();
        this._last_happiness_history.Clear();
        this.citizen_job = null;
        if (base.hasCity())
        {
            World.world.cities.unitDied(this.city);
            this.city = null;
        }
        if (base.hasKingdom())
        {
            if (this.isKing())
            {
                this.kingdom.removeKing();
            }
            World.world.kingdoms.unitDied(this.kingdom);
            this.kingdom = null;
        }
        this.callbacks_on_death = null;
        this.callbacks_landed = null;
        this.callbacks_cancel_path_movement = null;
        this.callbacks_magnet_update = null;
        this.s_personality = null;
        this._s_special_effect_augmentations.Clear();
        this._s_special_effect_augmentations_timers.Clear();
        this.s_action_attack_target = null;
        this.targets_to_ignore_timer = null;
        this.clearOldPath();
        this.data = null;
        this.attackedBy = null;
        this.attack_target = null;
        this.has_attack_target = false;
        this.army = null;
        this.clan = null;
        this.culture = null;
        this.subspecies = null;
        this.language = null;
        this.plot = null;
        this.religion = null;
        this.family = null;
        this.beh_tile_target = null;
        this.beh_building_target = null;
        this.beh_actor_target = null;
        this.beh_book_target = null;
        this.exitBuilding();
        this.inside_boat = null;
        this.is_inside_boat = false;
        this.army = null;
        this.batch = null;
        this.equipment = null;
        this.tile_target = null;
        this.profession_asset = null;
        this._next_step_tile = null;
        this.asset = null;
        this.frame_data = null;
        this.animation_container = null;
        this._home_building = null;
        this.cached_sprite_head = null;
        this._cached_sprite_item = null;
        this._cached_hand_renderer_asset = null;
        this.traits.Clear();
        this._traits_cache.Clear();
        this._aggression_targets.Clear();
        this._current_children = 0;
        this.is_forced_socialize_icon = false;
        this.is_forced_socialize_timestamp = 0.0;
        base.Dispose();
    }

    // Token: 0x06000EB4 RID: 3764 RVA: 0x000C0918 File Offset: 0x000BEB18
    private void checkComponentListDispose(List<BaseActorComponent> pList)
    {
        if (pList != null)
        {
            for (int i = 0; i < pList.Count; i++)
            {
                pList[i].Dispose();
            }
            pList.Clear();
        }
    }

    // Token: 0x06000EB5 RID: 3765 RVA: 0x000C094C File Offset: 0x000BEB4C
    private void checkSimpleComponentListDispose(List<ActorSimpleComponent> pList)
    {
        if (pList != null)
        {
            for (int i = 0; i < pList.Count; i++)
            {
                pList[i].Dispose();
            }
            pList.Clear();
        }
    }

    // Token: 0x06000EB6 RID: 3766 RVA: 0x000C0980 File Offset: 0x000BEB80
    public void showTooltip(object pUiObject)
    {
        string tTooltipID;
        if (this.isKing())
        {
            tTooltipID = "actor_king";
        }
        else if (this.isCityLeader())
        {
            tTooltipID = "actor_leader";
        }
        else
        {
            tTooltipID = "actor";
        }
        Tooltip.show(pUiObject, tTooltipID, new TooltipData
        {
            actor = this
        });
    }

    // Token: 0x06000EB7 RID: 3767 RVA: 0x000C09C6 File Offset: 0x000BEBC6
    public void setHoverState(HoverState pState)
    {
        this._hover_state = pState;
    }

    // Token: 0x06000EB8 RID: 3768 RVA: 0x000C09CF File Offset: 0x000BEBCF
    private int getMaxPossibleLevel()
    {
        return 9999;
    }

    // Token: 0x06000EB9 RID: 3769 RVA: 0x000C09D8 File Offset: 0x000BEBD8
    internal void addExperience(int pValue)
    {
        if (pValue == 0)
        {
            return;
        }
        if (!this.asset.can_level_up)
        {
            return;
        }
        if (!base.isAlive())
        {
            return;
        }
        if (this.hasCulture() && this.culture.hasTrait("fast_learners"))
        {
            pValue *= CultureTraitLibrary.getValue("fast_learners");
        }
        int tMaxLevel = this.getMaxPossibleLevel();
        if (this.data.level >= tMaxLevel)
        {
            return;
        }
        this.data.experience += pValue;
        if (this.data.experience >= this.getExpToLevelup())
        {
            this.levelUp();
        }
        if (this.data.level >= tMaxLevel)
        {
            this.data.experience = this.getExpToLevelup();
        }
    }

    // Token: 0x06000EBA RID: 3770 RVA: 0x000C0A89 File Offset: 0x000BEC89
    public void addRenown(int pValue)
    {
        this.data.renown += pValue;
    }

    // Token: 0x06000EBB RID: 3771 RVA: 0x000C0AA0 File Offset: 0x000BECA0
    public void addRenown(int pAmount, float pPercent)
    {
        int tRenown = (int)((float)pAmount * pPercent);
        this.addRenown(tRenown);
    }

    // Token: 0x06000EBC RID: 3772 RVA: 0x000C0ABC File Offset: 0x000BECBC
    internal void updateAge()
    {
        this.checkGrowthEvent();
        float tAge = (float)this.getAge();
        if (this.hasSubspecies())
        {
            WorldAction action_growth = this.subspecies.action_growth;
            if (action_growth != null)
            {
                action_growth(this, this.current_tile);
            }
            this.updateAttributes();
        }
        if (base.hasCity())
        {
            if (this.isKing())
            {
                this.addExperience(20);
            }
            if (this.isCityLeader())
            {
                this.addExperience(10);
            }
        }
        if (this.isSapient() && tAge > 300f && this.hasTrait("immortal") && Randy.randomBool())
        {
            this.addTrait("evil", false);
        }
        if (tAge > 40f && Randy.randomChance(0.3f))
        {
            this.addTrait("wise", false);
        }
    }

    // Token: 0x06000EBD RID: 3773 RVA: 0x000C0B80 File Offset: 0x000BED80
    private void updateAttributes()
    {
        if (!Randy.randomChance(0.3f))
        {
            return;
        }
        string tAttribute = this.subspecies.getPossibleAttribute();
        if (string.IsNullOrEmpty(tAttribute))
        {
            return;
        }
        ActorData actorData = this.data;
        string pKey = tAttribute;
        float num = actorData[pKey];
        actorData[pKey] = num + 1f;
    }

    // Token: 0x06000EBE RID: 3774 RVA: 0x000C0BCC File Offset: 0x000BEDCC
    public void setMaxHappiness()
    {
        this.setHappiness(this.getMaxHappiness(), true);
    }

    // Token: 0x06000EBF RID: 3775 RVA: 0x000C0BDB File Offset: 0x000BEDDB
    public void setHappiness(int pValue, bool pClamp = true)
    {
        if (pClamp)
        {
            pValue = Math.Clamp(pValue, this.getMinHappiness(), this.getMaxHappiness());
        }
        this.data.happiness = pValue;
    }

    // Token: 0x06000EC0 RID: 3776 RVA: 0x000C0C00 File Offset: 0x000BEE00
    public void restoreHealthPercent(float pVal)
    {
        if (pVal > 0f && !this.hasMaxHealth())
        {
            int tHealthToRestore = base.getMaxHealthPercent(pVal);
            this.restoreHealth(tHealthToRestore);
        }
    }

    // Token: 0x06000EC1 RID: 3777 RVA: 0x000C0C2C File Offset: 0x000BEE2C
    public void restoreHealth(int pVal)
    {
        if (this.hasMaxHealth())
        {
            return;
        }
        base.changeHealth(pVal);
    }

    // Token: 0x06000EC2 RID: 3778 RVA: 0x000C0C40 File Offset: 0x000BEE40
    public bool changeHappiness(string pID, int pValue = 0)
    {
        if (!this.hasEmotions())
        {
            return false;
        }
        if (this.isEgg())
        {
            return false;
        }
        HappinessAsset tHappinessAsset = AssetManager.happiness_library.get(pID);
        if (tHappinessAsset.ignored_by_psychopaths && this.hasTrait("psychopath"))
        {
            return false;
        }
        int tValueToAdd = pValue + tHappinessAsset.value;
        int tFinalHappiness = this.getHappiness() + tValueToAdd;
        tFinalHappiness = Mathf.Clamp(tFinalHappiness, this.getMinHappiness(), this.getMaxHappiness());
        this.setHappiness(tFinalHappiness, true);
        if (tHappinessAsset.show_change_happiness_effect)
        {
            if (tValueToAdd > 0)
            {
                EffectsLibrary.showMetaEventEffect("fx_change_happiness_positive", this);
            }
            else if (tValueToAdd < 0)
            {
                EffectsLibrary.showMetaEventEffect("fx_change_happiness_negative", this);
            }
        }
        this._last_happiness_history.Enqueue(new HappinessHistory
        {
            index = tHappinessAsset.index,
            timestamp = World.world.getCurWorldTime(),
            bonus = pValue
        });
        if (this._last_happiness_history.Count > 20)
        {
            this._last_happiness_history.Dequeue();
        }
        return true;
    }

    // Token: 0x06000EC3 RID: 3779 RVA: 0x000C0D2F File Offset: 0x000BEF2F
    public void spendNutritionOnBirth()
    {
        this.decreaseNutrition(SimGlobals.m.nutrition_cost_new_baby);
    }

    // Token: 0x06000EC4 RID: 3780 RVA: 0x000C0D44 File Offset: 0x000BEF44
    public void addNutritionFromEating(int pVal = 100, bool pSetMaxNutrition = false, bool pSetJustAte = false)
    {
        if (pSetMaxNutrition)
        {
            this.setNutrition(this.getMaxNutrition(), true);
        }
        else
        {
            int tNewValue = Math.Min(this.getMaxNutrition(), this.data.nutrition + pVal);
            this.setNutrition(tNewValue, true);
        }
        if (pSetJustAte)
        {
            this.justAte();
        }
    }

    // Token: 0x06000EC5 RID: 3781 RVA: 0x000C0D90 File Offset: 0x000BEF90
    public void updateNutritionDecay(bool pDoStarvationDamage = true)
    {
        int tNutritionSpent = this.subspecies.getMetabolicRate();
        this.decreaseNutrition(tNutritionSpent);
        if (this.isStarving())
        {
            this.setNutrition(0, true);
            if (pDoStarvationDamage)
            {
                int tDamage = base.getMaxHealthPercent(SimGlobals.m.starvation_damage_multiplier);
                this.getHit((float)tDamage, true, AttackType.Starvation, null, true, false, true);
                if (base.isAlive())
                {
                    base.addStatusEffect("starving", 0f, false);
                    return;
                }
            }
        }
        else
        {
            this.updateStamina();
            this.updateMana();
        }
    }

    // Token: 0x06000EC6 RID: 3782 RVA: 0x000C0E0A File Offset: 0x000BF00A
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public void decreaseNutrition(int pValue = -1)
    {
        this.setNutrition(this.getNutrition() - pValue, true);
    }

    // Token: 0x06000EC7 RID: 3783 RVA: 0x000C0E1B File Offset: 0x000BF01B
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public void setNutrition(int pVal, bool pClamp = true)
    {
        if (pClamp)
        {
            pVal = Math.Clamp(pVal, 0, this.getMaxNutrition());
        }
        this.data.nutrition = pVal;
    }

    // Token: 0x06000EC8 RID: 3784 RVA: 0x000C0E3B File Offset: 0x000BF03B
    public void updateMana()
    {
        if (this.isManaFull())
        {
            return;
        }
        this.addMana(SimGlobals.m.mana_change);
    }

    // Token: 0x06000EC9 RID: 3785 RVA: 0x000C0E58 File Offset: 0x000BF058
    public void addMana(int pValue)
    {
        int tValueMax = this.getMaxMana();
        int tValueCurrent = this.getMana();
        if (tValueCurrent < tValueMax)
        {
            tValueCurrent += pValue;
        }
        tValueCurrent = Math.Clamp(tValueCurrent, 0, tValueMax);
        this.setMana(tValueCurrent, true);
    }

    // Token: 0x06000ECA RID: 3786 RVA: 0x000C0E8C File Offset: 0x000BF08C
    public void setMana(int pValue, bool pClamp = true)
    {
        if (pClamp)
        {
            pValue = Math.Clamp(pValue, 0, this.getMaxMana());
        }
        this.data.mana = pValue;
    }

    // Token: 0x06000ECB RID: 3787 RVA: 0x000C0EAC File Offset: 0x000BF0AC
    public void spendMana(int pValueSpend)
    {
        if (pValueSpend == 0)
        {
            return;
        }
        this.setMana(this.getMana() - pValueSpend, true);
    }

    // Token: 0x06000ECC RID: 3788 RVA: 0x000C0EC1 File Offset: 0x000BF0C1
    public void updateStamina()
    {
        if (this.isStaminaFull())
        {
            return;
        }
        this.addStamina(SimGlobals.m.stamina_change);
    }

    // Token: 0x06000ECD RID: 3789 RVA: 0x000C0EDC File Offset: 0x000BF0DC
    public void addStamina(int pValue)
    {
        int tValueMax = this.getMaxStamina();
        int tValueCurrent = this.getStamina();
        if (tValueCurrent < tValueMax)
        {
            tValueCurrent += pValue;
        }
        tValueCurrent = Math.Clamp(tValueCurrent, 0, tValueMax);
        this.setStamina(tValueCurrent, true);
    }

    // Token: 0x06000ECE RID: 3790 RVA: 0x000C0F10 File Offset: 0x000BF110
    public void setStamina(int pValue, bool pClamp = true)
    {
        if (pClamp)
        {
            pValue = Math.Clamp(pValue, 0, this.getMaxStamina());
        }
        this.data.stamina = pValue;
    }

    // Token: 0x06000ECF RID: 3791 RVA: 0x000C0F30 File Offset: 0x000BF130
    public void spendStamina(int pValueSpend)
    {
        if (pValueSpend == 0)
        {
            return;
        }
        this.setStamina(this.getStamina() - pValueSpend, true);
    }

    // Token: 0x06000ED0 RID: 3792 RVA: 0x000C0F45 File Offset: 0x000BF145
    public void spendStaminaWithCooldown(int pValueSpend)
    {
        if (pValueSpend == 0)
        {
            return;
        }
        if (this.isUnderStaminaCooldown())
        {
            return;
        }
        this._last_stamina_reduce_timestamp = World.world.getCurSessionTime();
        this.setStamina(this.getStamina() - pValueSpend, true);
    }

    // Token: 0x06000ED1 RID: 3793 RVA: 0x000C0F74 File Offset: 0x000BF174
    public bool hasHappinessEntry(string pID, float pTime = 0f)
    {
        if (!this.hasHappinessHistory())
        {
            return false;
        }
        foreach (HappinessHistory tHappinessEntry in this.happiness_change_history)
        {
            if (!(tHappinessEntry.asset.id != pID))
            {
                if (pTime == 0f)
                {
                    return true;
                }
                if (tHappinessEntry.elapsedSince() < (double)pTime)
                {
                    return true;
                }
            }
        }
        return false;
    }

    // Token: 0x06000ED2 RID: 3794 RVA: 0x000C0FFC File Offset: 0x000BF1FC
    public void finishScale()
    {
        this.setActorScale(this.target_scale);
    }

    // Token: 0x06000ED3 RID: 3795 RVA: 0x000C100A File Offset: 0x000BF20A
    public void setActorScale(float pVal)
    {
        this.actor_scale = pVal;
        this.current_scale.Set(this.actor_scale, this.actor_scale, 1f);
    }

    // Token: 0x06000ED4 RID: 3796 RVA: 0x000C102F File Offset: 0x000BF22F
    public void setData(ActorData pData)
    {
        this.data = pData;
    }

    // Token: 0x06000ED5 RID: 3797 RVA: 0x000C1038 File Offset: 0x000BF238
    public void loadData(ActorData pData)
    {
        this.setData(pData);
        pData.load();
    }

    // Token: 0x06000ED6 RID: 3798 RVA: 0x000C1047 File Offset: 0x000BF247
    public void generateSex()
    {
        if (Randy.randomBool())
        {
            this.data.sex = ActorSex.Male;
            return;
        }
        this.data.sex = ActorSex.Female;
    }

    // Token: 0x06000ED7 RID: 3799 RVA: 0x000C106C File Offset: 0x000BF26C
    protected void generatePersonality()
    {
        if (this.hasSubspecies())
        {
            foreach (ActorTrait tTrait in this.subspecies.getActorBirthTraits().getTraits())
            {
                this.addTrait(tTrait, false);
            }
            if (this.subspecies.hasPhenotype())
            {
                this.generatePhenotypeAndShade();
            }
        }
        else
        {
            this.generateRandomSpawnTraits(this.asset);
        }
        if (this.isAdult())
        {
            this.checkTraitMutationGrowUp();
        }
        this.checkTraitMutationOnBirth();
        this.generateSex();
        this.setStatsDirty();
    }

    // Token: 0x06000ED8 RID: 3800 RVA: 0x000C1110 File Offset: 0x000BF310
    public void calcIsEgg()
    {
        if (!this.hasSubspecies() || !this.subspecies.has_egg_form)
        {
            return;
        }
        this._state_egg = base.hasStatus("egg");
    }

    // Token: 0x06000ED9 RID: 3801 RVA: 0x000C1139 File Offset: 0x000BF339
    public void calcIsBaby()
    {
        if (!this.hasSubspecies())
        {
            return;
        }
        if (!this.asset.has_baby_form)
        {
            return;
        }
        if ((float)this.getAge() >= this.subspecies.age_adult)
        {
            return;
        }
        this._state_baby = true;
        this.clearSprites();
    }

    // Token: 0x06000EDA RID: 3802 RVA: 0x000C1174 File Offset: 0x000BF374
    public void setCheckLanding()
    {
        this.should_check_land_cancel = true;
    }

    // Token: 0x06000EDB RID: 3803 RVA: 0x000C1180 File Offset: 0x000BF380
    public void addForce(float pX, float pY, float pHeight, bool pCheckLandCancelAllActions = false)
    {
        if (!this.asset.can_be_moved_by_powers)
        {
            return;
        }
        if (pCheckLandCancelAllActions)
        {
            this.setCheckLanding();
        }
        if (this.position_height > 0f)
        {
            return;
        }
        this.velocity.x = pX;
        this.velocity.y = pY;
        this.velocity.z = pHeight;
        this.velocity_speed = pHeight;
        this.under_forces = true;
    }

    // Token: 0x06000EDC RID: 3804 RVA: 0x000C11E5 File Offset: 0x000BF3E5
    public void setFlying(bool pVal)
    {
        this._flying = pVal;
        if (pVal)
        {
            this.hitbox_bonus_height = 8f;
            return;
        }
        this.hitbox_bonus_height = 2f;
    }

    // Token: 0x06000EDD RID: 3805 RVA: 0x000C1208 File Offset: 0x000BF408
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    internal void checkIsInLiquid()
    {
        bool tInLiquid = this.current_tile.is_liquid && this.move_jump_offset.y == 0f && this.position_height <= 0f && base.isAlive();
        if (tInLiquid != this._is_in_liquid)
        {
            this._is_in_liquid = tInLiquid;
        }
    }

    // Token: 0x06000EDE RID: 3806 RVA: 0x000C125B File Offset: 0x000BF45B
    private void addDefaultItemAttackActions(ItemAsset pItemAsset)
    {
        this.addItemActions(pItemAsset);
        if (pItemAsset.action_attack_target != null)
        {
            this.s_action_attack_target = (AttackAction)Delegate.Combine(this.s_action_attack_target, pItemAsset.action_attack_target);
        }
    }

    // Token: 0x06000EDF RID: 3807 RVA: 0x000C1288 File Offset: 0x000BF488
    private void addItemActions(ItemAsset pItemAsset)
    {
        if (pItemAsset.action_special_effect != null)
        {
            this._s_special_effect_augmentations.Add(pItemAsset);
        }
    }

    // Token: 0x06000EE0 RID: 3808 RVA: 0x000C129E File Offset: 0x000BF49E
    internal void attackTargetActions(BaseSimObject pTarget, WorldTile pTile)
    {
        AttackAction attackAction = this.s_action_attack_target;
        if (attackAction == null)
        {
            return;
        }
        attackAction(this, pTarget, pTile);
    }

    // Token: 0x06000EE1 RID: 3809 RVA: 0x000C12B4 File Offset: 0x000BF4B4
    protected void calcAgeStates()
    {
        this._state_egg = false;
        this._state_baby = false;
        this._state_adult = false;
        this.calcIsEgg();
        if (!this.isEgg())
        {
            this.calcIsBaby();
            if (!this.isBaby())
            {
                this._state_adult = true;
                this.clearSprites();
                return;
            }
        }
        else
        {
            this._state_baby = true;
            this.clearSprites();
        }
    }

    // Token: 0x06000EE2 RID: 3810 RVA: 0x000C1310 File Offset: 0x000BF510
    internal override void updateStats()
    {
        if (!base.isStatsDirty())
        {
            return;
        }
        base.updateStats();
        this.checkGrowthEvent();
        this.decisions_counter = 0;
        this.batch.c_stats_dirty.Remove(this.a);
        if (!base.isAlive())
        {
            return;
        }
        this.s_action_attack_target = null;
        this.s_get_hit_action = null;
        this._s_special_effect_augmentations.Clear();
        this._s_special_effect_augmentations_timers.Clear();
        this.stats.clear();
        this.clearCombatActions();
        this.clearSpells();
        if (this.hasSubspecies())
        {
            this.stats.mergeStats(this.subspecies.base_stats, 1f);
            if (this.isSexMale())
            {
                this.stats.mergeStats(this.subspecies.base_stats_male, 1f);
            }
            else
            {
                this.stats.mergeStats(this.subspecies.base_stats_female, 1f);
            }
        }
        else
        {
            this.stats.mergeStats(this.asset.base_stats, 1f);
        }
        if (this.hasClan())
        {
            this.stats.mergeStats(this.clan.base_stats, 1f);
            if (this.isSexMale())
            {
                this.stats.mergeStats(this.clan.base_stats_male, 1f);
            }
            else
            {
                this.stats.mergeStats(this.clan.base_stats_female, 1f);
            }
        }
        if (this.hasLanguage())
        {
            this.stats.mergeStats(this.language.base_stats, 1f);
        }
        if (this.hasCulture())
        {
            this.stats.mergeStats(this.culture.base_stats, 1f);
        }
        BaseStats stats = this.stats;
        stats["diplomacy"] = stats["diplomacy"] + this.data["diplomacy"];
        stats = this.stats;
        stats["stewardship"] = stats["stewardship"] + this.data["stewardship"];
        stats = this.stats;
        stats["intelligence"] = stats["intelligence"] + this.data["intelligence"];
        stats = this.stats;
        stats["warfare"] = stats["warfare"] + this.data["warfare"];
        this._cache_check_has_status_removed_on_damage = false;
        if (base.hasAnyStatusEffect())
        {
            foreach (Status tStatus in base.getStatuses())
            {
                this.stats.mergeStats(tStatus.asset.base_stats, 1f);
                if (tStatus.asset.removed_on_damage)
                {
                    this._cache_check_has_status_removed_on_damage = true;
                }
                if (!string.IsNullOrEmpty(tStatus.asset.decision_id))
                {
                    DecisionAsset[] array = this.decisions;
                    int num = this.decisions_counter;
                    this.decisions_counter = num + 1;
                    array[num] = tStatus.asset.getDecisionAsset();
                }
            }
        }
        if (!this.hasWeapon())
        {
            EquipmentAsset tDefaultWeapon = AssetManager.items.get(this.asset.default_attack);
            if (tDefaultWeapon != null)
            {
                this.stats.mergeStats(tDefaultWeapon.base_stats, 1f);
            }
        }
        this.checkAttackTypes();
        foreach (ActorTrait tTrait in this.traits)
        {
            if (!tTrait.only_active_on_era_flag || ((!tTrait.era_active_moon || World.world_era.flag_moon) && (!tTrait.era_active_night || World.world_era.overlay_darkness)))
            {
                if (tTrait.action_get_hit != null)
                {
                    this.s_get_hit_action = (GetHitAction)Delegate.Combine(this.s_get_hit_action, tTrait.action_get_hit);
                }
                this.stats.mergeStats(tTrait.base_stats, 1f);
            }
        }
        this.is_forced_socialize_icon = base.hasStatus("possessed") && this.hasTag("strong_mind");
        if (base.hasStatus("budding"))
        {
            stats = this.stats;
            stats["diplomacy"] = stats["diplomacy"] * 2f;
            stats = this.stats;
            stats["stewardship"] = stats["stewardship"] * 2f;
            stats = this.stats;
            stats["intelligence"] = stats["intelligence"] * 2f;
            stats = this.stats;
            stats["warfare"] = stats["warfare"] * 2f;
        }
        if (this.isSapient())
        {
            this.s_personality = null;
            if (this.isKing() || this.isCityLeader())
            {
                string tPersonality = "balanced";
                float tHighStat = this.stats["diplomacy"];
                if (this.stats["diplomacy"] > this.stats["stewardship"])
                {
                    tPersonality = "diplomat";
                    tHighStat = this.stats["diplomacy"];
                }
                else if (this.stats["diplomacy"] < this.stats["stewardship"])
                {
                    tPersonality = "administrator";
                    tHighStat = this.stats["stewardship"];
                }
                if (this.stats["warfare"] > tHighStat)
                {
                    tPersonality = "militarist";
                }
                this.s_personality = AssetManager.personalities.get(tPersonality);
                this.stats.mergeStats(this.s_personality.base_stats, 1f);
            }
        }
        float tBonusFromLevelHealth = (float)this.data.level * SimGlobals.m.level_mod_bonus_health * this.stats["health"];
        float tBonusFromLevelMana = (float)this.data.level * SimGlobals.m.level_mod_bonus_mana * this.stats["mana"];
        float tBonusFromLevelStamina = (float)this.data.level * SimGlobals.m.level_mod_bonus_stamina * this.stats["stamina"];
        stats = this.stats;
        stats["health"] = stats["health"] + tBonusFromLevelHealth;
        stats = this.stats;
        stats["mana"] = stats["mana"] + tBonusFromLevelMana;
        stats = this.stats;
        stats["stamina"] = stats["stamina"] + tBonusFromLevelStamina;
        stats = this.stats;
        stats["skill_combat"] = stats["skill_combat"] + (float)((int)(this.stats["warfare"] / 5f)) * 0.01f;
        stats = this.stats;
        stats["skill_spell"] = stats["skill_spell"] + (float)((int)(this.stats["intelligence"] / 5f)) * 0.01f;
        if (this.data.level > 5)
        {
            stats = this.stats;
            stats["skill_combat"] = stats["skill_combat"] + 0.1f;
            stats = this.stats;
            stats["skill_spell"] = stats["skill_spell"] + 0.1f;
        }
        this.addSpecialEffectAugmentations(this.traits);
        this.checkActionsFromAllMetas();
        this.recalcCombatActions();
        this.recalcSpells();
        this.registerDecisions();
        bool tHadStatusUnconscious = this._has_tag_unconscious;
        this.has_tag_generate_light = this.hasTag("generate_light");
        this._has_tag_unconscious = this.hasTag("unconscious");
        if (this._has_tag_unconscious)
        {
            if (!tHadStatusUnconscious)
            {
                if (Randy.randomBool())
                {
                    this._rotation_direction = RotationDirection.Left;
                }
                else
                {
                    this._rotation_direction = RotationDirection.Right;
                }
            }
            this.timer_jump_animation = 0f;
        }
        this._has_trait_weightless = this.hasTrait("weightless");
        this._has_status_sleeping = base.hasStatus("sleeping");
        this._has_status_strange_urge = base.hasStatus("strange_urge");
        this._has_status_possessed = base.hasStatus("possessed");
        this._has_status_tantrum = base.hasStatus("tantrum");
        this.is_immovable = this.isImmovable();
        this.is_ai_frozen = this.isAiFrozen();
        this._has_stop_idle_animation = this.hasStopIdleAnimation();
        if (this.hasSubspecies())
        {
            this._has_emotions = this.subspecies.can_process_emotions;
        }
        else
        {
            this._has_emotions = false;
        }
        if (!this.hasWeapon())
        {
            EquipmentAsset tDefaultItemAttackAsset = AssetManager.items.get(this.asset.default_attack);
            this.addDefaultItemAttackActions(tDefaultItemAttackAsset);
            if (tDefaultItemAttackAsset.item_modifiers != null)
            {
                for (int i = 0; i < tDefaultItemAttackAsset.item_modifiers.Length; i++)
                {
                    ItemModAsset tModData = tDefaultItemAttackAsset.item_modifiers[i];
                    if (tModData != null)
                    {
                        this.addDefaultItemAttackActions(tModData);
                    }
                }
            }
        }
        if (this.canUseItems())
        {
            foreach (ActorEquipmentSlot tSlot in this.equipment)
            {
                if (!tSlot.isEmpty())
                {
                    Item tItem = tSlot.getItem();
                    this.addItemActions(tItem.getAsset());
                    if (tItem.action_attack_target != null)
                    {
                        this.s_action_attack_target = (AttackAction)Delegate.Combine(this.s_action_attack_target, tItem.action_attack_target);
                    }
                    foreach (string ptr in tItem.data.modifiers)
                    {
                        string tModID = ptr;
                        ItemModAsset tModData2 = AssetManager.items_modifiers.get(tModID);
                        this.addItemActions(tModData2);
                    }
                }
            }
        }
        if (this._s_special_effect_augmentations.Count == 0)
        {
            this.batch.c_augmentation_effects.Remove(this.a);
        }
        else
        {
            this.batch.c_augmentation_effects.Add(this.a);
        }
        this._has_any_sick_trait = this.calculateIsSick();
        this._has_trait_peaceful = this.hasTrait("peaceful");
        this._has_trait_clone = this.hasTrait("clone");
        if (this.canUseItems())
        {
            foreach (ActorEquipmentSlot tSlot2 in this.equipment)
            {
                if (!tSlot2.isEmpty())
                {
                    Item tItem2 = tSlot2.getItem();
                    float tStatsMultiplier = 1f;
                    if (tItem2.data.durability <= 0)
                    {
                        tStatsMultiplier = 0.5f;
                    }
                    ItemTools.mergeStatsWithItem(this.stats, tItem2, false, tStatsMultiplier);
                }
            }
        }
        if (this.asset.only_melee_attack)
        {
            this.stats["range"] = this.asset.base_stats["range"];
        }
        this.stats.normalize();
        stats = this.stats;
        stats["cities"] = stats["cities"] + (float)((int)this.stats["stewardship"] / 6 + 1);
        stats = this.stats;
        stats["bonus_towers"] = stats["bonus_towers"] + (float)((int)(this.stats["warfare"] / 10f));
        stats = this.stats;
        stats["mana"] = stats["mana"] + (float)((int)(this.stats["intelligence"] * SimGlobals.m.MANA_PER_INTELLIGENCE));
        this.stats.checkMultipliers();
        if (this.isSapient())
        {
            this.calculateOffspringBasedOnAge();
        }
        if (this.hasRangeAttack())
        {
            stats = this.stats;
            stats["range"] = stats["range"] + this.stats["range"] * World.world_era.range_weapons_multiplier;
        }
        stats = this.stats;
        stats["damage"] = stats["damage"] + this.stats["warfare"] / 5f;
        if (this.isBaby())
        {
            this.stats["damage"] = this.stats["damage"] * 0.5f;
            this.stats["health"] = this.stats["health"] * 0.5f;
        }
        this.stats.normalize();
        if (base.getHealth() > base.getMaxHealth())
        {
            base.setMaxHealth();
        }
        if (this.getHappiness() > this.getMaxHappiness())
        {
            this.setMaxHappiness();
        }
        if (this.getStamina() > this.getMaxStamina())
        {
            this.setMaxStamina();
        }
        if (this.getMana() > this.getMaxMana())
        {
            this.setMaxMana();
        }
        if (this.event_full_stats)
        {
            this.event_full_stats = false;
            base.setMaxHealth();
            this.setMaxStamina();
            this.setMaxMana();
        }
        if (this.isHovering())
        {
            this.batch.c_hovering.Add(this.a);
        }
        else
        {
            this.move_jump_offset.y = 0f;
            this.batch.c_hovering.Remove(this.a);
        }
        if (this.isPollinator())
        {
            this.batch.c_pollinating.Add(this.a);
        }
        else
        {
            this.batch.c_pollinating.Remove(this.a);
        }
        this.target_scale = this.stats["scale"];
        if (this.attack_timer > this.getAttackCooldown())
        {
            this.attack_timer = this.getAttackCooldown();
        }
    }

    // Token: 0x06000EE3 RID: 3811 RVA: 0x000C20F8 File Offset: 0x000C02F8
    public void resetAttackTimeout()
    {
        this.attack_timer = 0f;
    }

    // Token: 0x06000EE4 RID: 3812 RVA: 0x000C2105 File Offset: 0x000C0305
    public void setActionTimeout(float pTimeout)
    {
        this.attack_timer = pTimeout;
    }

    // Token: 0x06000EE5 RID: 3813 RVA: 0x000C2110 File Offset: 0x000C0310
    private void addSpecialEffectAugmentations(IEnumerable<BaseAugmentationAsset> pAssets)
    {
        foreach (BaseAugmentationAsset tAugmentation in pAssets)
        {
            if (tAugmentation.action_special_effect != null)
            {
                this._s_special_effect_augmentations.Add(tAugmentation);
            }
            if (tAugmentation.action_attack_target != null)
            {
                this.s_action_attack_target = (AttackAction)Delegate.Combine(this.s_action_attack_target, tAugmentation.action_attack_target);
            }
        }
    }

    // Token: 0x06000EE6 RID: 3814 RVA: 0x000C218C File Offset: 0x000C038C
    private void addSpecialEffectsFromMetas(List<BaseAugmentationAsset> pAugmentations)
    {
        if (pAugmentations == null || pAugmentations.Count == 0)
        {
            return;
        }
        this._s_special_effect_augmentations.AddRange(pAugmentations);
    }

    // Token: 0x06000EE7 RID: 3815 RVA: 0x000C21A8 File Offset: 0x000C03A8
    private void calculateOffspringBasedOnAge()
    {
        if (!this.hasTrait("immortal"))
        {
            int tBaseOffspring = (int)this.stats["offspring"];
            float tMaxAgeRatio = this.getAgeRatio();
            float tAgeFertilityMod = 1f;
            if (tMaxAgeRatio > 0.9f)
            {
                tAgeFertilityMod = 0.1f;
            }
            else if (tMaxAgeRatio > 0.7f)
            {
                tAgeFertilityMod = 0.2f;
            }
            else if (tMaxAgeRatio > 0.5f)
            {
                tAgeFertilityMod = 0.5f;
            }
            else if (tMaxAgeRatio > 0.3f)
            {
                tAgeFertilityMod = 0.8f;
            }
            this.stats["offspring"] = (float)((int)Math.Ceiling((double)((float)tBaseOffspring * tAgeFertilityMod)));
        }
    }

    // Token: 0x06000EE8 RID: 3816 RVA: 0x000C223C File Offset: 0x000C043C
    internal virtual void updateFall()
    {
        if (this.position_height < 0f)
        {
            return;
        }
        float tElapsed = World.world.elapsed;
        float tF = SimGlobals.m.gravity * this.stats.get("mass");
        this.position_height -= tF * tElapsed;
        if (this.position_height <= 0f)
        {
            this.position_height = 0f;
            if (!this.under_forces)
            {
                this.stopForce();
            }
        }
    }

    // Token: 0x06000EE9 RID: 3817 RVA: 0x000C22B4 File Offset: 0x000C04B4
    private void stopForce()
    {
        this.position_height = 0f;
        this.velocity = Vector3.zero;
        this.under_forces = false;
        this.batch.c_action_landed.Add(this);
    }

    // Token: 0x06000EEA RID: 3818 RVA: 0x000C22E4 File Offset: 0x000C04E4
    internal virtual void actionLanded()
    {
        this.batch.c_action_landed.Remove(this);
        this.dirty_current_tile = true;
        BaseActionActor baseActionActor = this.callbacks_landed;
        if (baseActionActor != null)
        {
            baseActionActor(this);
        }
        if (this._action_wait_after_land)
        {
            this._action_wait_after_land = false;
            this.makeWait(this._action_wait_after_land_timer);
        }
        this.checkStepActionForTile(this.current_tile);
    }

    // Token: 0x06000EEB RID: 3819 RVA: 0x000C2344 File Offset: 0x000C0544
    public void updateShake(float pElapsed)
    {
        if (this.shake_active)
        {
            this.shake_timer -= pElapsed;
            if (this.shake_timer <= 0f)
            {
                this.shake_offset.Set(0f, 0f);
                this.shake_active = false;
                this.batch.c_shake.Remove(this);
                return;
            }
            if (this.shake_vertical)
            {
                this.shake_offset.y = this.batch.rnd.NextFloat(-this.shake_volume, this.shake_volume);
            }
            if (this.shake_horizontal)
            {
                this.shake_offset.x = this.batch.rnd.NextFloat(-this.shake_volume, this.shake_volume);
            }
        }
    }

    // Token: 0x06000EEC RID: 3820 RVA: 0x000C2408 File Offset: 0x000C0608
    internal void updateFlipRotation(float pElapsed)
    {
        if (!this.asset.can_flip)
        {
            return;
        }
        if (this.flip)
        {
            this.flip_angle += pElapsed * 600f;
            if (this.flip_angle > 180f)
            {
                this.flip_angle = 180f;
            }
        }
        else
        {
            this.flip_angle -= pElapsed * 600f;
            if (this.flip_angle < 0f)
            {
                this.flip_angle = 0f;
            }
        }
        if (this.target_angle.y != this.flip_angle)
        {
            this.target_angle.y = this.flip_angle;
        }
    }

    // Token: 0x06000EED RID: 3821 RVA: 0x000C24A9 File Offset: 0x000C06A9
    internal bool flipAnimationActive()
    {
        if (!this.asset.can_flip)
        {
            return false;
        }
        if (this.flip)
        {
            return this.flip_angle != 180f;
        }
        return this.flip_angle != 0f;
    }

    // Token: 0x06000EEE RID: 3822 RVA: 0x000C24E3 File Offset: 0x000C06E3
    private void updateRotations(float pElapsed)
    {
        if (this.rotation_cooldown > 0f)
        {
            this.rotation_cooldown -= pElapsed;
            return;
        }
        if (this.is_unconscious)
        {
            this.updateRotationFall(pElapsed);
            return;
        }
        this.updateRotationBack(pElapsed);
    }

    // Token: 0x06000EEF RID: 3823 RVA: 0x000C2518 File Offset: 0x000C0718
    private void updateRotationFall(float pElapsed)
    {
        if (this.getTextureAsset().prevent_unconscious_rotation)
        {
            return;
        }
        if (this.current_tile.is_liquid && this._is_in_liquid)
        {
            this.target_angle.z = 0f;
            return;
        }
        if (this._rotation_direction == RotationDirection.Left && this.target_angle.z != -90f)
        {
            this.target_angle.z = this.target_angle.z - 230f * pElapsed;
            if (this.target_angle.z < -90f)
            {
                this.target_angle.z = -90f;
            }
        }
        if (this._rotation_direction == RotationDirection.Right && this.target_angle.z != 90f)
        {
            this.target_angle.z = this.target_angle.z + 300f * pElapsed;
            if (this.target_angle.z > 90f)
            {
                this.target_angle.z = 90f;
            }
        }
    }

    // Token: 0x06000EF0 RID: 3824 RVA: 0x000C2600 File Offset: 0x000C0800
    private void updateRotationBack(float pElapsed)
    {
        if (this.target_angle.z == 0f)
        {
            return;
        }
        if (this.target_angle.z < 0f)
        {
            this.target_angle.z = this.target_angle.z + 300f * pElapsed;
            if (this.target_angle.z > 0f)
            {
                this.target_angle.z = 0f;
            }
        }
        if (this.target_angle.z > 0f)
        {
            this.target_angle.z = this.target_angle.z - 300f * pElapsed;
            if (this.target_angle.z < 0f)
            {
                this.target_angle.z = 0f;
            }
        }
    }

    // Token: 0x06000EF1 RID: 3825 RVA: 0x000C26B4 File Offset: 0x000C08B4
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public Vector3 updateRotation()
    {
        if (this.current_rotation.y == this.target_angle.y && this.current_rotation.z == this.target_angle.z)
        {
            return this.current_rotation;
        }
        this.current_rotation.Set(this.target_angle.x, this.target_angle.y, this.target_angle.z);
        return this.current_rotation;
    }

    // Token: 0x06000EF2 RID: 3826 RVA: 0x000C272C File Offset: 0x000C092C
    internal void updateDeadBlackAnimation(float pElapsed)
    {
        if (this._death_timer_color_stage_1 > 0f)
        {
            this._death_timer_color_stage_1 -= pElapsed;
            if (this._death_timer_color_stage_1 <= 0f)
            {
                this._death_timer_color_stage_1 = 0f;
            }
        }
        if (this._death_timer_color_stage_1 > 0f)
        {
            Color tColor = new Color(this._death_timer_color_stage_1, this._death_timer_color_stage_1, this._death_timer_color_stage_1, 1f);
            this.color = tColor;
            return;
        }
        if (this._death_timer_alpha_stage_2 > 0f)
        {
            this._death_timer_alpha_stage_2 -= 1f * pElapsed;
            if (this._death_timer_alpha_stage_2 <= 0f)
            {
                this.die(true, AttackType.None, false, true);
                return;
            }
            Color tColor2 = new Color(this._death_timer_color_stage_1, this._death_timer_color_stage_1, this._death_timer_color_stage_1, this._death_timer_alpha_stage_2);
            this.color = tColor2;
        }
    }

    // Token: 0x06000EF3 RID: 3827 RVA: 0x000C27FF File Offset: 0x000C09FF
    internal virtual void spawnOn(WorldTile pTile, float pZHeight = 0f)
    {
        this.setCurrentTilePosition(pTile);
        this.position_height = pZHeight;
        this.hitbox_bonus_height = this.asset.default_height;
    }

    // Token: 0x06000EF4 RID: 3828 RVA: 0x000C2820 File Offset: 0x000C0A20
    public string getName()
    {
        if (string.IsNullOrEmpty(this.data.name))
        {
            this.generateNewName();
            SignalManager.add(SignalLibrary.check_achievement_child_named_toto, this.data.name);
        }
        return this.data.name;
    }

    // Token: 0x06000EF5 RID: 3829 RVA: 0x000C285A File Offset: 0x000C0A5A
    public string generateName(MetaType pType, long pSeed, ActorSex pSex = ActorSex.None)
    {
        return NameGenerator.generateName(this, pType, pSeed + World.world.map_stats.life_dna, pSex);
    }

    // Token: 0x17000089 RID: 137
    // (get) Token: 0x06000EF6 RID: 3830 RVA: 0x000C2875 File Offset: 0x000C0A75
    public override string name
    {
        get
        {
            return this.getName();
        }
    }

    // Token: 0x06000EF7 RID: 3831 RVA: 0x000C2880 File Offset: 0x000C0A80
    private void generateNewName()
    {
        ActorSex tSex = (this.isSapient() ? this.data.sex : ActorSex.None);
        long tSeed = World.world.map_stats.life_dna + this.getID();
        string tNewName = NameGenerator.generateName(this, MetaType.Unit, tSeed, tSex);
        this.data.setName(tNewName);
        BaseSystemData baseSystemData = this.data;
        Culture culture = this.culture;
        baseSystemData.name_culture_id = ((culture != null) ? culture.id : (-1L));
    }

    // Token: 0x06000EF8 RID: 3832 RVA: 0x000C28F0 File Offset: 0x000C0AF0
    public void setHomeBuilding(Building pBuilding)
    {
        if (this._home_building != null)
        {
            this.clearHomeBuilding();
        }
        this._home_building = pBuilding;
        this._home_building.residents.Add(this.data.id);
        World.world.buildings.event_houses = true;
    }

    // Token: 0x06000EF9 RID: 3833 RVA: 0x000C293E File Offset: 0x000C0B3E
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public bool hasHomeBuilding()
    {
        return this.getHomeBuilding() != null;
    }

    // Token: 0x1700008A RID: 138
    // (get) Token: 0x06000EFA RID: 3834 RVA: 0x000C2949 File Offset: 0x000C0B49
    public Building home_building
    {
        get
        {
            return this._home_building;
        }
    }

    // Token: 0x06000EFB RID: 3835 RVA: 0x000C2951 File Offset: 0x000C0B51
    public Building getHomeBuilding()
    {
        this.checkHomeBuilding();
        return this._home_building;
    }

    // Token: 0x06000EFC RID: 3836 RVA: 0x000C2960 File Offset: 0x000C0B60
    public void checkHomeBuilding()
    {
        if (this._home_building == null)
        {
            return;
        }
        if (!this._home_building.isUsable() || this._home_building.isAbandoned())
        {
            this.clearHomeBuilding();
            this.changeHappiness("just_lost_house", 0);
            return;
        }
        if (this._home_building.asset.city_building && this._home_building.city != this.city)
        {
            this.clearHomeBuilding();
            this.changeHappiness("just_lost_house", 0);
        }
    }

    // Token: 0x06000EFD RID: 3837 RVA: 0x000C29DC File Offset: 0x000C0BDC
    public void cloneTopicSprite(Sprite pSprite)
    {
        this._last_topic_sprite = pSprite;
    }

    // Token: 0x06000EFE RID: 3838 RVA: 0x000C29E5 File Offset: 0x000C0BE5
    public void clearLastTopicSprite()
    {
        this._last_topic_sprite = null;
    }

    // Token: 0x06000EFF RID: 3839 RVA: 0x000C29EE File Offset: 0x000C0BEE
    public Sprite getTopicSpriteTrait()
    {
        if (this.traits.Count == 0)
        {
            return null;
        }
        return this.traits.GetRandom<ActorTrait>().getSprite();
    }

    // Token: 0x06000F00 RID: 3840 RVA: 0x000C2A0F File Offset: 0x000C0C0F
    public Sprite getSocializeTopic()
    {
        if (this._last_topic_sprite == null)
        {
            this._last_topic_sprite = AssetManager.communication_topic_library.getTopicSprite(this);
        }
        return this._last_topic_sprite;
    }

    // Token: 0x06000F01 RID: 3841 RVA: 0x000C2A36 File Offset: 0x000C0C36
    public void forceSocializeTopic(string pPath)
    {
        this._last_topic_sprite = SpriteTextureLoader.getSprite(pPath);
        this.is_forced_socialize_timestamp = World.world.getCurWorldTime();
    }

    // Token: 0x06000F02 RID: 3842 RVA: 0x000C2A54 File Offset: 0x000C0C54
    public void clearHomeBuilding()
    {
        this._home_building = null;
        World.world.buildings.event_houses = true;
    }

    // Token: 0x06000F03 RID: 3843 RVA: 0x000C2A70 File Offset: 0x000C0C70
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public override void setAlive(bool pValue)
    {
        this._alive = pValue;
        if (!pValue && this.data.died_time == 0.0)
        {
            this.data.died_time = World.world.getCurWorldTime();
        }
        if (!pValue)
        {
            World.world.units.somethingChanged();
        }
    }

    // Token: 0x06000F04 RID: 3844 RVA: 0x000C2AC4 File Offset: 0x000C0CC4
    internal bool isProfession(UnitProfession pType)
    {
        return this._profession == pType;
    }

    // Token: 0x06000F05 RID: 3845 RVA: 0x000C2ACF File Offset: 0x000C0CCF
    public bool isAnimal()
    {
        return !this.isSapient() && !this.asset.unit_other && this.asset.default_animal;
    }

    // Token: 0x06000F06 RID: 3846 RVA: 0x000C2AF5 File Offset: 0x000C0CF5
    public bool isNomad()
    {
        return !base.isKingdomCiv();
    }

    // Token: 0x06000F07 RID: 3847 RVA: 0x000C2B00 File Offset: 0x000C0D00
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public bool isSapient()
    {
        return this.hasSubspecies() && this.subspecies.isSapient();
    }

    // Token: 0x06000F08 RID: 3848 RVA: 0x000C2B18 File Offset: 0x000C0D18
    public bool isPrettyOld()
    {
        int tAge = this.getAge();
        return tAge > 1 && (float)tAge >= this.subspecies.age_adult && this.getAgeRatio() > 0.7f;
    }

    // Token: 0x06000F09 RID: 3849 RVA: 0x000C2B50 File Offset: 0x000C0D50
    public bool isBaby()
    {
        return this._state_baby;
    }

    // Token: 0x06000F0A RID: 3850 RVA: 0x000C2B58 File Offset: 0x000C0D58
    public bool isAdult()
    {
        return this._state_adult;
    }

    // Token: 0x06000F0B RID: 3851 RVA: 0x000C2B60 File Offset: 0x000C0D60
    public bool isBreedingAge()
    {
        return this.hasSubspecies() && (float)this.getAge() >= this.subspecies.age_breeding;
    }

    // Token: 0x06000F0C RID: 3852 RVA: 0x000C2B83 File Offset: 0x000C0D83
    public bool isEgg()
    {
        return this._state_egg;
    }

    // Token: 0x06000F0D RID: 3853 RVA: 0x000C2B8B File Offset: 0x000C0D8B
    public int getAge()
    {
        return this.data.getAge();
    }

    // Token: 0x1700008B RID: 139
    // (get) Token: 0x06000F0E RID: 3854 RVA: 0x000C2B98 File Offset: 0x000C0D98
    public int age
    {
        get
        {
            return this.getAge();
        }
    }

    // Token: 0x06000F0F RID: 3855 RVA: 0x000C2BA0 File Offset: 0x000C0DA0
    public string getBirthday()
    {
        return Date.getDate(this.data.created_time);
    }

    // Token: 0x06000F10 RID: 3856 RVA: 0x000C2BB2 File Offset: 0x000C0DB2
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public bool hasRangeAttack()
    {
        return this.s_type_attack == WeaponType.Range;
    }

    // Token: 0x06000F11 RID: 3857 RVA: 0x000C2BBD File Offset: 0x000C0DBD
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public bool hasMeleeAttack()
    {
        return this.s_type_attack == WeaponType.Melee;
    }

    // Token: 0x06000F12 RID: 3858 RVA: 0x000C2BC8 File Offset: 0x000C0DC8
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public bool isKing()
    {
        return base.hasKingdom() && this.kingdom.king == this;
    }

    // Token: 0x06000F13 RID: 3859 RVA: 0x000C2BE2 File Offset: 0x000C0DE2
    public float getMaturationTimeSeconds()
    {
        return this.getMaturationTimeMonths() * 5f;
    }

    // Token: 0x06000F14 RID: 3860 RVA: 0x000C2BF0 File Offset: 0x000C0DF0
    public float getMaturationTimeMonths()
    {
        float tResult = 0f;
        if (this.hasSubspecies())
        {
            tResult += this.subspecies.getMaturationTimeMonths();
        }
        return tResult;
    }

    // Token: 0x1700008C RID: 140
    // (get) Token: 0x06000F15 RID: 3861 RVA: 0x000C2C1A File Offset: 0x000C0E1A
    public bool is_army_captain
    {
        get
        {
            return this.hasArmy() && this.army.captain == this;
        }
    }

    // Token: 0x06000F16 RID: 3862 RVA: 0x000C2C34 File Offset: 0x000C0E34
    public bool isFavorite()
    {
        return this.data.favorite;
    }

    // Token: 0x06000F17 RID: 3863 RVA: 0x000C2C41 File Offset: 0x000C0E41
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public override City getCity()
    {
        return this.city;
    }

    // Token: 0x06000F18 RID: 3864 RVA: 0x000C2C49 File Offset: 0x000C0E49
    public bool canBuildNewCity()
    {
        return !base.hasCity() && this.current_tile.zone.isGoodForNewCity(this);
    }

    // Token: 0x06000F19 RID: 3865 RVA: 0x000C2C6B File Offset: 0x000C0E6B
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public bool isCityLeader()
    {
        return base.hasCity() && this.city.leader == this;
    }

    // Token: 0x06000F1A RID: 3866 RVA: 0x000C2C85 File Offset: 0x000C0E85
    public override bool hasDied()
    {
        return this.data.died_time > 0.0;
    }

    // Token: 0x06000F1B RID: 3867 RVA: 0x000C2C9D File Offset: 0x000C0E9D
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    internal bool isPollinator()
    {
        Subspecies subspecies = this.subspecies;
        return subspecies != null && subspecies.has_trait_pollinating;
    }

    // Token: 0x06000F1C RID: 3868 RVA: 0x000C2CB0 File Offset: 0x000C0EB0
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    internal bool isAffectedByLiquid()
    {
        return !this.isInAir() && this._is_in_liquid;
    }

    // Token: 0x06000F1D RID: 3869 RVA: 0x000C2CC2 File Offset: 0x000C0EC2
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    internal override bool isInAir()
    {
        return this._flying || this.isHovering() || this.isInMagnet();
    }

    // Token: 0x06000F1E RID: 3870 RVA: 0x000C2CDC File Offset: 0x000C0EDC
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    internal override bool isFlying()
    {
        return this._flying;
    }

    // Token: 0x06000F1F RID: 3871 RVA: 0x000C2CE4 File Offset: 0x000C0EE4
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    internal bool ignoresBlocks()
    {
        return this.asset.ignore_blocks || this.isFlying() || this.isInMagnet();
    }

    // Token: 0x06000F20 RID: 3872 RVA: 0x000C2D03 File Offset: 0x000C0F03
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    internal bool isInMagnet()
    {
        return this.is_in_magnet;
    }

    // Token: 0x06000F21 RID: 3873 RVA: 0x000C2D0B File Offset: 0x000C0F0B
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    internal bool isHovering()
    {
        Subspecies subspecies = this.subspecies;
        return subspecies != null && subspecies.has_trait_hovering;
    }

    // Token: 0x06000F22 RID: 3874 RVA: 0x000C2D1E File Offset: 0x000C0F1E
    public ActorAsset getActorAsset()
    {
        return this.asset;
    }

    // Token: 0x06000F23 RID: 3875 RVA: 0x000C2D26 File Offset: 0x000C0F26
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public IReadOnlyCollection<ActorTrait> getTraits()
    {
        return this.traits;
    }

    // Token: 0x06000F24 RID: 3876 RVA: 0x000C2D2E File Offset: 0x000C0F2E
    public bool isWaterCreature()
    {
        if (!this.asset.force_ocean_creature)
        {
            Subspecies subspecies = this.subspecies;
            return subspecies != null && subspecies.has_trait_water_creature;
        }
        return true;
    }

    // Token: 0x06000F25 RID: 3877 RVA: 0x000C2D50 File Offset: 0x000C0F50
    public bool mustAvoidGround()
    {
        return this.isWaterCreature() && !this.asset.force_land_creature;
    }

    // Token: 0x06000F26 RID: 3878 RVA: 0x000C2D6C File Offset: 0x000C0F6C
    public bool isInStablePlace()
    {
        if (this.mustAvoidGround())
        {
            if (this.current_tile.Type.ground)
            {
                return false;
            }
        }
        else
        {
            if (this.current_tile.Type.ocean && !this.isWaterCreature())
            {
                return false;
            }
            if (this.current_tile.Type.lava && this.asset.die_in_lava)
            {
                return false;
            }
        }
        return true;
    }

    // Token: 0x06000F27 RID: 3879 RVA: 0x000C2DD3 File Offset: 0x000C0FD3
    internal bool hasWeapon()
    {
        return this.canUseItems() && !this.equipment.weapon.isEmpty();
    }

    // Token: 0x06000F28 RID: 3880 RVA: 0x000C2DF2 File Offset: 0x000C0FF2
    internal Item getWeapon()
    {
        if (this.hasWeapon())
        {
            return this.equipment.weapon.getItem();
        }
        return null;
    }

    // Token: 0x06000F29 RID: 3881 RVA: 0x000C2E0E File Offset: 0x000C100E
    internal EquipmentAsset getWeaponAsset()
    {
        if (this.hasWeapon())
        {
            return this.equipment.weapon.getItem().getAsset();
        }
        return AssetManager.items.get(this.asset.default_attack);
    }

    // Token: 0x06000F2A RID: 3882 RVA: 0x000C2E43 File Offset: 0x000C1043
    public bool isWeaponFirearm()
    {
        Item weapon = this.getWeapon();
        return ((weapon != null) ? weapon.getAsset().group_id : null) == "firearm";
    }

    // Token: 0x06000F2B RID: 3883 RVA: 0x000C2E66 File Offset: 0x000C1066
    public bool isArmyGroupLeader()
    {
        return this.hasArmy() && this.army.captain == this;
    }

    // Token: 0x06000F2C RID: 3884 RVA: 0x000C2E80 File Offset: 0x000C1080
    public bool isArmyGroupWarrior()
    {
        return this.hasArmy() && this.army.captain != this;
    }

    // Token: 0x06000F2D RID: 3885 RVA: 0x000C2E9D File Offset: 0x000C109D
    public bool hasTraits()
    {
        return this.traits.Count > 0;
    }

    // Token: 0x1700008D RID: 141
    // (get) Token: 0x06000F2E RID: 3886 RVA: 0x000C2EAD File Offset: 0x000C10AD
    public bool is_profession_nothing
    {
        get
        {
            return this._profession == UnitProfession.Nothing;
        }
    }

    // Token: 0x1700008E RID: 142
    // (get) Token: 0x06000F2F RID: 3887 RVA: 0x000C2EB8 File Offset: 0x000C10B8
    public bool is_profession_king
    {
        get
        {
            return this._profession == UnitProfession.King;
        }
    }

    // Token: 0x1700008F RID: 143
    // (get) Token: 0x06000F30 RID: 3888 RVA: 0x000C2EC3 File Offset: 0x000C10C3
    public bool is_profession_leader
    {
        get
        {
            return this._profession == UnitProfession.Leader;
        }
    }

    // Token: 0x17000090 RID: 144
    // (get) Token: 0x06000F31 RID: 3889 RVA: 0x000C2ECE File Offset: 0x000C10CE
    public bool is_profession_warrior
    {
        get
        {
            return this._profession == UnitProfession.Warrior;
        }
    }

    // Token: 0x17000091 RID: 145
    // (get) Token: 0x06000F32 RID: 3890 RVA: 0x000C2ED9 File Offset: 0x000C10D9
    public bool is_profession_citizen
    {
        get
        {
            return this._profession == UnitProfession.Unit;
        }
    }

    // Token: 0x06000F33 RID: 3891 RVA: 0x000C2EE4 File Offset: 0x000C10E4
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public bool isSexMale()
    {
        return this.data.sex == ActorSex.Male;
    }

    // Token: 0x06000F34 RID: 3892 RVA: 0x000C2EF4 File Offset: 0x000C10F4
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public bool isSexFemale()
    {
        return this.data.sex == ActorSex.Female;
    }

    // Token: 0x06000F35 RID: 3893 RVA: 0x000C2F04 File Offset: 0x000C1104
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public bool hasEquipment()
    {
        return this.equipment != null;
    }

    // Token: 0x06000F36 RID: 3894 RVA: 0x000C2F0F File Offset: 0x000C110F
    public bool hasHouse()
    {
        return this.getHomeBuilding() != null;
    }

    // Token: 0x06000F37 RID: 3895 RVA: 0x000C2F1A File Offset: 0x000C111A
    public bool hasLover()
    {
        return this.lover != null;
    }

    // Token: 0x06000F38 RID: 3896 RVA: 0x000C2F25 File Offset: 0x000C1125
    public bool hasBestFriend()
    {
        return this.getBestFriend() != null;
    }

    // Token: 0x06000F39 RID: 3897 RVA: 0x000C2F30 File Offset: 0x000C1130
    public Actor getBestFriend()
    {
        if (this.data.best_friend_id.hasValue())
        {
            return World.world.units.get(this.data.best_friend_id);
        }
        return null;
    }

    // Token: 0x06000F3A RID: 3898 RVA: 0x000C2F60 File Offset: 0x000C1160
    public bool isChildOf(Actor pActor)
    {
        return this.isChildOf(pActor.data.id);
    }

    // Token: 0x06000F3B RID: 3899 RVA: 0x000C2F73 File Offset: 0x000C1173
    public bool isChildOf(long pID)
    {
        return this.data.parent_id_1 == pID || this.data.parent_id_2 == pID;
    }

    // Token: 0x06000F3C RID: 3900 RVA: 0x000C2F96 File Offset: 0x000C1196
    public bool isParentOf(long pID, Actor pActor)
    {
        return pID == pActor.data.parent_id_1 || pID == pActor.data.parent_id_2;
    }

    // Token: 0x06000F3D RID: 3901 RVA: 0x000C2FB9 File Offset: 0x000C11B9
    public bool isParentOf(Actor pActor)
    {
        return this.isParentOf(this.data.id, pActor);
    }

    // Token: 0x06000F3E RID: 3902 RVA: 0x000C2FCD File Offset: 0x000C11CD
    public IEnumerable<Actor> getParents()
    {
        Actor tParent = World.world.units.get(this.data.parent_id_1);
        if (tParent != null && tParent.isAlive())
        {
            yield return tParent;
        }
        Actor tParent2 = World.world.units.get(this.data.parent_id_2);
        if (tParent2 != null && tParent2.isAlive())
        {
            yield return tParent2;
        }
        yield break;
    }

    // Token: 0x06000F3F RID: 3903 RVA: 0x000C2FDD File Offset: 0x000C11DD
    public IEnumerable<Actor> getChildren(bool pOnlyCurrentFamily = true)
    {
        if (pOnlyCurrentFamily)
        {
            if (!this.hasFamily())
            {
                yield break;
            }
            Family tFamily = this.family;
            foreach (Actor tChild in tFamily.units)
            {
                if (tChild != this && tChild.isChildOf(this))
                {
                    yield return tChild;
                }
            }
            List<Actor>.Enumerator enumerator = default(List<Actor>.Enumerator);
        }
        else
        {
            int tCurrentLivingChildren = this.current_children_count;
            if (tCurrentLivingChildren == 0)
            {
                yield break;
            }
            long tParentID = this.data.id;
            if (this.hasSubspecies() && !this.subspecies.isRekt())
            {
                foreach (Actor tChild2 in this.subspecies.units)
                {
                    if (!tChild2.isRekt() && tChild2 != this && tChild2.isChildOf(tParentID))
                    {
                        int num = tCurrentLivingChildren;
                        tCurrentLivingChildren = num - 1;
                        yield return tChild2;
                        if (tCurrentLivingChildren == 0)
                        {
                            break;
                        }
                    }
                }
                List<Actor>.Enumerator enumerator = default(List<Actor>.Enumerator);
            }
        }
        yield break;
        yield break;
    }

    // Token: 0x06000F40 RID: 3904 RVA: 0x000C2FF4 File Offset: 0x000C11F4
    public bool hasSuitableBookTraits()
    {
        using (IEnumerator<ActorTrait> enumerator = this.getTraits().GetEnumerator())
        {
            while (enumerator.MoveNext())
            {
                if (enumerator.Current.group_id == "mind")
                {
                    return true;
                }
            }
        }
        return false;
    }

    // Token: 0x06000F41 RID: 3905 RVA: 0x000C3054 File Offset: 0x000C1254
    public bool canBeSurprised(WorldTile pFromTile = null)
    {
        return this._has_emotions && this.asset.can_be_surprised && !this.isFighting() && !this.isInsideSomething() && !this.is_unconscious && !this.isEgg() && (!this.hasTask() || !this.ai.task.ignore_fight_check);
    }

    // Token: 0x17000092 RID: 146
    // (get) Token: 0x06000F42 RID: 3906 RVA: 0x000C30BF File Offset: 0x000C12BF
    public bool is_looking_left
    {
        get
        {
            return !this.flip;
        }
    }

    // Token: 0x06000F43 RID: 3907 RVA: 0x000C30CA File Offset: 0x000C12CA
    public bool isTileOnTheLeft(WorldTile pTile)
    {
        return this.current_tile.x > pTile.x;
    }

    // Token: 0x06000F44 RID: 3908 RVA: 0x000C30DF File Offset: 0x000C12DF
    public bool isFighting()
    {
        return this.has_attack_target;
    }

    // Token: 0x06000F45 RID: 3909 RVA: 0x000C30EC File Offset: 0x000C12EC
    public UnitProfession getProfession()
    {
        return this._profession;
    }

    // Token: 0x06000F46 RID: 3910 RVA: 0x000C30F4 File Offset: 0x000C12F4
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public int getNutrition()
    {
        return this.data.nutrition;
    }

    // Token: 0x06000F47 RID: 3911 RVA: 0x000C3101 File Offset: 0x000C1301
    public bool isHungry()
    {
        return this.needsFood() && this.getNutritionRatio() <= SimGlobals.m.nutrition_level_hungry;
    }

    // Token: 0x06000F48 RID: 3912 RVA: 0x000C3124 File Offset: 0x000C1324
    public float getNutritionRatio()
    {
        float num = (float)this.getNutrition();
        float tMaxHunger = (float)this.getMaxNutrition();
        return num / tMaxHunger;
    }

    // Token: 0x06000F49 RID: 3913 RVA: 0x000C3144 File Offset: 0x000C1344
    public float getHealthRatio()
    {
        float num = (float)base.getHealth();
        float tMaxHealth = (float)base.getMaxHealth();
        return num / tMaxHealth;
    }

    // Token: 0x06000F4A RID: 3914 RVA: 0x000C3162 File Offset: 0x000C1362
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public bool hasMaxHealth()
    {
        return base.getHealth() >= base.getMaxHealth();
    }

    // Token: 0x06000F4B RID: 3915 RVA: 0x000C3175 File Offset: 0x000C1375
    public bool isStarving()
    {
        return this.getNutrition() == 0;
    }

    // Token: 0x06000F4C RID: 3916 RVA: 0x000C3180 File Offset: 0x000C1380
    public bool hasFavoriteFood()
    {
        return !string.IsNullOrEmpty(this.data.favorite_food);
    }

    // Token: 0x17000093 RID: 147
    // (get) Token: 0x06000F4D RID: 3917 RVA: 0x000C3195 File Offset: 0x000C1395
    public ResourceAsset favorite_food_asset
    {
        get
        {
            return AssetManager.resources.get(this.data.favorite_food);
        }
    }

    // Token: 0x06000F4E RID: 3918 RVA: 0x000C31AC File Offset: 0x000C13AC
    public bool hasEmotions()
    {
        return this._has_emotions;
    }

    // Token: 0x06000F4F RID: 3919 RVA: 0x000C31B4 File Offset: 0x000C13B4
    public bool canHavePrejudice()
    {
        return this.hasEmotions();
    }

    // Token: 0x06000F50 RID: 3920 RVA: 0x000C31BC File Offset: 0x000C13BC
    public bool hasHappinessHistory()
    {
        return this._last_happiness_history.Count > 0;
    }

    // Token: 0x06000F51 RID: 3921 RVA: 0x000C31CC File Offset: 0x000C13CC
    public bool isUnhappy()
    {
        return this.hasEmotions() && this.getHappinessRatio() < 0.3f;
    }

    // Token: 0x06000F52 RID: 3922 RVA: 0x000C31E5 File Offset: 0x000C13E5
    public int getHappiness()
    {
        return this.data.happiness;
    }

    // Token: 0x06000F53 RID: 3923 RVA: 0x000C31F2 File Offset: 0x000C13F2
    public bool isHappy()
    {
        return !this.hasEmotions() || this.getHappinessRatio() >= 0.6f;
    }

    // Token: 0x06000F54 RID: 3924 RVA: 0x000C320E File Offset: 0x000C140E
    public int getMinHappiness()
    {
        return -100;
    }

    // Token: 0x06000F55 RID: 3925 RVA: 0x000C3212 File Offset: 0x000C1412
    public int getMaxHappiness()
    {
        return 100;
    }

    // Token: 0x06000F56 RID: 3926 RVA: 0x000C3216 File Offset: 0x000C1416
    public float getHappinessRatio()
    {
        return ((float)this.getHappiness() + 100f) / 200f;
    }

    // Token: 0x06000F57 RID: 3927 RVA: 0x000C322B File Offset: 0x000C142B
    internal bool isSameSpecies(string pID)
    {
        return this.asset.id == pID;
    }

    // Token: 0x06000F58 RID: 3928 RVA: 0x000C323E File Offset: 0x000C143E
    internal bool isSameSpecies(Actor pActor)
    {
        return this.isSameSpecies(pActor.asset.id);
    }

    // Token: 0x06000F59 RID: 3929 RVA: 0x000C3251 File Offset: 0x000C1451
    internal bool isSameSubspecies(Subspecies pSubspecies)
    {
        return this.subspecies == pSubspecies;
    }

    // Token: 0x06000F5A RID: 3930 RVA: 0x000C325C File Offset: 0x000C145C
    public bool canFight()
    {
        return !this.skipFightCheck() && !this.ignoreAttackTarget() && !this._has_trait_peaceful && !this.isInsideSomething() && (this.kingdom.asset.units_always_aggressive || !this.isBaby());
    }

    // Token: 0x06000F5B RID: 3931 RVA: 0x000C32B0 File Offset: 0x000C14B0
    private bool ignoreAttackTarget()
    {
        return this.hasTask() && this.ai.task.ignore_fight_check;
    }

    // Token: 0x06000F5C RID: 3932 RVA: 0x000C32D1 File Offset: 0x000C14D1
    private bool skipFightCheck()
    {
        return this.asset.skip_fight_logic || (this.asset.is_boat && this.getSimpleComponent<Boat>().hasPassengers());
    }

    // Token: 0x06000F5D RID: 3933 RVA: 0x000C32FF File Offset: 0x000C14FF
    public bool isInWaterAndCantAttack()
    {
        return !this.isWaterCreature() && this.isAffectedByLiquid();
    }

    // Token: 0x06000F5E RID: 3934 RVA: 0x000C3314 File Offset: 0x000C1514
    public bool hasReachedOffspringLimit()
    {
        int tMaxOffspring = this.getMaxOffspring();
        return this.current_children_count >= tMaxOffspring;
    }

    // Token: 0x06000F5F RID: 3935 RVA: 0x000C3334 File Offset: 0x000C1534
    public int getMaxOffspring()
    {
        return (int)Math.Ceiling((double)this.stats["offspring"]);
    }

    // Token: 0x06000F60 RID: 3936 RVA: 0x000C334D File Offset: 0x000C154D
    public bool haveNutritionForNewBaby()
    {
        return !this.needsFood() || this.getNutrition() >= SimGlobals.m.nutrition_cost_new_baby;
    }

    // Token: 0x06000F61 RID: 3937 RVA: 0x000C336C File Offset: 0x000C156C
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public bool isInsideSomething()
    {
        return this.is_inside_building || this.is_inside_boat;
    }

    // Token: 0x06000F62 RID: 3938 RVA: 0x000C3381 File Offset: 0x000C1581
    public bool isOnSameIsland(Actor pActor)
    {
        return this.current_tile.isSameIsland(pActor.current_tile);
    }

    // Token: 0x06000F63 RID: 3939 RVA: 0x000C3394 File Offset: 0x000C1594
    public bool hasSameCity(Actor pActorTarget)
    {
        return base.hasCity() && this.city == pActorTarget.city;
    }

    // Token: 0x06000F64 RID: 3940 RVA: 0x000C33AE File Offset: 0x000C15AE
    public bool canBreed()
    {
        return base.isAlive() && this.isBreedingAge() && this.haveNutritionForNewBaby() && !base.hasStatus("pregnant") && !base.hasStatus("afterglow");
    }

    // Token: 0x06000F65 RID: 3941 RVA: 0x000C33F0 File Offset: 0x000C15F0
    public bool isPlacePrivateForBreeding()
    {
        int tUnitsInChunk = Toolbox.countUnitsInChunk(this.current_tile);
        if (base.hasCity())
        {
            int tEdge = this.city.getPopulationMaximum() * 2 + 10;
            return this.city.countUnits() < tEdge;
        }
        return this.asset.animal_breeding_close_units_limit > tUnitsInChunk;
    }

    // Token: 0x06000F66 RID: 3942 RVA: 0x000C343F File Offset: 0x000C163F
    public bool isOnGround()
    {
        if (this.is_immovable || this.is_unconscious)
        {
            return true;
        }
        if (this.hasTask())
        {
            BehaviourActionActor action = this.ai.action;
            return action != null && action.land_if_hovering;
        }
        return false;
    }

    // Token: 0x06000F67 RID: 3943 RVA: 0x000C3474 File Offset: 0x000C1674
    internal bool isInAttackRange(BaseSimObject pObject)
    {
        float tRange = this.getAttackRange() + pObject.stats["size"];
        tRange *= tRange;
        return Toolbox.SquaredDistVec2Float(this.current_position, pObject.current_position) < tRange;
    }

    // Token: 0x06000F68 RID: 3944 RVA: 0x000C34B1 File Offset: 0x000C16B1
    internal bool isAttackReady()
    {
        return this.attack_timer <= 0f;
    }

    // Token: 0x06000F69 RID: 3945 RVA: 0x000C34C4 File Offset: 0x000C16C4
    public float getAttackCooldownRatio()
    {
        float tCooldown = this.getAttackCooldown();
        if (tCooldown == 0f)
        {
            return 1f;
        }
        return this.attack_timer / tCooldown;
    }

    // Token: 0x06000F6A RID: 3946 RVA: 0x000C34EE File Offset: 0x000C16EE
    internal bool isAttackPossible()
    {
        return this.isAttackReady() && this.current_rotation.z == 0f;
    }

    // Token: 0x06000F6B RID: 3947 RVA: 0x000C350F File Offset: 0x000C170F
    public bool canUseSpells()
    {
        return !base.hasStatus("spell_silence") && !this.hasSpellCastCooldownStatus();
    }

    // Token: 0x06000F6C RID: 3948 RVA: 0x000C352C File Offset: 0x000C172C
    private bool hasSpells()
    {
        return this._spells.hasAny() || (this.hasSubspecies() && this.subspecies.spells.hasAny()) || (this.canUseReligionSpells() && this.religion.spells.hasAny()) || this.asset.hasDefaultSpells();
    }

    // Token: 0x06000F6D RID: 3949 RVA: 0x000C358C File Offset: 0x000C178C
    public bool canUseReligionSpells()
    {
        if (!this.hasReligion())
        {
            return false;
        }
        if (!this.religion.spells.hasAny())
        {
            return false;
        }
        if (this.hasTrait("mute"))
        {
            return false;
        }
        if (this.hasClan())
        {
            return !this.clan.hasTrait("void_ban");
        }
        return !this.religion.is_magic_only_clan_members;
    }

    // Token: 0x06000F6E RID: 3950 RVA: 0x000C35F4 File Offset: 0x000C17F4
    public SpellAsset getRandomSpell()
    {
        SpellAsset result;
        using (ListPool<SpellAsset> tSpellPool = new ListPool<SpellAsset>())
        {
            if (this._spells.hasAny())
            {
                tSpellPool.Add(this._spells.getRandomSpell());
            }
            if (this.hasSubspecies() && this.subspecies.spells.hasAny())
            {
                tSpellPool.Add(this.subspecies.spells.getRandomSpell());
            }
            if (this.canUseReligionSpells())
            {
                tSpellPool.Add(this.religion.spells.getRandomSpell());
            }
            if (this.asset.hasDefaultSpells())
            {
                tSpellPool.Add(this.asset.spells.getRandomSpell());
            }
            if (tSpellPool.Count == 0)
            {
                result = null;
            }
            else
            {
                result = tSpellPool.GetRandom<SpellAsset>();
            }
        }
        return result;
    }

    // Token: 0x06000F6F RID: 3951 RVA: 0x000C36C8 File Offset: 0x000C18C8
    internal override float getHeight()
    {
        return this.position_height + this.hitbox_bonus_height;
    }

    // Token: 0x06000F70 RID: 3952 RVA: 0x000C36D7 File Offset: 0x000C18D7
    public float getScaleMod()
    {
        return this.actor_scale / 0.1f;
    }

    // Token: 0x06000F71 RID: 3953 RVA: 0x000C36E5 File Offset: 0x000C18E5
    public bool isCameraFollowingUnit()
    {
        return MoveCamera.isCameraFollowingUnit(this);
    }

    // Token: 0x06000F72 RID: 3954 RVA: 0x000C36ED File Offset: 0x000C18ED
    internal bool isTargetOkToAttack(Actor pTarget)
    {
        return pTarget != this && base.canAttackTarget(pTarget, true) && base.isSameIslandAs(pTarget);
    }

    // Token: 0x06000F73 RID: 3955 RVA: 0x000C370D File Offset: 0x000C190D
    private float getLastColorEffectTime()
    {
        return World.world.getRealTimeElapsedSince(this._last_color_effect_timestamp);
    }

    // Token: 0x06000F74 RID: 3956 RVA: 0x000C371F File Offset: 0x000C191F
    private float getLastStaminaReduceTime()
    {
        return World.world.getRealTimeElapsedSince(this._last_stamina_reduce_timestamp);
    }

    // Token: 0x06000F75 RID: 3957 RVA: 0x000C3731 File Offset: 0x000C1931
    public bool isUnderDamageCooldown()
    {
        return this.getLastColorEffectTime() < 0.3f;
    }

    // Token: 0x06000F76 RID: 3958 RVA: 0x000C3740 File Offset: 0x000C1940
    private bool isUnderStaminaCooldown()
    {
        return this.getLastStaminaReduceTime() < 0.3f;
    }

    // Token: 0x06000F77 RID: 3959 RVA: 0x000C374F File Offset: 0x000C194F
    private bool haveMetallicArmor()
    {
        return false;
    }

    // Token: 0x06000F78 RID: 3960 RVA: 0x000C3752 File Offset: 0x000C1952
    private bool haveMetallicWeapon()
    {
        return this.hasEquipment() && !this.equipment.getSlot(EquipmentType.Weapon).isEmpty() && this.equipment.getSlot(EquipmentType.Weapon).getItem().getAsset()
            .metallic;
    }

    // Token: 0x06000F79 RID: 3961 RVA: 0x000C378E File Offset: 0x000C198E
    public bool isSameKingdomAndAlmostDead(Actor pActor, float pDamage)
    {
        return this.isSameKingdom(pActor) && (float)base.getHealth() - pDamage <= 0f;
    }

    // Token: 0x06000F7A RID: 3962 RVA: 0x000C37AC File Offset: 0x000C19AC
    public bool isSameKingdom(BaseSimObject pSimObject)
    {
        return this.kingdom == pSimObject.kingdom;
    }

    // Token: 0x06000F7B RID: 3963 RVA: 0x000C37BC File Offset: 0x000C19BC
    public bool isInCityIsland()
    {
        if (this.city.isRekt())
        {
            return false;
        }
        WorldTile tCityTile = this.city.getTile(false);
        return tCityTile != null && this.current_tile.isSameIsland(tCityTile);
    }

    // Token: 0x06000F7C RID: 3964 RVA: 0x000C37FB File Offset: 0x000C19FB
    public bool isClone()
    {
        return this._has_trait_clone;
    }

    // Token: 0x06000F7D RID: 3965 RVA: 0x000C3803 File Offset: 0x000C1A03
    public bool isClonedFrom(Actor pActor)
    {
        return this.isClone() && this.data.parent_id_1 == pActor.data.id;
    }

    // Token: 0x06000F7E RID: 3966 RVA: 0x000C382A File Offset: 0x000C1A2A
    public bool isSameClones(Actor pActor)
    {
        return this.isClone() && pActor.isClone() && this.data.parent_id_1 == pActor.data.parent_id_1;
    }

    // Token: 0x06000F7F RID: 3967 RVA: 0x000C385B File Offset: 0x000C1A5B
    public bool isUnitFitToRule()
    {
        return base.isAlive() && base.isKingdomCiv();
    }

    // Token: 0x17000094 RID: 148
    // (get) Token: 0x06000F80 RID: 3968 RVA: 0x000C3872 File Offset: 0x000C1A72
    public TileZone current_zone
    {
        get
        {
            return this.current_tile.zone;
        }
    }

    // Token: 0x17000095 RID: 149
    // (get) Token: 0x06000F81 RID: 3969 RVA: 0x000C387F File Offset: 0x000C1A7F
    public MapChunk current_chunk
    {
        get
        {
            return this.current_tile.chunk;
        }
    }

    // Token: 0x17000096 RID: 150
    // (get) Token: 0x06000F82 RID: 3970 RVA: 0x000C388C File Offset: 0x000C1A8C
    public MapRegion current_region
    {
        get
        {
            return this.current_tile.region;
        }
    }

    // Token: 0x17000097 RID: 151
    // (get) Token: 0x06000F83 RID: 3971 RVA: 0x000C3899 File Offset: 0x000C1A99
    public TileIsland current_island
    {
        get
        {
            return this.current_tile.region.island;
        }
    }

    // Token: 0x06000F84 RID: 3972 RVA: 0x000C38AB File Offset: 0x000C1AAB
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public bool Equals(Actor pObject)
    {
        return this.GetHashCode() == pObject.GetHashCode();
    }

    // Token: 0x06000F85 RID: 3973 RVA: 0x000C38BC File Offset: 0x000C1ABC
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public int CompareTo(Actor pTarget)
    {
        return this.GetHashCode().CompareTo(pTarget.GetHashCode());
    }

    // Token: 0x06000F86 RID: 3974 RVA: 0x000C38E0 File Offset: 0x000C1AE0
    public bool canTalkWith(Actor pTarget)
    {
        return this != pTarget && pTarget.isReadyToTalk() && base.isSameIslandAs(pTarget) && !base.areFoes(pTarget) && !this.isInsideSomething() && !pTarget.asset.special;
    }

    // Token: 0x06000F87 RID: 3975 RVA: 0x000C3930 File Offset: 0x000C1B30
    public bool canFallInLoveWith(Actor pTarget)
    {
        return !this.hasLover() && this.isAdult() && this.isBreedingAge() && this.subspecies.needs_mate && pTarget.subspecies.needs_mate && this.isSameSpecies(pTarget) && this.subspecies.isPartnerSuitableForReproduction(this, pTarget) && !pTarget.hasLover() && pTarget.isAdult() && pTarget.isBreedingAge() && !this.isRelatedTo(pTarget);
    }

    // Token: 0x06000F88 RID: 3976 RVA: 0x000C39BF File Offset: 0x000C1BBF
    public bool hasHouseCityInBordersAndSameIsland()
    {
        return base.hasCity() && this.hasHouse() && this.inOwnCityBorders() && this.inOwnHouseIsland();
    }

    // Token: 0x06000F89 RID: 3977 RVA: 0x000C39E4 File Offset: 0x000C1BE4
    public bool inOwnHouseIsland()
    {
        Building tHouse = this.getHomeBuilding();
        return !tHouse.isRekt() && this.current_tile.isSameIsland(tHouse.current_tile);
    }

    // Token: 0x06000F8A RID: 3978 RVA: 0x000C3A13 File Offset: 0x000C1C13
    public bool inOwnCityBorders()
    {
        return base.hasCity() && this.current_zone.isSameCityHere(this.city);
    }

    // Token: 0x06000F8B RID: 3979 RVA: 0x000C3A30 File Offset: 0x000C1C30
    public bool inOwnCityIsland()
    {
        if (!base.hasCity())
        {
            return false;
        }
        WorldTile tCityTile = this.city.getTile(false);
        return tCityTile != null && this.current_tile.isSameIsland(tCityTile);
    }

    // Token: 0x06000F8C RID: 3980 RVA: 0x000C3A65 File Offset: 0x000C1C65
    public bool isReadyToTalk()
    {
        return base.isAlive() && this.canSocialize() && (!this.hasTask() || this.ai.task.cancellable_by_socialize);
    }

    // Token: 0x06000F8D RID: 3981 RVA: 0x000C3A98 File Offset: 0x000C1C98
    public bool canSocialize()
    {
        return !this.asset.unit_zombie && !this.isEgg() && !this.isFighting() && !base.hasStatus("recovery_social") && this.hasSubspecies();
    }

    // Token: 0x06000F8E RID: 3982 RVA: 0x000C3AD8 File Offset: 0x000C1CD8
    public int getConstructionSpeed()
    {
        int tResult = 2;
        if (this.hasSubspecies())
        {
            tResult += (int)this.subspecies.base_stats_meta["construction_speed"];
        }
        return tResult;
    }

    // Token: 0x06000F8F RID: 3983 RVA: 0x000C3B09 File Offset: 0x000C1D09
    public bool hasArmy()
    {
        if (this.army == null)
        {
            return false;
        }
        if (!this.army.isAlive())
        {
            this.army = null;
            return false;
        }
        return true;
    }

    // Token: 0x06000F90 RID: 3984 RVA: 0x000C3B2C File Offset: 0x000C1D2C
    private bool combatActionOnTimeout()
    {
        return base.hasStatus("recovery_combat_action");
    }

    // Token: 0x06000F91 RID: 3985 RVA: 0x000C3B39 File Offset: 0x000C1D39
    private bool hasSpellCastCooldownStatus()
    {
        return base.hasStatus("recovery_spell");
    }

    // Token: 0x06000F92 RID: 3986 RVA: 0x000C3B46 File Offset: 0x000C1D46
    public bool hasEnoughMana(int pCostMana)
    {
        return pCostMana == 0 || this.getMana() >= pCostMana;
    }

    // Token: 0x06000F93 RID: 3987 RVA: 0x000C3B59 File Offset: 0x000C1D59
    public int getMana()
    {
        return this.data.mana;
    }

    // Token: 0x06000F94 RID: 3988 RVA: 0x000C3B66 File Offset: 0x000C1D66
    public int getMaxMana()
    {
        return (int)this.stats["mana"];
    }

    // Token: 0x06000F95 RID: 3989 RVA: 0x000C3B79 File Offset: 0x000C1D79
    public void setMaxMana()
    {
        this.setMana(this.getMaxMana(), true);
    }

    // Token: 0x06000F96 RID: 3990 RVA: 0x000C3B88 File Offset: 0x000C1D88
    public bool isManaFull()
    {
        return this.getMana() == this.getMaxMana();
    }

    // Token: 0x06000F97 RID: 3991 RVA: 0x000C3B98 File Offset: 0x000C1D98
    public bool hasEnoughStamina(int pCostStamina)
    {
        return pCostStamina == 0 || this.getStamina() >= pCostStamina;
    }

    // Token: 0x06000F98 RID: 3992 RVA: 0x000C3BAB File Offset: 0x000C1DAB
    public int getStamina()
    {
        return this.data.stamina;
    }

    // Token: 0x06000F99 RID: 3993 RVA: 0x000C3BB8 File Offset: 0x000C1DB8
    public int getMaxStamina()
    {
        return (int)this.stats["stamina"];
    }

    // Token: 0x06000F9A RID: 3994 RVA: 0x000C3BCB File Offset: 0x000C1DCB
    public void setMaxStamina()
    {
        this.setStamina(this.getMaxStamina(), true);
    }

    // Token: 0x06000F9B RID: 3995 RVA: 0x000C3BDA File Offset: 0x000C1DDA
    public bool isStaminaFull()
    {
        return this.getStamina() == this.getMaxStamina();
    }

    // Token: 0x17000098 RID: 152
    // (get) Token: 0x06000F9C RID: 3996 RVA: 0x000C3BEA File Offset: 0x000C1DEA
    public int current_children_count
    {
        get
        {
            return this._current_children;
        }
    }

    // Token: 0x06000F9D RID: 3997 RVA: 0x000C3BF2 File Offset: 0x000C1DF2
    public bool isWarrior()
    {
        return this.profession_asset.profession_id == UnitProfession.Warrior;
    }

    // Token: 0x06000F9E RID: 3998 RVA: 0x000C3C02 File Offset: 0x000C1E02
    public bool isCarnivore()
    {
        return this.hasSubspecies() && this.subspecies.diet_meat;
    }

    // Token: 0x06000F9F RID: 3999 RVA: 0x000C3C1C File Offset: 0x000C1E1C
    public bool isHerbivore()
    {
        return this.hasSubspecies() && this.subspecies.diet_vegetation;
    }

    // Token: 0x06000FA0 RID: 4000 RVA: 0x000C3C36 File Offset: 0x000C1E36
    public bool hasStatusStunned()
    {
        return base.hasStatus("stunned");
    }

    // Token: 0x17000099 RID: 153
    // (get) Token: 0x06000FA1 RID: 4001 RVA: 0x000C3C43 File Offset: 0x000C1E43
    public bool is_unconscious
    {
        get
        {
            return this._has_tag_unconscious;
        }
    }

    // Token: 0x06000FA2 RID: 4002 RVA: 0x000C3C4B File Offset: 0x000C1E4B
    public bool isLying()
    {
        return this.is_unconscious || this._has_status_sleeping;
    }

    // Token: 0x06000FA3 RID: 4003 RVA: 0x000C3C5D File Offset: 0x000C1E5D
    public override bool hasStatusTantrum()
    {
        return this._has_status_tantrum;
    }

    // Token: 0x06000FA4 RID: 4004 RVA: 0x000C3C65 File Offset: 0x000C1E65
    public bool hasAnyCash()
    {
        return this.money > 0 || this.loot > 0;
    }

    // Token: 0x1700009A RID: 154
    // (get) Token: 0x06000FA5 RID: 4005 RVA: 0x000C3C7B File Offset: 0x000C1E7B
    public int loot
    {
        get
        {
            return this.data.loot;
        }
    }

    // Token: 0x1700009B RID: 155
    // (get) Token: 0x06000FA6 RID: 4006 RVA: 0x000C3C88 File Offset: 0x000C1E88
    public int money
    {
        get
        {
            return this.data.money;
        }
    }

    // Token: 0x1700009C RID: 156
    // (get) Token: 0x06000FA7 RID: 4007 RVA: 0x000C3C95 File Offset: 0x000C1E95
    public int renown
    {
        get
        {
            return this.data.renown;
        }
    }

    // Token: 0x1700009D RID: 157
    // (get) Token: 0x06000FA8 RID: 4008 RVA: 0x000C3CA2 File Offset: 0x000C1EA2
    public int level
    {
        get
        {
            return this.data.level;
        }
    }

    // Token: 0x06000FA9 RID: 4009 RVA: 0x000C3CAF File Offset: 0x000C1EAF
    public bool hasEnoughMoney(int pCost)
    {
        return this.money >= pCost;
    }

    // Token: 0x06000FAA RID: 4010 RVA: 0x000C3CC0 File Offset: 0x000C1EC0
    public int getHappinessPercent()
    {
        int tMax = this.getMaxHappiness();
        int tMin = this.getMinHappiness();
        return Mathf.Clamp(Mathf.Clamp(this.getHappiness() - tMin, 0, tMax - tMin) * 100 / (tMax - tMin), 0, 100);
    }

    // Token: 0x06000FAB RID: 4011 RVA: 0x000C3CFB File Offset: 0x000C1EFB
    public float distanceToObjectTarget(BaseSimObject pBaseSimObject)
    {
        return Toolbox.DistVec2Float(this.current_position, pBaseSimObject.current_position);
    }

    // Token: 0x06000FAC RID: 4012 RVA: 0x000C3D0E File Offset: 0x000C1F0E
    public float distanceToActorTile(Actor pActor)
    {
        return this.distanceToActorTile(pActor.current_tile);
    }

    // Token: 0x06000FAD RID: 4013 RVA: 0x000C3D1C File Offset: 0x000C1F1C
    public float distanceToActorTile(WorldTile pTile)
    {
        return this.current_tile.distanceTo(pTile);
    }

    // Token: 0x06000FAE RID: 4014 RVA: 0x000C3D2C File Offset: 0x000C1F2C
    public bool isRelatedTo(Actor pTarget)
    {
        return (this.hasFamily() && pTarget.hasFamily() && this.isSapient() && this.family == pTarget.family) || this.isChildOf(pTarget) || this.isParentOf(pTarget);
    }

    // Token: 0x06000FAF RID: 4015 RVA: 0x000C3D78 File Offset: 0x000C1F78
    public bool isImportantTo(Actor pTarget)
    {
        return (this.hasLover() && this.lover == pTarget) || (this.hasBestFriend() && this.getBestFriend() == pTarget);
    }

    // Token: 0x06000FB0 RID: 4016 RVA: 0x000C3DA4 File Offset: 0x000C1FA4
    public bool canWork()
    {
        if (this.isAdult())
        {
            return true;
        }
        if (this.hasCulture())
        {
            Culture tCulture = this.culture;
            if (tCulture.hasTrait("tiny_legends"))
            {
                return true;
            }
            if (tCulture.hasTrait("youth_reverence"))
            {
                return false;
            }
        }
        return this.getAge() >= SimGlobals.m.child_work_age;
    }

    // Token: 0x1700009E RID: 158
    // (get) Token: 0x06000FB1 RID: 4017 RVA: 0x000C3DFD File Offset: 0x000C1FFD
    public int intelligence
    {
        get
        {
            return (int)this.stats["intelligence"];
        }
    }

    // Token: 0x1700009F RID: 159
    // (get) Token: 0x06000FB2 RID: 4018 RVA: 0x000C3E10 File Offset: 0x000C2010
    public int diplomacy
    {
        get
        {
            return (int)this.stats["diplomacy"];
        }
    }

    // Token: 0x170000A0 RID: 160
    // (get) Token: 0x06000FB3 RID: 4019 RVA: 0x000C3E23 File Offset: 0x000C2023
    public int warfare
    {
        get
        {
            return (int)this.stats["warfare"];
        }
    }

    // Token: 0x170000A1 RID: 161
    // (get) Token: 0x06000FB4 RID: 4020 RVA: 0x000C3E36 File Offset: 0x000C2036
    public int stewardship
    {
        get
        {
            return (int)this.stats["stewardship"];
        }
    }

    // Token: 0x06000FB5 RID: 4021 RVA: 0x000C3E49 File Offset: 0x000C2049
    public bool hasCultureTrait(string pTraitID)
    {
        return this.hasCulture() && this.culture.hasTrait(pTraitID);
    }

    // Token: 0x06000FB6 RID: 4022 RVA: 0x000C3E61 File Offset: 0x000C2061
    public bool canBePossessed()
    {
        return this.asset.allow_possession;
    }

    // Token: 0x06000FB7 RID: 4023 RVA: 0x000C3E6E File Offset: 0x000C206E
    public float getAttackRange()
    {
        return this.stats["range"];
    }

    // Token: 0x06000FB8 RID: 4024 RVA: 0x000C3E80 File Offset: 0x000C2080
    public float getAttackRangeSquared()
    {
        return this.stats["range"] * this.stats["range"];
    }

    // Token: 0x170000A2 RID: 162
    // (get) Token: 0x06000FB9 RID: 4025 RVA: 0x000C3EA3 File Offset: 0x000C20A3
    protected override MetaType meta_type
    {
        get
        {
            return MetaType.Unit;
        }
    }

    // Token: 0x06000FBA RID: 4026 RVA: 0x000C3EA8 File Offset: 0x000C20A8
    public float getStaminaRatio()
    {
        float tMax = (float)this.getMaxStamina();
        if (tMax == 0f)
        {
            return 0f;
        }
        return (float)this.getStamina() / tMax;
    }

    // Token: 0x06000FBB RID: 4027 RVA: 0x000C3ED4 File Offset: 0x000C20D4
    public float getManaRatio()
    {
        float tMax = (float)this.getMaxMana();
        if (tMax == 0f)
        {
            return 0f;
        }
        return (float)this.getMana() / tMax;
    }

    // Token: 0x06000FBC RID: 4028 RVA: 0x000C3F00 File Offset: 0x000C2100
    public bool canGetFoodFromCity()
    {
        return this.isFoodFreeForThisPerson() || this.money > SimGlobals.m.min_coins_before_city_food;
    }

    // Token: 0x06000FBD RID: 4029 RVA: 0x000C3F21 File Offset: 0x000C2121
    public bool isFoodFreeForThisPerson()
    {
        return this.isKing() || this.isCityLeader() || this.isBaby() || this.isStarving();
    }

    // Token: 0x06000FBE RID: 4030 RVA: 0x000C3F4C File Offset: 0x000C214C
    public int getMaxNutrition()
    {
        float tVal = (float)this.asset.nutrition_max;
        if (this.hasSubspecies())
        {
            tVal += this.subspecies.base_stats_meta["max_nutrition"];
        }
        return (int)tVal;
    }

    // Token: 0x06000FBF RID: 4031 RVA: 0x000C3F88 File Offset: 0x000C2188
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public int getExpToLevelup()
    {
        return 100 + (this.data.level - 1) * 20;
    }

    // Token: 0x06000FC0 RID: 4032 RVA: 0x000C3FA0 File Offset: 0x000C21A0
    private bool calculateIsSick()
    {
        return this.hasTrait("infected") || this.hasTrait("plague") || (this.hasTrait("mush_spores") && this.asset.can_turn_into_mush) || (this.hasTrait("tumor_infection") && this.asset.can_turn_into_tumor);
    }

    // Token: 0x06000FC1 RID: 4033 RVA: 0x000C4004 File Offset: 0x000C2204
    public bool isSick()
    {
        return this._has_any_sick_trait;
    }

    // Token: 0x06000FC2 RID: 4034 RVA: 0x000C400C File Offset: 0x000C220C
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public bool canTakeItems()
    {
        return this.asset.take_items;
    }

    // Token: 0x06000FC3 RID: 4035 RVA: 0x000C4019 File Offset: 0x000C2219
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public bool understandsHowToUseItems()
    {
        return this.canUseItems() && this.isSapient();
    }

    // Token: 0x06000FC4 RID: 4036 RVA: 0x000C4030 File Offset: 0x000C2230
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public bool canUseItems()
    {
        return this.asset.use_items;
    }

    // Token: 0x06000FC5 RID: 4037 RVA: 0x000C403D File Offset: 0x000C223D
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public bool canEditEquipment()
    {
        return this.asset.use_items;
    }

    // Token: 0x06000FC6 RID: 4038 RVA: 0x000C404A File Offset: 0x000C224A
    public bool canTurnIntoIceOne()
    {
        return !this.isAdult() && this.asset.can_turn_into_ice_one && this.asset.has_soul;
    }

    // Token: 0x06000FC7 RID: 4039 RVA: 0x000C4075 File Offset: 0x000C2275
    public bool canTurnIntoDemon()
    {
        return !this.isBaby() && this.asset.can_turn_into_demon_in_age_of_chaos;
    }

    // Token: 0x06000FC8 RID: 4040 RVA: 0x000C408C File Offset: 0x000C228C
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public override BaseObjectData getData()
    {
        return this.data;
    }

    // Token: 0x170000A3 RID: 163
    // (get) Token: 0x06000FC9 RID: 4041 RVA: 0x000C4094 File Offset: 0x000C2294
    public bool is_moving
    {
        get
        {
            return this._is_moving || this._possessed_movement;
        }
    }

    // Token: 0x06000FCA RID: 4042 RVA: 0x000C40A6 File Offset: 0x000C22A6
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public bool isCarryingResources()
    {
        return this.inventory.hasResources();
    }

    // Token: 0x06000FCB RID: 4043 RVA: 0x000C40B3 File Offset: 0x000C22B3
    public bool needsFood()
    {
        return this.hasSubspecies() && this.subspecies.needs_food;
    }

    // Token: 0x06000FCC RID: 4044 RVA: 0x000C40CA File Offset: 0x000C22CA
    public bool isDamagedByRain()
    {
        return this.hasSubspecies() && this.subspecies.is_damaged_by_water;
    }

    // Token: 0x06000FCD RID: 4045 RVA: 0x000C40E1 File Offset: 0x000C22E1
    public bool isDamagedByOcean()
    {
        if (this.hasSubspecies())
        {
            return this.subspecies.is_damaged_by_water;
        }
        return this.asset.damaged_by_ocean;
    }

    // Token: 0x06000FCE RID: 4046 RVA: 0x000C4104 File Offset: 0x000C2304
    public int getWaterDamage()
    {
        int tResult = (int)((float)base.getMaxHealth() * SimGlobals.m.water_damage_multiplier);
        if (tResult < 1)
        {
            tResult = 1;
        }
        return tResult;
    }

    // Token: 0x06000FCF RID: 4047 RVA: 0x000C412C File Offset: 0x000C232C
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public bool hasSubspeciesTrait(string pTraitID)
    {
        return this.hasSubspecies() && this.subspecies.hasTrait(pTraitID);
    }

    // Token: 0x06000FD0 RID: 4048 RVA: 0x000C4144 File Offset: 0x000C2344
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public bool hasSubspeciesMetaTag(string pTagID)
    {
        return this.hasSubspecies() && this.subspecies.hasMetaTag(pTagID);
    }

    // Token: 0x06000FD1 RID: 4049 RVA: 0x000C415C File Offset: 0x000C235C
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public bool hasTag(string pTag)
    {
        return this.stats.hasTag(pTag);
    }

    // Token: 0x06000FD2 RID: 4050 RVA: 0x000C416A File Offset: 0x000C236A
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public bool isImmuneToFire()
    {
        return this.hasTag("immunity_fire");
    }

    // Token: 0x06000FD3 RID: 4051 RVA: 0x000C4177 File Offset: 0x000C2377
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public bool isImmuneToCold()
    {
        return this.hasTag("immunity_cold");
    }

    // Token: 0x06000FD4 RID: 4052 RVA: 0x000C4184 File Offset: 0x000C2384
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public bool isImmovable()
    {
        return this.hasTag("immovable");
    }

    // Token: 0x06000FD5 RID: 4053 RVA: 0x000C4191 File Offset: 0x000C2391
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public bool isAiFrozen()
    {
        return this.hasTag("frozen_ai");
    }

    // Token: 0x06000FD6 RID: 4054 RVA: 0x000C419E File Offset: 0x000C239E
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public bool hasStopIdleAnimation()
    {
        return (!this.hasSubspecies() || !this.subspecies.hasMetaTag("always_idle_animation")) && this.hasTag("stop_idle_animation");
    }

    // Token: 0x06000FD7 RID: 4055 RVA: 0x000C41C7 File Offset: 0x000C23C7
    public bool hasDivineScar()
    {
        return this.hasTrait("scar_of_divinity");
    }

    // Token: 0x06000FD8 RID: 4056 RVA: 0x000C41D4 File Offset: 0x000C23D4
    public bool hasTelepathicLink()
    {
        return this.hasSubspecies() && this.subspecies.hasTrait("telepathic_link");
    }

    // Token: 0x06000FD9 RID: 4057 RVA: 0x000C41F0 File Offset: 0x000C23F0
    public float getResourceThrowDistance()
    {
        return this.asset.base_throwing_range + this.stats["throwing_range"];
    }

    // Token: 0x06000FDA RID: 4058 RVA: 0x000C420E File Offset: 0x000C240E
    internal bool isFalling()
    {
        return this.position_height != 0f || this.move_jump_offset.y != 0f;
    }

    // Token: 0x06000FDB RID: 4059 RVA: 0x000C4234 File Offset: 0x000C2434
    public float getAgeRatio()
    {
        float tLifespan = this.stats["lifespan"];
        return (float)this.getAge() / tLifespan;
    }

    // Token: 0x06000FDC RID: 4060 RVA: 0x000C425C File Offset: 0x000C245C
    public int getMassKG()
    {
        float tSizeDiff = this.target_scale / 0.1f;
        return (int)(this.stats["mass_2"] * tSizeDiff);
    }

    // Token: 0x06000FDD RID: 4061 RVA: 0x000C4289 File Offset: 0x000C2489
    public IEnumerable<ResourceContainer> getResourcesFromActor()
    {
        if (this.asset.resources_given == null)
        {
            yield break;
        }
        int tMass = this.getMassKG();
        foreach (ResourceContainer tContainer in this.asset.resources_given)
        {
            ResourceAsset tResourceAsset = tContainer.asset;
            int tMultiplier = tMass / tResourceAsset.drop_per_mass + 1;
            int tAmount = tContainer.amount * tMultiplier;
            tAmount = Mathf.Clamp(tAmount, 1, tResourceAsset.drop_max);
            if (tAmount > 0)
            {
                yield return new ResourceContainer(tContainer.id, tAmount);
            }
        }
        List<ResourceContainer>.Enumerator enumerator = default(List<ResourceContainer>.Enumerator);
        yield break;
        yield break;
    }

    // Token: 0x06000FDE RID: 4062 RVA: 0x000C4299 File Offset: 0x000C2499
    public bool hasXenophobic()
    {
        return this.hasCulture() && this.culture.hasTrait("xenophobic");
    }

    // Token: 0x06000FDF RID: 4063 RVA: 0x000C42B5 File Offset: 0x000C24B5
    public bool hasXenophiles()
    {
        return this.hasCulture() && this.culture.hasTrait("xenophiles");
    }

    // Token: 0x06000FE0 RID: 4064 RVA: 0x000C42D1 File Offset: 0x000C24D1
    public bool hasCannibalism()
    {
        return this.hasSubspecies() && this.subspecies.hasCannibalism();
    }

    // Token: 0x06000FE1 RID: 4065 RVA: 0x000C42E8 File Offset: 0x000C24E8
    public bool isOneCityKingdom()
    {
        return base.hasCity() && this.city.kingdom.countCities() == 1;
    }

    // Token: 0x06000FE2 RID: 4066 RVA: 0x000C4308 File Offset: 0x000C2508
    public bool isImportantPerson()
    {
        return this.isKing() || this.isCityLeader() || this.isArmyGroupLeader() || this.isFavorite();
    }

    // Token: 0x06000FE3 RID: 4067 RVA: 0x000C4333 File Offset: 0x000C2533
    public void generatePhenotypeAndShade()
    {
        this.data.phenotype_index = this.subspecies.getRandomPhenotypeIndex();
        this.data.phenotype_shade = Actor.getRandomPhenotypeShade();
    }

    // Token: 0x06000FE4 RID: 4068 RVA: 0x000C435B File Offset: 0x000C255B
    public static int getRandomPhenotypeShade()
    {
        return Randy.randomInt(0, 4);
    }

    // Token: 0x06000FE5 RID: 4069 RVA: 0x000C4364 File Offset: 0x000C2564
    public bool isRendered()
    {
        return this.current_tile.zone.visible;
    }

    // Token: 0x06000FE6 RID: 4070 RVA: 0x000C4378 File Offset: 0x000C2578
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public bool checkHasRenderedItem()
    {
        return this.canUseItems() && !this._is_in_liquid && !this.isEgg() && (!this.equipment.weapon.isEmpty() || (this.hasTask() && this.ai.task.force_hand_tool != string.Empty) || this.isCarryingResources());
    }

    // Token: 0x06000FE7 RID: 4071 RVA: 0x000C43E6 File Offset: 0x000C25E6
    internal Sprite getSpriteToRender()
    {
        return this.checkSpriteToRender();
    }

    // Token: 0x06000FE8 RID: 4072 RVA: 0x000C43EE File Offset: 0x000C25EE
    public bool hasColoredSprite()
    {
        return this.asset.need_colored_sprite;
    }

    // Token: 0x06000FE9 RID: 4073 RVA: 0x000C43FB File Offset: 0x000C25FB
    public bool isColoredSpriteNeedsCheck(Sprite pMainSprite)
    {
        return this._last_main_sprite != pMainSprite || this._last_color_asset != this.kingdom.kingdomColor;
    }

    // Token: 0x06000FEA RID: 4074 RVA: 0x000C4424 File Offset: 0x000C2624
    public Sprite calculateColoredSprite(Sprite pMainSprite, bool pUpdateFrameData = true)
    {
        if (this.isColoredSpriteNeedsCheck(pMainSprite))
        {
            if (this.animation_container != null && pUpdateFrameData)
            {
                this.animation_container.dict_frame_data.TryGetValue(pMainSprite.name, out this.frame_data);
            }
            this.checkSpriteHead();
            int tPhenotypeID = this.data.phenotype_index;
            int tPhenotypeShadeIndex = this.data.phenotype_shade;
            this._last_colored_sprite = DynamicSpriteCreator.getSpriteUnit(this.frame_data, pMainSprite, this, this.kingdom.kingdomColor, tPhenotypeID, tPhenotypeShadeIndex, this.asset.texture_atlas);
            this._last_main_sprite = pMainSprite;
            this._last_color_asset = this.kingdom.kingdomColor;
        }
        return this._last_colored_sprite;
    }

    // Token: 0x06000FEB RID: 4075 RVA: 0x000C44CE File Offset: 0x000C26CE
    public Sprite getLastColoredSprite()
    {
        return this._last_colored_sprite;
    }

    // Token: 0x06000FEC RID: 4076 RVA: 0x000C44D6 File Offset: 0x000C26D6
    public bool canParallelSetColoredSprite()
    {
        return this.asset.has_avatar_prefab || !this.dirty_sprite_main;
    }

    // Token: 0x06000FED RID: 4077 RVA: 0x000C44F4 File Offset: 0x000C26F4
    public Sprite calculateMainSprite()
    {
        if (this.asset.has_override_sprite)
        {
            return this.asset.get_override_sprite(this);
        }
        this.checkAnimationContainer();
        if (this.ai.action != null && this.ai.action.force_animation)
        {
            return this.animation_container.sprites[this.ai.action.force_animation_id];
        }
        if (!base.isAlive() || this._has_stop_idle_animation)
        {
            return this.animation_container.idle.frames[0];
        }
        float tAnimSpeed = this.asset.animation_walk_speed;
        bool tSpeedAffectsAnimSpeed = false;
        ActorAnimation tAnimation;
        if (this.is_moving || this.timer_jump_animation > 0f || this.move_jump_offset.y > 0f || this.is_in_magnet)
        {
            if (this.animation_container.has_swimming && this.isAffectedByLiquid())
            {
                tAnimation = this.animation_container.swimming;
                tAnimSpeed = this.asset.animation_swim_speed;
            }
            else
            {
                tAnimation = this.animation_container.walking;
            }
            tSpeedAffectsAnimSpeed = true;
        }
        else if (this.position_height > 0f)
        {
            tAnimation = this.animation_container.idle;
        }
        else if (this.animation_container.has_swimming && this.isAffectedByLiquid())
        {
            tAnimation = this.animation_container.swimming;
            tAnimSpeed = this.asset.animation_swim_speed;
            tSpeedAffectsAnimSpeed = true;
        }
        else
        {
            tAnimation = this.animation_container.idle;
            tAnimSpeed = this.asset.animation_idle_speed;
        }
        if (this.asset.animation_speed_based_on_walk_speed && tSpeedAffectsAnimSpeed)
        {
            tAnimSpeed *= this.stats["speed"] / 10f;
            tAnimSpeed = Mathf.Clamp(tAnimSpeed, 4f, tAnimSpeed);
        }
        Sprite tMainSprite;
        if (tAnimation.frames.Length > 1)
        {
            tMainSprite = AnimationHelper.getSpriteFromList(this.GetHashCode(), tAnimation.frames, tAnimSpeed);
        }
        else
        {
            tMainSprite = tAnimation.frames[0];
        }
        return tMainSprite;
    }

    // Token: 0x06000FEE RID: 4078 RVA: 0x000C46CC File Offset: 0x000C28CC
    internal Sprite checkSpriteToRender()
    {
        Sprite tMainSprite = this.calculateMainSprite();
        if (!this.asset.need_colored_sprite)
        {
            return tMainSprite;
        }
        return this.calculateColoredSprite(tMainSprite, true);
    }

    // Token: 0x06000FEF RID: 4079 RVA: 0x000C46F7 File Offset: 0x000C28F7
    protected void setItemSpriteRenderDirty()
    {
        this._dirty_sprite_item = true;
    }

    // Token: 0x06000FF0 RID: 4080 RVA: 0x000C4700 File Offset: 0x000C2900
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public Sprite getRenderedItemSprite()
    {
        if (this._dirty_sprite_item || this._has_animated_item)
        {
            this._cached_hand_renderer_asset = this.getHandRendererAsset();
            this._cached_sprite_item = ItemRendering.getItemMainSpriteFrame(this._cached_hand_renderer_asset);
            this._dirty_sprite_item = false;
        }
        return this._cached_sprite_item;
    }

    // Token: 0x06000FF1 RID: 4081 RVA: 0x000C473C File Offset: 0x000C293C
    public IHandRenderer getCachedHandRendererAsset()
    {
        return this._cached_hand_renderer_asset;
    }

    // Token: 0x06000FF2 RID: 4082 RVA: 0x000C4744 File Offset: 0x000C2944
    public IHandRenderer getHandRendererAsset()
    {
        IHandRenderer tToolItem = this.getRenderedToolOrItem();
        if (tToolItem != null)
        {
            return tToolItem;
        }
        if (this.hasWeapon())
        {
            return this.getWeaponTextureId();
        }
        return null;
    }

    // Token: 0x06000FF3 RID: 4083 RVA: 0x000C4770 File Offset: 0x000C2970
    private IHandRenderer getRenderedToolOrItem()
    {
        if (!this.asset.use_tool_items)
        {
            return null;
        }
        this._has_animated_item = false;
        if (this.has_attack_target && this.hasWeapon())
        {
            return null;
        }
        if (this.isCarryingResources())
        {
            return AssetManager.resources.get(this.inventory.getItemIDToRender());
        }
        if (this.hasTask())
        {
            UnitHandToolAsset tTaskTool = this.ai.task.cached_hand_tool_asset;
            if (tTaskTool != null)
            {
                this._has_animated_item = tTaskTool.animated;
                return tTaskTool;
            }
        }
        return null;
    }

    // Token: 0x06000FF4 RID: 4084 RVA: 0x000C47F0 File Offset: 0x000C29F0
    public bool isItemInHandAnimated()
    {
        if (this.isCarryingResources())
        {
            return false;
        }
        if (this.hasTask())
        {
            UnitHandToolAsset tTaskTool = this.ai.task.cached_hand_tool_asset;
            if (tTaskTool != null)
            {
                return tTaskTool.animated;
            }
        }
        return this.hasWeapon() && this.getWeapon().getAsset().animated;
    }

    // Token: 0x06000FF5 RID: 4085 RVA: 0x000C4844 File Offset: 0x000C2A44
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public void clearSprites()
    {
        this.dirty_sprite_head = true;
        this.dirty_sprite_main = true;
    }

    // Token: 0x06000FF6 RID: 4086 RVA: 0x000C4854 File Offset: 0x000C2A54
    public void clearGraphicsFully()
    {
        this.clearSprites();
        this.clearLastColorCache();
        this.animation_container = null;
        this.frame_data = null;
        this.animation_container = null;
        this._last_main_sprite = null;
    }

    // Token: 0x06000FF7 RID: 4087 RVA: 0x000C487E File Offset: 0x000C2A7E
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public AnimationFrameData getAnimationFrameData()
    {
        return this.frame_data;
    }

    // Token: 0x06000FF8 RID: 4088 RVA: 0x000C4888 File Offset: 0x000C2A88
    public Vector3 getHeadOffsetPositionForFunRendering()
    {
        Vector3 tPos = new Vector3(this.cur_transform_position.x, this.cur_transform_position.y, 0f);
        AnimationFrameData tFrameData = this.getAnimationFrameData();
        if (tFrameData != null)
        {
            tPos.x += tFrameData.pos_head.x * this.current_scale.x;
            tPos.y += tFrameData.pos_head.y * this.current_scale.y;
        }
        return tPos;
    }

    // Token: 0x06000FF9 RID: 4089 RVA: 0x000C4908 File Offset: 0x000C2B08
    public IHandRenderer getWeaponTextureId()
    {
        Item tWeapon = this.getWeapon();
        this._has_animated_item = tWeapon.getAsset().animated;
        return tWeapon.asset;
    }

    // Token: 0x06000FFA RID: 4090 RVA: 0x000C4934 File Offset: 0x000C2B34
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    private ActorTextureSubAsset getTextureAsset()
    {
        ActorTextureSubAsset tTextureAsset;
        if (this.hasSubspecies() && this.subspecies.has_mutation_reskin)
        {
            tTextureAsset = this.subspecies.mutation_skin_asset.texture_asset;
        }
        else
        {
            tTextureAsset = this.asset.texture_asset;
        }
        return tTextureAsset;
    }

    // Token: 0x06000FFB RID: 4091 RVA: 0x000C4976 File Offset: 0x000C2B76
    public string getUnitTexturePath()
    {
        return this.getTextureAsset().getUnitTexturePath(this);
    }

    // Token: 0x06000FFC RID: 4092 RVA: 0x000C4984 File Offset: 0x000C2B84
    internal void checkAnimationContainer()
    {
        if (!this.dirty_sprite_main)
        {
            return;
        }
        this.dirty_sprite_main = false;
        string unitTexturePath = this.getUnitTexturePath();
        ActorAsset pAsset = this.asset;
        Subspecies subspecies = this.subspecies;
        SubspeciesTrait pEggAsset = ((subspecies != null) ? subspecies.egg_asset : null);
        Subspecies subspecies2 = this.subspecies;
        AnimationContainerUnit tContainer = ActorAnimationLoader.getAnimationContainer(unitTexturePath, pAsset, pEggAsset, (subspecies2 != null) ? subspecies2.mutation_skin_asset : null);
        this.animation_container = tContainer;
    }

    // Token: 0x06000FFD RID: 4093 RVA: 0x000C49DE File Offset: 0x000C2BDE
    public SpriteAnimation getSpriteAnimation()
    {
        return this.sprite_animation;
    }

    // Token: 0x06000FFE RID: 4094 RVA: 0x000C49E8 File Offset: 0x000C2BE8
    public Vector2 getRenderedItemPosition()
    {
        AnimationFrameData tFrameData = this.getAnimationFrameData();
        if (tFrameData == null)
        {
            return Vector2.one;
        }
        return tFrameData.pos_item;
    }

    // Token: 0x06000FFF RID: 4095 RVA: 0x000C4A0B File Offset: 0x000C2C0B
    public void clearLastColorCache()
    {
        this._last_colored_sprite = null;
        this._last_color_asset = null;
        this.cached_sprite_head = null;
    }

    // Token: 0x06001000 RID: 4096 RVA: 0x000C4A24 File Offset: 0x000C2C24
    public void startColorEffect(ActorColorEffect pColorType = ActorColorEffect.White)
    {
        if (!this.asset.effect_damage)
        {
            return;
        }
        if (!this.is_visible)
        {
            return;
        }
        if (this.isUnderDamageCooldown())
        {
            return;
        }
        this._last_color_effect_timestamp = World.world.getCurSessionTime();
        if (World.world.stack_effects.actor_effect_hit.Count > 1000)
        {
            return;
        }
        if (pColorType == ActorColorEffect.Red)
        {
            World.world.stack_effects.actor_effect_hit.Add(new ActorDamageEffectData
            {
                actor = this,
                timestamp = this._last_color_effect_timestamp
            });
            return;
        }
        World.world.stack_effects.actor_effect_highlight.Add(new ActorHighlightEffectData
        {
            actor = this,
            timestamp = this._last_color_effect_timestamp
        });
    }

    // Token: 0x06001001 RID: 4097 RVA: 0x000C4AE8 File Offset: 0x000C2CE8
    protected void checkSpriteHead()
    {
        if (!this.dirty_sprite_head)
        {
            return;
        }
        this.dirty_sprite_head = false;
        if (this.frame_data == null)
        {
            return;
        }
        if (!this.frame_data.show_head)
        {
            return;
        }
        if (this.animation_container.heads.Length == 0)
        {
            return;
        }
        if (this.isEgg())
        {
            return;
        }
        if (this.isBaby() && !this.animation_container.render_heads_for_children)
        {
            return;
        }
        ActorTextureSubAsset tTextureAsset = this.getTextureAsset();
        if (!tTextureAsset.has_advanced_textures)
        {
            this.checkHeadID(this.animation_container.heads, true);
            this.setHeadSprite(this.animation_container.heads[this.data.head]);
            return;
        }
        bool tSpecial = false;
        string tHeadPath;
        Sprite[] tListHeadsSprites;
        if (this.isSexMale())
        {
            tHeadPath = tTextureAsset.texture_heads_male;
            tListHeadsSprites = this.animation_container.heads_male;
        }
        else
        {
            tHeadPath = tTextureAsset.texture_heads_female;
            tListHeadsSprites = this.animation_container.heads_female;
        }
        if (this.isSapient())
        {
            if (this.is_profession_warrior && !this.equipment.helmet.isEmpty())
            {
                tHeadPath = tTextureAsset.texture_head_warrior;
                tSpecial = true;
            }
            else if (this.is_profession_king)
            {
                tHeadPath = tTextureAsset.texture_head_king;
                tSpecial = true;
            }
            else if (tTextureAsset.has_old_heads && this.hasTrait("wise"))
            {
                if (this.isSexMale())
                {
                    tHeadPath = tTextureAsset.texture_heads_old_male;
                }
                else
                {
                    tHeadPath = tTextureAsset.texture_heads_old_female;
                }
                tSpecial = true;
            }
            else if (this.isSexMale())
            {
                tHeadPath = tTextureAsset.texture_heads_male;
                tListHeadsSprites = this.animation_container.heads_male;
            }
            else
            {
                tHeadPath = tTextureAsset.texture_heads_female;
                tListHeadsSprites = this.animation_container.heads_female;
            }
        }
        if (tSpecial)
        {
            this.setHeadSprite(ActorAnimationLoader.getHeadSpecial(tHeadPath));
            return;
        }
        this.checkHeadID(tListHeadsSprites, true);
        this.setHeadSprite(ActorAnimationLoader.getHead(tHeadPath, this.data.head));
    }

    // Token: 0x06001002 RID: 4098 RVA: 0x000C4C90 File Offset: 0x000C2E90
    internal void checkHeadID(Sprite[] pListHeads, bool pCheckSavedHead = true)
    {
        if (pCheckSavedHead && this.data.head > pListHeads.Length - 1)
        {
            this.data.head = 0;
        }
        if (this.data.head == -1)
        {
            this.data.head = this.batch.rnd.NextInt(0, pListHeads.Length);
        }
    }

    // Token: 0x06001003 RID: 4099 RVA: 0x000C4CEB File Offset: 0x000C2EEB
    private void setHeadSprite(Sprite pSprite)
    {
        this.cached_sprite_head = pSprite;
    }

    // Token: 0x06001004 RID: 4100 RVA: 0x000C4CF4 File Offset: 0x000C2EF4
    protected void updateDeadAnimation(float pElapsed)
    {
        if (this.asset.special_dead_animation && this.asset.action_dead_animation(this, this.current_tile, pElapsed))
        {
            return;
        }
        if (World.world.quality_changer.isFullLowRes())
        {
            this.die(true, AttackType.None, false, true);
            return;
        }
        if (this.asset.death_animation_angle && this.target_angle.z < 90f)
        {
            this.target_angle.z = Mathf.Lerp(this.target_angle.z, 90f, pElapsed * 4f);
            if (this.target_angle.z > 90f)
            {
                this.target_angle.z = 90f;
            }
            if (this.is_visible && Mathf.Abs(this.current_rotation.z) < 45f)
            {
                return;
            }
        }
        this.changeMoveJumpOffset(-0.05f);
        if (this.isFalling())
        {
            return;
        }
        this.updateDeadBlackAnimation(pElapsed);
    }

    // Token: 0x170000A4 RID: 164
    // (get) Token: 0x06001005 RID: 4101 RVA: 0x000C4DE9 File Offset: 0x000C2FE9
    public bool has_rendered_sprite_head
    {
        get
        {
            return this.cached_sprite_head != null;
        }
    }

    // Token: 0x06001006 RID: 4102 RVA: 0x000C4DF7 File Offset: 0x000C2FF7
    public double[] getDecisionsCooldowns()
    {
        return this._decision_cooldowns;
    }

    // Token: 0x06001007 RID: 4103 RVA: 0x000C4DFF File Offset: 0x000C2FFF
    public bool[] getDecisionsDisabled()
    {
        return this._decision_disabled;
    }

    // Token: 0x06001008 RID: 4104 RVA: 0x000C4E08 File Offset: 0x000C3008
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public bool isDecisionOnCooldown(int pIndex, double pCooldown)
    {
        double tTimestamp = this._decision_cooldowns[pIndex];
        if (tTimestamp == 0.0)
        {
            return false;
        }
        if ((double)World.world.getWorldTimeElapsedSince(tTimestamp) > pCooldown)
        {
            this._decision_cooldowns[pIndex] = 0.0;
            return false;
        }
        return true;
    }

    // Token: 0x06001009 RID: 4105 RVA: 0x000C4E4F File Offset: 0x000C304F
    public void setDecisionCooldown(DecisionAsset pAsset)
    {
        if (pAsset.cooldown == 0)
        {
            return;
        }
        this._decision_cooldowns[pAsset.decision_index] = World.world.getCurWorldTime();
    }

    // Token: 0x0600100A RID: 4106 RVA: 0x000C4E71 File Offset: 0x000C3071
    public bool isDecisionEnabled(int pIndex)
    {
        return !this._decision_disabled[pIndex];
    }

    // Token: 0x0600100B RID: 4107 RVA: 0x000C4E7E File Offset: 0x000C307E
    public bool switchDecisionState(int pIndex)
    {
        this._decision_disabled[pIndex] = !this._decision_disabled[pIndex];
        return this._decision_disabled[pIndex];
    }

    // Token: 0x0600100C RID: 4108 RVA: 0x000C4E9B File Offset: 0x000C309B
    public void setDecisionState(int pIndex, bool pState)
    {
        this._decision_disabled[pIndex] = !pState;
    }

    // Token: 0x0600100D RID: 4109 RVA: 0x000C4EA9 File Offset: 0x000C30A9
    public void setTask(string pTaskId, bool pClean = true, bool pCleanJob = false, bool pForceAction = false)
    {
        this.ai.setTask(pTaskId, pClean, pCleanJob, pForceAction);
    }

    // Token: 0x0600100E RID: 4110 RVA: 0x000C4EBB File Offset: 0x000C30BB
    public void cancelAllBeh()
    {
        this.ai.clearBeh();
        this.ai.setTaskBehFinished();
        this.endJob();
        this.clearTasks();
    }

    // Token: 0x0600100F RID: 4111 RVA: 0x000C4EDF File Offset: 0x000C30DF
    public void endJob()
    {
        this.ai.clearJob();
        this.citizen_job = null;
    }

    // Token: 0x06001010 RID: 4112 RVA: 0x000C4EF3 File Offset: 0x000C30F3
    protected virtual void clearTasks()
    {
        this.exitBuilding();
        this.clearAttackTarget();
        this.timer_action = 0f;
        this.clearTileTarget();
        this.stopMovement();
    }

    // Token: 0x06001011 RID: 4113 RVA: 0x000C4F18 File Offset: 0x000C3118
    public void setCitizenJob(CitizenJobAsset pJobAsset)
    {
        this.citizen_job = pJobAsset;
        this.ai.setJob(pJobAsset.unit_job_default);
    }

    // Token: 0x06001012 RID: 4114 RVA: 0x000C4F32 File Offset: 0x000C3132
    internal void clearBeh()
    {
        this.clearTasks();
        this.beh_tile_target = null;
        this.beh_building_target = null;
        this.beh_actor_target = null;
        this.beh_book_target = null;
    }

    // Token: 0x06001013 RID: 4115 RVA: 0x000C4F56 File Offset: 0x000C3156
    public string getNextJob()
    {
        return Actor.nextJobActor(this.a);
    }

    // Token: 0x06001014 RID: 4116 RVA: 0x000C4F64 File Offset: 0x000C3164
    public static string nextJobActor(Actor pActor)
    {
        if (pActor.isEgg())
        {
            return "egg";
        }
        string tNewJobID = null;
        if (pActor.isSapient())
        {
            if (pActor.isBaby())
            {
                tNewJobID = pActor.asset.job_baby.GetRandom<string>();
            }
            else if (pActor.hasCity())
            {
                if (pActor.isProfession(UnitProfession.Warrior))
                {
                    tNewJobID = pActor.asset.job_attacker.GetRandom<string>();
                }
                else
                {
                    tNewJobID = pActor.asset.job_citizen.GetRandom<string>();
                }
            }
            else if (pActor.isKingdomCiv())
            {
                tNewJobID = pActor.asset.job_kingdom.GetRandom<string>();
            }
            else if (pActor.asset.job.Length != 0)
            {
                tNewJobID = pActor.asset.job.GetRandom<string>();
            }
        }
        else if (pActor.asset.job.Length != 0)
        {
            tNewJobID = pActor.asset.job.GetRandom<string>();
        }
        return tNewJobID;
    }

    // Token: 0x06001015 RID: 4117 RVA: 0x000C503D File Offset: 0x000C323D
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public bool isTask(string pID)
    {
        BehaviourTaskActor task = this.ai.task;
        return ((task != null) ? task.id : null) == pID;
    }

    // Token: 0x06001016 RID: 4118 RVA: 0x000C505C File Offset: 0x000C325C
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public bool hasTask()
    {
        return this.ai.hasTask();
    }

    // Token: 0x06001017 RID: 4119 RVA: 0x000C5069 File Offset: 0x000C3269
    public void clearDecisions()
    {
        this._decision_cooldowns.Clear<double>();
        this._decision_disabled.Clear<bool>();
        this.decisions.Clear<DecisionAsset>();
        this.decisions_counter = 0;
    }

    // Token: 0x06001018 RID: 4120 RVA: 0x000C5093 File Offset: 0x000C3293
    public void scheduleTask(string pTask, WorldTile pTile)
    {
        this.ai.scheduleTask(pTask);
        this.scheduled_tile_target = pTile;
    }

    // Token: 0x06001019 RID: 4121 RVA: 0x000C50A8 File Offset: 0x000C32A8
    private void registerDecisions()
    {
        foreach (ActorTrait actorTrait in this.traits)
        {
            DecisionAsset[] tTraitDecisionAssets = actorTrait.decisions_assets;
            if (tTraitDecisionAssets != null)
            {
                for (int i = 0; i < tTraitDecisionAssets.Length; i++)
                {
                    DecisionAsset[] array = this.decisions;
                    int num = this.decisions_counter;
                    this.decisions_counter = num + 1;
                    array[num] = tTraitDecisionAssets[i];
                }
            }
        }
        Clan clan = this.clan;
        if (clan != null && clan.decisions_assets.Count > 0)
        {
            List<DecisionAsset> tDecisionsAssets = this.clan.decisions_assets;
            for (int j = 0; j < tDecisionsAssets.Count; j++)
            {
                DecisionAsset[] array2 = this.decisions;
                int num = this.decisions_counter;
                this.decisions_counter = num + 1;
                array2[num] = tDecisionsAssets[j];
            }
        }
        Culture culture = this.culture;
        if (culture != null && culture.decisions_assets.Count > 0)
        {
            List<DecisionAsset> tDecisionsAssets2 = this.culture.decisions_assets;
            for (int k = 0; k < tDecisionsAssets2.Count; k++)
            {
                DecisionAsset[] array3 = this.decisions;
                int num = this.decisions_counter;
                this.decisions_counter = num + 1;
                array3[num] = tDecisionsAssets2[k];
            }
        }
        Language language = this.language;
        if (language != null && language.decisions_assets.Count > 0)
        {
            List<DecisionAsset> tDecisionsAssets3 = this.language.decisions_assets;
            for (int l = 0; l < tDecisionsAssets3.Count; l++)
            {
                DecisionAsset[] array4 = this.decisions;
                int num = this.decisions_counter;
                this.decisions_counter = num + 1;
                array4[num] = tDecisionsAssets3[l];
            }
        }
        Religion religion = this.religion;
        if (religion != null && religion.decisions_assets.Count > 0 && this.canUseReligionSpells())
        {
            List<DecisionAsset> tDecisionsAssets4 = this.religion.decisions_assets;
            for (int m = 0; m < tDecisionsAssets4.Count; m++)
            {
                DecisionAsset[] array5 = this.decisions;
                int num = this.decisions_counter;
                this.decisions_counter = num + 1;
                array5[num] = tDecisionsAssets4[m];
            }
        }
        Subspecies subspecies = this.subspecies;
        if (subspecies != null && subspecies.decisions_assets.Count > 0)
        {
            List<DecisionAsset> tDecisionsAssets5 = this.subspecies.decisions_assets;
            for (int n = 0; n < tDecisionsAssets5.Count; n++)
            {
                DecisionAsset[] array6 = this.decisions;
                int num = this.decisions_counter;
                this.decisions_counter = num + 1;
                array6[num] = tDecisionsAssets5[n];
            }
        }
        if (this.profession_asset != null && this.profession_asset.hasDecisions())
        {
            DecisionAsset[] tDecisionsAssets6 = this.profession_asset.decisions_assets;
            for (int i2 = 0; i2 < tDecisionsAssets6.Length; i2++)
            {
                DecisionAsset[] array7 = this.decisions;
                int num = this.decisions_counter;
                this.decisions_counter = num + 1;
                array7[num] = tDecisionsAssets6[i2];
            }
        }
        if (this._spells.hasAny())
        {
            foreach (SpellAsset tSpellAsset in this._spells.spells)
            {
                if (tSpellAsset.hasDecisions())
                {
                    DecisionAsset[] tSpellDecisions = tSpellAsset.decisions_assets;
                    for (int i3 = 0; i3 < tSpellDecisions.Length; i3++)
                    {
                        DecisionAsset[] array8 = this.decisions;
                        int num = this.decisions_counter;
                        this.decisions_counter = num + 1;
                        array8[num] = tSpellDecisions[i3];
                    }
                }
            }
        }
        if (this.hasWeapon() && this.getWeapon().getAsset().hasDecisions())
        {
            DecisionAsset[] tWeaponDecisions = this.getWeapon().getAsset().decisions_assets;
            for (int i4 = 0; i4 < tWeaponDecisions.Length; i4++)
            {
                DecisionAsset[] array9 = this.decisions;
                int num = this.decisions_counter;
                this.decisions_counter = num + 1;
                array9[num] = tWeaponDecisions[i4];
            }
        }
        if (this.hasFamily())
        {
            DecisionAsset[] tDecisionsAssets7 = AssetManager.meta_type_library.family.decisions_assets;
            for (int i5 = 0; i5 < tDecisionsAssets7.Length; i5++)
            {
                DecisionAsset[] array10 = this.decisions;
                int num = this.decisions_counter;
                this.decisions_counter = num + 1;
                array10[num] = tDecisionsAssets7[i5];
            }
        }
        if (base.hasCity() && !this.asset.is_boat)
        {
            DecisionAsset[] tDecisionsAssets8 = AssetManager.meta_type_library.city.decisions_assets;
            for (int i6 = 0; i6 < tDecisionsAssets8.Length; i6++)
            {
                DecisionAsset[] array11 = this.decisions;
                int num = this.decisions_counter;
                this.decisions_counter = num + 1;
                array11[num] = tDecisionsAssets8[i6];
            }
        }
        if (this.hasPlot())
        {
            DecisionAsset[] tDecisionsAssets9 = AssetManager.meta_type_library.plot.decisions_assets;
            for (int i7 = 0; i7 < tDecisionsAssets9.Length; i7++)
            {
                DecisionAsset[] array12 = this.decisions;
                int num = this.decisions_counter;
                this.decisions_counter = num + 1;
                array12[num] = tDecisionsAssets9[i7];
            }
        }
        if (this.hasClan())
        {
            DecisionAsset[] tDecisionsAssets10 = AssetManager.meta_type_library.clan.decisions_assets;
            for (int i8 = 0; i8 < tDecisionsAssets10.Length; i8++)
            {
                DecisionAsset[] array13 = this.decisions;
                int num = this.decisions_counter;
                this.decisions_counter = num + 1;
                array13[num] = tDecisionsAssets10[i8];
            }
        }
    }

    // Token: 0x0600101A RID: 4122 RVA: 0x000C557C File Offset: 0x000C377C
    public void debugFav()
    {
    }

    // Token: 0x170000A5 RID: 165
    // (get) Token: 0x0600101B RID: 4123 RVA: 0x000C557E File Offset: 0x000C377E
    public WorldTile debug_next_step_tile
    {
        get
        {
            return this._next_step_tile;
        }
    }

    // Token: 0x0600101C RID: 4124 RVA: 0x000C5586 File Offset: 0x000C3786
    public void clearWait()
    {
        this.timer_action = 0f;
    }

    // Token: 0x0600101D RID: 4125 RVA: 0x000C5593 File Offset: 0x000C3793
    public void makeWait(float pValue = 10f)
    {
        this.stopMovement();
        this.timer_action = pValue;
    }

    // Token: 0x0600101E RID: 4126 RVA: 0x000C55A2 File Offset: 0x000C37A2
    public void stopSleeping()
    {
        base.finishStatusEffect("sleeping");
    }

    // Token: 0x0600101F RID: 4127 RVA: 0x000C55B0 File Offset: 0x000C37B0
    private void checkStepActionForTile(WorldTile pTile)
    {
        if (pTile.Type.step_action != null && Randy.randomChance(pTile.Type.step_action_chance))
        {
            pTile.Type.step_action(pTile, this.a);
        }
        Building tBuilding = pTile.building;
        if (tBuilding != null && tBuilding.asset.flora)
        {
            BuildingAsset tBuildingAsset = tBuilding.asset;
            FloraType flora_type = tBuildingAsset.flora_type;
            if (flora_type != FloraType.Fungi)
            {
                if (flora_type != FloraType.Plant)
                {
                    return;
                }
                if (tBuildingAsset.type == "type_flower" && WorldLawLibrary.world_law_nectar_nap.isEnabled() && Randy.randomChance(0.1f))
                {
                    this.makeSleep(10f);
                    return;
                }
                if (WorldLawLibrary.world_law_plants_tickles.isEnabled() && Randy.randomChance(0.3f))
                {
                    this.tryToGetSurprised(pTile, false);
                }
                if (WorldLawLibrary.world_law_root_pranks.isEnabled() && Randy.randomChance(0.2f))
                {
                    this.makeStunned(5f);
                }
            }
            else if (WorldLawLibrary.world_law_exploding_mushrooms.isEnabled())
            {
                MapAction.damageWorld(pTile, 5, AssetManager.terraform.get("grenade"), null);
                EffectsLibrary.spawnAtTileRandomScale("fx_explosion_small", pTile, 0.1f, 0.15f);
                return;
            }
        }
    }

    // Token: 0x06001020 RID: 4128 RVA: 0x000C56DF File Offset: 0x000C38DF
    public void setLover(Actor pActor)
    {
        this.lover = pActor;
    }

    // Token: 0x06001021 RID: 4129 RVA: 0x000C56E8 File Offset: 0x000C38E8
    public void setBestFriend(Actor pActor, bool pNew)
    {
        this.data.best_friend_id = pActor.data.id;
        if (pNew)
        {
            this.changeHappiness("just_made_friend", 0);
        }
    }

    // Token: 0x06001022 RID: 4130 RVA: 0x000C5710 File Offset: 0x000C3910
    public void becomeLoversWith(Actor pTarget)
    {
        this.setLover(pTarget);
        pTarget.setLover(this);
        base.addStatusEffect("fell_in_love", 0f, false);
        pTarget.addStatusEffect("fell_in_love", 0f, false);
    }

    // Token: 0x06001023 RID: 4131 RVA: 0x000C5744 File Offset: 0x000C3944
    public void resetSocialize()
    {
        this.data.removeInt("socialize");
        this.timestamp_tween_session_social = 0.0;
    }

    // Token: 0x06001024 RID: 4132 RVA: 0x000C5765 File Offset: 0x000C3965
    public void addActionWaitAfterLand(float pTimer)
    {
        this._action_wait_after_land = true;
        this._action_wait_after_land_timer = pTimer;
    }

    // Token: 0x06001025 RID: 4133 RVA: 0x000C5775 File Offset: 0x000C3975
    private void actionMagnetAnimation(Actor pActor)
    {
        this.position_height = 0f;
    }

    // Token: 0x06001026 RID: 4134 RVA: 0x000C5784 File Offset: 0x000C3984
    private bool isSurprisedJump(WorldTile pTile)
    {
        bool flag = this.canSeeTileBasedOnDirection(pTile);
        bool tMakeJump = false;
        if (!flag && this.hasSubspecies() && this.subspecies.can_process_emotions && (this.subspecies.has_trait_timid || !base.hasStatus("on_guard")))
        {
            tMakeJump = true;
        }
        return tMakeJump;
    }

    // Token: 0x06001027 RID: 4135 RVA: 0x000C57D0 File Offset: 0x000C39D0
    private void checkLand(Actor pActor)
    {
        if (!this.should_check_land_cancel)
        {
            return;
        }
        this.should_check_land_cancel = false;
        if (this.has_attack_target && this.isEnemyTargetAlive() && this._has_emotions && !this.hasStatusTantrum())
        {
            if (this.getHealthRatio() < 0.15f)
            {
                this.cancelAllBeh();
                this.setTask("run_away", true, false, true);
                return;
            }
            if (Toolbox.DistVec2Float(this.current_position, this.attack_target.current_position) < 10f)
            {
                return;
            }
        }
        this.cancelAllBeh();
    }

    // Token: 0x06001028 RID: 4136 RVA: 0x000C5853 File Offset: 0x000C3A53
    private void checkDeathOutsideMap(Actor pActor)
    {
        if (!this.inMapBorder())
        {
            this.getHitFullHealth(AttackType.Gravity);
        }
    }

    // Token: 0x06001029 RID: 4137 RVA: 0x000C5865 File Offset: 0x000C3A65
    public void tryToGetSurprised(WorldTile pTile, bool pForceJump = false)
    {
        if (this.canBeSurprised(pTile))
        {
            this.getSurprised(pTile, pForceJump);
        }
    }

    // Token: 0x0600102A RID: 4138 RVA: 0x000C5878 File Offset: 0x000C3A78
    public void getSurprised(WorldTile pTile, bool pForceJump = false)
    {
        if (!this._has_emotions)
        {
            return;
        }
        float tTimer = 1f + Randy.randomFloat(0f, 2f);
        bool flag = !base.hasStatus("surprised");
        bool tDoSurprisedJump = pForceJump || this.isSurprisedJump(pTile);
        if (flag)
        {
            base.addStatusEffect("surprised", tTimer, false);
            if (base.hasStatus("just_ate"))
            {
                this.poop(false);
                tDoSurprisedJump = true;
            }
        }
        else
        {
            tTimer = 0.1f;
        }
        if (tDoSurprisedJump)
        {
            this.addActionWaitAfterLand(tTimer);
            this.applyRandomForce(1.5f, 2f);
        }
        base.addStatusEffect("on_guard", 0f, false);
        if (tDoSurprisedJump || !this.isTask("investigate_curiosity") || !this.is_moving)
        {
            this.lookTowardsPosition(pTile.posV3);
            this.stopMovement();
            this.cancelAllBeh();
            if (!tDoSurprisedJump)
            {
                this.makeWait(tTimer);
            }
            this.scheduleTask("investigate_curiosity", pTile);
        }
        float tRunAwayChance = 0.3f;
        if (this.hasSubspecies() && this.subspecies.has_trait_timid)
        {
            tRunAwayChance += 0.3f;
        }
        if (Randy.randomChance(tRunAwayChance))
        {
            this.cancelAllBeh();
            this.scheduleTask("run_away", null);
        }
    }

    // Token: 0x0600102B RID: 4139 RVA: 0x000C59A2 File Offset: 0x000C3BA2
    public bool makeSleep(float pTime)
    {
        bool flag = base.addStatusEffect("sleeping", pTime, true);
        if (flag)
        {
            this.makeWait(pTime);
        }
        return flag;
    }

    // Token: 0x0600102C RID: 4140 RVA: 0x000C59BB File Offset: 0x000C3BBB
    public void makeStunned(float pTime = 5f)
    {
        pTime += Randy.randomFloat(0f, pTime * 0.1f);
        this.cancelAllBeh();
        this.makeWait(pTime);
        if (base.addStatusEffect("stunned", pTime, true))
        {
            this.finishAngryStatus();
        }
    }

    // Token: 0x0600102D RID: 4141 RVA: 0x000C59F4 File Offset: 0x000C3BF4
    public void makeStunnedFromUI()
    {
        this.makeStunned(5f);
        this.updateStats();
    }

    // Token: 0x0600102E RID: 4142 RVA: 0x000C5A07 File Offset: 0x000C3C07
    public void justAte()
    {
        base.addStatusEffect("just_ate", 0f, true);
    }

    // Token: 0x0600102F RID: 4143 RVA: 0x000C5A1C File Offset: 0x000C3C1C
    public void poop(bool pApplyForce)
    {
        this.donePooping();
        float tRandomChance = 1f;
        string tBuildingID;
        if (this.hasSubspecies())
        {
            tBuildingID = this.subspecies.getRandomBioProduct();
            tRandomChance = 0.2f;
        }
        else
        {
            tBuildingID = "poop";
        }
        if (tRandomChance >= 1f || Randy.randomChance(tRandomChance))
        {
            BuildingHelper.tryToBuildNear(this.current_tile, tBuildingID);
        }
        if (pApplyForce)
        {
            this.applyRandomForce(1.5f, 2f);
        }
    }

    // Token: 0x06001030 RID: 4144 RVA: 0x000C5A86 File Offset: 0x000C3C86
    public void donePooping()
    {
        base.finishStatusEffect("just_ate");
        this.changeHappiness("just_pooped", 0);
    }

    // Token: 0x06001031 RID: 4145 RVA: 0x000C5AA0 File Offset: 0x000C3CA0
    public void birthEvent(string pAddSpecialTrait = null, string pAddSpecialStatus = null)
    {
        this.changeHappiness("just_had_child", 0);
        this.makeStunned(4f);
        this.spendNutritionOnBirth();
        if (!string.IsNullOrEmpty(pAddSpecialTrait))
        {
            this.addTrait(pAddSpecialTrait, false);
        }
        if (!string.IsNullOrEmpty(pAddSpecialStatus))
        {
            base.addStatusEffect(pAddSpecialStatus, 0f, true);
        }
    }

    // Token: 0x06001032 RID: 4146 RVA: 0x000C5AF4 File Offset: 0x000C3CF4
    public void consumeTopTile(WorldTile pTile)
    {
        if (Randy.randomChance(0.3f))
        {
            World.world.units.addRandomTraitFromBiomeToActor(this, pTile);
        }
        this.addNutritionFromEating(pTile.Type.nutrition, false, true);
        this.countConsumed();
        pTile.topTileEaten(5);
        pTile.setBurned(-1);
    }

    // Token: 0x06001033 RID: 4147 RVA: 0x000C5B48 File Offset: 0x000C3D48
    public void countConsumed()
    {
        ActorData actorData = this.data;
        int food_consumed = actorData.food_consumed;
        actorData.food_consumed = food_consumed + 1;
    }

    // Token: 0x06001034 RID: 4148 RVA: 0x000C5B6C File Offset: 0x000C3D6C
    public void consumeFoodResource(ResourceAsset pAsset)
    {
        this.ate_last_item_id = pAsset.id;
        this.timestamp_session_ate_food = World.world.getCurSessionTime();
        if (pAsset.give_experience != 0)
        {
            this.addExperience(pAsset.give_experience);
        }
        if (pAsset.restore_happiness != 0)
        {
            this.changeHappiness("just_ate", pAsset.restore_happiness);
        }
        int tRestoreHungerValue = pAsset.restore_nutrition;
        float tRestoreHealthPercent = pAsset.restore_health;
        if (this.hasFavoriteFood())
        {
            if (pAsset.id != this.data.favorite_food)
            {
                ResourceAsset tFavoriteFood = this.favorite_food_asset;
                if (pAsset.tastiness > tFavoriteFood.tastiness && Randy.randomChance(pAsset.favorite_food_chance))
                {
                    this.data.favorite_food = pAsset.id;
                }
            }
        }
        else if (Randy.randomChance(pAsset.favorite_food_chance))
        {
            this.data.favorite_food = pAsset.id;
        }
        if (pAsset.id == this.data.favorite_food)
        {
            tRestoreHungerValue *= 2;
            tRestoreHealthPercent *= 2f;
        }
        this.addNutritionFromEating(tRestoreHungerValue, false, true);
        this.restoreHealthPercent(tRestoreHealthPercent);
        this.countConsumed();
        if (Randy.randomChance(pAsset.give_chance))
        {
            ActorTrait[] give_trait = pAsset.give_trait;
            if (give_trait != null && give_trait.Length != 0 && Randy.randomBool())
            {
                ActorTrait tTrait = pAsset.give_trait.GetRandom<ActorTrait>();
                if (tTrait != null)
                {
                    this.addTrait(tTrait, false);
                }
            }
            StatusAsset[] give_status = pAsset.give_status;
            if (give_status != null && give_status.Length != 0 && Randy.randomBool())
            {
                StatusAsset tStatus = pAsset.give_status.GetRandom<StatusAsset>();
                if (tStatus != null)
                {
                    this.addStatusEffect(tStatus, 0f, true);
                }
            }
            if (pAsset.give_action != null && Randy.randomBool())
            {
                pAsset.give_action(pAsset);
            }
        }
    }

    // Token: 0x06001035 RID: 4149 RVA: 0x000C5D15 File Offset: 0x000C3F15
    internal void justBorn()
    {
        this.setActorScale(0.02f);
    }

    // Token: 0x06001036 RID: 4150 RVA: 0x000C5D22 File Offset: 0x000C3F22
    public void stopBeingWarrior()
    {
        this.setProfession(UnitProfession.Unit, true);
        if (base.hasCity())
        {
            this.city.status.warriors_current--;
        }
        this.removeFromArmy();
    }

    // Token: 0x06001037 RID: 4151 RVA: 0x000C5D54 File Offset: 0x000C3F54
    public void pokeFromAvatarUI()
    {
        if (base.getHealth() > 1)
        {
            this.getHit(1f, true, AttackType.Divine, null, true, false, true);
        }
        if (Randy.randomChance(0.15f))
        {
            this.makeStunnedFromUI();
            this.changeHappiness("got_poked", 0);
        }
        base.addStatusEffect("motivated", 0f, true);
        this.applyRandomForce(1.5f, 2f);
    }

    // Token: 0x06001038 RID: 4152 RVA: 0x000C5DBC File Offset: 0x000C3FBC
    public void finishPossessionStatus()
    {
        base.finishStatusEffect("possessed");
        this._has_status_possessed = false;
    }

    // Token: 0x06001039 RID: 4153 RVA: 0x000C5DD0 File Offset: 0x000C3FD0
    public void madePeace(War pWar)
    {
        this.changeHappiness("just_made_peace", 0);
        if (this.isKing())
        {
            this.addRenown(pWar.getRenown(), 0.2f);
        }
        if (this.isCityLeader())
        {
            this.addRenown(pWar.getRenown(), 0.05f);
        }
        if (this.hasTag("love_peace"))
        {
            base.addStatusEffect("festive_spirit", 0f, true);
        }
    }

    // Token: 0x0600103A RID: 4154 RVA: 0x000C5E3C File Offset: 0x000C403C
    public void warWon(War pWar)
    {
        if (!this.hasHappinessEntry("was_conquered", 300f))
        {
            if (this.isKing())
            {
                this.addRenown(pWar.getRenown());
            }
            if (this.isCityLeader())
            {
                this.addRenown(pWar.getRenown(), 0.2f);
            }
            if (this.isWarrior())
            {
                this.addRenown(pWar.getRenown(), 0.05f);
            }
            this.changeHappiness("just_won_war", 0);
        }
        if (this.hasTag("love_peace"))
        {
            base.addStatusEffect("festive_spirit", 0f, true);
        }
    }

    // Token: 0x0600103B RID: 4155 RVA: 0x000C5ECD File Offset: 0x000C40CD
    public void warLost(War pWar)
    {
        this.changeHappiness("just_lost_war", 0);
        if (this.isKing())
        {
            this.addRenown(pWar.getRenown(), 0.05f);
        }
    }

    // Token: 0x0600103C RID: 4156 RVA: 0x000C5EF5 File Offset: 0x000C40F5
    public void setTransformed()
    {
        this.data.set("transformation_done", true);
    }

    // Token: 0x0600103D RID: 4157 RVA: 0x000C5F0C File Offset: 0x000C410C
    public bool isAlreadyTransformed()
    {
        bool tValue;
        this.data.get("transformation_done", out tValue, false);
        return tValue;
    }

    // Token: 0x0600103E RID: 4158 RVA: 0x000C5F2D File Offset: 0x000C412D
    public void makeConfused(float pConfusedTimer = -1f, bool pColorEffect = false)
    {
        this.cancelAllBeh();
        if (pColorEffect)
        {
            this.startColorEffect(ActorColorEffect.White);
        }
        base.addStatusEffect("confused", pConfusedTimer, pColorEffect);
        this.makeStunned(3f);
    }

    // Token: 0x0600103F RID: 4159 RVA: 0x000C5F58 File Offset: 0x000C4158
    public void checkShouldBeEgg()
    {
        if (this.hasSubspecies() && this.subspecies.has_egg_form && (float)this.age < this.subspecies.age_adult)
        {
            float tMaturationTime = this.getMaturationTimeSeconds();
            base.addStatusEffect("egg", tMaturationTime, true);
        }
    }

    // Token: 0x06001040 RID: 4160 RVA: 0x000C5FA3 File Offset: 0x000C41A3
    public void leavePlot()
    {
        this.setPlot(null);
    }

    // Token: 0x06001041 RID: 4161 RVA: 0x000C5FAC File Offset: 0x000C41AC
    private void levelUp()
    {
        int tExpToLevelUp = this.getExpToLevelup();
        int tMaxLevel = this.getMaxPossibleLevel();
        this.data.experience = 0;
        ActorData actorData = this.data;
        int level = actorData.level;
        actorData.level = level + 1;
        if (this.hasCulture() && this.culture.hasTrait("training_potential"))
        {
            ActorData actorData2 = this.data;
            level = actorData2.level;
            actorData2.level = level + 1;
        }
        if (this.data.level == tMaxLevel)
        {
            this.data.experience = tExpToLevelUp;
        }
        this.setStatsDirty();
        EffectsLibrary.showMetaEventEffect("fx_experience_gain", this);
    }

    // Token: 0x06001042 RID: 4162 RVA: 0x000C6044 File Offset: 0x000C4244
    private void checkGrowthEvent()
    {
        bool tWasBaby = this.isBaby();
        bool flag = this.isEgg();
        this.calcAgeStates();
        if (this.animation_container != null && this.animation_container.child != this.isBaby())
        {
            this.clearSprites();
        }
        if (flag && !this.isEgg())
        {
            this.batch.c_events_hatched.Add(this);
            return;
        }
        if (tWasBaby && !this.isBaby())
        {
            this.batch.c_events_become_adult.Add(this);
        }
    }

    // Token: 0x06001043 RID: 4163 RVA: 0x000C60BD File Offset: 0x000C42BD
    internal void eventHatchFromEgg()
    {
        this.growthStateEvent();
        this.triggerHatchFromEggAction();
        this.applyRandomForce(1.5f, 2f);
        this.changeHappiness("just_got_out_of_egg", 0);
        this.batch.c_events_hatched.Remove(this);
    }

    // Token: 0x06001044 RID: 4164 RVA: 0x000C60FC File Offset: 0x000C42FC
    internal void eventBecomeAdult()
    {
        this.growthStateEvent();
        this.changeHappiness("just_became_adult", 0);
        this.checkTraitMutationGrowUp();
        this.batch.c_events_become_adult.Remove(this);
        RateCounter counter_new_adults = this.subspecies.counter_new_adults;
        if (counter_new_adults == null)
        {
            return;
        }
        counter_new_adults.registerEvent();
    }

    // Token: 0x06001045 RID: 4165 RVA: 0x000C6148 File Offset: 0x000C4348
    private void growthStateEvent()
    {
        this.setStatsDirty();
        this.event_full_stats = true;
        if (base.hasCity())
        {
            this.city.setCitizensDirty();
            this.city.setStatusDirty();
        }
    }

    // Token: 0x06001046 RID: 4166 RVA: 0x000C6178 File Offset: 0x000C4378
    private void triggerHatchFromEggAction()
    {
        SubspeciesTrait tEgg = this.subspecies.egg_asset;
        if (tEgg == null)
        {
            return;
        }
        if (!tEgg.has_after_hatch_from_egg_action)
        {
            return;
        }
        tEgg.after_hatch_from_egg_action(this);
    }

    // Token: 0x06001047 RID: 4167 RVA: 0x000C61AC File Offset: 0x000C43AC
    public bool checkNaturalDeath()
    {
        if (!WorldLawLibrary.world_law_old_age.isEnabled())
        {
            return false;
        }
        if (this.hasTrait("immortal"))
        {
            return false;
        }
        float tAge = (float)this.getAge();
        float tLifespan = this.stats["lifespan"];
        if (tLifespan == 0f)
        {
            return false;
        }
        if (tAge <= tLifespan)
        {
            return false;
        }
        float tOverAge = tAge - tLifespan;
        float tSeverity = 5f;
        if (Randy.randomChance(Mathf.Clamp(1f / (1f + Mathf.Exp(-tSeverity * (tOverAge / tLifespan - 0.5f))), 0f, 0.9f)))
        {
            this.getHitFullHealth(AttackType.Age);
            return true;
        }
        return false;
    }

    // Token: 0x06001048 RID: 4168 RVA: 0x000C6248 File Offset: 0x000C4448
    public void spawnParticle(Color pColor)
    {
        if (Randy.randomBool())
        {
            return;
        }
        if (!MapBox.isRenderGameplay())
        {
            return;
        }
        Vector3 tVec = this.current_position;
        tVec.y += 0.5f * this.current_scale.y / 2f;
        tVec.x += Randy.randomFloat(-0.2f, 0.2f);
        tVec.y += Randy.randomFloat(-0.2f, 0.2f);
        BaseEffect tEffects = EffectsLibrary.spawn("fx_status_particle", null, null, null, 0f, -1f, -1f, null);
        if (tEffects != null)
        {
            ((StatusParticle)tEffects).spawnParticle(tVec, pColor, 0.25f);
        }
    }

    // Token: 0x06001049 RID: 4169 RVA: 0x000C6300 File Offset: 0x000C4500
    private void checkActionsFromAllMetas()
    {
        if (this.hasSubspecies())
        {
            this.addSpecialEffectsFromMetas(this.subspecies.s_special_effect_traits);
            this.s_action_attack_target = (AttackAction)Delegate.Combine(this.s_action_attack_target, this.subspecies.s_action_attack_target);
            this.s_get_hit_action = (GetHitAction)Delegate.Combine(this.s_get_hit_action, this.subspecies.s_action_get_hit);
        }
        if (this.hasClan())
        {
            this.addSpecialEffectsFromMetas(this.clan.s_special_effect_traits);
            this.s_action_attack_target = (AttackAction)Delegate.Combine(this.s_action_attack_target, this.clan.s_action_attack_target);
            this.s_get_hit_action = (GetHitAction)Delegate.Combine(this.s_get_hit_action, this.clan.s_action_get_hit);
        }
        if (this.hasLanguage())
        {
            this.addSpecialEffectsFromMetas(this.language.s_special_effect_traits);
            this.s_action_attack_target = (AttackAction)Delegate.Combine(this.s_action_attack_target, this.language.s_action_attack_target);
            this.s_get_hit_action = (GetHitAction)Delegate.Combine(this.s_get_hit_action, this.language.s_action_get_hit);
        }
        if (this.hasCulture())
        {
            this.addSpecialEffectsFromMetas(this.culture.s_special_effect_traits);
            this.s_action_attack_target = (AttackAction)Delegate.Combine(this.s_action_attack_target, this.culture.s_action_attack_target);
            this.s_get_hit_action = (GetHitAction)Delegate.Combine(this.s_get_hit_action, this.culture.s_action_get_hit);
        }
        if (this.hasReligion())
        {
            this.addSpecialEffectsFromMetas(this.religion.s_special_effect_traits);
            this.s_action_attack_target = (AttackAction)Delegate.Combine(this.s_action_attack_target, this.religion.s_action_attack_target);
            this.s_get_hit_action = (GetHitAction)Delegate.Combine(this.s_get_hit_action, this.religion.s_action_get_hit);
        }
    }

    // Token: 0x0600104A RID: 4170 RVA: 0x000C64D4 File Offset: 0x000C46D4
    private void recalcCombatActions()
    {
        foreach (ActorTrait tTrait in this.traits)
        {
            if (tTrait.hasCombatActions())
            {
                this._combat_actions.mergeWith(tTrait.combat_actions);
            }
        }
        Subspecies subspecies = this.subspecies;
        this.checkCombatActions((subspecies != null) ? subspecies.combat_actions : null);
        Clan clan = this.clan;
        this.checkCombatActions((clan != null) ? clan.combat_actions : null);
        Religion religion = this.religion;
        this.checkCombatActions((religion != null) ? religion.combat_actions : null);
    }

    // Token: 0x0600104B RID: 4171 RVA: 0x000C6584 File Offset: 0x000C4784
    private void recalcSpells()
    {
        foreach (ActorTrait tTrait in this.traits)
        {
            if (tTrait.hasSpells())
            {
                this._spells.mergeWith(tTrait.spells);
            }
        }
        if (this.hasEquipment())
        {
            foreach (ActorEquipmentSlot tSlot in this.equipment)
            {
                if (!tSlot.isEmpty())
                {
                    Item tItem = tSlot.getItem();
                    if (tItem.asset.hasSpells())
                    {
                        this._spells.mergeWith(tItem.asset.spells);
                    }
                }
            }
        }
    }

    // Token: 0x0600104C RID: 4172 RVA: 0x000C665C File Offset: 0x000C485C
    private void checkSpells(SpellHolder pSpellsHolder)
    {
        if (pSpellsHolder == null || !pSpellsHolder.hasAny())
        {
            return;
        }
        this._spells.mergeWith(pSpellsHolder);
    }

    // Token: 0x0600104D RID: 4173 RVA: 0x000C6676 File Offset: 0x000C4876
    private void checkCombatActions(CombatActionHolder pHolder)
    {
        if (pHolder == null)
        {
            return;
        }
        if (pHolder.isEmpty())
        {
            return;
        }
        this._combat_actions.mergeWith(pHolder);
    }

    // Token: 0x0600104E RID: 4174 RVA: 0x000C6691 File Offset: 0x000C4891
    public List<CombatActionAsset> getCombatActionPool(CombatActionPool pPool)
    {
        if (!this._combat_actions.hasAny())
        {
            return null;
        }
        return this._combat_actions.getPool(pPool);
    }

    // Token: 0x0600104F RID: 4175 RVA: 0x000C66AE File Offset: 0x000C48AE
    private void clearCombatActions()
    {
        this._combat_actions.reset();
    }

    // Token: 0x06001050 RID: 4176 RVA: 0x000C66BB File Offset: 0x000C48BB
    private void clearSpells()
    {
        this._spells.reset();
    }

    // Token: 0x06001051 RID: 4177 RVA: 0x000C66C8 File Offset: 0x000C48C8
    private bool checkCurrentEnemyTarget()
    {
        if (this.skipFightCheck())
        {
            return false;
        }
        if (!this.has_attack_target)
        {
            return false;
        }
        if (this.ignoreAttackTarget())
        {
            return false;
        }
        if (!this.isEnemyTargetAlive())
        {
            return false;
        }
        BaseSimObject tAttackTarget = this.attack_target;
        Actor tAttackTargetActor = this.attack_target.a;
        if (base.isKingdomCiv() && tAttackTarget.isKingdomCiv() && !this.shouldContinueToAttackTarget())
        {
            this.clearAttackTarget();
            return false;
        }
        if (tAttackTarget.isActor() && !this.hasStatusTantrum() && !tAttackTarget.areFoes(this) && tAttackTarget.a.is_unconscious)
        {
            this.clearAttackTarget();
            return false;
        }
        if (base.canAttackTarget(tAttackTarget, true))
        {
            bool tAttackPossible = this.isAttackPossible();
            bool tInAttackInRange = this.isInAttackRange(tAttackTarget);
            if (!tInAttackInRange)
            {
                float tDist = this.distanceToObjectTarget(tAttackTarget);
                if (tDist > 20f && tAttackTargetActor != null && tAttackTargetActor.isTask("run_away"))
                {
                    this.clearAttackTarget();
                    return false;
                }
                if (tDist > 50f)
                {
                    this.clearAttackTarget();
                    return false;
                }
                CombatActionAsset tCombatAsset;
                if (tDist > 3f && this.tryToUseAdvancedCombatAction(this.getCombatActionPool(CombatActionPool.BEFORE_ATTACK_MELEE), tAttackTarget, out tCombatAsset))
                {
                    tCombatAsset.action_actor_target_position(this, tAttackTarget.current_position, tAttackTarget.current_tile);
                    return false;
                }
            }
            if (this.attack_timer > 0f || (!tAttackPossible && tInAttackInRange))
            {
                this.stopMovement();
                CombatActionAsset tCombatAsset2;
                if (this.hasRangeAttack() && this.tryToUseAdvancedCombatAction(this.getCombatActionPool(CombatActionPool.BEFORE_ATTACK_RANGE), tAttackTarget, out tCombatAsset2))
                {
                    tCombatAsset2.action_actor_target_position(this, tAttackTarget.current_position, tAttackTarget.current_tile);
                }
                return true;
            }
            if (tInAttackInRange && this.tryToAttack(tAttackTarget, false, null, default(Vector3), null, null, 0f))
            {
                this.stopMovement();
                return true;
            }
        }
        return false;
    }

    // Token: 0x06001052 RID: 4178 RVA: 0x000C6868 File Offset: 0x000C4A68
    private bool checkEnemyTargets()
    {
        if (!this.canFight())
        {
            return false;
        }
        if (this.isInWaterAndCantAttack())
        {
            return false;
        }
        if (this._has_status_strange_urge)
        {
            return false;
        }
        if (this.has_attack_target)
        {
            if (!this.hasTask() || !this.ai.task.in_combat)
            {
                this.setTask("fighting", true, true, false);
            }
            return false;
        }
        if (this._timeout_targets > 0f)
        {
            return false;
        }
        this._timeout_targets = 0.1f + Randy.randomFloat(0f, 1f);
        BaseSimObject tNewTarget = base.findEnemyObjectTarget();
        if (tNewTarget == null && this._aggression_targets.Count > 0)
        {
            using (ListPool<Actor> tList = new ListPool<Actor>(this._aggression_targets.Count))
            {
                foreach (long tID in this._aggression_targets)
                {
                    Actor tActor = World.world.units.get(tID);
                    if (!tActor.isRekt())
                    {
                        tList.Add(tActor);
                    }
                }
                if (tList.Count > 0)
                {
                    base.checkObjectList(tList, true, 30f, true, out tNewTarget);
                }
                else
                {
                    this._aggression_targets.Clear();
                }
            }
        }
        if (tNewTarget == null)
        {
            return false;
        }
        this.startFightingWith(tNewTarget);
        return true;
    }

    // Token: 0x06001053 RID: 4179 RVA: 0x000C69CC File Offset: 0x000C4BCC
    public void startFightingWith(BaseSimObject pSimObject)
    {
        this.setAttackTarget(pSimObject);
        this.setTask("fighting", false, true, false);
        this.beh_actor_target = pSimObject;
    }

    // Token: 0x06001054 RID: 4180 RVA: 0x000C69EA File Offset: 0x000C4BEA
    internal void startAttackCooldown()
    {
        this.attack_timer = this.getAttackCooldown();
        this.last_attack_timestamp = World.world.getCurWorldTime();
    }

    // Token: 0x06001055 RID: 4181 RVA: 0x000C6A08 File Offset: 0x000C4C08
    internal bool isJustAttacked()
    {
        return World.world.getWorldTimeElapsedSince(this.last_attack_timestamp) < 0.25f;
    }

    // Token: 0x06001056 RID: 4182 RVA: 0x000C6A24 File Offset: 0x000C4C24
    internal bool tryToAttack(BaseSimObject pTarget, bool pDoChecks = true, Action pKillAction = null, Vector3 pAttackPosition = default(Vector3), Kingdom pForceKingdom = null, WorldTile pTileTarget = null, float pBonusAreOfEffect = 0f)
    {
        if (pDoChecks)
        {
            if (this.hasMeleeAttack() && pTarget != null && pTarget.position_height > 0f)
            {
                return false;
            }
            if (this.isInWaterAndCantAttack())
            {
                return false;
            }
            if (!this.isAttackPossible())
            {
                return false;
            }
            if (pTarget != null && !this.isInAttackRange(pTarget))
            {
                return false;
            }
        }
        float tZ = 0f;
        float tTargetSize = 0f;
        Vector3 tTargetPos;
        if (pTarget != null)
        {
            tTargetPos = pTarget.current_position;
            tZ = pTarget.getHeight();
            tTargetSize = pTarget.stats["size"];
        }
        else
        {
            tTargetPos = pAttackPosition;
        }
        bool tPossessed = this._has_status_possessed;
        this.startAttackCooldown();
        this.punchTargetAnimation(tTargetPos, true, this.hasRangeAttack(), 40f);
        Vector3 tAttackPosition = new Vector3(tTargetPos.x, tTargetPos.y);
        if (pTarget != null && pTarget.isActor() && pTarget.a.is_moving && pTarget.isFlying())
        {
            tAttackPosition = Vector3.MoveTowards(tAttackPosition, pTarget.a.next_step_position, tTargetSize * 3f);
        }
        Vector3 tCurrentPos = this.current_position;
        float tDist = Vector2.Distance(tCurrentPos, tTargetPos) + tZ;
        Vector3 tAttackVector = Toolbox.getNewPoint(tCurrentPos.x, tCurrentPos.y, tAttackPosition.x, tAttackPosition.y, tDist - tTargetSize, true);
        string tProjectileID = this.getWeaponAsset().projectile;
        bool tRangeAttack = this.hasRangeAttack();
        Kingdom tKingdomForData = pForceKingdom ?? this.kingdom;
        WorldTile tHitTileTarget = pTileTarget ?? ((pTarget != null) ? pTarget.current_tile : null);
        Kingdom pKingdom = tKingdomForData;
        Vector3 pInitiatorPosition = tCurrentPos;
        AttackData tAttackData = new AttackData(this, tHitTileTarget, tAttackVector, pInitiatorPosition, pTarget, pKingdom, AttackType.Weapon, this.haveMetallicWeapon(), true, tRangeAttack, tProjectileID, pKillAction, pBonusAreOfEffect);
        bool result;
        using (ListPool<CombatActionAsset> tRandomPool = new ListPool<CombatActionAsset>())
        {
            if (this.hasSpells() && this.canUseSpells() && !tPossessed)
            {
                this.addToAttackPool(CombatActionLibrary.combat_cast_spell, tRandomPool);
            }
            CombatActionAsset tCombatAsset;
            bool tCombatActionDone;
            if (tRandomPool.Count > 0)
            {
                if (this.hasMeleeAttack())
                {
                    this.addToAttackPool(CombatActionLibrary.combat_attack_melee, tRandomPool);
                }
                else
                {
                    this.addToAttackPool(CombatActionLibrary.combat_attack_range, tRandomPool);
                }
                tCombatAsset = tRandomPool.GetRandom<CombatActionAsset>();
                tCombatActionDone = tCombatAsset.action(tAttackData);
                if (!tCombatActionDone && !tCombatAsset.basic)
                {
                    if (this.hasMeleeAttack())
                    {
                        tCombatActionDone = CombatActionLibrary.combat_attack_melee.action(tAttackData);
                    }
                    else
                    {
                        tCombatActionDone = CombatActionLibrary.combat_attack_range.action(tAttackData);
                    }
                }
            }
            else
            {
                if (this.hasMeleeAttack())
                {
                    tCombatAsset = CombatActionLibrary.combat_attack_melee;
                }
                else
                {
                    tCombatAsset = CombatActionLibrary.combat_attack_range;
                }
                tCombatActionDone = tCombatAsset.action(tAttackData);
            }
            if (tCombatActionDone)
            {
                this.spendStamina(tCombatAsset.cost_stamina);
                this.spendMana(tCombatAsset.cost_mana);
            }
            if (tCombatAsset.play_unit_attack_sounds && this.asset.has_sound_attack)
            {
                MusicBox.playSound(this.asset.sound_attack, this.current_tile, true, true);
            }
            if (this.needsFood() && Randy.randomBool())
            {
                this.decreaseNutrition(-1);
            }
            float tRecoil = this.stats.get("recoil");
            if (tRecoil > 0f)
            {
                this.calculateForce(this.current_position.x, this.current_position.y, tAttackPosition.x, tAttackPosition.y, tRecoil, 0f, false);
            }
            result = true;
        }
        return result;
    }

    // Token: 0x06001057 RID: 4183 RVA: 0x000C6D80 File Offset: 0x000C4F80
    internal override void getHitFullHealth(AttackType pAttackType)
    {
        this.getHit((float)base.getHealth(), false, pAttackType, null, false, false, false);
    }

    // Token: 0x06001058 RID: 4184 RVA: 0x000C6D98 File Offset: 0x000C4F98
    internal override void getHit(float pDamage, bool pFlash, AttackType pAttackType, BaseSimObject pAttacker = null, bool pSkipIfShake = true, bool pMetallicWeapon = false, bool pCheckDamageReduction = true)
    {
        this._last_attack_type = pAttackType;
        if (this._cache_check_has_status_removed_on_damage)
        {
            foreach (Status tStatusData in base.getStatuses())
            {
                if (tStatusData.asset.removed_on_damage && !tStatusData.is_finished)
                {
                    base.finishStatusEffect(tStatusData.asset.id);
                }
            }
        }
        if (DebugConfig.isOn(DebugOption.IgnoreDamage))
        {
            return;
        }
        if (pSkipIfShake && this.shake_active)
        {
            return;
        }
        this.attackedBy = null;
        if (pAttacker.isRekt())
        {
            pAttacker = null;
        }
        if (pAttacker != this)
        {
            this.attackedBy = pAttacker;
        }
        if (!base.hasHealth())
        {
            return;
        }
        if (base.hasStatus("invincible"))
        {
            return;
        }
        Actor tAttackerUnit = ((pAttacker != null) ? pAttacker.a : null);
        if (pAttackType == AttackType.Weapon)
        {
            bool tClank = false;
            if (pMetallicWeapon && this.haveMetallicWeapon())
            {
                tClank = true;
            }
            if (tClank)
            {
                MusicBox.playSound("event:/SFX/HIT/HitSwordSword", this.current_tile, false, true);
            }
            else if (this.asset.has_sound_hit)
            {
                MusicBox.playSound(this.asset.sound_hit, this.current_tile, false, true);
            }
            if (tAttackerUnit != null && !base.hasStatus("shield"))
            {
                this.damageEquipmentOnGetHit(tAttackerUnit);
            }
        }
        if (pCheckDamageReduction)
        {
            if (pAttackType == AttackType.Other || pAttackType == AttackType.Weapon)
            {
                float tArmorPercent = 1f - this.stats["armor"] / 100f;
                pDamage *= tArmorPercent;
            }
            if (pDamage < 1f)
            {
                pDamage = 1f;
            }
            if (tAttackerUnit != null)
            {
                float tFinalDamage;
                this.checkSpecialAttackLogic(tAttackerUnit, pAttackType, pDamage, out tFinalDamage);
                pDamage = tFinalDamage;
                SignalManager.add(SignalLibrary.check_achievement_clone_wars, new ValueTuple<Actor, Actor>(this, tAttackerUnit));
            }
        }
        base.changeHealth((int)(-(int)pDamage));
        this.timer_action = 0.002f;
        GetHitAction getHitAction = this.s_get_hit_action;
        if (getHitAction != null)
        {
            getHitAction(this, pAttacker, this.current_tile);
        }
        if (pFlash)
        {
            this.startColorEffect(ActorColorEffect.Red);
        }
        if (!base.hasHealth())
        {
            this.batch.c_check_deaths.Add(this);
        }
        if (pAttackType == AttackType.Weapon && !this.asset.immune_to_injuries && !base.hasStatus("shield"))
        {
            if (Randy.randomChance(0.02f))
            {
                this.addInjuryTrait("crippled");
            }
            if (Randy.randomChance(0.02f))
            {
                this.addInjuryTrait("eyepatch");
            }
        }
        this.startShake(0.3f, 0.1f, true, true);
        if (!this.has_attack_target)
        {
            if (this.attackedBy != null && !base.shouldIgnoreTarget(this.attackedBy) && base.canAttackTarget(this.attackedBy, false))
            {
                this.setAttackTarget(this.attackedBy);
            }
        }
        else if (this.hasMeleeAttack() && this.attackedBy != null && base.canAttackTarget(this.attackedBy, false))
        {
            float tDistToCurrentTarget = Toolbox.SquaredDistVec2Float(this.current_position, this.attack_target.current_position);
            float tDistToAttacker = Toolbox.SquaredDistVec2Float(this.current_position, pAttacker.current_position);
            if (tDistToCurrentTarget > this.getAttackRangeSquared() && tDistToAttacker < tDistToCurrentTarget)
            {
                this.setAttackTarget(pAttacker);
            }
        }
        if (base.hasAnyStatusEffect())
        {
            foreach (Status status in base.getStatuses())
            {
                GetHitAction action_get_hit = status.asset.action_get_hit;
                if (action_get_hit != null)
                {
                    action_get_hit(this, pAttacker, this.current_tile);
                }
            }
        }
        GetHitAction action_get_hit2 = this.asset.action_get_hit;
        if (action_get_hit2 != null)
        {
            action_get_hit2(this, pAttacker, this.current_tile);
        }
        if (!base.hasHealth())
        {
            this.checkCallbacksOnDeath();
        }
    }

    // Token: 0x06001059 RID: 4185 RVA: 0x000C7130 File Offset: 0x000C5330
    private void pickupResourcesFromKill(Actor pAttacker)
    {
        if (!pAttacker.hasCity())
        {
            return;
        }
        foreach (ResourceContainer tResource in this.getResourcesFromActor())
        {
            if (!this.isSameSpecies(pAttacker) || pAttacker.hasTrait("savage"))
            {
                pAttacker.addToInventory(tResource);
            }
        }
    }

    // Token: 0x0600105A RID: 4186 RVA: 0x000C719C File Offset: 0x000C539C
    private void checkSpecialAttackLogic(Actor pAttacker, AttackType pAttackType, float pInitialDamage, out float pDamageFinal)
    {
        pDamageFinal = pInitialDamage;
        bool tIsSameKingdom = this.isSameKingdom(pAttacker);
        bool tLucky = false;
        bool tAttackerFriendHasTantrum = pAttacker.hasStatus("tantrum") && !tIsSameKingdom;
        bool tAttackHasPossessed = pAttacker.hasStatus("possessed");
        bool flag = this.kingdom.isEnemy(pAttacker.kingdom);
        float tStunChance = 0.1f;
        if (this._has_status_possessed || tAttackHasPossessed)
        {
            tStunChance = 0.7f;
        }
        else if (tIsSameKingdom)
        {
            tStunChance = 0.5f;
        }
        if (flag)
        {
            tStunChance = 0f;
        }
        bool tShouldStun = Randy.randomChance(tStunChance);
        if (tAttackerFriendHasTantrum)
        {
            tShouldStun = true;
        }
        if (this.getHealthRatio() < 0.5f && tShouldStun)
        {
            pDamageFinal = 1f;
            this.makeStunned(5f);
            this.changeHappiness("lost_fight", 0);
            this.finishAngryStatus();
            tLucky = true;
            if (tAttackerFriendHasTantrum)
            {
                pAttacker.finishStatusEffect("tantrum");
            }
            if (Randy.randomChance(0.4f))
            {
                pAttacker.finishAngryStatus();
            }
        }
        bool tIsAggroChecked = false;
        if (tIsSameKingdom && pAttackType != AttackType.Eaten)
        {
            if (Randy.randomChance(0.3f) || tAttackHasPossessed || pAttacker.hasStatus("angry"))
            {
                this.checkAggroAgainst(pAttacker, tAttackHasPossessed);
                tIsAggroChecked = true;
            }
            if (tLucky)
            {
                pDamageFinal = 0f;
                pAttacker.clearAttackTarget();
                pAttacker.makeWait(0.3f);
                if (pAttacker.hasStatus("angry"))
                {
                    pAttacker.finishAngryStatus();
                }
            }
        }
        if (!tIsAggroChecked && tAttackHasPossessed)
        {
            this.checkAggroAgainst(pAttacker, false);
        }
    }

    // Token: 0x0600105B RID: 4187 RVA: 0x000C72F4 File Offset: 0x000C54F4
    private void damageEquipmentOnGetHit(Actor pAttacker)
    {
        if (!pAttacker.hasWeapon())
        {
            return;
        }
        if (!this.hasEquipment())
        {
            return;
        }
        int tDamageMultiplier = 4;
        float tBowDamageChance = 0.35f;
        Item tAttackerWeapon = pAttacker.getWeapon();
        EquipmentAsset tAttackerWeaponAsset = tAttackerWeapon.getAsset();
        int tAttackerRigidityRating = tAttackerWeaponAsset.rigidity_rating;
        int tSumRigidityOfAttacked = 0;
        bool tSetStatsDirty = false;
        foreach (ActorEquipmentSlot tSlot in this.equipment)
        {
            if (!Randy.randomBool())
            {
                Item tItem = tSlot.getItem();
                if (tItem.getDurabilityCurrent() > 0)
                {
                    EquipmentAsset equipmentAsset = tItem.getAsset();
                    int tRigidityRating = equipmentAsset.rigidity_rating;
                    if (!equipmentAsset.is_pool_weapon)
                    {
                        tSumRigidityOfAttacked += tRigidityRating;
                    }
                    int tDamage = tAttackerRigidityRating / tRigidityRating * tDamageMultiplier;
                    tItem.getDamaged(tDamage);
                    if (tItem.getDurabilityCurrent() <= 0)
                    {
                        tSetStatsDirty = true;
                    }
                }
            }
        }
        if (tSetStatsDirty)
        {
            this.setStatsDirty();
        }
        if (tAttackerWeapon.getDurabilityCurrent() <= 0)
        {
            return;
        }
        if (Randy.randomBool())
        {
            return;
        }
        if (tAttackerWeaponAsset.attack_type == WeaponType.Melee)
        {
            int tDamageToAttackerWeapon = tSumRigidityOfAttacked / 5 / tAttackerRigidityRating * tDamageMultiplier;
            tAttackerWeapon.getDamaged(tDamageToAttackerWeapon);
        }
        else if (tAttackerWeaponAsset.attack_type == WeaponType.Range && Randy.randomChance(tBowDamageChance))
        {
            tAttackerWeapon.getDamaged(1);
        }
        if (tAttackerWeapon.data.durability <= 0)
        {
            pAttacker.setStatsDirty();
        }
    }

    // Token: 0x0600105C RID: 4188 RVA: 0x000C7434 File Offset: 0x000C5634
    public void addInjuryTrait(string pTraitID)
    {
        if (this.addTrait(pTraitID, false))
        {
            this.changeHappiness("just_injured", 0);
        }
    }

    // Token: 0x0600105D RID: 4189 RVA: 0x000C7450 File Offset: 0x000C5650
    private void checkAggroAgainst(Actor pAttackedBy, bool pCheckAllLists = false)
    {
        this.addAggro(pAttackedBy);
        if (pCheckAllLists)
        {
            if (this.hasFamily())
            {
                this.family.allAngryAt(pAttackedBy, 10f);
            }
            if (this.hasClan())
            {
                this.clan.allAngryAt(pAttackedBy, 10f);
            }
            if (base.hasCity() && this.isBaby())
            {
                this.city.allAngryAt(pAttackedBy, 10f);
            }
            if (this.hasLover())
            {
                this.lover.addAggro(pAttackedBy);
            }
            if (this.hasBestFriend())
            {
                this.getBestFriend().addAggro(pAttackedBy);
            }
            if ((this.isKing() || this.isWarrior() || this.isCityLeader() || this.isBaby()) && !pAttackedBy.isKing())
            {
                foreach (City tCity in this.kingdom.cities)
                {
                    if (tCity.hasArmy())
                    {
                        tCity.army.allAngryAt(pAttackedBy, 10f);
                    }
                }
            }
        }
    }

    // Token: 0x0600105E RID: 4190 RVA: 0x000C756C File Offset: 0x000C576C
    internal void newKillAction(Actor pDeadUnit, Kingdom pPrevKingdom, AttackType pAttackType)
    {
        this.increaseKills();
        if (this.hasWeapon())
        {
            this.getWeapon().countKill();
        }
        if (base.isKingdomCiv() && pPrevKingdom.isCiv())
        {
            War tWar = World.world.wars.getWar(this.kingdom, pPrevKingdom, false);
            if (tWar != null)
            {
                if (tWar.isAttacker(this.kingdom))
                {
                    tWar.increaseDeathsDefenders(pAttackType);
                }
                else
                {
                    tWar.increaseDeathsAttackers(pAttackType);
                }
            }
        }
        if (!base.isAlive())
        {
            return;
        }
        if (this.timer_action <= 0f)
        {
            this.makeWait(Randy.randomFloat(0.1f, 1f));
        }
        if (this.hasTrait("bloodlust"))
        {
            this.changeHappiness("just_killed", 0);
        }
        int tMoneys = pDeadUnit.giveAllLootAndMoney();
        this.addLoot(tMoneys);
        this.takeAllResources(pDeadUnit);
        if (this.data.kills > 10)
        {
            this.addTrait("veteran", false);
        }
        if (pDeadUnit.isKing())
        {
            this.addTrait("kingslayer", false);
        }
        this.addExperience(pDeadUnit.asset.experience_given);
        this.addRenown(pDeadUnit.asset.experience_given);
        if (this.hasTrait("madness"))
        {
            this.restoreHealth(base.getMaxHealthPercent(0.05f));
        }
        if (this.understandsHowToUseItems() && !pDeadUnit.hasTrait("infected") && this.canTakeItems())
        {
            this.takeItems(pDeadUnit, 1f, 0);
        }
        this.checkRageDemon();
    }

    // Token: 0x0600105F RID: 4191 RVA: 0x000C76D8 File Offset: 0x000C58D8
    internal void applyRandomForce(float pMinHeight = 1.5f, float pMaxHeight = 2f)
    {
        float tForceDirection = Randy.randomFloat(1.5f, 2f);
        float tForceHeight = Randy.randomFloat(pMinHeight, pMaxHeight);
        WorldTile tRandomTile = this.current_tile.neighboursAll.GetRandom<WorldTile>();
        this.calculateForce(this.current_tile.posV3.x, this.current_tile.posV3.y, tRandomTile.posV3.x, tRandomTile.posV3.y, tForceDirection, tForceHeight, true);
    }

    // Token: 0x06001060 RID: 4192 RVA: 0x000C7750 File Offset: 0x000C5950
    internal void calculateForce(float pStartX, float pStartY, float pTargetX, float pTargetY, float pForceAmountDirection, float pForceHeight = 0f, bool pCheckCancelJobOnLand = false)
    {
        if (pForceHeight == 0f)
        {
            pForceHeight = pForceAmountDirection;
        }
        pForceAmountDirection *= SimGlobals.m.unit_force_multiplier;
        pForceHeight *= SimGlobals.m.unit_force_multiplier;
        if (pForceAmountDirection <= 0f)
        {
            return;
        }
        float angle = Toolbox.getAngle(pStartX, pStartY, pTargetX, pTargetY);
        float tForceDirectionX = -Mathf.Cos(angle) * pForceAmountDirection;
        float tForceDirectionY = -Mathf.Sin(angle) * pForceAmountDirection;
        if (pStartX == pTargetX && pStartY == pTargetY)
        {
            tForceDirectionX = 0f;
            tForceDirectionY = 0f;
        }
        this.addForce(tForceDirectionX, tForceDirectionY, pForceHeight, pCheckCancelJobOnLand);
    }

    // Token: 0x06001061 RID: 4193 RVA: 0x000C77D4 File Offset: 0x000C59D4
    public bool tryToUseAdvancedCombatAction(List<CombatActionAsset> pCombatActionAssetsCategory, BaseSimObject pAttackTarget, out CombatActionAsset pResultCombatAsset)
    {
        pResultCombatAsset = null;
        if (pCombatActionAssetsCategory == null)
        {
            return false;
        }
        if (pCombatActionAssetsCategory.Count == 0)
        {
            return false;
        }
        if (this.hasTrait("slow"))
        {
            return false;
        }
        if (this.combatActionOnTimeout())
        {
            return false;
        }
        bool result;
        using (ListPool<CombatActionAsset> tPossibleList = new ListPool<CombatActionAsset>(pCombatActionAssetsCategory.Count))
        {
            foreach (CombatActionAsset tCombatActionAsset in pCombatActionAssetsCategory)
            {
                if (this.hasEnoughStamina(tCombatActionAsset.cost_stamina) && this.hasEnoughMana(tCombatActionAsset.cost_mana))
                {
                    if (pAttackTarget != null)
                    {
                        CombatActionCheckStart can_do_action = tCombatActionAsset.can_do_action;
                        if (can_do_action != null && !can_do_action(this, pAttackTarget))
                        {
                            continue;
                        }
                    }
                    tPossibleList.Add(tCombatActionAsset);
                }
            }
            if (tPossibleList.Count == 0)
            {
                result = false;
            }
            else
            {
                CombatActionAsset tAsset = tPossibleList.GetRandom<CombatActionAsset>();
                if (!Randy.randomChance(tAsset.chance + tAsset.chance * this.stats["skill_combat"]))
                {
                    result = false;
                }
                else
                {
                    this.spendStamina(tAsset.cost_stamina);
                    this.spendMana(tAsset.cost_mana);
                    pResultCombatAsset = tAsset;
                    base.addStatusEffect("recovery_combat_action", pResultCombatAsset.cooldown, false);
                    result = true;
                }
            }
        }
        return result;
    }

    // Token: 0x06001062 RID: 4194 RVA: 0x000C791C File Offset: 0x000C5B1C
    public void addAggro(long pActorID)
    {
        Actor tActor = World.world.units.get(pActorID);
        if (tActor.isRekt())
        {
            return;
        }
        this.addAggro(tActor);
    }

    // Token: 0x06001063 RID: 4195 RVA: 0x000C794A File Offset: 0x000C5B4A
    public void addAggro(Actor pActor)
    {
        if (pActor.isRekt())
        {
            return;
        }
        if (pActor == this)
        {
            return;
        }
        base.addStatusEffect("angry", 0f, false);
        this._aggression_targets.Add(pActor.getID());
    }

    // Token: 0x06001064 RID: 4196 RVA: 0x000C797E File Offset: 0x000C5B7E
    public void finishAngryStatus()
    {
        this._aggression_targets.Clear();
        base.finishStatusEffect("angry");
    }

    // Token: 0x06001065 RID: 4197 RVA: 0x000C7998 File Offset: 0x000C5B98
    public void spawnSlashPunch(Vector2 pTowardsPosition)
    {
        this.spawnSlash(pTowardsPosition, "effects/slashes/slash_punch", 2f, 0f, 0f, null);
    }

    // Token: 0x06001066 RID: 4198 RVA: 0x000C79CC File Offset: 0x000C5BCC
    public void spawnSlashSteal(Vector2 pTowardsPosition)
    {
        this.spawnSlash(pTowardsPosition, "effects/slashes/slash_steal", 2f, 0f, 0f, null);
    }

    // Token: 0x06001067 RID: 4199 RVA: 0x000C7A00 File Offset: 0x000C5C00
    public void spawnSlashSwear(Vector2 pTowardsPosition)
    {
        this.spawnSlash(pTowardsPosition, "effects/slashes/slash_swear", 2f, 0f, 0f, null);
    }

    // Token: 0x06001068 RID: 4200 RVA: 0x000C7A34 File Offset: 0x000C5C34
    public void spawnSlashTalk(Vector2 pTowardsPosition)
    {
        this.spawnSlash(pTowardsPosition, "effects/slashes/slash_talk", 2f, 0f, 0f, null);
    }

    // Token: 0x06001069 RID: 4201 RVA: 0x000C7A68 File Offset: 0x000C5C68
    public void spawnSlashKick(Vector2 pTowardsPosition)
    {
        this.spawnSlash(pTowardsPosition, "effects/slashes/slash_kick", 2f, 0f, -this.actor_scale * 8f, null);
    }

    // Token: 0x0600106A RID: 4202 RVA: 0x000C7AA4 File Offset: 0x000C5CA4
    public void spawnSlash(Vector2 pTowardsPosition, string pSlashType = null, float pDistMod = 2f, float pTargetZ = 0f, float pStartZ = 0f, float? pAngle = null)
    {
        if (!this.is_visible)
        {
            return;
        }
        if (!EffectsLibrary.canShowSlashEffect())
        {
            return;
        }
        if (string.IsNullOrEmpty(pSlashType))
        {
            pSlashType = this.s_type_slash;
        }
        Vector2 tSlashPosition = this.getSlashPosition(this, pTowardsPosition, pDistMod, pTargetZ, pStartZ);
        float tAngle = ((pAngle != null) ? pAngle.Value : this.getSlashAngle(tSlashPosition, pTowardsPosition));
        EffectsLibrary.spawnSlash(tSlashPosition, pSlashType, tAngle, this.actor_scale);
    }

    // Token: 0x0600106B RID: 4203 RVA: 0x000C7B09 File Offset: 0x000C5D09
    public float getSlashAngle(Vector2 pSlashVector, Vector2 pAttackPosition)
    {
        return Toolbox.getAngleDegrees(pSlashVector.x, pSlashVector.y, pAttackPosition.x, pAttackPosition.y);
    }

    // Token: 0x0600106C RID: 4204 RVA: 0x000C7B28 File Offset: 0x000C5D28
    public Vector2 getSlashPosition(Actor pActor, Vector2 pAttackPosition, float pDistMod, float pTargetZ = 0f, float pStartZ = 0f)
    {
        float tScaleMod = pActor.getScaleMod();
        float num = pActor.stats["size"];
        Vector2 tSlashStartPosition = new Vector2(pActor.current_position.x, pActor.current_position.y);
        tSlashStartPosition.y += pActor.getHeight();
        tSlashStartPosition.y += 0.5f * tScaleMod;
        tSlashStartPosition.y += pStartZ;
        float tDist = num * tScaleMod * pDistMod;
        return Toolbox.getNewPointVec2(tSlashStartPosition.x, tSlashStartPosition.y, pAttackPosition.x, pAttackPosition.y + pTargetZ, tDist, true);
    }

    // Token: 0x0600106D RID: 4205 RVA: 0x000C7BC0 File Offset: 0x000C5DC0
    public void doCastAnimation()
    {
        if (!this.is_visible)
        {
            return;
        }
        Vector2 tHeadPos = this.getRenderedItemPosition();
        Vector3 tPos = this.cur_transform_position;
        EffectsLibrary.spawnAt(this.asset.effect_cast_ground, tPos, this.stats["scale"]);
        tPos.y += tHeadPos.y * 6f * this.current_scale.y;
        EffectsLibrary.spawnAt(this.asset.effect_cast_top, tPos, this.stats["scale"]);
    }

    // Token: 0x0600106E RID: 4206 RVA: 0x000C7C4C File Offset: 0x000C5E4C
    internal void punchTargetAnimation(Vector3 pDirection, bool pFlip = true, bool pReverse = false, float pAngle = 40f)
    {
        if (this.asset.can_flip)
        {
            if (pFlip && this.checkFlip())
            {
                if (this.current_position.x < pDirection.x)
                {
                    this.setFlip(true);
                }
                else
                {
                    this.setFlip(false);
                }
            }
            if (pReverse)
            {
                this.target_angle.z = -pAngle;
                return;
            }
            this.target_angle.z = pAngle;
        }
    }

    // Token: 0x0600106F RID: 4207 RVA: 0x000C7CB4 File Offset: 0x000C5EB4
    private void addToAttackPool(CombatActionAsset pAsset, ListPool<CombatActionAsset> pPool)
    {
        for (int i = 0; i < pAsset.rate; i++)
        {
            pPool.Add(pAsset);
        }
    }

    // Token: 0x06001070 RID: 4208 RVA: 0x000C7CDC File Offset: 0x000C5EDC
    private void checkHappinessChangeFromDeathEvent()
    {
        foreach (Actor actor in this.getParents())
        {
            actor.changeHappiness("death_child", 0);
        }
        Actor tBestFriend = this.getBestFriend();
        if (tBestFriend != null)
        {
            tBestFriend.changeHappiness("death_best_friend", 0);
        }
        if (this.hasLover())
        {
            this.lover.changeHappiness("death_lover", 0);
            this.lover.finishStatusEffect("fell_in_love");
        }
        if (this.hasFamily())
        {
            foreach (Actor tFamilyMember in this.family.units)
            {
                if (tFamilyMember != this && !tFamilyMember.isParentOf(this))
                {
                    tFamilyMember.changeHappiness("death_family_member", 0);
                }
            }
        }
    }

    // Token: 0x06001071 RID: 4209 RVA: 0x000C7DD0 File Offset: 0x000C5FD0
    private void checkCallbacksOnDeath()
    {
        WorldAction unit_death_action = this.current_tile.Type.unit_death_action;
        if (unit_death_action != null)
        {
            unit_death_action(this, this.current_tile);
        }
        WorldAction action_death = this.asset.action_death;
        if (action_death != null)
        {
            action_death(this, this.current_tile);
        }
        using (ListPool<ActorTrait> tListCurrentTraits = new ListPool<ActorTrait>(this.getTraits()))
        {
            for (int i = 0; i < tListCurrentTraits.Count; i++)
            {
                WorldAction action_death2 = tListCurrentTraits[i].action_death;
                if (action_death2 != null)
                {
                    action_death2(this, this.current_tile);
                }
            }
            if (base.hasAnyStatusEffect())
            {
                foreach (Status tStatusEffectData in base.getStatuses())
                {
                    if (tStatusEffectData.asset.action_death != null)
                    {
                        tStatusEffectData.asset.action_death(this, this.current_tile);
                    }
                }
            }
            if (this.hasClan())
            {
                WorldAction action_death3 = this.clan.action_death;
                if (action_death3 != null)
                {
                    action_death3(this, this.current_tile);
                }
            }
            if (this.hasSubspecies())
            {
                WorldAction action_death4 = this.subspecies.action_death;
                if (action_death4 != null)
                {
                    action_death4(this, this.current_tile);
                }
            }
            BaseActionActor baseActionActor = this.callbacks_on_death;
            if (baseActionActor != null)
            {
                baseActionActor(this);
            }
        }
    }

    // Token: 0x06001072 RID: 4210 RVA: 0x000C7F3C File Offset: 0x000C613C
    public void checkDeath()
    {
        if (base.hasHealth())
        {
            return;
        }
        if (!base.isAlive())
        {
            return;
        }
        Kingdom tPrevKingdom = this.kingdom;
        Actor tAttackerUnit = null;
        if (!this.attackedBy.isRekt() && this.attackedBy.isActor() && this.attackedBy != this)
        {
            tAttackerUnit = this.attackedBy.a;
        }
        if (this._last_attack_type == AttackType.Weapon && (base.isKingdomCiv() || (!tAttackerUnit.isRekt() && tAttackerUnit.isKingdomCiv())))
        {
            BattleKeeperManager.addUnitKilled(this);
        }
        if (tAttackerUnit != null)
        {
            tAttackerUnit.newKillAction(this, tPrevKingdom, this._last_attack_type);
            this.pickupResourcesFromKill(tAttackerUnit);
        }
        this.die(false, this._last_attack_type, true, true);
    }

    // Token: 0x06001073 RID: 4211 RVA: 0x000C7FE2 File Offset: 0x000C61E2
    public void dieSimpleNone()
    {
        this.die(false, AttackType.None, false, true);
    }

    // Token: 0x06001074 RID: 4212 RVA: 0x000C7FEF File Offset: 0x000C61EF
    public void dieAndDestroy(AttackType pType)
    {
        this.die(true, pType, false, true);
    }

    // Token: 0x06001075 RID: 4213 RVA: 0x000C7FFB File Offset: 0x000C61FB
    public void removeByMetamorphosis()
    {
        this.die(true, AttackType.Metamorphosis, false, false);
    }

    // Token: 0x06001076 RID: 4214 RVA: 0x000C8008 File Offset: 0x000C6208
    private void die(bool pDestroy = false, AttackType pType = AttackType.Other, bool pCountDeath = true, bool pLogFavorite = true)
    {
        if (!base.isAlive() && !pDestroy)
        {
            return;
        }
        switch (pType)
        {
            case AttackType.Plague:
            case AttackType.Infection:
            case AttackType.Tumor:
            case AttackType.Divine:
            case AttackType.AshFever:
            case AttackType.Metamorphosis:
            case AttackType.Starvation:
            case AttackType.Age:
            case AttackType.None:
            case AttackType.Poison:
            case AttackType.Gravity:
            case AttackType.Drowning:
                this.attackedBy = null;
                break;
        }
        SelectedUnit.removeSelected(this);
        if (ControllableUnit.isControllingUnit(this))
        {
            ControllableUnit.remove(this);
            if (this.asset.id == "crabzilla")
            {
                pDestroy = true;
            }
        }
        if (base.isAlive())
        {
            this.setAlive(false);
            this.skipUpdates();
            if (this.is_inside_boat)
            {
                this.inside_boat.removePassenger(this);
                this.exitBoat();
            }
            if (pCountDeath)
            {
                this.countDeath(pType);
                this.checkHappinessChangeFromDeathEvent();
            }
            if (this.isFavorite() && pLogFavorite)
            {
                if (!this.attackedBy.isRekt() && this.attackedBy.isActor())
                {
                    WorldLog.logFavMurder(this, this.attackedBy.a);
                }
                else
                {
                    WorldLog.logFavDead(this);
                }
            }
            this.clearTasks();
        }
        this.exitBuilding();
        this.clearHomeBuilding();
        using (ListPool<Item> tItems = new ListPool<Item>())
        {
            if (this.hasEquipment())
            {
                tItems.AddRange(this.equipment.getItems());
                this.takeAwayItems();
            }
            if (this.current_tile.zone.hasCity())
            {
                this.current_tile.zone.city.tryToPutItems(tItems);
                tItems.Clear();
            }
            if (pDestroy)
            {
                World.world.units.scheduleDestroy(this);
            }
            if (base.hasCity())
            {
                this.removeFromArmy();
                if (pType == AttackType.Age)
                {
                    this.city.tryToPutItems(tItems);
                    tItems.Clear();
                }
                if (this.isKing())
                {
                    this.kingdom.removeKing();
                    this.kingdom.logKingDead(this);
                }
                this.setCity(null);
            }
            if (this.isKing())
            {
                this.kingdom.removeKing();
            }
            this.clearManagers();
            if (this.hasEquipment())
            {
                this.equipment.destroyAllEquipment();
            }
            this.clearAttackTarget();
            this.clearTileTarget();
        }
    }

    // Token: 0x06001077 RID: 4215 RVA: 0x000C8230 File Offset: 0x000C6430
    public void checkDieOnGroundBoat()
    {
        if (!this.asset.is_boat)
        {
            return;
        }
        if (!this.current_tile.Type.liquid && base.isAlive() && !this.isInMagnet())
        {
            this.getHitFullHealth(AttackType.Gravity);
            this.skipBehaviour();
            if (base.hasStatus("magnetized"))
            {
                World.world.game_stats.data.boatsDestroyedByMagnet += 1L;
                SignalManager.add(SignalLibrary.check_achievement_boats_disposal, null);
            }
        }
    }

    // Token: 0x06001078 RID: 4216 RVA: 0x000C82B0 File Offset: 0x000C64B0
    public void copyAggroFrom(Actor pTarget)
    {
        if (pTarget.hasStatus("angry"))
        {
            foreach (long tAggroTarget in pTarget._aggression_targets)
            {
                this.addAggro(tAggroTarget);
            }
            if (!pTarget.attackedBy.isRekt() && pTarget.attackedBy.isActor())
            {
                this.addAggro(pTarget.attackedBy.a);
            }
            if (!pTarget.attack_target.isRekt() && pTarget.attack_target.isActor())
            {
                this.addAggro(pTarget.attack_target.a);
            }
        }
    }

    // Token: 0x06001079 RID: 4217 RVA: 0x000C836C File Offset: 0x000C656C
    public bool isInAggroList(Actor pActor)
    {
        return this._aggression_targets.Contains(pActor.getID());
    }

    // Token: 0x0600107A RID: 4218 RVA: 0x000C8380 File Offset: 0x000C6580
    public bool shouldContinueToAttackTarget()
    {
        BaseSimObject tAttackTarget = this.attack_target;
        return base.areFoes(tAttackTarget) || (tAttackTarget.isActor() && (tAttackTarget.a.hasStatusTantrum() || this.isInAggroList(tAttackTarget.a)));
    }

    // Token: 0x0600107B RID: 4219 RVA: 0x000C83C9 File Offset: 0x000C65C9
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public void clearAttackTarget()
    {
        if (!this.has_attack_target)
        {
            return;
        }
        this.attack_target = null;
        this.has_attack_target = false;
        this.batch.c_check_attack_target.Remove(this.a);
    }

    // Token: 0x0600107C RID: 4220 RVA: 0x000C83F8 File Offset: 0x000C65F8
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public bool isEnemyTargetAlive()
    {
        if (this.has_attack_target)
        {
            if (this.attack_target.isRekt())
            {
                this.clearAttackTarget();
                return false;
            }
            if (this.attack_target.isBuilding() && !this.attack_target.b.isUsable())
            {
                this.clearAttackTarget();
                return false;
            }
        }
        return true;
    }

    // Token: 0x0600107D RID: 4221 RVA: 0x000C844A File Offset: 0x000C664A
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public void setAttackTarget(BaseSimObject pAttackTarget)
    {
        this.attack_target = pAttackTarget;
        if (this.has_attack_target)
        {
            return;
        }
        this.has_attack_target = true;
        this.batch.c_check_attack_target.Add(this.a);
    }

    // Token: 0x0600107E RID: 4222 RVA: 0x000C847C File Offset: 0x000C667C
    public void checkAttackTypes()
    {
        EquipmentAsset tWeaponAsset = this.getWeaponAsset();
        if (this.asset.only_melee_attack)
        {
            this.s_type_attack = WeaponType.Melee;
        }
        else
        {
            this.s_type_attack = tWeaponAsset.attack_type;
        }
        this.s_type_slash = tWeaponAsset.path_slash_animation;
    }

    // Token: 0x0600107F RID: 4223 RVA: 0x000C84BE File Offset: 0x000C66BE
    public float getAttackCooldown()
    {
        return 1f / this.stats["attack_speed"];
    }

    // Token: 0x06001080 RID: 4224 RVA: 0x000C84D8 File Offset: 0x000C66D8
    private void takeAwayItems()
    {
        if (!this.hasEquipment())
        {
            return;
        }
        foreach (ActorEquipmentSlot tDeadActorSlot in this.equipment)
        {
            if (!tDeadActorSlot.isEmpty())
            {
                tDeadActorSlot.takeAwayItem();
            }
        }
    }

    // Token: 0x170000A6 RID: 166
    // (get) Token: 0x06001081 RID: 4225 RVA: 0x000C8538 File Offset: 0x000C6738
    // (set) Token: 0x06001082 RID: 4226 RVA: 0x000C8545 File Offset: 0x000C6745
    public ActorBag inventory
    {
        get
        {
            return this.data.inventory;
        }
        set
        {
            this.data.inventory = value;
        }
    }

    // Token: 0x06001083 RID: 4227 RVA: 0x000C8554 File Offset: 0x000C6754
    public void addLoot(int pLootValue)
    {
        if (pLootValue == 0)
        {
            return;
        }
        this.data.loot += pLootValue;
        this.data.loot = Mathf.Clamp(this.data.loot, 0, 99999);
        EffectsLibrary.showMoneyEffect("fx_money_got_loot", this.current_position, this.current_zone, this.actor_scale);
    }

    // Token: 0x06001084 RID: 4228 RVA: 0x000C85B8 File Offset: 0x000C67B8
    public void addMoney(int pValue)
    {
        if (pValue == 0)
        {
            return;
        }
        this.data.money += pValue;
        this.data.money = Mathf.Clamp(this.data.money, 0, 99999);
        EffectsLibrary.showMoneyEffect("fx_money_got_money", this.current_position, this.current_zone, this.actor_scale);
    }

    // Token: 0x06001085 RID: 4229 RVA: 0x000C8619 File Offset: 0x000C6819
    public int giveAllLoot()
    {
        int loot = this.data.loot;
        this.lootEmpty();
        return loot;
    }

    // Token: 0x06001086 RID: 4230 RVA: 0x000C862C File Offset: 0x000C682C
    public int giveAllMoney()
    {
        int money = this.data.money;
        this.data.money = 0;
        return money;
    }

    // Token: 0x06001087 RID: 4231 RVA: 0x000C8645 File Offset: 0x000C6845
    public void spendMoney(int pCost)
    {
        if (pCost == 0)
        {
            return;
        }
        this.data.money -= pCost;
        EffectsLibrary.showMoneyEffect("fx_money_spend_money", this.current_position, this.current_zone, this.actor_scale);
    }

    // Token: 0x06001088 RID: 4232 RVA: 0x000C867C File Offset: 0x000C687C
    public int getMoneyForGift()
    {
        if (this.money < 10)
        {
            return 0;
        }
        float tRandomMoneyMod = Randy.randomFloat(0.05f, 0.1f);
        int tRandomMoney = Mathf.RoundToInt((float)this.money * tRandomMoneyMod);
        if (tRandomMoney == 0)
        {
            return 0;
        }
        EffectsLibrary.showMoneyEffect("fx_money_spend_money", this.current_position, this.current_zone, this.actor_scale);
        return tRandomMoney;
    }

    // Token: 0x06001089 RID: 4233 RVA: 0x000C86D6 File Offset: 0x000C68D6
    public void takeAllOwnLoot()
    {
        this.addMoney(this.giveAllLoot());
    }

    // Token: 0x0600108A RID: 4234 RVA: 0x000C86E4 File Offset: 0x000C68E4
    public int giveAllLootAndMoney()
    {
        return this.giveAllLoot() + this.giveAllMoney();
    }

    // Token: 0x0600108B RID: 4235 RVA: 0x000C86F4 File Offset: 0x000C68F4
    public void paidTax(float pTaxRate, string pEffect)
    {
        this.lootEmpty();
        EffectsLibrary.showMoneyEffect(pEffect, this.current_position, this.current_zone, this.actor_scale);
        int tBonusHappinessChange = -5;
        if ((double)pTaxRate > 0.7)
        {
            tBonusHappinessChange = -10;
        }
        this.changeHappiness("paid_tax", tBonusHappinessChange);
    }

    // Token: 0x0600108C RID: 4236 RVA: 0x000C873F File Offset: 0x000C693F
    public void lootEmpty()
    {
        this.data.loot = 0;
    }

    // Token: 0x0600108D RID: 4237 RVA: 0x000C8750 File Offset: 0x000C6950
    public void giveInventoryResourcesToCity()
    {
        if (this.isCarryingResources() && base.hasCity() && this.city.isAlive())
        {
            foreach (ResourceContainer tContainer in this.inventory.getResources().Values)
            {
                this.city.addResourcesToRandomStockpile(tContainer.id, tContainer.amount);
            }
        }
        this.inventory.empty();
        this.setItemSpriteRenderDirty();
    }

    // Token: 0x0600108E RID: 4238 RVA: 0x000C87EC File Offset: 0x000C69EC
    public void generateDefaultSpawnWeapons(bool pUseOwnerless)
    {
        if (pUseOwnerless && this.canUseItems())
        {
            foreach (Item tItem in World.world.items)
            {
                if (!tItem.isDestroyable() && !tItem.hasCity() && !tItem.hasActor())
                {
                    this.equipment.setItem(tItem, this);
                    return;
                }
            }
        }
        string[] default_weapons = this.asset.default_weapons;
        if (default_weapons != null && default_weapons.Length != 0)
        {
            string tItemId = this.asset.default_weapons.GetRandom<string>();
            this.createNewWeapon(tItemId);
        }
    }

    // Token: 0x0600108F RID: 4239 RVA: 0x000C889C File Offset: 0x000C6A9C
    public bool createNewWeapon(string pItemId)
    {
        EquipmentAsset tItemAsset = AssetManager.items.get(pItemId);
        Item tNewItem = World.world.items.generateItem(tItemAsset, null, null, 1, this.a, 10, false);
        this.equipment.weapon.setItem(tNewItem, this.a);
        return true;
    }

    // Token: 0x06001090 RID: 4240 RVA: 0x000C88EA File Offset: 0x000C6AEA
    internal void reloadInventory()
    {
        this.setStatsDirty();
    }

    // Token: 0x06001091 RID: 4241 RVA: 0x000C88F4 File Offset: 0x000C6AF4
    public void stealActionFrom(Actor pTarget, float pTargetStunnedTimer = 5f, float pWaitTimerForThief = 1f, bool pAddAggro = true)
    {
        bool tAnythingStolen = false;
        int tEverything = pTarget.giveAllLootAndMoney();
        if (tEverything > 0)
        {
            tAnythingStolen = true;
        }
        this.addLoot(tEverything);
        pTarget.cancelAllBeh();
        pTarget.makeStunned(pTargetStunnedTimer);
        this.makeWait(pWaitTimerForThief);
        base.addStatusEffect("being_suspicious", 0f, true);
        if (pAddAggro)
        {
            pTarget.addAggro(this);
        }
        this.punchTargetAnimation(this.current_position, false, false, -40f);
        if ((this.hasSubspeciesMetaTag("steal_items") || this.hasTag("steal_items")) && this.tryToStealItems(pTarget))
        {
            tAnythingStolen = true;
        }
        if (tAnythingStolen)
        {
            pTarget.changeHappiness("got_robbed", 0);
        }
    }

    // Token: 0x06001092 RID: 4242 RVA: 0x000C8995 File Offset: 0x000C6B95
    public bool tryToStealItems(Actor pActorTarget)
    {
        if (!this.understandsHowToUseItems())
        {
            return false;
        }
        if (!this.hasMeleeAttack())
        {
            return false;
        }
        if (this.takeItems(pActorTarget, 0.5f, 1))
        {
            pActorTarget.makeStunned(1f);
            this.checkAttackTypes();
            pActorTarget.checkAttackTypes();
            return true;
        }
        return false;
    }

    // Token: 0x06001093 RID: 4243 RVA: 0x000C89D4 File Offset: 0x000C6BD4
    public bool tryToAcceptGift(Actor pActorTarget)
    {
        if (!this.understandsHowToUseItems())
        {
            return false;
        }
        if (this.takeItems(pActorTarget, 0.5f, 1))
        {
            this.checkAttackTypes();
            pActorTarget.checkAttackTypes();
            return true;
        }
        return false;
    }

    // Token: 0x06001094 RID: 4244 RVA: 0x000C8A00 File Offset: 0x000C6C00
    public void takeAllResources(Actor pActorTarget)
    {
        if (pActorTarget.isCarryingResources())
        {
            foreach (KeyValuePair<string, ResourceContainer> tContainer in pActorTarget.inventory.getResources())
            {
                this.inventory.add(tContainer.Value);
            }
            pActorTarget.inventory.empty();
        }
    }

    // Token: 0x06001095 RID: 4245 RVA: 0x000C8A78 File Offset: 0x000C6C78
    public bool takeItems(Actor pActorTarget, float pChance = 1f, int pMaxItems = 0)
    {
        if (!this.understandsHowToUseItems())
        {
            return false;
        }
        if (!pActorTarget.hasEquipment())
        {
            return false;
        }
        bool result;
        using (ListPool<ActorEquipmentSlot> tList = new ListPool<ActorEquipmentSlot>(pActorTarget.equipment))
        {
            bool tAnyItemTaken = false;
            if (pMaxItems == 0)
            {
                pMaxItems = tList.Count;
            }
            foreach (ActorEquipmentSlot tTargetSlot in tList.LoopRandom(pMaxItems))
            {
                if (!tTargetSlot.isEmpty())
                {
                    ActorEquipmentSlot tOurSlot = this.equipment.getSlot(tTargetSlot.type);
                    Item tOurItem = tOurSlot.getItem();
                    Item tTargetItem = tTargetSlot.getItem();
                    if (!tTargetItem.isCursed() && (tOurSlot.isEmpty() || (!tOurItem.isCursed() && tTargetItem.getValue() > tOurItem.getValue())))
                    {
                        tAnyItemTaken = true;
                        tTargetSlot.takeAwayItem();
                        tOurSlot.setItem(tTargetItem, this);
                        this.setStatsDirty();
                        pActorTarget.setStatsDirty();
                    }
                }
            }
            result = tAnyItemTaken;
        }
        return result;
    }

    // Token: 0x06001096 RID: 4246 RVA: 0x000C8B84 File Offset: 0x000C6D84
    public void addToInventory(string pResourceID, int pAmount)
    {
        this.inventory = this.inventory.add(pResourceID, pAmount);
        this.setItemSpriteRenderDirty();
    }

    // Token: 0x06001097 RID: 4247 RVA: 0x000C8B9F File Offset: 0x000C6D9F
    public void addToInventory(ResourceContainer pResourceContainer)
    {
        this.inventory = this.inventory.add(pResourceContainer);
        this.setItemSpriteRenderDirty();
    }

    // Token: 0x06001098 RID: 4248 RVA: 0x000C8BB9 File Offset: 0x000C6DB9
    public void takeFromInventory(string pID, int pAmount)
    {
        this.inventory = this.inventory.remove(pID, pAmount);
        this.setItemSpriteRenderDirty();
    }

    // Token: 0x06001099 RID: 4249 RVA: 0x000C8BD4 File Offset: 0x000C6DD4
    public void setSubspecies(Subspecies pObject)
    {
        World.world.subspecies.setDirtyUnits(this.subspecies);
        this.subspecies = pObject;
        World.world.subspecies.unitAdded(pObject);
        this.setStatsDirty();
    }

    // Token: 0x0600109A RID: 4250 RVA: 0x000C8C08 File Offset: 0x000C6E08
    public void joinLanguage(Language pLanguage)
    {
        if (this.language != pLanguage)
        {
            bool tHadLanguage = false;
            if (this.hasLanguage())
            {
                this.language.increaseSpeakersLost();
                tHadLanguage = true;
            }
            if (pLanguage != null)
            {
                if (!tHadLanguage)
                {
                    pLanguage.countNewSpeaker();
                }
                else
                {
                    pLanguage.countConversion();
                }
            }
        }
        this.setLanguage(pLanguage);
    }

    // Token: 0x0600109B RID: 4251 RVA: 0x000C8C50 File Offset: 0x000C6E50
    public void setLanguage(Language pObject)
    {
        World.world.languages.setDirtyUnits(this.language);
        this.language = pObject;
        World.world.languages.unitAdded(pObject);
        this.setStatsDirty();
    }

    // Token: 0x0600109C RID: 4252 RVA: 0x000C8C84 File Offset: 0x000C6E84
    public void setPlot(Plot pObject)
    {
        World.world.plots.setDirtyUnits(this.plot);
        this.plot = pObject;
        World.world.plots.unitAdded(pObject);
        this.setStatsDirty();
    }

    // Token: 0x0600109D RID: 4253 RVA: 0x000C8CB8 File Offset: 0x000C6EB8
    public void setReligion(Religion pObject)
    {
        World.world.religions.setDirtyUnits(this.religion);
        this.religion = pObject;
        World.world.religions.unitAdded(pObject);
        this.setStatsDirty();
    }

    // Token: 0x0600109E RID: 4254 RVA: 0x000C8CEC File Offset: 0x000C6EEC
    public void setFamily(Family pObject)
    {
        World.world.families.setDirtyUnits(this.family);
        this.family = pObject;
        World.world.families.unitAdded(pObject);
        this.setStatsDirty();
    }

    // Token: 0x0600109F RID: 4255 RVA: 0x000C8D20 File Offset: 0x000C6F20
    public void setClan(Clan pObject)
    {
        World.world.clans.setDirtyUnits(this.clan);
        this.clan = pObject;
        World.world.clans.unitAdded(pObject);
        this.setStatsDirty();
    }

    // Token: 0x060010A0 RID: 4256 RVA: 0x000C8D54 File Offset: 0x000C6F54
    public void setCulture(Culture pCulture)
    {
        World.world.cultures.setDirtyUnits(this.culture);
        this.culture = pCulture;
        World.world.cultures.unitAdded(pCulture);
        this.setStatsDirty();
    }

    // Token: 0x060010A1 RID: 4257 RVA: 0x000C8D88 File Offset: 0x000C6F88
    public void setArmy(Army pObject)
    {
        World.world.armies.setDirtyUnits(this.army);
        this.army = pObject;
        World.world.armies.unitAdded(pObject);
        this.setStatsDirty();
    }

    // Token: 0x060010A2 RID: 4258 RVA: 0x000C8DBC File Offset: 0x000C6FBC
    internal void setCity(City pCity)
    {
        if (this.city == pCity)
        {
            return;
        }
        if (this.city != null)
        {
            this.city.eventUnitRemoved(this.a);
        }
        World.world.cities.setDirtyUnits(this.city);
        this.city = pCity;
        if (this.city != null)
        {
            this.city.eventUnitAdded(this.a);
            this.setKingdom(this.city.kingdom);
        }
        World.world.cities.unitAdded(this.city);
        this.setStatsDirty();
    }

    // Token: 0x060010A3 RID: 4259 RVA: 0x000C8E50 File Offset: 0x000C7050
    public void setMetasFromCity(City pCity)
    {
        if (pCity.hasCulture() && !this.hasCulture())
        {
            this.setCulture(pCity.culture);
        }
        if (pCity.hasLanguage() && !this.hasLanguage())
        {
            this.joinLanguage(pCity.language);
        }
        if (pCity.hasReligion() && !this.hasReligion())
        {
            this.setReligion(pCity.religion);
        }
    }

    // Token: 0x060010A4 RID: 4260 RVA: 0x000C8EB1 File Offset: 0x000C70B1
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public bool hasClan()
    {
        return this.clan != null;
    }

    // Token: 0x060010A5 RID: 4261 RVA: 0x000C8EBC File Offset: 0x000C70BC
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public bool hasSubspecies()
    {
        return this.subspecies != null;
    }

    // Token: 0x060010A6 RID: 4262 RVA: 0x000C8EC7 File Offset: 0x000C70C7
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public bool hasFamily()
    {
        return this.family != null;
    }

    // Token: 0x060010A7 RID: 4263 RVA: 0x000C8ED2 File Offset: 0x000C70D2
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public bool hasLanguage()
    {
        return this.language != null;
    }

    // Token: 0x060010A8 RID: 4264 RVA: 0x000C8EDD File Offset: 0x000C70DD
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public bool hasPlot()
    {
        return this.plot != null;
    }

    // Token: 0x060010A9 RID: 4265 RVA: 0x000C8EE8 File Offset: 0x000C70E8
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public bool hasReligion()
    {
        return this.religion != null;
    }

    // Token: 0x060010AA RID: 4266 RVA: 0x000C8EF4 File Offset: 0x000C70F4
    public bool tryToConvertToReligion(Religion pReligion)
    {
        if (!this.hasSubspecies() || !this.subspecies.has_advanced_memory)
        {
            return false;
        }
        if (this.hasReligion() && this.religion == pReligion)
        {
            return false;
        }
        if (this.hasCulture() && !this.culture.isPossibleToConvertToOtherMeta())
        {
            return false;
        }
        this.setReligion(pReligion);
        pReligion.countConversion();
        EffectsLibrary.showMetaEventEffectConversion("fx_conversion_religion", this);
        return true;
    }

    // Token: 0x060010AB RID: 4267 RVA: 0x000C8F5C File Offset: 0x000C715C
    public bool tryToConvertToCulture(Culture pCulture)
    {
        if (!this.hasSubspecies() || !this.subspecies.has_advanced_memory)
        {
            return false;
        }
        if (this.hasCulture() && this.culture == pCulture)
        {
            return false;
        }
        if (this.hasCulture() && !this.culture.isPossibleToConvertToOtherMeta())
        {
            return false;
        }
        bool flag = this.hasCulture();
        Culture culture = this.culture;
        this.setCulture(pCulture);
        if (flag)
        {
            pCulture.countConversion();
        }
        EffectsLibrary.showMetaEventEffectConversion("fx_conversion_culture", this);
        return true;
    }

    // Token: 0x060010AC RID: 4268 RVA: 0x000C8FD4 File Offset: 0x000C71D4
    public bool tryToConvertToLanguage(Language pLanguage)
    {
        if (!this.hasSubspecies() || !this.subspecies.has_advanced_communication)
        {
            return false;
        }
        if (this.hasLanguage() && this.language == pLanguage)
        {
            return false;
        }
        if (this.hasCulture() && !this.culture.isPossibleToConvertToOtherMeta())
        {
            return false;
        }
        this.joinLanguage(pLanguage);
        EffectsLibrary.showMetaEventEffectConversion("fx_conversion_language", this);
        return true;
    }

    // Token: 0x060010AD RID: 4269 RVA: 0x000C9035 File Offset: 0x000C7235
    public void saveOriginFamily(long pID)
    {
        this.data.ancestor_family = pID;
    }

    // Token: 0x060010AE RID: 4270 RVA: 0x000C9044 File Offset: 0x000C7244
    private void clearManagers()
    {
        if (this.hasClan())
        {
            World.world.clans.unitDied(this.clan);
            this.clan = null;
        }
        if (this.hasArmy())
        {
            World.world.armies.unitDied(this.army);
            this.army = null;
        }
        if (this.hasCulture())
        {
            World.world.cultures.unitDied(this.culture);
            this.culture = null;
        }
        if (this.hasFamily())
        {
            World.world.families.unitDied(this.family);
            this.family = null;
        }
        if (this.hasLanguage())
        {
            World.world.languages.unitDied(this.language);
            this.language = null;
        }
        if (this.hasPlot())
        {
            World.world.plots.unitDied(this.plot);
            this.plot = null;
        }
        if (this.hasReligion())
        {
            World.world.religions.unitDied(this.religion);
            this.religion = null;
        }
    }

    // Token: 0x060010AF RID: 4271 RVA: 0x000C914D File Offset: 0x000C734D
    internal bool isCitizenJob(string pJob)
    {
        return this.citizen_job != null && this.citizen_job.id == pJob;
    }

    // Token: 0x060010B0 RID: 4272 RVA: 0x000C916A File Offset: 0x000C736A
    public void forgetCulture()
    {
        this.makeConfused(-1f, false);
        if (this.hasCulture())
        {
            this.setCulture(null);
        }
    }

    // Token: 0x060010B1 RID: 4273 RVA: 0x000C9187 File Offset: 0x000C7387
    public void forgetReligion()
    {
        this.makeConfused(-1f, false);
        if (this.hasReligion())
        {
            this.setReligion(null);
        }
    }

    // Token: 0x060010B2 RID: 4274 RVA: 0x000C91A4 File Offset: 0x000C73A4
    public void forgetLanguage()
    {
        this.makeConfused(10f, false);
        if (this.hasLanguage())
        {
            this.joinLanguage(null);
        }
    }

    // Token: 0x060010B3 RID: 4275 RVA: 0x000C91C1 File Offset: 0x000C73C1
    public void forgetClan()
    {
        this.makeConfused(-1f, false);
        if (this.hasClan())
        {
            this.clan.tryForgetChief(this);
            this.setClan(null);
        }
    }

    // Token: 0x060010B4 RID: 4276 RVA: 0x000C91EA File Offset: 0x000C73EA
    public void forgetKingdomAndCity()
    {
        this.makeConfused(-1f, false);
        this.removeFromPreviousFaction();
        if (base.isKingdomCiv())
        {
            this.joinKingdom(World.world.kingdoms_wild.get(this.asset.kingdom_id_wild));
        }
    }

    // Token: 0x060010B5 RID: 4277 RVA: 0x000C9228 File Offset: 0x000C7428
    public void tryToConvertActorToMetaFromActor(Actor pActor, bool pStunOnSuccess = true)
    {
        int tCounterSuccess = 0;
        if (pActor.hasCulture() && Randy.randomBool() && this.tryToConvertToCulture(pActor.culture))
        {
            tCounterSuccess++;
        }
        if (pActor.hasLanguage() && Randy.randomBool() && this.tryToConvertToLanguage(pActor.language))
        {
            tCounterSuccess++;
        }
        if (pActor.hasReligion() && Randy.randomBool() && this.tryToConvertToReligion(pActor.religion))
        {
            tCounterSuccess++;
        }
        if (!pStunOnSuccess)
        {
            return;
        }
        if (tCounterSuccess > 0)
        {
            this.makeStunned(5f);
            this.applyRandomForce(1.5f, 2f);
            base.addStatusEffect("voices_in_my_head", 0f, true);
            return;
        }
        if (Randy.randomChance(0.1f))
        {
            this.makeConfused(Randy.randomFloat(0.8f, 5f), false);
        }
    }

    // Token: 0x060010B6 RID: 4278 RVA: 0x000C92F4 File Offset: 0x000C74F4
    public void joinCity(City pCity)
    {
        bool tCount = !this.asset.is_boat;
        if (this.city != pCity)
        {
            bool tHadCity = base.hasCity();
            if (tHadCity && tCount)
            {
                this.city.increaseLeft();
            }
            if (pCity != null)
            {
                if (pCity.kingdom != this.kingdom)
                {
                    this.joinKingdom(pCity.kingdom);
                }
                if (tCount)
                {
                    if (tHadCity)
                    {
                        pCity.increaseMoved();
                    }
                    else
                    {
                        pCity.increaseJoined();
                    }
                }
            }
        }
        this.setCity(pCity);
    }

    // Token: 0x060010B7 RID: 4279 RVA: 0x000C936C File Offset: 0x000C756C
    public void joinKingdom(Kingdom pKingdom)
    {
        if (!this.asset.is_boat && this.kingdom != pKingdom)
        {
            bool tHadKingdom = base.hasKingdom();
            if (tHadKingdom && this.kingdom.isCiv())
            {
                this.kingdom.increaseLeft();
            }
            if (pKingdom != null && pKingdom.isCiv())
            {
                if (tHadKingdom)
                {
                    pKingdom.increaseMoved();
                }
                else
                {
                    pKingdom.increaseJoined();
                }
            }
        }
        this.setKingdom(pKingdom);
    }

    // Token: 0x060010B8 RID: 4280 RVA: 0x000C93D7 File Offset: 0x000C75D7
    internal void setKingdom(Kingdom pKingdomToSet)
    {
        if (this.kingdom == pKingdomToSet)
        {
            return;
        }
        this.checkKingdom();
        this.kingdom = pKingdomToSet;
        this.checkKingdom();
        this.setStatsDirty();
    }

    // Token: 0x060010B9 RID: 4281 RVA: 0x000C93FC File Offset: 0x000C75FC
    private void checkKingdom()
    {
        if (base.hasKingdom())
        {
            if (this.kingdom.wild)
            {
                World.world.kingdoms_wild.setDirtyUnits(this.kingdom);
                return;
            }
            World.world.kingdoms.setDirtyUnits(this.kingdom);
        }
    }

    // Token: 0x060010BA RID: 4282 RVA: 0x000C9449 File Offset: 0x000C7649
    internal void removeFromArmy()
    {
        if (this.hasArmy())
        {
            this.setArmy(null);
        }
    }

    // Token: 0x060010BB RID: 4283 RVA: 0x000C945A File Offset: 0x000C765A
    public void setForcedKingdom(Kingdom pForcedKingdom)
    {
        if (this.kingdom.asset.id == pForcedKingdom.asset.id)
        {
            return;
        }
        this.joinKingdom(pForcedKingdom);
    }

    // Token: 0x060010BC RID: 4284 RVA: 0x000C9486 File Offset: 0x000C7686
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public bool hasCulture()
    {
        return this.culture != null;
    }

    // Token: 0x060010BD RID: 4285 RVA: 0x000C9494 File Offset: 0x000C7694
    public bool buildCityAndStartCivilization()
    {
        if (!World.world.cities.canStartNewCityCivilizationHere(this))
        {
            return false;
        }
        Kingdom kingdom = World.world.kingdoms.makeNewCivKingdom(this, null, true);
        City tNewCity = World.world.cities.buildFirstCivilizationCity(this);
        this.createDefaultCultureAndLanguageAndClan(tNewCity.name);
        kingdom.setUnitMetas(this);
        tNewCity.setUnitMetas(this);
        return true;
    }

    // Token: 0x060010BE RID: 4286 RVA: 0x000C94F4 File Offset: 0x000C76F4
    public void createDefaultCultureAndLanguageAndClan(string pCultureName = null)
    {
        if (!this.hasClan())
        {
            World.world.clans.newClan(this, true);
        }
        if (!this.hasLanguage() && this.subspecies.has_advanced_communication)
        {
            Language tLanguage = World.world.languages.newLanguage(this, true);
            this.joinLanguage(tLanguage);
            tLanguage.convertSameSpeciesAroundUnit(this, false);
        }
        if (!this.hasCulture() && this.subspecies.has_advanced_memory)
        {
            Culture tCulture = World.world.cultures.newCulture(this, true);
            if (pCultureName != null)
            {
                tCulture.data.name = pCultureName;
            }
            this.setCulture(tCulture);
            tCulture.convertSameSpeciesAroundUnit(this, false);
        }
    }

    // Token: 0x060010BF RID: 4287 RVA: 0x000C9596 File Offset: 0x000C7796
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public void checkDefaultKingdom()
    {
        if (base.hasKingdom())
        {
            return;
        }
        this.setDefaultKingdom();
    }

    // Token: 0x060010C0 RID: 4288 RVA: 0x000C95A7 File Offset: 0x000C77A7
    public void setDefaultKingdom()
    {
        this.setKingdom(World.world.kingdoms_wild.get(this.asset.kingdom_id_wild));
    }

    // Token: 0x060010C1 RID: 4289 RVA: 0x000C95C9 File Offset: 0x000C77C9
    public void removeFromPreviousFaction()
    {
        this.removeFromArmy();
        if (this.isKing())
        {
            this.kingdom.kingLeftEvent();
        }
        this.joinCity(null);
    }

    // Token: 0x060010C2 RID: 4290 RVA: 0x000C95EC File Offset: 0x000C77EC
    public bool wantsToSplitMeta()
    {
        return (!base.hasKingdom() || !base.isKingdomCiv() || !this.hasSubspecies() || this.kingdom.getMainSubspecies() != this.subspecies) && (this.hasTrait("ambitious") || base.hasStatus("inspired"));
    }

    // Token: 0x060010C3 RID: 4291 RVA: 0x000C9645 File Offset: 0x000C7845
    internal void setFlip(bool pFlip)
    {
        this.flip = pFlip;
    }

    // Token: 0x060010C4 RID: 4292 RVA: 0x000C9650 File Offset: 0x000C7850
    public void precalcMovementSpeed(bool pForce = false)
    {
        if (!pForce)
        {
            if (!this.is_moving)
            {
                return;
            }
            if (this._precalc_movement_speed_skips > 0)
            {
                this._precalc_movement_speed_skips--;
                return;
            }
            this._precalc_movement_speed_skips = 5;
        }
        bool tIsInAir = this.isInAir();
        bool tIsWaterCreature = this.isWaterCreature();
        float tWalkMultiplier = 1f;
        if (this.asset.ignore_tile_speed_multiplier || tIsInAir || tIsWaterCreature)
        {
            tWalkMultiplier = 1f;
        }
        else if (this.current_tile.is_liquid)
        {
            if (this.getStamina() <= 0 && !this.hasTag("fast_swimming"))
            {
                tWalkMultiplier *= 0.4f;
            }
        }
        else
        {
            tWalkMultiplier = this.current_tile.Type.walk_multiplier;
        }
        if (!this.asset.ignore_tile_speed_multiplier && this._is_in_liquid && this.hasTag("fast_swimming"))
        {
            tWalkMultiplier *= 5f;
        }
        if (this.hasTask() && this.ai.task.speed_multiplier != 1f)
        {
            tWalkMultiplier *= this.ai.task.speed_multiplier;
        }
        float tSpeed = this.stats["speed"] * tWalkMultiplier;
        if (!tIsInAir && WorldLawLibrary.world_law_entanglewood.isEnabled())
        {
            Building building = this.current_tile.building;
            if (building != null && building.asset.flora_type == FloraType.Tree)
            {
                tSpeed *= 0.5f;
            }
        }
        if (tSpeed < 1f)
        {
            tSpeed = 1f;
        }
        if (DebugConfig.isOn(DebugOption.UnitsAlwaysFast))
        {
            tSpeed *= 20f;
        }
        tSpeed *= 0.4f;
        this._current_combined_movement_speed = tSpeed * SimGlobals.m.unit_speed_multiplier;
        if (this.tile_target != null)
        {
            float tDistFinal = Toolbox.DistVec2Float(this.current_position, this.tile_target.posV3);
            if (tDistFinal < 1f && this._current_combined_movement_speed > 3f)
            {
                float tSlodownFactor = Mathf.Lerp(1f, 0.3f, 1f - tDistFinal);
                this._current_combined_movement_speed *= tSlodownFactor;
            }
        }
    }

    // Token: 0x060010C5 RID: 4293 RVA: 0x000C9839 File Offset: 0x000C7A39
    internal bool checkFlip()
    {
        return this.asset.check_flip(this, null);
    }

    // Token: 0x060010C6 RID: 4294 RVA: 0x000C9850 File Offset: 0x000C7A50
    protected void updateMovement(float pElapsed, float pWalkedDistance = 0f)
    {
        float tSqrRemainingDistance = Toolbox.DistVec2Float(this.current_position, this.next_step_position);
        if (this.asset.can_flip && this.checkFlip())
        {
            if (this.current_position.x < this.next_step_position.x)
            {
                this.setFlip(true);
            }
            else
            {
                this.setFlip(false);
            }
        }
        float tDelta = this.getMovementDelta(pElapsed, pWalkedDistance);
        if (tSqrRemainingDistance < tDelta)
        {
            tDelta = tSqrRemainingDistance;
            this.current_position = this.next_step_position;
            if (this.isUsingPath())
            {
                this.updatePathMovement();
            }
            else
            {
                this.stopMovement();
            }
            if (this.is_moving)
            {
                this.updateMovement(pElapsed, pWalkedDistance + tDelta);
                return;
            }
        }
        else
        {
            this.current_position = Vector2.MoveTowards(this.current_position, this.next_step_position, tDelta);
        }
    }

    // Token: 0x060010C7 RID: 4295 RVA: 0x000C9908 File Offset: 0x000C7B08
    private float getMovementDelta(float pElapsed, float pWalkedDistance = 0f)
    {
        float tDelta = this._current_combined_movement_speed;
        tDelta *= pElapsed;
        tDelta -= pWalkedDistance;
        if (tDelta < 0f)
        {
            tDelta = 0f;
        }
        return tDelta;
    }

    // Token: 0x060010C8 RID: 4296 RVA: 0x000C9934 File Offset: 0x000C7B34
    internal void updateMovementPossessedFlip()
    {
        if (InputHelpers.mouseSupported)
        {
            this.checkFlipAgainstTargetPosition(World.world.getMousePos());
            return;
        }
        if (ControllableUnit.isMovementActionActive())
        {
            Vector2 tPos = ControllableUnit.getMovementVector() + this.current_position;
            this.checkFlipAgainstTargetPosition(tPos);
        }
    }

    // Token: 0x060010C9 RID: 4297 RVA: 0x000C9978 File Offset: 0x000C7B78
    public void checkFlipAgainstTargetPosition(Vector2 pPosition)
    {
        if (!this.asset.can_flip)
        {
            return;
        }
        if (this.current_position.x < pPosition.x)
        {
            this.setFlip(true);
            return;
        }
        this.setFlip(false);
    }

    // Token: 0x060010CA RID: 4298 RVA: 0x000C99AC File Offset: 0x000C7BAC
    internal float updatePossessedMovementTowards(float pElapsed, Vector2 pMovementPoint)
    {
        this.precalcMovementSpeed(true);
        if (this.asset.can_flip && this.checkFlip())
        {
            float tMismatchFactor = this.getMismatchFactorForSideMovement(pMovementPoint);
            if (tMismatchFactor > 0.2f)
            {
                pElapsed *= Mathf.Lerp(1f, 0.8f, tMismatchFactor);
            }
        }
        float tDelta = this.getMovementDelta(pElapsed, 0f);
        Vector2 tNewPos = Vector2.MoveTowards(this.current_position, pMovementPoint, tDelta);
        tNewPos = this.checkVelocityAgainstBlock(tNewPos);
        if (!Toolbox.inMapBorder(ref tNewPos))
        {
            return 0f;
        }
        this.current_position = tNewPos;
        return tDelta;
    }

    // Token: 0x060010CB RID: 4299 RVA: 0x000C9A33 File Offset: 0x000C7C33
    public Vector2 getPossessionControlTargetPosition()
    {
        return ControllableUnit.getClickVector();
    }

    // Token: 0x060010CC RID: 4300 RVA: 0x000C9A3A File Offset: 0x000C7C3A
    public Vector2 getPossessionControlTargetPositionMovementVector()
    {
        if (InputHelpers.mouseSupported)
        {
            return ControllableUnit.getClickVector();
        }
        return ControllableUnit.getMovementVector() + this.current_position;
    }

    // Token: 0x060010CD RID: 4301 RVA: 0x000C9A5C File Offset: 0x000C7C5C
    private float getMismatchFactorForSideMovement(Vector2 pMovementPoint)
    {
        Vector2 tCursorPos = World.world.getMousePos();
        bool tSideLook = this.current_position.x < tCursorPos.x;
        bool tSideMove = this.current_position.x < pMovementPoint.x;
        bool flag = this.current_position.y < tCursorPos.y;
        bool tUpMove = this.current_position.y < pMovementPoint.y;
        float tDeltaX = Mathf.Abs(pMovementPoint.x - this.current_position.x);
        float tDeltaY = Mathf.Abs(pMovementPoint.y - this.current_position.y);
        float tMismatchFactor = 0f;
        if (tSideLook != tSideMove)
        {
            tMismatchFactor += tDeltaX;
        }
        if (flag != tUpMove)
        {
            tMismatchFactor += tDeltaY;
        }
        return Mathf.Clamp01(tMismatchFactor / (tDeltaX + tDeltaY + 0.001f));
    }

    // Token: 0x060010CE RID: 4302 RVA: 0x000C9B28 File Offset: 0x000C7D28
    internal void findCurrentTile(bool pCheckNeighbours = true)
    {
        Vector3 tCurrentPosition = this.current_position;
        if (!this.dirty_current_tile && tCurrentPosition.x == this.lastX && tCurrentPosition.y == this.lastY)
        {
            return;
        }
        this.dirty_current_tile = false;
        this.lastX = this.current_position.x;
        this.lastY = this.current_position.y;
        if (this.current_tile != null && Toolbox.SquaredDist(this.current_tile.posV3.x, this.current_tile.posV3.y, tCurrentPosition.x, tCurrentPosition.y) < 0.16000001f)
        {
            return;
        }
        WorldTile tNewTile = Toolbox.getTileAt(tCurrentPosition.x, tCurrentPosition.y);
        this.setCurrentTile(tNewTile);
        if (Toolbox.SquaredDist(tNewTile.posV3.x, tNewTile.posV3.y, tCurrentPosition.x, tCurrentPosition.y) < 0.09f)
        {
            return;
        }
        if (!pCheckNeighbours)
        {
            return;
        }
        if (this.isFlying())
        {
            return;
        }
        bool tMustAvoidGround = this.mustAvoidGround();
        if (tNewTile.Type.lava && this.asset.die_in_lava)
        {
            foreach (WorldTile tTile in tNewTile.neighboursAll)
            {
                if (tTile.Type.ground)
                {
                    this.setCurrentTile(tTile);
                    break;
                }
            }
        }
        if (tNewTile.Type.ocean && this.isDamagedByOcean())
        {
            foreach (WorldTile tTile2 in tNewTile.neighboursAll)
            {
                if (!tTile2.is_liquid)
                {
                    this.setCurrentTile(tTile2);
                    break;
                }
            }
        }
        if (tNewTile.Type.block && !this.isFlying() && !tMustAvoidGround)
        {
            foreach (WorldTile tTile3 in tNewTile.neighboursAll)
            {
                if (tTile3.Type.ground)
                {
                    this.setCurrentTile(tTile3);
                    break;
                }
            }
        }
        if (!tNewTile.is_liquid && tMustAvoidGround)
        {
            foreach (WorldTile tTile4 in tNewTile.neighboursAll)
            {
                if (tTile4.is_liquid)
                {
                    this.setCurrentTile(tTile4);
                    return;
                }
            }
        }
    }

    // Token: 0x060010CF RID: 4303 RVA: 0x000C9D5A File Offset: 0x000C7F5A
    internal void checkFindCurrentTile()
    {
        if (this.dirty_current_tile || (this._next_step_tile != null && (float)Toolbox.SquaredDistTile(this.current_tile, this._next_step_tile) > 4f))
        {
            this.findCurrentTile(true);
        }
    }

    // Token: 0x060010D0 RID: 4304 RVA: 0x000C9D8C File Offset: 0x000C7F8C
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    internal void setTileTarget(WorldTile pTile)
    {
        this.clearTileTarget();
        this.tile_target = pTile;
        this.tile_target.setTargetedBy(this.a);
    }

    // Token: 0x060010D1 RID: 4305 RVA: 0x000C9DAC File Offset: 0x000C7FAC
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    internal void clearTileTarget()
    {
        if (this.tile_target == null)
        {
            return;
        }
        if (this.tile_target.isTargetedBy(this))
        {
            this.tile_target.cleanTargetedBy();
        }
        this.tile_target = null;
        this.scheduled_tile_target = null;
    }

    // Token: 0x060010D2 RID: 4306 RVA: 0x000C9DDE File Offset: 0x000C7FDE
    internal void clearOldPath()
    {
        this.current_path.Clear();
        this.current_path_global = null;
        this.current_path_index = 0;
    }

    // Token: 0x060010D3 RID: 4307 RVA: 0x000C9DFC File Offset: 0x000C7FFC
    public virtual void updatePathMovement()
    {
        if (!this.isFollowingLocalPath())
        {
            this.setNotMoving();
            if (this.split_path != SplitPathStatus.Split)
            {
                this.split_path = SplitPathStatus.Split;
                this.timer_action = Randy.randomFloat(0f, this.asset.path_movement_timeout);
                return;
            }
            this.split_path = SplitPathStatus.Normal;
            if (this.tile_target != null)
            {
                this.goTo(this.tile_target, false, false, false);
            }
            return;
        }
        else
        {
            WorldTile tMoveTile = this.current_path[this.current_path_index];
            TileTypeBase tMoveTileType = tMoveTile.Type;
            this.current_path_index++;
            if (tMoveTileType.damaged_when_walked)
            {
                this.current_tile.tryToBreak();
            }
            bool tCheckFailure = true;
            if (this._has_status_strange_urge)
            {
                tCheckFailure = false;
            }
            if (tCheckFailure)
            {
                if (this.asset.is_boat && !tMoveTile.isGoodForBoat())
                {
                    BaseActionActor baseActionActor = this.callbacks_cancel_path_movement;
                    if (baseActionActor != null)
                    {
                        baseActionActor(this);
                    }
                    this.cancelAllBeh();
                    return;
                }
                if (tMoveTileType.block && !this.ignoresBlocks())
                {
                    if (!this.hasTask() || !this.ai.task.move_from_block)
                    {
                        this.cancelAllBeh();
                        return;
                    }
                }
                else
                {
                    if (this.asset.die_in_lava && tMoveTileType.lava)
                    {
                        this.cancelAllBeh();
                        return;
                    }
                    if (this.isDamagedByOcean() && tMoveTileType.ocean && !this._is_in_liquid)
                    {
                        this.cancelAllBeh();
                        return;
                    }
                }
            }
            if (tMoveTile.isOnFire() && !this.isImmuneToFire() && !base.hasStatus("burning") && !this.current_tile.isOnFire())
            {
                this.cancelAllBeh();
                return;
            }
            this.moveTo(tMoveTile);
            return;
        }
    }

    // Token: 0x060010D4 RID: 4308 RVA: 0x000C9F81 File Offset: 0x000C8181
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    internal bool isFollowingLocalPath()
    {
        return this.current_path.Count > 0 && this.current_path_index < this.current_path.Count;
    }

    // Token: 0x060010D5 RID: 4309 RVA: 0x000C9FA7 File Offset: 0x000C81A7
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    internal bool isUsingPath()
    {
        return this.isFollowingLocalPath() || this.current_path_global != null;
    }

    // Token: 0x060010D6 RID: 4310 RVA: 0x000C9FBC File Offset: 0x000C81BC
    public ExecuteEvent goTo(WorldTile pTile, bool pPathOnWater = false, bool pWalkOnBlocks = false, bool pWalkOnLava = false)
    {
        this.setTileTarget(pTile);
        return ActorMove.goTo(this, pTile, pPathOnWater, pWalkOnBlocks, pWalkOnLava);
    }

    // Token: 0x060010D7 RID: 4311 RVA: 0x000C9FD0 File Offset: 0x000C81D0
    public void clearPathForCalibration()
    {
        this.clearOldPath();
        this.next_step_position = this.current_position;
    }

    // Token: 0x060010D8 RID: 4312 RVA: 0x000C9FE4 File Offset: 0x000C81E4
    private void finishStrangeUrgeMovement()
    {
        this._has_status_strange_urge = false;
        base.finishStatusEffect("strange_urge");
        this.setTask("strange_urge_finish", true, false, false);
    }

    // Token: 0x060010D9 RID: 4313 RVA: 0x000CA008 File Offset: 0x000C8208
    public void stopMovement()
    {
        this.split_path = SplitPathStatus.Normal;
        this._next_step_tile = null;
        this.clearOldPath();
        this.clearTileTarget();
        this.setNotMoving();
        this.next_step_position = Globals.emptyVector;
        this.dirty_current_tile = true;
        if (this._has_status_strange_urge)
        {
            this.finishStrangeUrgeMovement();
        }
    }

    // Token: 0x060010DA RID: 4314 RVA: 0x000CA05A File Offset: 0x000C825A
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    private void setIsMoving()
    {
        if (this.is_moving)
        {
            return;
        }
        this._is_moving = true;
        this.batch.c_update_movement.Add(this.a);
    }

    // Token: 0x060010DB RID: 4315 RVA: 0x000CA082 File Offset: 0x000C8282
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    private void setNotMoving()
    {
        if (!this.is_moving)
        {
            return;
        }
        this._is_moving = false;
        this.batch.c_update_movement.Remove(this.a);
    }

    // Token: 0x060010DC RID: 4316 RVA: 0x000CA0AA File Offset: 0x000C82AA
    public void setPossessedMovement(bool pValue)
    {
        this._possessed_movement = pValue;
    }

    // Token: 0x060010DD RID: 4317 RVA: 0x000CA0B4 File Offset: 0x000C82B4
    public void moveTo(WorldTile pTileTarget)
    {
        this.setIsMoving();
        if (!this.has_attack_target && this.current_tile != null && pTileTarget.isOnFire() && !this.current_tile.isOnFire() && !this.isImmuneToFire())
        {
            this.cancelAllBeh();
            return;
        }
        this._next_step_tile = pTileTarget;
        if ((float)Toolbox.SquaredDistTile(this.current_tile, pTileTarget) > 4f)
        {
            this.dirty_current_tile = true;
        }
        else
        {
            this.setCurrentTile(this._next_step_tile);
        }
        this.checkStepActionForTile(this.current_tile);
        Vector3 tEnd = new Vector3(pTileTarget.posV3.x, pTileTarget.posV3.y);
        this.next_step_position = tEnd;
    }

    // Token: 0x060010DE RID: 4318 RVA: 0x000CA160 File Offset: 0x000C8360
    public Vector3 updatePos()
    {
        Vector3 tCurPosition = this.current_position;
        Vector2 tShakePos = this.shake_offset;
        Vector2 tMoveJumpOffset = this.move_jump_offset;
        float xx = tCurPosition.x + tMoveJumpOffset.x + tShakePos.x;
        float yy = tCurPosition.y + tMoveJumpOffset.y + tShakePos.y;
        yy += this.position_height;
        this.current_shadow_position.Set(tCurPosition.x + tShakePos.x, tCurPosition.y + tShakePos.y);
        float zz = this.position_height;
        this.cur_transform_position.Set(xx, yy, zz);
        return this.cur_transform_position;
    }

    // Token: 0x060010DF RID: 4319 RVA: 0x000CA200 File Offset: 0x000C8400
    public void stayInBuilding(Building pBuilding)
    {
        this.is_inside_building = true;
        this.inside_building = pBuilding;
    }

    // Token: 0x060010E0 RID: 4320 RVA: 0x000CA210 File Offset: 0x000C8410
    internal void exitBuilding()
    {
        if (!this.is_inside_building)
        {
            return;
        }
        this.timer_action = 0f;
        this.is_inside_building = false;
        this.inside_building = null;
    }

    // Token: 0x060010E1 RID: 4321 RVA: 0x000CA234 File Offset: 0x000C8434
    internal void embarkInto(Boat pBoat)
    {
        this.stopMovement();
        this.data.transportID = pBoat.actor.data.id;
        this.is_inside_boat = true;
        this.inside_boat = pBoat;
        this.inside_boat.addPassenger(this);
        this.setTask("sit_inside_boat", true, false, false);
        this.ai.update();
    }

    // Token: 0x060010E2 RID: 4322 RVA: 0x000CA295 File Offset: 0x000C8495
    internal void disembarkTo(Boat pBoat, WorldTile pTile)
    {
        this.spawnOn(pTile, 0f);
        this.data.transportID = -1L;
        this.exitBoat();
        this.setTask("short_move", true, false, false);
    }

    // Token: 0x060010E3 RID: 4323 RVA: 0x000CA2C4 File Offset: 0x000C84C4
    internal void exitBoat()
    {
        this.inside_boat = null;
        this.is_inside_boat = false;
        this.dirty_current_tile = true;
    }

    // Token: 0x060010E4 RID: 4324 RVA: 0x000CA2DB File Offset: 0x000C84DB
    internal void changeMoveJumpOffset(float pValue)
    {
        this.move_jump_offset.y = this.move_jump_offset.y + pValue;
        if (this.move_jump_offset.y < 0f)
        {
            this.move_jump_offset.y = 0f;
        }
    }

    // Token: 0x060010E5 RID: 4325 RVA: 0x000CA30F File Offset: 0x000C850F
    internal void setCurrentTile(WorldTile pTile)
    {
        this.current_tile = pTile;
    }

    // Token: 0x060010E6 RID: 4326 RVA: 0x000CA318 File Offset: 0x000C8518
    internal void setCurrentTilePosition(WorldTile pTile)
    {
        this.setCurrentTile(pTile);
        this.current_position.Set(pTile.posV3.x, pTile.posV3.y);
    }

    // Token: 0x060010E7 RID: 4327 RVA: 0x000CA344 File Offset: 0x000C8544
    protected void updateWalkJump(float pElapsed)
    {
        if (!this.is_visible && this.move_jump_offset.y == 0f)
        {
            return;
        }
        if (this.position_height > 0f)
        {
            return;
        }
        if (this.asset.disable_jump_animation)
        {
            return;
        }
        if (!this.is_moving)
        {
            if (this.move_jump_offset.y == 0f && (this._jump_time == 0f || this.isAffectedByLiquid()))
            {
                return;
            }
        }
        else if ((!this.is_moving && this._jump_time == 0f) || this.isAffectedByLiquid())
        {
            return;
        }
        this._jump_time += World.world.elapsed * 6f;
        if (this._jump_time >= 1f)
        {
            this.changeMoveJumpOffset(-3f * pElapsed);
        }
        else
        {
            this.changeMoveJumpOffset(3f * pElapsed);
        }
        if (this._jump_time >= 2f)
        {
            this._jump_time = 0f;
            this.changeMoveJumpOffset(0f);
        }
        if (this.asset.rotating_animation)
        {
            this.target_angle.z = this.target_angle.z + -this.move_jump_offset.y * 200f * World.world.elapsed;
        }
    }

    // Token: 0x060010E8 RID: 4328 RVA: 0x000CA478 File Offset: 0x000C8678
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public bool inMapBorder()
    {
        return Toolbox.inMapBorder(ref this.current_position);
    }

    // Token: 0x060010E9 RID: 4329 RVA: 0x000CA488 File Offset: 0x000C8688
    protected virtual void updateVelocity()
    {
        if (this.velocity.x == 0f && this.velocity.y == 0f && this.velocity.z == 0f)
        {
            return;
        }
        this.dirty_current_tile = true;
        float tElapsed = World.world.elapsed;
        float tDirectionSpeed = tElapsed * this.velocity_speed;
        float tDampMod = this.stats["mass"] * SimGlobals.m.gravity;
        tDampMod = Mathf.Min(tDampMod, 20f);
        float tVelocity = this.velocity.z * tElapsed * tDampMod;
        this.position_height += tVelocity;
        this.velocity.z = this.velocity.z - tElapsed * tDampMod * 0.3f;
        Vector3 tCurrentPosition = this.current_position;
        Vector2 tNewPos = new Vector2(tCurrentPosition.x + this.velocity.x * tDirectionSpeed, tCurrentPosition.y + this.velocity.y * tDirectionSpeed);
        tNewPos = this.checkVelocityAgainstBlock(tNewPos);
        this.current_position.Set(tNewPos.x, tNewPos.y);
        if (this.position_height < 0f)
        {
            this.position_height = 0f;
            this.velocity.z = 0f;
        }
        if (this.position_height <= 0f)
        {
            this.stopForce();
        }
    }

    // Token: 0x060010EA RID: 4330 RVA: 0x000CA5E4 File Offset: 0x000C87E4
    private Vector2 checkVelocityAgainstBlock(Vector2 pNewPos)
    {
        WorldTile tTileAtCoords = Toolbox.getTileAt(pNewPos.x, pNewPos.y);
        if (this.current_tile.Type.block && (!this.current_tile.Type.mountains || tTileAtCoords.Type.mountains))
        {
            return pNewPos;
        }
        if (tTileAtCoords == this.current_tile)
        {
            return pNewPos;
        }
        if (this.asset.is_boat)
        {
            if (tTileAtCoords.Type.liquid)
            {
                return pNewPos;
            }
        }
        else
        {
            if (!tTileAtCoords.Type.block)
            {
                return pNewPos;
            }
            if (this.getHeight() > tTileAtCoords.Type.block_height)
            {
                return pNewPos;
            }
        }
        Vector2 tWallNormal = this.getWallNormal(pNewPos, tTileAtCoords.posV3);
        float tElasticity = 0.8f;
        float tDotProduct = this.velocity.x * tWallNormal.x + this.velocity.y * tWallNormal.y;
        float tReflectionX = this.velocity.x - 2f * tDotProduct * tWallNormal.x;
        float tReflectionY = this.velocity.y - 2f * tDotProduct * tWallNormal.y;
        this.velocity.x = tReflectionX * tElasticity;
        this.velocity.y = tReflectionY * tElasticity;
        pNewPos.x = this.current_position.x;
        pNewPos.y = this.current_position.y;
        return pNewPos;
    }

    // Token: 0x060010EB RID: 4331 RVA: 0x000CA73C File Offset: 0x000C893C
    private Vector2 getWallNormal(Vector2 pPosition, Vector2 pBlockPosition)
    {
        Vector2 dirToObject = (pPosition - pBlockPosition).normalized;
        if (Mathf.Abs(dirToObject.x) > Mathf.Abs(dirToObject.y))
        {
            return new Vector2(Mathf.Sign(dirToObject.x), 0f);
        }
        return new Vector2(0f, Mathf.Sign(dirToObject.y));
    }

    // Token: 0x060010EC RID: 4332 RVA: 0x000CA79C File Offset: 0x000C899C
    public void prepareForSave()
    {
        this.data.x = this.current_tile.pos.x;
        this.data.y = this.current_tile.pos.y;
        this.data.asset_id = this.asset.id;
        this.data.profession = this._profession;
        if (this._home_building != null && this._home_building.isUsable() && !this._home_building.isAbandoned())
        {
            this.data.homeBuildingID = this._home_building.data.id;
        }
        else
        {
            this.data.homeBuildingID = -1L;
        }
        if (this.hasEquipment())
        {
            List<long> tItems = this.equipment.getDataForSave();
            this.data.saved_items = tItems;
        }
        if (this.hasLover())
        {
            this.data.lover = this.lover.data.id;
        }
        else
        {
            this.data.lover = -1L;
        }
        if (base.hasCity() && this.city.isAlive())
        {
            this.data.cityID = this.city.id;
        }
        else
        {
            this.data.cityID = -1L;
        }
        if (base.isKingdomCiv())
        {
            this.data.civ_kingdom_id = this.kingdom.id;
        }
        else
        {
            this.data.civ_kingdom_id = -1L;
        }
        if (this.hasCulture())
        {
            this.data.culture = this.culture.id;
        }
        else
        {
            this.data.culture = -1L;
        }
        if (this.hasClan())
        {
            this.data.clan = this.clan.id;
        }
        else
        {
            this.data.clan = -1L;
        }
        if (this.hasSubspecies())
        {
            this.data.subspecies = this.subspecies.id;
        }
        else
        {
            this.data.subspecies = -1L;
        }
        if (this.hasFamily())
        {
            this.data.family = this.family.id;
        }
        else
        {
            this.data.family = -1L;
        }
        if (this.hasArmy())
        {
            this.data.army = this.army.id;
        }
        else
        {
            this.data.army = -1L;
        }
        if (this.hasLanguage())
        {
            this.data.language = this.language.id;
        }
        else
        {
            this.data.language = -1L;
        }
        if (this.hasPlot())
        {
            this.data.plot = this.plot.id;
        }
        else
        {
            this.data.plot = -1L;
        }
        if (this.hasReligion())
        {
            this.data.religion = this.religion.id;
        }
        else
        {
            this.data.religion = -1L;
        }
        this.data.saved_traits = Toolbox.getListForSave<ActorTrait>(this.getTraits());
        this.data.save();
    }

    // Token: 0x060010ED RID: 4333 RVA: 0x000CAA9C File Offset: 0x000C8C9C
    public void loadFromSave()
    {
        this.setStatsDirty();
        TraitTools.loadTraits(this, this.data.saved_traits);
        foreach (ActorTrait tTrait in this.traits)
        {
            WorldActionTrait action_on_load = tTrait.action_on_load;
            if (action_on_load != null)
            {
                action_on_load(this, tTrait);
            }
        }
        if (this.isSapient() && this.is_profession_nothing)
        {
            this.data.profession = UnitProfession.Unit;
        }
        this.setProfession(this.data.profession, false);
        City tCity = World.world.cities.get(this.data.cityID);
        Kingdom tKingdom = World.world.kingdoms.get(this.data.civ_kingdom_id);
        if (tCity != null && !tCity.isNeutral())
        {
            this.setCity(tCity);
        }
        if (tKingdom != null)
        {
            this.setKingdom(tKingdom);
        }
        if (this.hasEquipment())
        {
            foreach (ActorEquipmentSlot tSlot in this.equipment)
            {
                if (!tSlot.isEmpty())
                {
                    Item tItem = tSlot.getItem();
                    int i = 0;
                    while (i < tItem.data.modifiers.Count)
                    {
                        if (AssetManager.items_modifiers.get(tItem.data.modifiers[i]) == null)
                        {
                            tItem.data.modifiers.RemoveAt(i);
                        }
                        else
                        {
                            i++;
                        }
                    }
                }
            }
        }
        if (this.data.inventory.isEmpty())
        {
            this.data.inventory.empty();
        }
        foreach (Actor actor in this.getParents())
        {
            actor.increaseChildren();
        }
    }

    // Token: 0x060010EE RID: 4334 RVA: 0x000CACA0 File Offset: 0x000C8EA0
    private void countDeath(AttackType pType)
    {
        World.world.game_stats.data.creaturesDied += 1L;
        MapStats map_stats = World.world.map_stats;
        long num = map_stats.deaths;
        map_stats.deaths = num + 1L;
        switch (pType)
        {
            case AttackType.Acid:
                {
                    MapStats map_stats2 = World.world.map_stats;
                    num = map_stats2.deaths_acid;
                    map_stats2.deaths_acid = num + 1L;
                    break;
                }
            case AttackType.Fire:
                {
                    MapStats map_stats3 = World.world.map_stats;
                    num = map_stats3.deaths_fire;
                    map_stats3.deaths_fire = num + 1L;
                    break;
                }
            case AttackType.Plague:
                {
                    MapStats map_stats4 = World.world.map_stats;
                    num = map_stats4.deaths_plague;
                    map_stats4.deaths_plague = num + 1L;
                    break;
                }
            case AttackType.Infection:
                {
                    MapStats map_stats5 = World.world.map_stats;
                    num = map_stats5.deaths_infection;
                    map_stats5.deaths_infection = num + 1L;
                    break;
                }
            case AttackType.Tumor:
                {
                    MapStats map_stats6 = World.world.map_stats;
                    num = map_stats6.deaths_tumor;
                    map_stats6.deaths_tumor = num + 1L;
                    break;
                }
            case AttackType.Other:
            case AttackType.AshFever:
            case AttackType.None:
                break;
            case AttackType.Divine:
                {
                    MapStats map_stats7 = World.world.map_stats;
                    num = map_stats7.deaths_divine;
                    map_stats7.deaths_divine = num + 1L;
                    break;
                }
            case AttackType.Metamorphosis:
                {
                    MapStats map_stats8 = World.world.map_stats;
                    num = map_stats8.metamorphosis;
                    map_stats8.metamorphosis = num + 1L;
                    break;
                }
            case AttackType.Starvation:
                {
                    MapStats map_stats9 = World.world.map_stats;
                    num = map_stats9.deaths_hunger;
                    map_stats9.deaths_hunger = num + 1L;
                    break;
                }
            case AttackType.Eaten:
                {
                    MapStats map_stats10 = World.world.map_stats;
                    num = map_stats10.deaths_eaten;
                    map_stats10.deaths_eaten = num + 1L;
                    break;
                }
            case AttackType.Age:
                {
                    MapStats map_stats11 = World.world.map_stats;
                    num = map_stats11.deaths_age;
                    map_stats11.deaths_age = num + 1L;
                    break;
                }
            case AttackType.Weapon:
                {
                    MapStats map_stats12 = World.world.map_stats;
                    num = map_stats12.deaths_weapon;
                    map_stats12.deaths_weapon = num + 1L;
                    break;
                }
            case AttackType.Poison:
                {
                    MapStats map_stats13 = World.world.map_stats;
                    num = map_stats13.deaths_poison;
                    map_stats13.deaths_poison = num + 1L;
                    break;
                }
            case AttackType.Gravity:
                {
                    MapStats map_stats14 = World.world.map_stats;
                    num = map_stats14.deaths_gravity;
                    map_stats14.deaths_gravity = num + 1L;
                    break;
                }
            case AttackType.Drowning:
                {
                    MapStats map_stats15 = World.world.map_stats;
                    num = map_stats15.deaths_drowning;
                    map_stats15.deaths_drowning = num + 1L;
                    break;
                }
            case AttackType.Water:
                {
                    MapStats map_stats16 = World.world.map_stats;
                    num = map_stats16.deaths_water;
                    map_stats16.deaths_water = num + 1L;
                    break;
                }
            case AttackType.Explosion:
                {
                    MapStats map_stats17 = World.world.map_stats;
                    num = map_stats17.deaths_explosion;
                    map_stats17.deaths_explosion = num + 1L;
                    break;
                }
            case AttackType.Smile:
                {
                    MapStats map_stats18 = World.world.map_stats;
                    num = map_stats18.deaths_smile;
                    map_stats18.deaths_smile = num + 1L;
                    break;
                }
            default:
                throw new ArgumentOutOfRangeException(string.Format("Unknown attack type: {0}", pType));
        }
        if (base.hasCity())
        {
            this.city.increaseDeaths(pType);
        }
        if (this.hasClan())
        {
            this.clan.increaseDeaths(pType);
        }
        if (this.hasCulture())
        {
            this.culture.increaseDeaths(pType);
        }
        if (this.hasFamily())
        {
            this.family.increaseDeaths(pType);
        }
        if (this.hasLanguage())
        {
            this.language.increaseDeaths(pType);
        }
        if (this.hasReligion())
        {
            this.religion.increaseDeaths(pType);
        }
        if (this.hasSubspecies())
        {
            this.subspecies.increaseDeaths(pType);
        }
        if (base.isKingdomCiv())
        {
            this.kingdom.increaseDeaths(pType);
        }
        foreach (Actor actor in this.getParents())
        {
            actor.decreaseChildren();
        }
    }

    // Token: 0x060010EF RID: 4335 RVA: 0x000CB038 File Offset: 0x000C9238
    public void increaseEvolutions()
    {
        MapStats map_stats = World.world.map_stats;
        long evolutions = map_stats.evolutions;
        map_stats.evolutions = evolutions + 1L;
        if (base.hasCity())
        {
            this.city.increaseEvolutions();
        }
        if (this.hasClan())
        {
            this.clan.increaseEvolutions();
        }
        if (this.hasReligion())
        {
            this.religion.increaseEvolutions();
        }
        if (this.hasSubspecies())
        {
            this.subspecies.increaseEvolutions();
        }
        if (base.isKingdomCiv())
        {
            this.kingdom.increaseEvolutions();
        }
    }

    // Token: 0x060010F0 RID: 4336 RVA: 0x000CB0C0 File Offset: 0x000C92C0
    private void increaseKills()
    {
        ActorData actorData = this.data;
        int kills = actorData.kills;
        actorData.kills = kills + 1;
        if (base.hasCity())
        {
            this.city.increaseKills();
        }
        if (this.hasClan())
        {
            this.clan.increaseKills();
        }
        if (this.hasCulture())
        {
            this.culture.increaseKills();
        }
        if (this.hasFamily())
        {
            this.family.increaseKills();
        }
        if (this.hasLanguage())
        {
            this.language.increaseKills();
        }
        if (this.hasReligion())
        {
            this.religion.increaseKills();
        }
        if (this.hasSubspecies())
        {
            this.subspecies.increaseKills();
        }
        if (base.isKingdomCiv())
        {
            this.kingdom.increaseKills();
        }
    }

    // Token: 0x060010F1 RID: 4337 RVA: 0x000CB17A File Offset: 0x000C937A
    public void increaseChildren()
    {
        this._current_children++;
    }

    // Token: 0x060010F2 RID: 4338 RVA: 0x000CB18A File Offset: 0x000C938A
    public void decreaseChildren()
    {
        this._current_children--;
    }

    // Token: 0x060010F3 RID: 4339 RVA: 0x000CB19A File Offset: 0x000C939A
    public void applyForcedKingdomTrait()
    {
        this.removeFromPreviousFaction();
        this.removeTrait("peaceful");
        this.startShake(0.3f, 0.2f, true, true);
        this.startColorEffect(ActorColorEffect.White);
        this.cancelAllBeh();
    }

    // Token: 0x060010F4 RID: 4340 RVA: 0x000CB1CC File Offset: 0x000C93CC
    public string getTraitsAsLocalizedString()
    {
        string tResult = "";
        foreach (ActorTrait tBaseTrait in this.traits)
        {
            tResult = tResult + tBaseTrait.getTranslatedName() + ", ";
        }
        return tResult;
    }

    // Token: 0x060010F5 RID: 4341 RVA: 0x000CB234 File Offset: 0x000C9434
    public void sortTraits(IReadOnlyCollection<ActorTrait> pTraits)
    {
        if (!this.traits.SetEquals(pTraits))
        {
            return;
        }
        this.traits.Clear();
        foreach (ActorTrait tTrait in pTraits)
        {
            this.traits.Add(tTrait);
        }
    }

    // Token: 0x060010F6 RID: 4342 RVA: 0x000CB29C File Offset: 0x000C949C
    public void traitModifiedEvenet()
    {
    }

    // Token: 0x060010F7 RID: 4343 RVA: 0x000CB2A0 File Offset: 0x000C94A0
    public void removeTrait(string pTraitID)
    {
        ActorTrait tTrait = AssetManager.traits.get(pTraitID);
        this.removeTrait(tTrait);
    }

    // Token: 0x060010F8 RID: 4344 RVA: 0x000CB2C1 File Offset: 0x000C94C1
    public bool removeTrait(ActorTrait pTrait)
    {
        bool flag = this.traits.Remove(pTrait);
        if (flag)
        {
            this.setStatsDirty();
            this.clearTraitCache();
            WorldActionTrait action_on_remove = pTrait.action_on_remove;
            if (action_on_remove == null)
            {
                return flag;
            }
            action_on_remove(this, pTrait);
        }
        return flag;
    }

    // Token: 0x060010F9 RID: 4345 RVA: 0x000CB2F4 File Offset: 0x000C94F4
    public void removeTraits(ICollection<ActorTrait> pTraits)
    {
        bool tAnyRemoved = false;
        foreach (ActorTrait tTrait in pTraits)
        {
            if (this.traits.Remove(tTrait))
            {
                WorldActionTrait action_on_remove = tTrait.action_on_remove;
                if (action_on_remove != null)
                {
                    action_on_remove(this, tTrait);
                }
                tAnyRemoved = true;
            }
        }
        if (tAnyRemoved)
        {
            this.setStatsDirty();
            this.clearTraitCache();
        }
    }

    // Token: 0x060010FA RID: 4346 RVA: 0x000CB36C File Offset: 0x000C956C
    public void clearTraitCache()
    {
        if (this._traits_cache.Count == 0)
        {
            return;
        }
        this._traits_cache.Clear();
    }

    // Token: 0x060010FB RID: 4347 RVA: 0x000CB387 File Offset: 0x000C9587
    private void removeOppositeTraits(ActorTrait pTrait)
    {
        if (!pTrait.hasOppositeTraits<ActorTrait>())
        {
            return;
        }
        this.removeTraits(pTrait.opposite_traits);
    }

    // Token: 0x060010FC RID: 4348 RVA: 0x000CB3A0 File Offset: 0x000C95A0
    public bool addTrait(string pTraitID, bool pRemoveOpposites = false)
    {
        ActorTrait tTrait = AssetManager.traits.get(pTraitID);
        return tTrait != null && this.addTrait(tTrait, pRemoveOpposites);
    }

    // Token: 0x060010FD RID: 4349 RVA: 0x000CB3C8 File Offset: 0x000C95C8
    public bool addTrait(ActorTrait pTrait, bool pRemoveOpposites = false)
    {
        if (this.hasTrait(pTrait))
        {
            return false;
        }
        if (pTrait.affects_mind && this.hasTag("strong_mind"))
        {
            return false;
        }
        if (pTrait.traits_to_remove != null)
        {
            this.removeTraits(pTrait.traits_to_remove);
        }
        if (pRemoveOpposites)
        {
            this.removeOppositeTraits(pTrait);
        }
        else if (this.hasOppositeTrait(pTrait))
        {
            return false;
        }
        this.traits.Add(pTrait);
        WorldActionTrait action_on_add = pTrait.action_on_add;
        if (action_on_add != null)
        {
            action_on_add(this, pTrait);
        }
        this.setStatsDirty();
        this.clearTraitCache();
        return true;
    }

    // Token: 0x060010FE RID: 4350 RVA: 0x000CB450 File Offset: 0x000C9650
    internal bool hasOppositeTrait(string pTraitID)
    {
        return TraitTools.hasOppositeTrait(pTraitID, this.traits);
    }

    // Token: 0x060010FF RID: 4351 RVA: 0x000CB45E File Offset: 0x000C965E
    internal bool hasOppositeTrait(ActorTrait pTrait)
    {
        return pTrait.hasOppositeTrait(this.traits);
    }

    // Token: 0x06001100 RID: 4352 RVA: 0x000CB46C File Offset: 0x000C966C
    public void generateRandomSpawnTraits(ActorAsset pAsset)
    {
        if (pAsset.traits == null)
        {
            return;
        }
        for (int i = 0; i < pAsset.traits.Count; i++)
        {
            string tTrait = pAsset.traits[i];
            this.addTrait(tTrait, false);
        }
    }

    // Token: 0x06001101 RID: 4353 RVA: 0x000CB4B0 File Offset: 0x000C96B0
    public void checkTraitMutationOnBirth()
    {
        if (!this.hasSubspecies())
        {
            return;
        }
        int tCurrentRandomMutationsMax = this.subspecies.getAmountOfRandomMutationsActorTraits();
        if (tCurrentRandomMutationsMax == 0)
        {
            return;
        }
        for (int i = 0; i < tCurrentRandomMutationsMax; i++)
        {
            ActorTrait tTrait = AssetManager.traits.pot_traits_birth.GetRandom<ActorTrait>();
            if (this.asset.traits_ignore == null || !this.asset.traits_ignore.Contains(tTrait.id))
            {
                this.addTrait(tTrait, false);
            }
        }
    }

    // Token: 0x06001102 RID: 4354 RVA: 0x000CB520 File Offset: 0x000C9720
    public void checkTraitMutationGrowUp()
    {
        if (!this.hasSubspecies())
        {
            return;
        }
        int tRandomTraits = Randy.randomInt(0, 3);
        for (int i = 0; i < tRandomTraits; i++)
        {
            ActorTrait tTrait = AssetManager.traits.pot_traits_growup.GetRandom<ActorTrait>();
            if ((this.asset.traits_ignore == null || !this.asset.traits_ignore.Contains(tTrait.id)) && (!tTrait.acquire_grow_up_sapient_only || this.isSapient()))
            {
                this.addTrait(tTrait, false);
            }
        }
    }

    // Token: 0x06001103 RID: 4355 RVA: 0x000CB598 File Offset: 0x000C9798
    public int countTraits()
    {
        return this.traits.Count;
    }

    // Token: 0x06001104 RID: 4356 RVA: 0x000CB5A8 File Offset: 0x000C97A8
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public bool hasTrait(string pTraitID)
    {
        bool tResult;
        if (!this._traits_cache.TryGetValue(pTraitID, out tResult))
        {
            ActorTrait tTrait = AssetManager.traits.get(pTraitID);
            tResult = this.hasTrait(tTrait);
            this._traits_cache[pTraitID] = tResult;
        }
        return tResult;
    }

    // Token: 0x06001105 RID: 4357 RVA: 0x000CB5E7 File Offset: 0x000C97E7
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public bool hasTrait(ActorTrait pTrait)
    {
        return this.traits.Contains(pTrait);
    }

    // Token: 0x06001106 RID: 4358 RVA: 0x000CB5F8 File Offset: 0x000C97F8
    public void updateParallelChecks(float pElapsed)
    {
        this._update_done = false;
        this._beh_skip = false;
        if (this.timer_jump_animation > 0f)
        {
            this.timer_jump_animation -= pElapsed;
        }
        this.checkFindCurrentTile();
        this.checkIsInLiquid();
        if (this.asset.update_z && this.position_height != 0f)
        {
            this.updateFall();
        }
        if (this.attackedBy != null && !this.attackedBy.isAlive())
        {
            this.attackedBy = null;
        }
        if (this.is_inside_boat)
        {
            return;
        }
        this.updateFlipRotation(pElapsed);
        this.updateVelocity();
        if (World.world.isPaused())
        {
            return;
        }
        if (!base.isAlive())
        {
            return;
        }
        this.updateRotations(pElapsed);
        if (this.attack_timer >= 0f)
        {
            this.attack_timer -= pElapsed;
        }
        this.updateWalkJump(World.world.delta_time);
        if (this._timeout_targets >= 0f)
        {
            this._timeout_targets -= World.world.delta_time;
        }
        if (this.timer_action >= 0f)
        {
            this.timer_action -= pElapsed;
        }
        if (this.canFight())
        {
            this.targets_to_ignore_timer.update(pElapsed);
        }
        this.updateChangeScale(pElapsed);
        if (this.is_immovable)
        {
            return;
        }
        this.precalcMovementSpeed(false);
    }

    // Token: 0x06001107 RID: 4359 RVA: 0x000CB73E File Offset: 0x000C993E
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public void skipUpdates()
    {
        this._update_done = true;
    }

    // Token: 0x06001108 RID: 4360 RVA: 0x000CB747 File Offset: 0x000C9947
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public void skipBehaviour()
    {
        this._beh_skip = true;
    }

    // Token: 0x06001109 RID: 4361 RVA: 0x000CB750 File Offset: 0x000C9950
    public void u1_checkInside(float pElapsed)
    {
        if (!this.isInsideSomething())
        {
            return;
        }
        if (this.is_inside_boat)
        {
            this.setCurrentTilePosition(this.inside_boat.actor.current_tile);
            this.skipUpdates();
        }
    }

    // Token: 0x0600110A RID: 4362 RVA: 0x000CB77F File Offset: 0x000C997F
    public void u2_updateChildren(float pElapsed)
    {
        if (this._update_done)
        {
            return;
        }
        this.updateChildrenList(this.children_special, pElapsed);
        this.updateChildrenListSimple(this.children_pre_behaviour, pElapsed);
    }

    // Token: 0x0600110B RID: 4363 RVA: 0x000CB7A4 File Offset: 0x000C99A4
    public void u3_spriteAnimation(float pElapsed)
    {
        if (this._update_done)
        {
            return;
        }
        if (!this.is_visible)
        {
            return;
        }
        this.sprite_animation.update(pElapsed);
    }

    // Token: 0x0600110C RID: 4364 RVA: 0x000CB7C4 File Offset: 0x000C99C4
    public void u4_deadCheck(float pElapsed)
    {
        if (this._update_done)
        {
            return;
        }
        if (!base.isAlive())
        {
            this.updateDeadAnimation(pElapsed);
            this.skipUpdates();
            return;
        }
        if (this.isInMagnet() || this.under_forces)
        {
            this.skipUpdates();
        }
    }

    // Token: 0x0600110D RID: 4365 RVA: 0x000CB7FC File Offset: 0x000C99FC
    public void u5_curTileAction()
    {
        if (this._update_done)
        {
            return;
        }
        if (this.position_height > 0f)
        {
            return;
        }
        WorldTile tTile = this.current_tile;
        TileTypeBase tType = tTile.Type;
        if (this.isFlying())
        {
            return;
        }
        if (tType.block && !this.ignoresBlocks())
        {
            if (this.asset.move_from_block && !this.is_moving && (!this.hasTask() || !this.ai.task.move_from_block))
            {
                this.setTask("move_from_block", true, true, false);
            }
            if (this.asset.die_on_blocks && !this.isUnderDamageCooldown() && !this.shake_active && base.getHealth() > 1)
            {
                this.getHit(1f, true, AttackType.Gravity, null, true, false, true);
            }
            if (!this.isInAir() || this.isHovering())
            {
                this.applyRandomForce(1.5f, 3f);
                if (Randy.randomChance(0.02f))
                {
                    this.makeStunned(5f);
                }
            }
            return;
        }
        if (tType.ground)
        {
            if (tTile.isOnFire() && !this.isImmuneToFire())
            {
                ActionLibrary.addBurningEffectOnTarget(null, this, null);
                if (!base.isAlive())
                {
                    if (!this._update_done)
                    {
                        Debug.LogError("If you ever see me, remove this line");
                    }
                    this.skipUpdates();
                    return;
                }
            }
            if (this.isWaterCreature() && !this.asset.force_land_creature)
            {
                this.spendStaminaWithCooldown(Randy.randomInt(1, 6));
                if (this.getStamina() <= 0 && !this.isUnderDamageCooldown())
                {
                    this.getHit(1f, true, AttackType.Drowning, null, true, false, true);
                }
            }
            this.checkDieOnGroundBoat();
        }
        else if (tType.liquid)
        {
            if (tType.damaged_when_walked)
            {
                tTile.tryToBreak();
            }
            if (!tType.lava)
            {
                base.finishStatusEffect("burning");
            }
            if (this.isDamagedByOcean() && tTile.Type.ocean && !this.isUnderDamageCooldown() && !this.shake_active)
            {
                this.getHit((float)this.getWaterDamage(), true, AttackType.Water, null, true, false, true);
            }
            if (!this.hasTag("fast_swimming") && !this.isWaterCreature() && !this.isInAir())
            {
                this.spendStaminaWithCooldown(Randy.randomInt(1, 6));
                if (this.getStamina() <= 0 && !this.isUnderDamageCooldown())
                {
                    this.getHit(1f, true, AttackType.Drowning, null, true, false, true);
                }
            }
        }
        if (tType.damage_units && !this.isUnderDamageCooldown() && (!tType.lava || this.asset.die_in_lava))
        {
            this.getHit((float)tType.damage, true, AttackType.Fire, null, true, false, true);
            if (!base.hasHealth())
            {
                if (tType.lava)
                {
                    CursedSacrifice.checkGoodForSacrifice(this);
                }
                this.skipUpdates();
            }
        }
        if (tTile.hasBuilding() && tTile.building.asset.has_step_action)
        {
            tTile.building.asset.step_action(this, tTile.building);
            if (!base.hasHealth())
            {
                this.skipUpdates();
            }
        }
    }

    // Token: 0x0600110E RID: 4366 RVA: 0x000CBAD9 File Offset: 0x000C9CD9
    public void u6_checkFrozen(float pElapsed)
    {
        if (this._update_done)
        {
            return;
        }
        if (this.is_ai_frozen || this.is_unconscious)
        {
            this.skipUpdates();
        }
    }

    // Token: 0x0600110F RID: 4367 RVA: 0x000CBAFA File Offset: 0x000C9CFA
    public void u8_checkUpdateTimers(float pElapsed)
    {
        if (this._update_done)
        {
            return;
        }
        if (this.timer_action >= 0f)
        {
            this.skipUpdates();
            return;
        }
        if (!base.isAlive())
        {
            if (!this._update_done)
            {
                Debug.LogError("If you ever see me, remove this line");
            }
            this.skipUpdates();
        }
    }

    // Token: 0x06001110 RID: 4368 RVA: 0x000CBB3C File Offset: 0x000C9D3C
    public void u7_checkAugmentationEffects()
    {
        if (this._update_done)
        {
            return;
        }
        if (World.world.getWorldTimeElapsedSince(this._timestamp_augmentation_effects) < 1f)
        {
            return;
        }
        this._timestamp_augmentation_effects = World.world.getCurWorldTime();
        int i = 0;
        while (i < this._s_special_effect_augmentations.Count)
        {
            BaseAugmentationAsset tAugmentation = this._s_special_effect_augmentations[i];
            double tLastUseTimestamp;
            if (!this._s_special_effect_augmentations_timers.TryGetValue(tAugmentation, out tLastUseTimestamp))
            {
                goto IL_70;
            }
            if (World.world.getWorldTimeElapsedSince(tLastUseTimestamp) >= tAugmentation.special_effect_interval)
            {
                Actor._tempAugmentationList.Add(tAugmentation);
                goto IL_70;
            }
        IL_86:
            i++;
            continue;
        IL_70:
            this._s_special_effect_augmentations_timers[tAugmentation] = World.world.getCurWorldTime();
            goto IL_86;
        }
        if (Actor._tempAugmentationList.Count == 0)
        {
            return;
        }
        for (int j = 0; j < Actor._tempAugmentationList.Count; j++)
        {
            BaseAugmentationAsset tAugmentation2 = Actor._tempAugmentationList[j];
            WorldAction tSpecialEffect = tAugmentation2.action_special_effect;
            if (Bench.bench_enabled)
            {
                double tTimeStart = Time.realtimeSinceStartupAsDouble;
                tSpecialEffect(this, this.current_tile);
                double tTimeEnd = Time.realtimeSinceStartupAsDouble - tTimeStart;
                Bench.benchSaveSplit(tAugmentation2.id, tTimeEnd, 1, "effects_traits");
            }
            else
            {
                tSpecialEffect(this, this.current_tile);
            }
        }
        Actor._tempAugmentationList.Clear();
    }

    // Token: 0x06001111 RID: 4369 RVA: 0x000CBC70 File Offset: 0x000C9E70
    public void b1_checkUnderForce(float pElapsed)
    {
        if (this._update_done)
        {
            return;
        }
        if (this.under_forces)
        {
            this.skipBehaviour();
            return;
        }
        if (this.asset.update_z && this.position_height != 0f)
        {
            this.skipBehaviour();
        }
    }

    // Token: 0x06001112 RID: 4370 RVA: 0x000CBCAA File Offset: 0x000C9EAA
    public void b2_checkCurrentEnemyTarget(float pElapsed)
    {
        if (this._update_done)
        {
            return;
        }
        if (this._beh_skip)
        {
            return;
        }
        if (this.checkCurrentEnemyTarget())
        {
            this.skipBehaviour();
        }
    }

    // Token: 0x06001113 RID: 4371 RVA: 0x000CBCCC File Offset: 0x000C9ECC
    public void b3_findEnemyTarget(float pElapsed)
    {
        if (this._update_done)
        {
            return;
        }
        if (this._beh_skip)
        {
            return;
        }
        if (this.checkEnemyTargets())
        {
            this.stopMovement();
            this.skipBehaviour();
        }
    }

    // Token: 0x06001114 RID: 4372 RVA: 0x000CBCF4 File Offset: 0x000C9EF4
    public void b4_checkTaskVerifier(float pElapsed)
    {
        if (this._update_done)
        {
            return;
        }
        if (this._beh_skip)
        {
            return;
        }
        if (this.hasTask() && this.ai.task.has_verifier && this.ai.task.task_verifier.execute(this) == BehResult.Stop)
        {
            this.cancelAllBeh();
            this.skipBehaviour();
            return;
        }
        if (this.is_moving)
        {
            this.skipBehaviour();
        }
    }

    // Token: 0x06001115 RID: 4373 RVA: 0x000CBD61 File Offset: 0x000C9F61
    public void b5_checkPathMovement(float pElapsed)
    {
        if (this._update_done)
        {
            return;
        }
        if (this._beh_skip)
        {
            return;
        }
        if (this.isUsingPath())
        {
            this.updatePathMovement();
            this.skipBehaviour();
        }
    }

    // Token: 0x06001116 RID: 4374 RVA: 0x000CBD89 File Offset: 0x000C9F89
    public void b6_0_updateDecision(float pElapsed)
    {
        if (this._update_done)
        {
            return;
        }
        if (this._beh_skip)
        {
            return;
        }
        if (this.is_unconscious)
        {
            return;
        }
        if (this._has_status_possessed)
        {
            return;
        }
        if (!this.asset.has_ai_system)
        {
            return;
        }
        DecisionHelper.makeDecisionFor(this);
    }

    // Token: 0x06001117 RID: 4375 RVA: 0x000CBDC4 File Offset: 0x000C9FC4
    public void b6_updateAI(float pElapsed)
    {
        if (this._update_done)
        {
            return;
        }
        if (this._beh_skip)
        {
            return;
        }
        if (this.is_unconscious)
        {
            return;
        }
        if (this._has_status_possessed)
        {
            return;
        }
        if (!this.asset.has_ai_system)
        {
            return;
        }
        this.ai.update();
    }

    // Token: 0x06001118 RID: 4376 RVA: 0x000CBE04 File Offset: 0x000CA004
    public void b55_updateNaturalDeaths(float pElapsed)
    {
        if (this._update_done)
        {
            return;
        }
        if (this._beh_skip)
        {
            return;
        }
        if (this.is_unconscious)
        {
            return;
        }
        if (this._has_status_possessed)
        {
            return;
        }
        if (!this.asset.has_ai_system)
        {
            return;
        }
        if (this.ai.action_index == 0 && this.checkNaturalDeath())
        {
            this.skipBehaviour();
            this.skipUpdates();
        }
    }

    // Token: 0x06001119 RID: 4377 RVA: 0x000CBE64 File Offset: 0x000CA064
    public void u10_checkSmoothMovement(float pElapsed)
    {
        if (this._update_done)
        {
            return;
        }
        if (this.is_immovable)
        {
            return;
        }
        if (!Config.time_scale_asset.sonic)
        {
            this.checkCalibrateTargetPosition();
        }
        this.updateMovement(pElapsed, 0f);
    }

    // Token: 0x04000ECF RID: 3791
    internal ActorIdleLoopSound idle_loop_sound;

    // Token: 0x04000ED0 RID: 3792
    internal bool is_forced_socialize_icon;

    // Token: 0x04000ED1 RID: 3793
    internal double is_forced_socialize_timestamp;

    // Token: 0x04000ED2 RID: 3794
    internal string ate_last_item_id;

    // Token: 0x04000ED3 RID: 3795
    internal double timestamp_session_ate_food;

    // Token: 0x04000ED4 RID: 3796
    internal double timestamp_tween_session_social;

    // Token: 0x04000ED5 RID: 3797
    private double _last_color_effect_timestamp;

    // Token: 0x04000ED6 RID: 3798
    private double _last_stamina_reduce_timestamp;

    // Token: 0x04000ED7 RID: 3799
    internal double timestamp_profession_set;

    // Token: 0x04000ED8 RID: 3800
    internal List<BaseActorComponent> children_special;

    // Token: 0x04000ED9 RID: 3801
    private Dictionary<Type, BaseActorComponent> _dict_special;

    // Token: 0x04000EDA RID: 3802
    private List<ActorSimpleComponent> children_pre_behaviour;

    // Token: 0x04000EDB RID: 3803
    private Dictionary<Type, ActorSimpleComponent> dict_pre_behaviour;

    // Token: 0x04000EDC RID: 3804
    private UnitProfession _profession;

    // Token: 0x04000EDD RID: 3805
    public GameObject avatar;

    // Token: 0x04000EDE RID: 3806
    private double _timestamp_augmentation_effects;

    // Token: 0x04000EDF RID: 3807
    internal bool show_shadow;

    // Token: 0x04000EE0 RID: 3808
    internal Vector2 current_shadow_position = Globals.POINT_IN_VOID;

    // Token: 0x04000EE1 RID: 3809
    private double[] _decision_cooldowns;

    // Token: 0x04000EE2 RID: 3810
    private bool[] _decision_disabled;

    // Token: 0x04000EE3 RID: 3811
    public DecisionAsset[] decisions = new DecisionAsset[64];

    // Token: 0x04000EE4 RID: 3812
    public int decisions_counter;

    // Token: 0x04000EE5 RID: 3813
    private int _current_children;

    // Token: 0x04000EE6 RID: 3814
    private readonly Queue<HappinessHistory> _last_happiness_history = new Queue<HappinessHistory>();

    // Token: 0x04000EE7 RID: 3815
    private HashSet<long> _aggression_targets = new HashSet<long>();

    // Token: 0x04000EE8 RID: 3816
    private HoverState _hover_state;

    // Token: 0x04000EE9 RID: 3817
    private float _hover_timer;

    // Token: 0x04000EEA RID: 3818
    public BatchActors batch;

    // Token: 0x04000EEB RID: 3819
    internal WorldTile beh_tile_target;

    // Token: 0x04000EEC RID: 3820
    internal Building beh_building_target;

    // Token: 0x04000EED RID: 3821
    internal BaseSimObject beh_actor_target;

    // Token: 0x04000EEE RID: 3822
    internal Book beh_book_target;

    // Token: 0x04000EEF RID: 3823
    internal Building inside_building;

    // Token: 0x04000EF0 RID: 3824
    internal bool is_inside_building;

    // Token: 0x04000EF1 RID: 3825
    internal Boat inside_boat;

    // Token: 0x04000EF2 RID: 3826
    internal bool is_inside_boat;

    // Token: 0x04000EF3 RID: 3827
    internal BaseSimObject attackedBy;

    // Token: 0x04000EF4 RID: 3828
    public Actor lover;

    // Token: 0x04000EF5 RID: 3829
    public readonly HashSet<ActorTrait> traits = new HashSet<ActorTrait>();

    // Token: 0x04000EF6 RID: 3830
    private CombatActionHolder _combat_actions = new CombatActionHolder();

    // Token: 0x04000EF7 RID: 3831
    private SpellHolder _spells = new SpellHolder();

    // Token: 0x04000EF8 RID: 3832
    private Dictionary<string, bool> _traits_cache = new Dictionary<string, bool>();

    // Token: 0x04000EF9 RID: 3833
    internal ActorData data;

    // Token: 0x04000EFA RID: 3834
    internal ProfessionAsset profession_asset;

    // Token: 0x04000EFB RID: 3835
    private bool _state_adult;

    // Token: 0x04000EFC RID: 3836
    private bool _state_baby;

    // Token: 0x04000EFD RID: 3837
    private bool _state_egg;

    // Token: 0x04000EFE RID: 3838
    public ActorAsset asset;

    // Token: 0x04000EFF RID: 3839
    public Vector2 next_step_position;

    // Token: 0x04000F00 RID: 3840
    public Vector2 next_step_position_possession;

    // Token: 0x04000F01 RID: 3841
    internal Vector2 shake_offset;

    // Token: 0x04000F02 RID: 3842
    public static readonly Vector2 sprite_offset = new Vector2(0.5f, 0.5f);

    // Token: 0x04000F03 RID: 3843
    public Vector2 move_jump_offset;

    // Token: 0x04000F04 RID: 3844
    protected bool shake_horizontal;

    // Token: 0x04000F05 RID: 3845
    protected bool shake_vertical;

    // Token: 0x04000F06 RID: 3846
    protected float shake_timer;

    // Token: 0x04000F07 RID: 3847
    protected bool shake_active;

    // Token: 0x04000F08 RID: 3848
    public float shake_volume;

    // Token: 0x04000F09 RID: 3849
    private bool _is_moving;

    // Token: 0x04000F0A RID: 3850
    private bool _possessed_movement;

    // Token: 0x04000F0B RID: 3851
    internal bool _is_in_liquid;

    // Token: 0x04000F0C RID: 3852
    internal bool is_visible;

    // Token: 0x04000F0D RID: 3853
    internal bool last_sprite_renderer_enabled;

    // Token: 0x04000F0E RID: 3854
    internal AnimationFrameData frame_data;

    // Token: 0x04000F0F RID: 3855
    internal bool dirty_current_tile;

    // Token: 0x04000F10 RID: 3856
    internal WorldTile tile_target;

    // Token: 0x04000F11 RID: 3857
    private WorldTile _next_step_tile;

    // Token: 0x04000F12 RID: 3858
    public SplitPathStatus split_path;

    // Token: 0x04000F13 RID: 3859
    public int current_path_index;

    // Token: 0x04000F14 RID: 3860
    public readonly List<WorldTile> current_path = new List<WorldTile>();

    // Token: 0x04000F15 RID: 3861
    public List<MapRegion> current_path_global;

    // Token: 0x04000F16 RID: 3862
    public BaseActionActor callbacks_on_death;

    // Token: 0x04000F17 RID: 3863
    public BaseActionActor callbacks_landed;

    // Token: 0x04000F18 RID: 3864
    public BaseActionActor callbacks_cancel_path_movement;

    // Token: 0x04000F19 RID: 3865
    public BaseActionActor callbacks_magnet_update;

    // Token: 0x04000F1A RID: 3866
    internal float actor_scale;

    // Token: 0x04000F1B RID: 3867
    internal float target_scale;

    // Token: 0x04000F1C RID: 3868
    internal BaseSimObject attack_target;

    // Token: 0x04000F1D RID: 3869
    internal bool has_attack_target;

    // Token: 0x04000F1E RID: 3870
    internal float timer_action;

    // Token: 0x04000F1F RID: 3871
    internal float timer_jump_animation;

    // Token: 0x04000F20 RID: 3872
    internal float hitbox_bonus_height;

    // Token: 0x04000F21 RID: 3873
    internal Vector3 velocity;

    // Token: 0x04000F22 RID: 3874
    internal float velocity_speed;

    // Token: 0x04000F23 RID: 3875
    internal bool under_forces;

    // Token: 0x04000F24 RID: 3876
    protected WorldTimer targets_to_ignore_timer;

    // Token: 0x04000F25 RID: 3877
    private bool _flying;

    // Token: 0x04000F26 RID: 3878
    internal bool is_in_magnet;

    // Token: 0x04000F27 RID: 3879
    internal float attack_timer;

    // Token: 0x04000F28 RID: 3880
    internal double last_attack_timestamp;

    // Token: 0x04000F29 RID: 3881
    internal WeaponType s_type_attack;

    // Token: 0x04000F2A RID: 3882
    internal string s_type_slash;

    // Token: 0x04000F2B RID: 3883
    internal PersonalityAsset s_personality;

    // Token: 0x04000F2C RID: 3884
    private readonly List<BaseAugmentationAsset> _s_special_effect_augmentations = new List<BaseAugmentationAsset>();

    // Token: 0x04000F2D RID: 3885
    private readonly Dictionary<BaseAugmentationAsset, double> _s_special_effect_augmentations_timers = new Dictionary<BaseAugmentationAsset, double>();

    // Token: 0x04000F2E RID: 3886
    internal AttackAction s_action_attack_target;

    // Token: 0x04000F2F RID: 3887
    internal GetHitAction s_get_hit_action;

    // Token: 0x04000F30 RID: 3888
    protected static readonly List<BaseAugmentationAsset> _tempAugmentationList = new List<BaseAugmentationAsset>();

    // Token: 0x04000F31 RID: 3889
    private bool _has_emotions;

    // Token: 0x04000F32 RID: 3890
    private bool _has_tag_unconscious;

    // Token: 0x04000F33 RID: 3891
    private bool _has_status_strange_urge;

    // Token: 0x04000F34 RID: 3892
    private bool _has_status_possessed;

    // Token: 0x04000F35 RID: 3893
    private bool _has_status_sleeping;

    // Token: 0x04000F36 RID: 3894
    private bool _has_status_tantrum;

    // Token: 0x04000F37 RID: 3895
    private bool _cache_check_has_status_removed_on_damage;

    // Token: 0x04000F38 RID: 3896
    private bool _has_trait_weightless;

    // Token: 0x04000F39 RID: 3897
    private bool _has_trait_peaceful;

    // Token: 0x04000F3A RID: 3898
    private bool _has_trait_clone;

    // Token: 0x04000F3B RID: 3899
    internal bool has_tag_generate_light;

    // Token: 0x04000F3C RID: 3900
    private bool _has_any_sick_trait;

    // Token: 0x04000F3D RID: 3901
    internal bool is_immovable;

    // Token: 0x04000F3E RID: 3902
    internal bool is_ai_frozen;

    // Token: 0x04000F3F RID: 3903
    private bool _has_stop_idle_animation;

    // Token: 0x04000F40 RID: 3904
    protected bool should_check_land_cancel;

    // Token: 0x04000F41 RID: 3905
    internal WorldTile scheduled_tile_target;

    // Token: 0x04000F42 RID: 3906
    internal bool _action_wait_after_land;

    // Token: 0x04000F43 RID: 3907
    internal float _action_wait_after_land_timer;

    // Token: 0x04000F44 RID: 3908
    internal AiSystemActor ai;

    // Token: 0x04000F45 RID: 3909
    public CitizenJobAsset citizen_job;

    // Token: 0x04000F46 RID: 3910
    protected Building _home_building;

    // Token: 0x04000F47 RID: 3911
    private float _death_timer_color_stage_1;

    // Token: 0x04000F48 RID: 3912
    private float _death_timer_alpha_stage_2;

    // Token: 0x04000F49 RID: 3913
    private float _jump_time;

    // Token: 0x04000F4A RID: 3914
    private float lastX;

    // Token: 0x04000F4B RID: 3915
    private float lastY;

    // Token: 0x04000F4C RID: 3916
    public float flip_angle;

    // Token: 0x04000F4D RID: 3917
    internal bool flip;

    // Token: 0x04000F4E RID: 3918
    private int _precalc_movement_speed_skips;

    // Token: 0x04000F4F RID: 3919
    private float _current_combined_movement_speed;

    // Token: 0x04000F50 RID: 3920
    internal float _timeout_targets;

    // Token: 0x04000F51 RID: 3921
    internal Vector3 target_angle;

    // Token: 0x04000F52 RID: 3922
    internal float rotation_cooldown;

    // Token: 0x04000F53 RID: 3923
    private RotationDirection _rotation_direction;

    // Token: 0x04000F54 RID: 3924
    private Sprite _last_topic_sprite;

    // Token: 0x04000F55 RID: 3925
    public Color color;

    // Token: 0x04000F56 RID: 3926
    internal bool dirty_sprite_main;

    // Token: 0x04000F57 RID: 3927
    private Sprite _cached_sprite_item;

    // Token: 0x04000F58 RID: 3928
    private IHandRenderer _cached_hand_renderer_asset;

    // Token: 0x04000F59 RID: 3929
    internal Sprite cached_sprite_head;

    // Token: 0x04000F5A RID: 3930
    internal bool dirty_sprite_head;

    // Token: 0x04000F5B RID: 3931
    internal AnimationContainerUnit animation_container;

    // Token: 0x04000F5C RID: 3932
    private Sprite _last_main_sprite;

    // Token: 0x04000F5D RID: 3933
    private Sprite _last_colored_sprite;

    // Token: 0x04000F5E RID: 3934
    private ColorAsset _last_color_asset;

    // Token: 0x04000F5F RID: 3935
    private bool _dirty_sprite_item;

    // Token: 0x04000F60 RID: 3936
    private bool _has_animated_item;

    // Token: 0x04000F61 RID: 3937
    public SpriteAnimation sprite_animation;

    // Token: 0x04000F62 RID: 3938
    private AttackType _last_attack_type;

    // Token: 0x04000F63 RID: 3939
    public ActorEquipment equipment;

    // Token: 0x04000F64 RID: 3940
    public City city;

    // Token: 0x04000F65 RID: 3941
    public Subspecies subspecies;

    // Token: 0x04000F66 RID: 3942
    public Language language;

    // Token: 0x04000F67 RID: 3943
    public Plot plot;

    // Token: 0x04000F68 RID: 3944
    public Religion religion;

    // Token: 0x04000F69 RID: 3945
    public Family family;

    // Token: 0x04000F6A RID: 3946
    public Army army;

    // Token: 0x04000F6B RID: 3947
    public Clan clan;

    // Token: 0x04000F6C RID: 3948
    public Culture culture;

    // Token: 0x04000F6D RID: 3949
    private const float FIND_TILE_SQ_DIST = 4f;

    // Token: 0x04000F6E RID: 3950
    private const float CUR_SQ_DIST = 0.16000001f;

    // Token: 0x04000F6F RID: 3951
    private const float NEW_SQ_DIST = 0.09f;

    // Token: 0x04000F70 RID: 3952
    private bool _beh_skip;

    // Token: 0x04000F71 RID: 3953
    private bool _update_done;

    // Token: 0x04000F72 RID: 3954
    public string last_decision_id;
}
using System;
using System.Collections.Generic;
using System.Runtime.CompilerServices;
using UnityEngine;

// Token: 0x020001B7 RID: 439
public class BaseSimObject : NanoObject, IEquatable<BaseSimObject>
{
    // Token: 0x06000C93 RID: 3219 RVA: 0x000B56D5 File Offset: 0x000B38D5
    internal virtual void create()
    {
    }

    // Token: 0x06000C94 RID: 3220 RVA: 0x000B56D7 File Offset: 0x000B38D7
    public int countStatusEffects()
    {
        return this._active_status_dict.Count;
    }

    // Token: 0x06000C95 RID: 3221 RVA: 0x000B56E4 File Offset: 0x000B38E4
    public Dictionary<string, Status>.ValueCollection getStatuses()
    {
        return this._active_status_dict.Values;
    }

    // Token: 0x06000C96 RID: 3222 RVA: 0x000B56F1 File Offset: 0x000B38F1
    public Dictionary<string, Status>.KeyCollection getStatusesIds()
    {
        return this._active_status_dict.Keys;
    }

    // Token: 0x06000C97 RID: 3223 RVA: 0x000B56FE File Offset: 0x000B38FE
    public IReadOnlyDictionary<string, Status> getStatusesDict()
    {
        return this._active_status_dict;
    }

    // Token: 0x06000C98 RID: 3224 RVA: 0x000B5708 File Offset: 0x000B3908
    protected override void setDefaultValues()
    {
        base.setDefaultValues();
        this._stats_dirty_version = 0;
        this._stats_dirty = true;
        this.event_full_stats = false;
        this.current_rotation = default(Vector3);
        this.position_height = 0f;
        this._has_any_status_cached = false;
        this._has_any_status_to_render = false;
    }

    // Token: 0x06000C99 RID: 3225 RVA: 0x000B5755 File Offset: 0x000B3955
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public bool hasCity()
    {
        return this.getCity() != null;
    }

    // Token: 0x06000C9A RID: 3226 RVA: 0x000B5760 File Offset: 0x000B3960
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public virtual City getCity()
    {
        return null;
    }

    // Token: 0x06000C9B RID: 3227 RVA: 0x000B5764 File Offset: 0x000B3964
    internal bool addStatusEffect(string pID, float pOverrideTimer = 0f, bool pColorEffect = true)
    {
        StatusAsset tStatusAsset = AssetManager.status.get(pID);
        return tStatusAsset != null && this.addStatusEffect(tStatusAsset, pOverrideTimer, pColorEffect);
    }

    // Token: 0x06000C9C RID: 3228 RVA: 0x000B578C File Offset: 0x000B398C
    internal virtual bool addStatusEffect(StatusAsset pStatusAsset, float pOverrideTimer = 0f, bool pColorEffect = true)
    {
        if (!base.isAlive())
        {
            return false;
        }
        bool tIsActor = this.isActor();
        if (tIsActor && this.a.asset.allowed_status_tiers < pStatusAsset.tier)
        {
            return false;
        }
        bool tHasAnyStatus = this.hasAnyStatusEffectRaw();
        if (tHasAnyStatus && this.hasStatus(pStatusAsset.id))
        {
            if (!pStatusAsset.allow_timer_reset && pOverrideTimer == 0f)
            {
                return false;
            }
            Status tStatusEffect = this._active_status_dict[pStatusAsset.id];
            float tResetTimer = pStatusAsset.duration;
            if (pOverrideTimer != 0f)
            {
                tResetTimer = pOverrideTimer;
            }
            if (tStatusEffect.getRemainingTime() < (double)tResetTimer)
            {
                tStatusEffect.setDuration(tResetTimer);
            }
            return true;
        }
        else
        {
            if (!this.canAddStatus(pStatusAsset, tIsActor, pColorEffect))
            {
                return false;
            }
            this.addNewStatusEffect(pStatusAsset, pOverrideTimer, pColorEffect, tIsActor, tHasAnyStatus);
            return true;
        }
    }

    // Token: 0x06000C9D RID: 3229 RVA: 0x000B5840 File Offset: 0x000B3A40
    private bool canAddStatus(StatusAsset pStatusAsset, bool pIsActor, bool pHasAnyStatus)
    {
        if (pIsActor)
        {
            if (pStatusAsset.opposite_traits != null)
            {
                for (int i = 0; i < pStatusAsset.opposite_traits.Length; i++)
                {
                    string tTraitID = pStatusAsset.opposite_traits[i];
                    if (this.a.hasTrait(tTraitID))
                    {
                        return false;
                    }
                }
            }
            if (pStatusAsset.opposite_tags != null && this.a.stats.hasTags() && this.a.stats.hasTags(pStatusAsset.opposite_tags))
            {
                return false;
            }
        }
        if (pStatusAsset.opposite_status != null && pHasAnyStatus)
        {
            for (int j = 0; j < pStatusAsset.opposite_status.Length; j++)
            {
                string tStatusID = pStatusAsset.opposite_status[j];
                if (this.hasStatus(tStatusID))
                {
                    return false;
                }
            }
        }
        return true;
    }

    // Token: 0x06000C9E RID: 3230 RVA: 0x000B58F0 File Offset: 0x000B3AF0
    private void addNewStatusEffect(StatusAsset pStatusAsset, float pOverrideTimer, bool pColorEffect, bool pIsActor, bool pHasAnyStatus)
    {
        Status tNewStatus = World.world.statuses.newStatus(this, pStatusAsset, pOverrideTimer);
        this.setStatsDirty();
        this._active_status_dict.Add(pStatusAsset.id, tNewStatus);
        if (pIsActor && pStatusAsset.cancel_actor_job && pColorEffect)
        {
            this.a.cancelAllBeh();
            this.a.startColorEffect(ActorColorEffect.White);
        }
        if (pStatusAsset.remove_status != null && pHasAnyStatus)
        {
            for (int i = 0; i < pStatusAsset.remove_status.Length; i++)
            {
                string tStatusToFinish = pStatusAsset.remove_status[i];
                this.finishStatusEffect(tStatusToFinish);
            }
        }
        if (pIsActor)
        {
            WorldAction action_on_receive = pStatusAsset.action_on_receive;
            if (action_on_receive == null)
            {
                return;
            }
            action_on_receive(this, null);
        }
    }

    // Token: 0x06000C9F RID: 3231 RVA: 0x000B5998 File Offset: 0x000B3B98
    internal void finishAllStatusEffects()
    {
        if (!this.hasAnyStatusEffect())
        {
            return;
        }
        foreach (Status status in this._active_status_dict.Values)
        {
            status.finish();
        }
    }

    // Token: 0x06000CA0 RID: 3232 RVA: 0x000B59F8 File Offset: 0x000B3BF8
    public void finishStatusEffect(string pID)
    {
        if (!this.hasAnyStatusEffect())
        {
            return;
        }
        Status tStatusEffect;
        if (this._active_status_dict.TryGetValue(pID, out tStatusEffect))
        {
            tStatusEffect.finish();
        }
    }

    // Token: 0x06000CA1 RID: 3233 RVA: 0x000B5A24 File Offset: 0x000B3C24
    public virtual void setStatsDirty()
    {
        this._stats_dirty = true;
    }

    // Token: 0x06000CA2 RID: 3234 RVA: 0x000B5A2D File Offset: 0x000B3C2D
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    internal bool isActor()
    {
        return this._object_type == MapObjectType.Actor;
    }

    // Token: 0x06000CA3 RID: 3235 RVA: 0x000B5A38 File Offset: 0x000B3C38
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    internal bool isBuilding()
    {
        return this._object_type == MapObjectType.Building;
    }

    // Token: 0x06000CA4 RID: 3236 RVA: 0x000B5A43 File Offset: 0x000B3C43
    public void setObjectType(MapObjectType pType)
    {
        this._object_type = pType;
        if (this._object_type == MapObjectType.Actor)
        {
            this.a = (Actor)this;
            return;
        }
        this.b = (Building)this;
    }

    // Token: 0x06000CA5 RID: 3237 RVA: 0x000B5A6D File Offset: 0x000B3C6D
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    internal bool hasStatus(string pID)
    {
        return this._active_status_dict.ContainsKey(pID);
    }

    // Token: 0x06000CA6 RID: 3238 RVA: 0x000B5A7B File Offset: 0x000B3C7B
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    internal bool hasAnyStatusEffect()
    {
        return this._has_any_status_cached;
    }

    // Token: 0x06000CA7 RID: 3239 RVA: 0x000B5A83 File Offset: 0x000B3C83
    internal bool hasAnyStatusEffectRaw()
    {
        return this._active_status_dict.Count > 0;
    }

    // Token: 0x06000CA8 RID: 3240 RVA: 0x000B5A93 File Offset: 0x000B3C93
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    internal bool hasAnyStatusEffectToRender()
    {
        return this._has_any_status_to_render;
    }

    // Token: 0x06000CA9 RID: 3241 RVA: 0x000B5A9B File Offset: 0x000B3C9B
    public void removeFinishedStatusEffect(Status pStatusData)
    {
        this._active_status_dict.Remove(pStatusData.asset.id);
        if (base.isAlive())
        {
            this.setStatsDirty();
        }
    }

    // Token: 0x06000CAA RID: 3242 RVA: 0x000B5AC2 File Offset: 0x000B3CC2
    internal virtual void updateStats()
    {
        this._stats_dirty = false;
        this._stats_dirty_version++;
        this.updateCachedStatusEffects();
    }

    // Token: 0x06000CAB RID: 3243 RVA: 0x000B5ADF File Offset: 0x000B3CDF
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public bool isStatsDirty()
    {
        return this._stats_dirty;
    }

    // Token: 0x06000CAC RID: 3244 RVA: 0x000B5AE7 File Offset: 0x000B3CE7
    public int getStatsDirtyVersion()
    {
        return this._stats_dirty_version;
    }

    // Token: 0x06000CAD RID: 3245 RVA: 0x000B5AF0 File Offset: 0x000B3CF0
    private void updateCachedStatusEffects()
    {
        this._has_any_status_cached = this.hasAnyStatusEffectRaw();
        this._has_any_status_to_render = false;
        if (this.hasAnyStatusEffect())
        {
            using (Dictionary<string, Status>.ValueCollection.Enumerator enumerator = this._active_status_dict.Values.GetEnumerator())
            {
                while (enumerator.MoveNext())
                {
                    if (enumerator.Current.asset.need_visual_render)
                    {
                        this._has_any_status_to_render = true;
                        break;
                    }
                }
            }
        }
    }

    // Token: 0x06000CAE RID: 3246 RVA: 0x000B5B70 File Offset: 0x000B3D70
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    internal bool isInLiquid()
    {
        return this.current_tile.Type.liquid;
    }

    // Token: 0x06000CAF RID: 3247 RVA: 0x000B5B82 File Offset: 0x000B3D82
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    internal bool isInWater()
    {
        return this.current_tile.Type.ocean;
    }

    // Token: 0x06000CB0 RID: 3248 RVA: 0x000B5B94 File Offset: 0x000B3D94
    public bool isTouchingLiquid()
    {
        return this.isInLiquid() && !this.isInAir();
    }

    // Token: 0x06000CB1 RID: 3249 RVA: 0x000B5BA9 File Offset: 0x000B3DA9
    internal virtual bool isInAir()
    {
        return false;
    }

    // Token: 0x06000CB2 RID: 3250 RVA: 0x000B5BAC File Offset: 0x000B3DAC
    internal virtual bool isFlying()
    {
        return false;
    }

    // Token: 0x06000CB3 RID: 3251 RVA: 0x000B5BAF File Offset: 0x000B3DAF
    internal virtual float getHeight()
    {
        return 0f;
    }

    // Token: 0x06000CB4 RID: 3252 RVA: 0x000B5BB6 File Offset: 0x000B3DB6
    internal virtual void getHit(float pDamage, bool pFlash = true, AttackType pAttackType = AttackType.Other, BaseSimObject pAttacker = null, bool pSkipIfShake = true, bool pMetallicWeapon = false, bool pCheckDamageReduction = true)
    {
    }

    // Token: 0x06000CB5 RID: 3253 RVA: 0x000B5BB8 File Offset: 0x000B3DB8
    internal virtual void getHitFullHealth(AttackType pAttackType)
    {
    }

    // Token: 0x06000CB6 RID: 3254 RVA: 0x000B5BBC File Offset: 0x000B3DBC
    internal BaseSimObject findEnemyObjectTarget()
    {
        EnemyFinderData tEnemyData = EnemiesFinder.findEnemiesFrom(this.current_tile, this.kingdom, -1);
        if (tEnemyData.isEmpty())
        {
            return null;
        }
        bool tFindClosest = true;
        if (tEnemyData.list.Count > 50)
        {
            tFindClosest = Randy.randomChance(0.6f);
        }
        BaseSimObject tBestTarget;
        this.checkObjectList(tEnemyData.list.LoopRandom<BaseSimObject>(), tFindClosest, float.MaxValue, false, out tBestTarget);
        return tBestTarget;
    }

    // Token: 0x06000CB7 RID: 3255 RVA: 0x000B5C20 File Offset: 0x000B3E20
    protected void checkObjectList(IEnumerable<BaseSimObject> pList, bool pFindClosest, float pMaxDist, bool pIgnoreStunned, out BaseSimObject pBestObjectLast)
    {
        float tBestDist = float.MaxValue;
        float tDist = float.MaxValue;
        BaseSimObject tBestObject = null;
        float tMaxDist = pMaxDist * pMaxDist;
        bool tHasMelee = this.isActor() && this.a.hasMeleeAttack();
        WorldTile tCurrentTile = this.current_tile;
        Vector2Int tCurrentPos = this.current_tile.pos;
        foreach (BaseSimObject tObject in pList)
        {
            if (tObject.isAlive() && tObject != this)
            {
                WorldTile tObjectTile = tObject.current_tile;
                if (pFindClosest)
                {
                    tDist = (float)Toolbox.SquaredDistVec2(tObjectTile.pos, tCurrentPos);
                    if (tDist >= tBestDist || tDist > tMaxDist)
                    {
                        continue;
                    }
                }
                if ((!pIgnoreStunned || !tObject.isActor() || !tObject.a.hasStatusStunned()) && this.canAttackTarget(tObject, true) && (!tHasMelee || tObjectTile.isSameIsland(tCurrentTile) || (!tObjectTile.Type.block && tCurrentTile.region.island.isConnectedWith(tObjectTile.region.island))) && (!tObject.isBuilding() || !this.isKingdomCiv() || !tObject.b.asset.city_building || tObject.b.asset.tower || !(tObject.kingdom.getSpecies() == this.kingdom.getSpecies())) && !this.shouldIgnoreTarget(tObject))
                {
                    if (!pFindClosest)
                    {
                        pBestObjectLast = tObject;
                        return;
                    }
                    if (tDist < tBestDist)
                    {
                        tBestObject = tObject;
                        tBestDist = tDist;
                        if (tBestDist < 4f)
                        {
                            pBestObjectLast = tBestObject;
                            return;
                        }
                    }
                }
            }
        }
        pBestObjectLast = tBestObject;
    }

    // Token: 0x06000CB8 RID: 3256 RVA: 0x000B5DE8 File Offset: 0x000B3FE8
    internal void ignoreTarget(BaseSimObject pTarget)
    {
        if (this._targets_to_ignore == null)
        {
            this._targets_to_ignore = new HashSet<long>();
        }
        this._targets_to_ignore.Add(pTarget.getID());
    }

    // Token: 0x06000CB9 RID: 3257 RVA: 0x000B5E0F File Offset: 0x000B400F
    internal bool shouldIgnoreTarget(BaseSimObject pTarget)
    {
        HashSet<long> targets_to_ignore = this._targets_to_ignore;
        return targets_to_ignore != null && targets_to_ignore.Contains(pTarget.getID());
    }

    // Token: 0x06000CBA RID: 3258 RVA: 0x000B5E28 File Offset: 0x000B4028
    internal void clearIgnoreTargets()
    {
        HashSet<long> targets_to_ignore = this._targets_to_ignore;
        if (targets_to_ignore == null)
        {
            return;
        }
        targets_to_ignore.Clear();
    }

    // Token: 0x06000CBB RID: 3259 RVA: 0x000B5E3A File Offset: 0x000B403A
    internal int countTargetsToIgnore()
    {
        HashSet<long> targets_to_ignore = this._targets_to_ignore;
        if (targets_to_ignore == null)
        {
            return 0;
        }
        return targets_to_ignore.Count;
    }

    // Token: 0x06000CBC RID: 3260 RVA: 0x000B5E50 File Offset: 0x000B4050
    internal bool canAttackTarget(BaseSimObject pTarget, bool pCheckForFactions = true)
    {
        if (!base.isAlive())
        {
            return false;
        }
        if (!pTarget.isAlive())
        {
            return false;
        }
        bool tThisIsActor = this.isActor();
        string tSpeciesID;
        WeaponType tAttackType;
        if (tThisIsActor)
        {
            if (this.a.asset.skip_fight_logic)
            {
                return false;
            }
            tSpeciesID = this.a.asset.id;
            tAttackType = this.a.s_type_attack;
        }
        else
        {
            tSpeciesID = this.b.kingdom.getSpecies();
            tAttackType = WeaponType.Range;
        }
        if (pTarget.isActor())
        {
            Actor tActorTarget = pTarget.a;
            if (!tActorTarget.asset.can_be_killed_by_stuff)
            {
                return false;
            }
            if (tActorTarget.isInsideSomething())
            {
                return false;
            }
            if (tActorTarget.isFlying() && tAttackType == WeaponType.Melee)
            {
                return false;
            }
            if (tActorTarget.ai.action != null && tActorTarget.ai.action.special_prevent_can_be_attacked)
            {
                return false;
            }
            if (tActorTarget.isInMagnet())
            {
                return false;
            }
            if (pCheckForFactions && this.areFoes(pTarget) && tActorTarget.isKingdomCiv() && this.isKingdomCiv() && !this.hasStatusTantrum() && !tActorTarget.hasStatusTantrum())
            {
                bool tXenophobicAny = (tThisIsActor && this.a.hasXenophobic()) || tActorTarget.hasXenophobic();
                bool tXenophileAny = (tThisIsActor && this.a.hasXenophiles()) || tActorTarget.hasXenophiles();
                bool tSameCulture = tThisIsActor && this.a.culture == tActorTarget.culture;
                bool tSameSpecies = tSpeciesID == tActorTarget.asset.id;
                bool tIgnoreCivilians = ((tSameSpecies || tXenophileAny) && !tXenophobicAny) || (tSameCulture && tSameSpecies);
                if (!WorldLawLibrary.world_law_angry_civilians.isEnabled())
                {
                    if (tActorTarget.profession_asset.is_civilian && tIgnoreCivilians)
                    {
                        return false;
                    }
                    if (tThisIsActor && this.a.profession_asset.is_civilian && tIgnoreCivilians)
                    {
                        return false;
                    }
                }
            }
            if (pCheckForFactions && tThisIsActor && this.a.hasCannibalism() && this.a.isSameSpecies(tActorTarget))
            {
                Family tFamilyThis = this.a.family;
                Family tFamilyTarget = tActorTarget.family;
                if (tFamilyTarget == null || tFamilyThis == null)
                {
                    return false;
                }
                if (this.a.hasFamily())
                {
                    if (tFamilyTarget == tFamilyThis)
                    {
                        return false;
                    }
                    if (!tFamilyTarget.areMostUnitsHungry() && !tFamilyThis.areMostUnitsHungry())
                    {
                        return false;
                    }
                }
            }
        }
        else
        {
            Building tBuildingTarget = pTarget.b;
            if (this.isKingdomCiv() && tBuildingTarget.asset.city_building && tBuildingTarget.asset.tower && !tBuildingTarget.isCiv() && tThisIsActor && this.a.profession_asset.is_civilian && !WorldLawLibrary.world_law_angry_civilians.isEnabled() && tBuildingTarget.kingdom.getSpecies() == this.kingdom.getSpecies())
            {
                return false;
            }
            if (tThisIsActor)
            {
                return this.a.asset.can_attack_buildings || (this.a.asset.can_attack_brains && pTarget.kingdom.asset.brain);
            }
        }
        if (tThisIsActor)
        {
            ActorAsset tActorAsset = this.a.asset;
            if (!this.a.isWaterCreature() || !this.a.hasRangeAttack())
            {
                if (this.a.isWaterCreature() && !tActorAsset.force_land_creature)
                {
                    if (!pTarget.isInLiquid())
                    {
                        return false;
                    }
                    if (!pTarget.current_tile.isSameIsland(this.current_tile))
                    {
                        return false;
                    }
                }
                else if (tAttackType == WeaponType.Melee && pTarget.isInLiquid() && !this.a.isWaterCreature())
                {
                    return false;
                }
            }
        }
        return true;
    }

    // Token: 0x06000CBD RID: 3261 RVA: 0x000B61BF File Offset: 0x000B43BF
    public bool areFoes(BaseSimObject pTarget)
    {
        return this.kingdom.isEnemy(pTarget.kingdom);
    }

    // Token: 0x06000CBE RID: 3262 RVA: 0x000B61D2 File Offset: 0x000B43D2
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public void setHealth(int pValue, bool pClamp = true)
    {
        BaseObjectData data = this.getData();
        if (pClamp)
        {
            pValue = Mathf.Clamp(pValue, 1, this.getMaxHealth());
        }
        data.health = pValue;
    }

    // Token: 0x06000CBF RID: 3263 RVA: 0x000B61F2 File Offset: 0x000B43F2
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public void setMaxHealth()
    {
        this.setHealth(this.getMaxHealth(), true);
    }

    // Token: 0x06000CC0 RID: 3264 RVA: 0x000B6204 File Offset: 0x000B4404
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public void changeHealth(int pValue)
    {
        BaseObjectData data = this.getData();
        int tNewValue = data.health + pValue;
        data.health = Mathf.Clamp(tNewValue, 0, this.getMaxHealth());
    }

    // Token: 0x06000CC1 RID: 3265 RVA: 0x000B6232 File Offset: 0x000B4432
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public int getHealth()
    {
        return this.getData().health;
    }

    // Token: 0x06000CC2 RID: 3266 RVA: 0x000B6240 File Offset: 0x000B4440
    public int getMaxHealthPercent(float pPercent)
    {
        int tResult = (int)((float)this.getMaxHealth() * pPercent);
        return Mathf.Max(1, tResult);
    }

    // Token: 0x06000CC3 RID: 3267 RVA: 0x000B625F File Offset: 0x000B445F
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public bool hasHealth()
    {
        return this.getHealth() > 0;
    }

    // Token: 0x06000CC4 RID: 3268 RVA: 0x000B626A File Offset: 0x000B446A
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public bool Equals(BaseSimObject pObject)
    {
        return this._hashcode == pObject.GetHashCode();
    }

    // Token: 0x06000CC5 RID: 3269 RVA: 0x000B627A File Offset: 0x000B447A
    public int getMaxHealth()
    {
        return (int)this.stats["health"];
    }

    // Token: 0x06000CC6 RID: 3270 RVA: 0x000B628D File Offset: 0x000B448D
    public override void Dispose()
    {
        this.current_tile = null;
        this.kingdom = null;
        this.stats.reset();
        this.clearIgnoreTargets();
        this._targets_to_ignore = null;
        this.disposeStatusEffects();
        this.current_tile = null;
        base.Dispose();
    }

    // Token: 0x06000CC7 RID: 3271 RVA: 0x000B62C8 File Offset: 0x000B44C8
    private void disposeStatusEffects()
    {
        if (!this.hasAnyStatusEffect())
        {
            return;
        }
        foreach (Status status in this._active_status_dict.Values)
        {
            status.finish();
        }
        this._active_status_dict.Clear();
    }

    // Token: 0x06000CC8 RID: 3272 RVA: 0x000B6334 File Offset: 0x000B4534
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public bool isKingdomCiv()
    {
        return this.kingdom.isCiv();
    }

    // Token: 0x06000CC9 RID: 3273 RVA: 0x000B6341 File Offset: 0x000B4541
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public bool isKingdomMob()
    {
        return this.kingdom.isMobs();
    }

    // Token: 0x06000CCA RID: 3274 RVA: 0x000B634E File Offset: 0x000B454E
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public bool hasKingdom()
    {
        return this.kingdom != null;
    }

    // Token: 0x06000CCB RID: 3275 RVA: 0x000B6359 File Offset: 0x000B4559
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public virtual BaseObjectData getData()
    {
        return null;
    }

    // Token: 0x06000CCC RID: 3276 RVA: 0x000B635C File Offset: 0x000B455C
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public sealed override long getID()
    {
        return this.getData().id;
    }

    // Token: 0x06000CCD RID: 3277 RVA: 0x000B6369 File Offset: 0x000B4569
    public override double getFoundedTimestamp()
    {
        return this.getData().created_time;
    }

    // Token: 0x06000CCE RID: 3278 RVA: 0x000B6376 File Offset: 0x000B4576
    public virtual bool hasStatusTantrum()
    {
        return false;
    }

    // Token: 0x06000CCF RID: 3279 RVA: 0x000B6379 File Offset: 0x000B4579
    public bool isSameIsland(WorldTile pTile)
    {
        return this.current_tile.isSameIsland(pTile);
    }

    // Token: 0x06000CD0 RID: 3280 RVA: 0x000B6387 File Offset: 0x000B4587
    public bool isSameIslandAs(BaseSimObject pTarget)
    {
        return this.current_tile.isSameIsland(pTarget.current_tile);
    }

    // Token: 0x1700005F RID: 95
    // (get) Token: 0x06000CD1 RID: 3281 RVA: 0x000B639A File Offset: 0x000B459A
    public MapChunk chunk
    {
        get
        {
            return this.current_tile.chunk;
        }
    }

    // Token: 0x04000C44 RID: 3140
    public float position_height;

    // Token: 0x04000C45 RID: 3141
    public WorldTile current_tile;

    // Token: 0x04000C46 RID: 3142
    public Vector2 current_position;

    // Token: 0x04000C47 RID: 3143
    public Vector3 current_scale;

    // Token: 0x04000C48 RID: 3144
    internal Vector3 current_rotation;

    // Token: 0x04000C49 RID: 3145
    private HashSet<long> _targets_to_ignore;

    // Token: 0x04000C4A RID: 3146
    [NonSerialized]
    public Kingdom kingdom;

    // Token: 0x04000C4B RID: 3147
    private bool _stats_dirty;

    // Token: 0x04000C4C RID: 3148
    private int _stats_dirty_version;

    // Token: 0x04000C4D RID: 3149
    internal bool event_full_stats;

    // Token: 0x04000C4E RID: 3150
    internal readonly BaseStats stats = new BaseStats();

    // Token: 0x04000C4F RID: 3151
    internal Actor a;

    // Token: 0x04000C50 RID: 3152
    internal Building b;

    // Token: 0x04000C51 RID: 3153
    private MapObjectType _object_type;

    // Token: 0x04000C52 RID: 3154
    private Dictionary<string, Status> _active_status_dict = new Dictionary<string, Status>();

    // Token: 0x04000C53 RID: 3155
    private bool _has_any_status_cached;

    // Token: 0x04000C54 RID: 3156
    private bool _has_any_status_to_render;

    // Token: 0x04000C55 RID: 3157
    internal Vector3 cur_transform_position;
}
using System;
using System.Collections.Generic;
using System.Runtime.CompilerServices;
using Newtonsoft.Json;
using UnityEngine;

// Token: 0x02000024 RID: 36
[Serializable]
public class BaseStats : ICloneable
{
    // Token: 0x060001E1 RID: 481 RVA: 0x0000EED4 File Offset: 0x0000D0D4
    private void set(string pID, float pAmount)
    {
        BaseStatAsset tAsset = AssetManager.base_stats_library.get(pID);
        if (tAsset.ignore)
        {
            return;
        }
        if (pAmount == 0f && !tAsset.normalize)
        {
            BaseStatsContainer tRemoveStatsContainer;
            if (this._stats_dict.TryGetValue(pID, out tRemoveStatsContainer))
            {
                if (tAsset.multiplier)
                {
                    List<BaseStatsContainer> multipliers_list = this._multipliers_list;
                    if (multipliers_list != null)
                    {
                        multipliers_list.Remove(tRemoveStatsContainer);
                    }
                }
                this._stats_list.Remove(tRemoveStatsContainer);
                this._stats_dict.Remove(pID);
            }
            return;
        }
        BaseStatsContainer tStatsContainer;
        if (!this._stats_dict.TryGetValue(pID, out tStatsContainer))
        {
            tStatsContainer = new BaseStatsContainer();
            tStatsContainer.value = pAmount;
            tStatsContainer.id = pID;
            this._stats_dict[pID] = tStatsContainer;
            this._stats_list.Add(tStatsContainer);
            if (tAsset.multiplier)
            {
                if (this._multipliers_list == null)
                {
                    this._multipliers_list = new List<BaseStatsContainer>();
                }
                this._multipliers_list.Add(tStatsContainer);
            }
            return;
        }
        this._stats_dict[pID].value = pAmount;
    }

    // Token: 0x060001E2 RID: 482 RVA: 0x0000EFC3 File Offset: 0x0000D1C3
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public List<BaseStatsContainer> getList()
    {
        return this._stats_list;
    }

    // Token: 0x060001E3 RID: 483 RVA: 0x0000EFCB File Offset: 0x0000D1CB
    public void checkStatName(string pID)
    {
        if (!Config.game_loaded)
        {
            return;
        }
        if (AssetManager.base_stats_library.get(pID) == null)
        {
            Debug.LogError("base_stats_library.get() - no asset with id: " + pID);
            Debug.LogError("Only call stats with S.id, never with pure strings to avoid typos");
        }
    }

    // Token: 0x060001E4 RID: 484 RVA: 0x0000EFFC File Offset: 0x0000D1FC
    public float get(string pID)
    {
        BaseStatsContainer tContainer;
        if (this._stats_dict.TryGetValue(pID, out tContainer))
        {
            return tContainer.value;
        }
        return 0f;
    }

    // Token: 0x060001E5 RID: 485 RVA: 0x0000F025 File Offset: 0x0000D225
    public bool hasStat(string pID)
    {
        return this._stats_dict.ContainsKey(pID);
    }

    // Token: 0x060001E6 RID: 486 RVA: 0x0000F034 File Offset: 0x0000D234
    public BaseStatsContainer getContainer(string pID)
    {
        BaseStatsContainer tContainer = null;
        this._stats_dict.TryGetValue(pID, out tContainer);
        return tContainer;
    }

    // Token: 0x060001E7 RID: 487 RVA: 0x0000F054 File Offset: 0x0000D254
    internal void mergeStats(BaseStats pStats, float pMultiplier = 1f)
    {
        for (int i = 0; i < pStats._stats_list.Count; i++)
        {
            BaseStatsContainer tStat = pStats._stats_list[i];
            string id = tStat.id;
            this[id] += tStat.value * pMultiplier;
        }
        if (pStats._tags != null)
        {
            if (this._tags == null)
            {
                this._tags = new HashSet<string>(pStats._tags);
                return;
            }
            this._tags.UnionWith(pStats._tags);
        }
    }

    // Token: 0x060001E8 RID: 488 RVA: 0x0000F0D8 File Offset: 0x0000D2D8
    public void checkMultipliers()
    {
        if (this._multipliers_list == null)
        {
            return;
        }
        for (int i = 0; i < this._multipliers_list.Count; i++)
        {
            BaseStatsContainer tMultiplierContainer = this._multipliers_list[i];
            BaseStatAsset tAssetMultiplier = tMultiplierContainer.asset;
            BaseStatsContainer tContainerToMultiply = this.getContainer(tAssetMultiplier.main_stat_to_multiply);
            if (tContainerToMultiply != null)
            {
                tContainerToMultiply.value += tContainerToMultiply.value * tMultiplierContainer.value;
            }
        }
    }

    // Token: 0x060001E9 RID: 489 RVA: 0x0000F142 File Offset: 0x0000D342
    public bool hasTag(string pTag)
    {
        HashSet<string> tags = this._tags;
        return tags != null && tags.Contains(pTag);
    }

    // Token: 0x060001EA RID: 490 RVA: 0x0000F156 File Offset: 0x0000D356
    public bool hasTags(string[] pTags)
    {
        HashSet<string> tags = this._tags;
        return tags != null && tags.Overlaps(pTags);
    }

    // Token: 0x060001EB RID: 491 RVA: 0x0000F16C File Offset: 0x0000D36C
    public void normalize()
    {
        for (int i = 0; i < this._stats_list.Count; i++)
        {
            this._stats_list[i].normalize();
        }
    }

    // Token: 0x060001EC RID: 492 RVA: 0x0000F1A0 File Offset: 0x0000D3A0
    internal void clear()
    {
        List<BaseStatsContainer> multipliers_list = this._multipliers_list;
        if (multipliers_list != null)
        {
            multipliers_list.Clear();
        }
        this._stats_list.Clear();
        this._stats_dict.Clear();
        HashSet<string> tags = this._tags;
        if (tags == null)
        {
            return;
        }
        tags.Clear();
    }

    // Token: 0x060001ED RID: 493 RVA: 0x0000F1D9 File Offset: 0x0000D3D9
    public void reset()
    {
        this.clear();
    }

    // Token: 0x1700000D RID: 13
    public float this[string pKey]
    {
        get
        {
            return this.get(pKey);
        }
        set
        {
            this.set(pKey, value);
        }
    }

    // Token: 0x060001F0 RID: 496 RVA: 0x0000F1F4 File Offset: 0x0000D3F4
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public void addTag(string pTag)
    {
        if (this._tags == null)
        {
            this._tags = new HashSet<string>();
        }
        this._tags.Add(pTag);
    }

    // Token: 0x060001F1 RID: 497 RVA: 0x0000F216 File Offset: 0x0000D416
    public bool hasTags()
    {
        HashSet<string> tags = this._tags;
        return tags != null && tags.Count > 0;
    }

    // Token: 0x060001F2 RID: 498 RVA: 0x0000F22C File Offset: 0x0000D42C
    public bool hasStats()
    {
        List<BaseStatsContainer> stats_list = this._stats_list;
        return stats_list != null && stats_list.Count > 0;
    }

    // Token: 0x060001F3 RID: 499 RVA: 0x0000F242 File Offset: 0x0000D442
    public bool ShouldSerialize_tags()
    {
        return this.hasTags();
    }

    // Token: 0x060001F4 RID: 500 RVA: 0x0000F24A File Offset: 0x0000D44A
    public bool ShouldSerialize_stats_list()
    {
        return this.hasStats();
    }

    // Token: 0x060001F5 RID: 501 RVA: 0x0000F252 File Offset: 0x0000D452
    public void addCombatAction(string pCombatAction)
    {
    }

    // Token: 0x060001F6 RID: 502 RVA: 0x0000F254 File Offset: 0x0000D454
    public object Clone()
    {
        BaseStats baseStats = new BaseStats();
        baseStats.mergeStats(this, 1f);
        return baseStats;
    }

    // Token: 0x04000151 RID: 337
    [JsonProperty]
    private List<BaseStatsContainer> _stats_list = new List<BaseStatsContainer>();

    // Token: 0x04000152 RID: 338
    private Dictionary<string, BaseStatsContainer> _stats_dict = new Dictionary<string, BaseStatsContainer>();

    // Token: 0x04000153 RID: 339
    private List<BaseStatsContainer> _multipliers_list;

    // Token: 0x04000154 RID: 340
    [JsonProperty]
    private HashSet<string> _tags;
}
using System;
using Newtonsoft.Json;
using UnityEngine;

// Token: 0x02000023 RID: 35
public class BaseStatsContainer
{
    // Token: 0x060001DE RID: 478 RVA: 0x0000EE80 File Offset: 0x0000D080
    public void normalize()
    {
        BaseStatAsset tAsset = this.asset;
        if (tAsset.normalize)
        {
            this.value = Mathf.Clamp(this.value, tAsset.normalize_min, tAsset.normalize_max);
        }
    }

    // Token: 0x1700000C RID: 12
    // (get) Token: 0x060001DF RID: 479 RVA: 0x0000EEB9 File Offset: 0x0000D0B9
    [JsonIgnore]
    public BaseStatAsset asset
    {
        get
        {
            return AssetManager.base_stats_library.get(this.id);
        }
    }

    // Token: 0x0400014F RID: 335
    public string id;

    // Token: 0x04000150 RID: 336
    public float value;
}
using System;

// Token: 0x0200020E RID: 526
public class BaseStatsLibrary : AssetLibrary<BaseStatAsset>
{
    // Token: 0x0600128C RID: 4748 RVA: 0x000D1240 File Offset: 0x000CF440
    public override void init()
    {
        base.init();
        this.add(new BaseStatAsset
        {
            id = "personality_aggression",
            hidden = true,
            normalize = true,
            normalize_min = 0f,
            normalize_max = 1f,
            used_only_for_civs = true
        });
        this.add(new BaseStatAsset
        {
            id = "personality_administration",
            hidden = true,
            normalize = true,
            normalize_min = 0f,
            normalize_max = 1f,
            used_only_for_civs = true
        });
        this.add(new BaseStatAsset
        {
            id = "personality_diplomatic",
            hidden = true,
            normalize = true,
            normalize_min = 0f,
            normalize_max = 1f,
            used_only_for_civs = true
        });
        this.add(new BaseStatAsset
        {
            id = "personality_rationality",
            hidden = true,
            normalize = true,
            normalize_min = 0f,
            normalize_max = 1f,
            used_only_for_civs = true
        });
        this.add(new BaseStatAsset
        {
            id = "diplomacy",
            actor_data_attribute = true,
            normalize = true,
            normalize_max = 999f,
            used_only_for_civs = true,
            sort_rank = 900
        });
        this.add(new BaseStatAsset
        {
            id = "warfare",
            actor_data_attribute = true,
            normalize = true,
            normalize_max = 999f,
            used_only_for_civs = true,
            sort_rank = 900
        });
        this.add(new BaseStatAsset
        {
            id = "stewardship",
            actor_data_attribute = true,
            normalize = true,
            normalize_max = 999f,
            used_only_for_civs = true,
            sort_rank = 900
        });
        this.add(new BaseStatAsset
        {
            id = "intelligence",
            actor_data_attribute = true,
            normalize = true,
            normalize_max = 999f,
            used_only_for_civs = true,
            sort_rank = 900
        });
        this.add(new BaseStatAsset
        {
            id = "lifespan",
            sort_rank = 997,
            normalize = true,
            normalize_min = 1f
        });
        this.add(new BaseStatAsset
        {
            id = "mutation",
            sort_rank = 996
        });
        this.add(new BaseStatAsset
        {
            id = "offspring",
            normalize = true,
            normalize_min = 0f,
            normalize_max = 1000f
        });
        this.add(new BaseStatAsset
        {
            id = "multiplier_offspring",
            show_as_percents = true,
            multiplier = true,
            main_stat_to_multiply = "offspring",
            tooltip_multiply_for_visual_number = 100f,
            translation_key = "offspring"
        });
        this.add(new BaseStatAsset
        {
            id = "army",
            normalize = true,
            normalize_min = 0.1f,
            used_only_for_civs = true
        });
        this.add(new BaseStatAsset
        {
            id = "cities",
            used_only_for_civs = true
        });
        this.add(new BaseStatAsset
        {
            id = "range"
        });
        this.add(new BaseStatAsset
        {
            id = "bonus_towers",
            normalize = true,
            normalize_max = 2f,
            used_only_for_civs = true
        });
        this.add(new BaseStatAsset
        {
            id = "damage",
            normalize = true,
            normalize_min = 1f,
            sort_rank = 999
        });
        this.add(new BaseStatAsset
        {
            id = "speed",
            normalize = true,
            normalize_min = 1f,
            sort_rank = 998
        });
        this.add(new BaseStatAsset
        {
            id = "health",
            normalize = true,
            normalize_min = 1f,
            sort_rank = 1000
        });
        this.add(new BaseStatAsset
        {
            id = "armor",
            normalize = true,
            normalize_min = 0f,
            normalize_max = 99f
        });
        this.add(new BaseStatAsset
        {
            id = "stamina",
            normalize = true,
            normalize_min = 1f,
            sort_rank = 1000
        });
        this.add(new BaseStatAsset
        {
            id = "mana",
            normalize = true,
            normalize_min = 0f,
            sort_rank = 1000
        });
        this.add(new BaseStatAsset
        {
            id = "accuracy",
            normalize_min = 1f,
            normalize_max = 10f,
            normalize = true
        });
        this.add(new BaseStatAsset
        {
            id = "targets",
            hidden = true
        });
        this.add(new BaseStatAsset
        {
            id = "projectiles",
            hidden = true
        });
        this.add(new BaseStatAsset
        {
            id = "experience"
        });
        this.add(new BaseStatAsset
        {
            id = "happiness",
            normalize = true,
            normalize_min = 0f
        });
        this.add(new BaseStatAsset
        {
            id = "critical_chance",
            normalize = true,
            normalize_min = 0f,
            show_as_percents = true,
            tooltip_multiply_for_visual_number = 100f
        });
        this.add(new BaseStatAsset
        {
            id = "critical_damage_multiplier",
            show_as_percents = true,
            tooltip_multiply_for_visual_number = 100f
        });
        this.add(new BaseStatAsset
        {
            id = "size",
            hidden = true
        });
        this.add(new BaseStatAsset
        {
            id = "area_of_effect",
            hidden = true
        });
        this.add(new BaseStatAsset
        {
            id = "attack_speed",
            normalize = true,
            normalize_min = 0.5f,
            normalize_max = 10f
        });
        this.add(new BaseStatAsset
        {
            id = "throwing_range",
            normalize = true,
            normalize_min = 1f,
            normalize_max = 100f
        });
        this.add(new BaseStatAsset
        {
            id = "construction_speed",
            normalize = true,
            normalize_min = 1f,
            normalize_max = 100f
        });
        this.add(new BaseStatAsset
        {
            id = "loyalty_traits",
            translation_key = "loyalty",
            used_only_for_civs = true
        });
        this.add(new BaseStatAsset
        {
            id = "birth_rate",
            translation_key = "birth_rate"
        });
        this.add(new BaseStatAsset
        {
            id = "maturation",
            translation_key = "maturation"
        });
        this.add(new BaseStatAsset
        {
            id = "age_adult",
            translation_key = "age_adult",
            hidden = true
        });
        this.add(new BaseStatAsset
        {
            id = "age_breeding",
            translation_key = "age_breeding",
            hidden = true
        });
        this.add(new BaseStatAsset
        {
            id = "max_nutrition",
            translation_key = "max_nutrition"
        });
        this.add(new BaseStatAsset
        {
            id = "metabolic_rate",
            translation_key = "metabolic_rate",
            normalize_min = 1f,
            hidden = true
        });
        this.add(new BaseStatAsset
        {
            id = "loyalty_mood",
            translation_key = "loyalty",
            used_only_for_civs = true
        });
        this.add(new BaseStatAsset
        {
            id = "opinion",
            used_only_for_civs = true
        });
        this.add(new BaseStatAsset
        {
            id = "skill_combat",
            show_as_percents = true,
            tooltip_multiply_for_visual_number = 100f
        });
        this.add(new BaseStatAsset
        {
            id = "skill_spell",
            show_as_percents = true,
            tooltip_multiply_for_visual_number = 100f
        });
        this.add(new BaseStatAsset
        {
            id = "knockback"
        });
        this.add(new BaseStatAsset
        {
            id = "recoil"
        });
        this.add(new BaseStatAsset
        {
            id = "mass"
        });
        this.add(new BaseStatAsset
        {
            id = "mass_2"
        });
        this.add(new BaseStatAsset
        {
            id = "multiplier_mass",
            show_as_percents = true,
            multiplier = true,
            main_stat_to_multiply = "mass_2",
            hidden = true
        });
        this.add(new BaseStatAsset
        {
            id = "limit_population"
        });
        this.add(new BaseStatAsset
        {
            id = "multiplier_health",
            show_as_percents = true,
            multiplier = true,
            main_stat_to_multiply = "health",
            tooltip_multiply_for_visual_number = 100f,
            translation_key = "health"
        });
        this.add(new BaseStatAsset
        {
            id = "multiplier_lifespan",
            show_as_percents = true,
            multiplier = true,
            main_stat_to_multiply = "lifespan",
            tooltip_multiply_for_visual_number = 100f,
            translation_key = "lifespan"
        });
        this.add(new BaseStatAsset
        {
            id = "multiplier_stamina",
            show_as_percents = true,
            multiplier = true,
            main_stat_to_multiply = "stamina",
            tooltip_multiply_for_visual_number = 100f,
            translation_key = "stamina"
        });
        this.add(new BaseStatAsset
        {
            id = "multiplier_mana",
            show_as_percents = true,
            multiplier = true,
            main_stat_to_multiply = "mana",
            tooltip_multiply_for_visual_number = 100f,
            translation_key = "mana"
        });
        this.add(new BaseStatAsset
        {
            id = "multiplier_damage",
            show_as_percents = true,
            multiplier = true,
            main_stat_to_multiply = "damage",
            tooltip_multiply_for_visual_number = 100f,
            translation_key = "damage"
        });
        this.add(new BaseStatAsset
        {
            id = "multiplier_crit",
            show_as_percents = true,
            multiplier = true,
            main_stat_to_multiply = "critical_chance",
            tooltip_multiply_for_visual_number = 100f,
            translation_key = "critical_chance"
        });
        this.add(new BaseStatAsset
        {
            id = "multiplier_diplomacy",
            show_as_percents = true,
            multiplier = true,
            main_stat_to_multiply = "diplomacy",
            tooltip_multiply_for_visual_number = 100f,
            translation_key = "diplomacy",
            used_only_for_civs = true
        });
        this.add(new BaseStatAsset
        {
            id = "multiplier_speed",
            show_as_percents = true,
            multiplier = true,
            main_stat_to_multiply = "speed",
            tooltip_multiply_for_visual_number = 100f,
            translation_key = "speed"
        });
        this.add(new BaseStatAsset
        {
            id = "multiplier_attack_speed",
            show_as_percents = true,
            multiplier = true,
            main_stat_to_multiply = "attack_speed",
            tooltip_multiply_for_visual_number = 100f,
            translation_key = "attack_speed"
        });
        this.add(new BaseStatAsset
        {
            id = "scale",
            show_as_percents = true,
            tooltip_multiply_for_visual_number = 1000f,
            translation_key = "size"
        });
        this.add(new BaseStatAsset
        {
            id = "multiplier_supply_timer",
            hidden = true,
            used_only_for_civs = true
        });
        this.add(new BaseStatAsset
        {
            id = "limit_clan_members",
            used_only_for_civs = true
        });
        this.add(new BaseStatAsset
        {
            id = "status_chance"
        });
        this.add(new BaseStatAsset
        {
            id = "damage_range",
            hidden = true,
            normalize = true,
            normalize_min = 0.1f
        });
    }

    // Token: 0x0600128D RID: 4749 RVA: 0x000D1E80 File Offset: 0x000D0080
    public override void editorDiagnosticLocales()
    {
        foreach (BaseStatAsset tAsset in this.list)
        {
            if (!tAsset.hidden)
            {
                this.checkLocale(tAsset, tAsset.getLocaleID());
            }
        }
        base.editorDiagnosticLocales();
    }
}
using System;

// Token: 0x0200008D RID: 141
// (Invoke) Token: 0x060004A0 RID: 1184
[Serializable]
public delegate bool GetHitAction(BaseSimObject pSelf, BaseSimObject pAttackedBy = null, WorldTile pTile = null);
using System;

// Token: 0x0200008C RID: 140
// (Invoke) Token: 0x0600049C RID: 1180
[Serializable]
public delegate bool AttackAction(BaseSimObject pSelf, BaseSimObject pTarget, WorldTile pTile = null);
using System;

// Token: 0x020000C9 RID: 201
// (Invoke) Token: 0x06000607 RID: 1543
public delegate bool CombatAction(AttackData pData);
using System;

// Token: 0x020000CB RID: 203
// (Invoke) Token: 0x0600060F RID: 1551
public delegate bool CombatActionActor(Actor pActor, AttackData pData, float pTargetX = 0f, float pTargetY = 0f);
using System;

// Token: 0x020000CA RID: 202
// (Invoke) Token: 0x0600060B RID: 1547
public delegate bool CombatActionCheckStart(Actor pActor, BaseSimObject pAttackTarget);
using System;
using System.Collections.Generic;
using System.Threading.Tasks;
using ai;
using ai.behaviours;
using UnityEngine;

// Token: 0x020001EF RID: 495
public class ActorManager : SimSystemManager<Actor, ActorData>
{
    // Token: 0x0600111F RID: 4383 RVA: 0x000CBFA4 File Offset: 0x000CA1A4
    public ActorManager()
    {
        this.type_id = "unit";
        this._job_manager = new JobManagerActors("actors");
        this._unit_visible_lists.Add(this.visible_units);
        this._unit_visible_lists.Add(this.visible_units_avatars);
        this._unit_visible_lists.Add(this.visible_units_alive);
        this._unit_visible_lists.Add(this.visible_units_with_status);
        this._unit_visible_lists.Add(this.visible_units_with_favorite);
        this._unit_visible_lists.Add(this.visible_units_with_banner);
        this._unit_visible_lists.Add(this.visible_units_just_ate);
        this._unit_visible_lists.Add(this.visible_units_socialize);
    }

    // Token: 0x06001120 RID: 4384 RVA: 0x000CC104 File Offset: 0x000CA304
    public void prepareForMetaChecks()
    {
        this.units_only_wild.Clear();
        this.units_only_alive.Clear();
        this.units_only_dying.Clear();
        this.units_only_civ.Clear();
        this.have_dying_units = false;
        List<Actor> tActorList = base.getSimpleList();
        for (int i = 0; i < tActorList.Count; i++)
        {
            Actor tUnit = tActorList[i];
            if (tUnit.isAlive())
            {
                if (tUnit.kingdom.wild)
                {
                    this.units_only_wild.Add(tUnit);
                }
                else
                {
                    this.units_only_civ.Add(tUnit);
                }
                this.units_only_alive.Add(tUnit);
            }
            else
            {
                this.units_only_dying.Add(tUnit);
                this.have_dying_units = true;
            }
        }
    }

    // Token: 0x06001121 RID: 4385 RVA: 0x000CC1B4 File Offset: 0x000CA3B4
    public void calculateVisibleActors()
    {
        Bench.bench("actors_prepare_lists", "game_total", false);
        this.clearLists();
        this.prepareLists();
        Bench.benchEnd("actors_prepare_lists", "game_total", false, 0L, false);
        Bench.bench("actors_fill_visible", "game_total", false);
        this.fillVisibleObjects();
        Bench.benchEnd("actors_fill_visible", "game_total", false, 0L, false);
        Bench.bench("actors_precalc_render_data_parallel", "game_total", false);
        this.precalculateRenderDataParallel();
        Bench.benchEnd("actors_precalc_render_data_parallel", "game_total", false, 0L, false);
        Bench.bench("actors_precalc_render_data_normal", "game_total", false);
        this.precalculateRenderDataNormal();
        Bench.benchEnd("actors_precalc_render_data_normal", "game_total", false, 0L, false);
    }

    // Token: 0x06001122 RID: 4386 RVA: 0x000CC274 File Offset: 0x000CA474
    private void precalculateRenderDataParallel()
    {
        int tDebugItemScale = (DebugConfig.isOn(DebugOption.RenderBigItems) ? 10 : 1);
        bool tShouldRenderUnitShadows = World.world.quality_changer.shouldRenderUnitShadows();
        int tTotalVisibleObjects = this.visible_units.count;
        Actor[] tArray = this.visible_units.array;
        int tDynamicBatchSize = 256;
        int tTotalBatches = ParallelHelper.calcTotalBatches(tTotalVisibleObjects, tDynamicBatchSize);
        Parallel.For(0, tTotalBatches, World.world.parallel_options, delegate (int pBatchIndex)
        {
            int num = ParallelHelper.calculateBatchBeg(pBatchIndex, tDynamicBatchSize);
            int tIndexEnd = ParallelHelper.calculateBatchEnd(num, tDynamicBatchSize, tTotalVisibleObjects);
            for (int tIndex = num; tIndex < tIndexEnd; tIndex++)
            {
                Actor tActor = tArray[tIndex];
                Vector3 tActorScale = tActor.current_scale;
                Vector3 tActorRotation = tActor.updateRotation();
                Vector3 tCurrentActorPos = tActor.updatePos();
                bool tHasRenderedItem = tActor.checkHasRenderedItem();
                bool tHasNormalRender = !tActor.asset.ignore_generic_render;
                Sprite tItemSpriteFinal;
                if (tHasRenderedItem)
                {
                    Sprite tItemSpriteMain = tActor.getRenderedItemSprite();
                    IHandRenderer cachedHandRendererAsset = tActor.getCachedHandRendererAsset();
                    int tColorAssetID = -900000;
                    if (cachedHandRendererAsset.is_colored)
                    {
                        tColorAssetID = tActor.kingdom.kingdomColor.GetHashCode();
                    }
                    tItemSpriteFinal = DynamicSprites.getCachedAtlasItemSprite(DynamicSprites.getItemSpriteID(tItemSpriteMain, tColorAssetID), tItemSpriteMain);
                }
                else
                {
                    tItemSpriteFinal = null;
                }
                this.render_data.positions[tIndex] = tCurrentActorPos;
                this.render_data.scales[tIndex] = tActorScale;
                this.render_data.rotations[tIndex] = tActorRotation;
                this.render_data.flip_x_states[tIndex] = tActor.flip;
                this.render_data.colors[tIndex] = tActor.color;
                this.render_data.has_normal_render[tIndex] = tHasNormalRender;
                this.render_data.shadows[tIndex] = tActor.show_shadow;
                this.render_data.has_item[tIndex] = tHasRenderedItem;
                this.render_data.item_sprites[tIndex] = tItemSpriteFinal;
                AnimationFrameData tFrameData = tActor.getAnimationFrameData();
                if (tShouldRenderUnitShadows && tActor.show_shadow)
                {
                    this.render_data.shadow_sprites[tIndex] = tActor.asset.shadow_sprite;
                    float tAbsAngle = Mathf.Abs(tActorRotation.z);
                    Vector2 tSizeShadow = tActor.asset.shadow_size * tActorScale;
                    int tFlip = (tActor.flip ? 1 : (-1));
                    float tOffsetX = tSizeShadow.x / 2f;
                    float tOffsetY = tSizeShadow.y * 0.6f;
                    Vector2 tShadowPosition = tActor.current_shadow_position;
                    tShadowPosition.x += tOffsetX * (tActorRotation.z * (float)tFlip) / 90f;
                    tShadowPosition.y -= tOffsetY * tAbsAngle / 90f;
                    this.render_data.shadow_position[tIndex] = tShadowPosition;
                    if (tFrameData != null && tFrameData.size_unit != default(Vector2))
                    {
                        float tScaleWidthLay = (tFrameData.size_unit * tActorScale).y / tSizeShadow.x * tActorScale.x;
                        float tScaleX = Mathf.Lerp(tActorScale.x, tScaleWidthLay, tAbsAngle / 90f);
                        this.render_data.shadow_scales[tIndex] = new Vector2(tScaleX, tActorScale.y);
                    }
                    else
                    {
                        this.render_data.shadow_scales[tIndex] = tActorScale;
                    }
                }
                if (tHasNormalRender)
                {
                    if (tActor.canParallelSetColoredSprite())
                    {
                        Sprite tMainSprite = tActor.calculateMainSprite();
                        this.render_data.main_sprites[tIndex] = tMainSprite;
                        if (tActor.hasColoredSprite())
                        {
                            if (!tActor.isColoredSpriteNeedsCheck(tMainSprite))
                            {
                                this.render_data.main_sprite_colored[tIndex] = tActor.getLastColoredSprite();
                            }
                            else
                            {
                                this.render_data.main_sprite_colored[tIndex] = null;
                            }
                        }
                        else
                        {
                            this.render_data.main_sprite_colored[tIndex] = tMainSprite;
                        }
                    }
                    else
                    {
                        this.render_data.main_sprites[tIndex] = null;
                        this.render_data.main_sprite_colored[tIndex] = null;
                    }
                    if (tHasRenderedItem)
                    {
                        this.render_data.item_scale[tIndex] = tActorScale * (float)tDebugItemScale;
                        float tFrameDataPosX = 0f;
                        float tFrameDataPosY = 0f;
                        if (tFrameData != null)
                        {
                            tFrameDataPosX = tFrameData.pos_item.x;
                            tFrameDataPosY = tFrameData.pos_item.y;
                        }
                        float tX = tCurrentActorPos.x + tFrameDataPosX * tActorScale.x;
                        float tY = tCurrentActorPos.y + tFrameDataPosY * tActorScale.y;
                        float tZ = -0.01f + tFrameDataPosY * tActorScale.y;
                        Vector3 tItemPosition = new Vector3(tX, tY);
                        Vector3 tAngle = tActorRotation;
                        if (tAngle.y != 0f || tAngle.z != 0f)
                        {
                            Vector3 t_pivot = new Vector3(tCurrentActorPos.x, tCurrentActorPos.y, 0f);
                            tItemPosition = Toolbox.RotatePointAroundPivot(ref tItemPosition, ref t_pivot, ref tAngle);
                        }
                        tItemPosition.z = tZ;
                        this.render_data.item_pos[tIndex] = tItemPosition;
                    }
                }
            }
        });
    }

    // Token: 0x06001123 RID: 4387 RVA: 0x000CC314 File Offset: 0x000CA514
    private void precalculateRenderDataNormal()
    {
        ActorRenderData tRenderData = this.render_data;
        int tTotalVisibleObjects = this.visible_units.count;
        Actor[] tArray = this.visible_units.array;
        for (int i = 0; i < tTotalVisibleObjects; i++)
        {
            Actor tActor = tArray[i];
            if (tRenderData.has_normal_render[i] && tRenderData.main_sprite_colored[i] == null)
            {
                Sprite tMainSprite = tRenderData.main_sprites[i];
                if (tMainSprite == null)
                {
                    tMainSprite = tActor.calculateMainSprite();
                }
                tRenderData.main_sprite_colored[i] = tActor.calculateColoredSprite(tMainSprite, true);
            }
        }
    }

    // Token: 0x06001124 RID: 4388 RVA: 0x000CC390 File Offset: 0x000CA590
    private void fillVisibleObjects()
    {
        base.prepareArray();
        Actor[] tUnits = base.getSimpleArray();
        int tCountTotal = this.Count;
        bool tRenderNormalUnits = MapBox.isRenderGameplay();
        int tCountVisible = 0;
        int tCountVisibleAlive = 0;
        Actor[] tVisible = this.visible_units.array;
        Actor[] tVisibleAlive = this.visible_units_alive.array;
        for (int i = 0; i < tCountTotal; i++)
        {
            Actor tActor = tUnits[i];
            ActorAsset tActorAsset = tActor.asset;
            TileZone tZone = tActor.current_tile.zone;
            if (tActorAsset.has_avatar_prefab)
            {
                Actor[] array = this.visible_units_avatars.array;
                ActorVisibleDataArray actorVisibleDataArray = this.visible_units_avatars;
                int count = actorVisibleDataArray.count;
                actorVisibleDataArray.count = count + 1;
                array[count] = tActor;
            }
            if (tActor.isFavorite() && !tActorAsset.hide_favorite_icon && tZone.visible && !ControllableUnit.isControllingUnit(tActor))
            {
                Actor[] array2 = this.visible_units_with_favorite.array;
                ActorVisibleDataArray actorVisibleDataArray2 = this.visible_units_with_favorite;
                int count = actorVisibleDataArray2.count;
                actorVisibleDataArray2.count = count + 1;
                array2[count] = tActor;
            }
            if (tZone.visible && tRenderNormalUnits && tActor.is_visible)
            {
                tVisible[tCountVisible++] = tActor;
                if (tActor.isAlive())
                {
                    tVisibleAlive[tCountVisibleAlive++] = tActor;
                    if (tActor.is_army_captain)
                    {
                        Actor[] array3 = this.visible_units_with_banner.array;
                        ActorVisibleDataArray actorVisibleDataArray3 = this.visible_units_with_banner;
                        int count = actorVisibleDataArray3.count;
                        actorVisibleDataArray3.count = count + 1;
                        array3[count] = tActor;
                    }
                    if (tActorAsset.render_status_effects && tActor.hasAnyStatusEffectToRender())
                    {
                        Actor[] array4 = this.visible_units_with_status.array;
                        ActorVisibleDataArray actorVisibleDataArray4 = this.visible_units_with_status;
                        int count = actorVisibleDataArray4.count;
                        actorVisibleDataArray4.count = count + 1;
                        array4[count] = tActor;
                    }
                    if (tActor.timestamp_session_ate_food > 0.0)
                    {
                        Actor[] array5 = this.visible_units_just_ate.array;
                        ActorVisibleDataArray actorVisibleDataArray5 = this.visible_units_just_ate;
                        int count = actorVisibleDataArray5.count;
                        actorVisibleDataArray5.count = count + 1;
                        array5[count] = tActor;
                    }
                    BehaviourActionActor tActorAction = tActor.ai.action;
                    if (tActorAction != null && tActorAction.socialize)
                    {
                        Actor[] array6 = this.visible_units_socialize.array;
                        ActorVisibleDataArray actorVisibleDataArray6 = this.visible_units_socialize;
                        int count = actorVisibleDataArray6.count;
                        actorVisibleDataArray6.count = count + 1;
                        array6[count] = tActor;
                    }
                    else if (tActor.is_forced_socialize_icon && !tActor.is_moving && !tActor.isLying() && tActor.isAttackReady() && Date.getMonthsSince(tActor.is_forced_socialize_timestamp) < 1)
                    {
                        Actor[] array7 = this.visible_units_socialize.array;
                        ActorVisibleDataArray actorVisibleDataArray7 = this.visible_units_socialize;
                        int count = actorVisibleDataArray7.count;
                        actorVisibleDataArray7.count = count + 1;
                        array7[count] = tActor;
                    }
                }
            }
        }
        this.visible_units.count = tCountVisible;
        this.visible_units_alive.count = tCountVisibleAlive;
    }

    // Token: 0x06001125 RID: 4389 RVA: 0x000CC620 File Offset: 0x000CA820
    public override void update(float pElapsed)
    {
        base.update(pElapsed);
        Bench.bench("actors", "game_total", false);
        base.checkContainer();
        this._job_manager.updateBase(pElapsed);
        base.checkContainer();
        Bench.benchEnd("actors", "game_total", false, 0L, false);
    }

    // Token: 0x06001126 RID: 4390 RVA: 0x000CC674 File Offset: 0x000CA874
    private void checkOverrideUnitShooting()
    {
        if (!DebugConfig.isOn(DebugOption.OverrideUnitShooting))
        {
            return;
        }
        if (!Input.GetMouseButtonDown(0))
        {
            return;
        }
        Vector2 tCursorPos = World.world.getMousePos();
        WorldTile tCursorTile = World.world.getMouseTilePos();
        Actor tCursorActor = World.world.getActorNearCursor();
        if (tCursorTile == null)
        {
            return;
        }
        foreach (Actor tActor in this)
        {
            if (tActor != tCursorActor && tActor.isAlive() && tActor.hasRangeAttack())
            {
                BaseSimObject pInitiator = tActor;
                Kingdom kingdom = tActor.kingdom;
                Vector3 pInitiatorPosition = tActor.current_position;
                AttackData tAttackData = new AttackData(pInitiator, tCursorTile, tCursorPos, pInitiatorPosition, null, kingdom, AttackType.Weapon, false, true, false, tActor.getWeaponAsset().projectile, null, 0f);
                CombatActionLibrary.combat_attack_range.action(tAttackData);
            }
        }
    }

    // Token: 0x06001127 RID: 4391 RVA: 0x000CC760 File Offset: 0x000CA960
    protected override void destroyObject(Actor pActor)
    {
        base.destroyObject(pActor);
        if (pActor.hasKingdom())
        {
            pActor.setKingdom(null);
        }
        if (pActor.hasSubspecies())
        {
            pActor.setSubspecies(null);
        }
        if (pActor.tile_target != null)
        {
            pActor.clearTileTarget();
        }
        pActor.asset.units.Remove(pActor);
        this.removeObject(pActor);
        this._job_manager.removeObject(pActor, pActor.batch);
        if (pActor.avatar != null)
        {
            Object.Destroy(pActor.avatar);
            pActor.avatar = null;
        }
        if (pActor.idle_loop_sound != null)
        {
            pActor.idle_loop_sound.stop();
        }
    }

    // Token: 0x06001128 RID: 4392 RVA: 0x000CC7FE File Offset: 0x000CA9FE
    public override void loadFromSave(List<ActorData> pList)
    {
        base.loadFromSave(pList);
        base.checkContainer();
    }

    // Token: 0x06001129 RID: 4393 RVA: 0x000CC810 File Offset: 0x000CAA10
    public Actor evolutionEvent(Actor pTargetActor, bool pWithBiomeEffect, bool pAscension)
    {
        Subspecies tOriginalSubspecies = pTargetActor.subspecies;
        bool tNewSubspecies = false;
        Subspecies tEvolvedSubspecies = null;
        string tNewActorAssetId = pTargetActor.asset.id;
        if (tOriginalSubspecies.hasEvolvedIntoForm())
        {
            tEvolvedSubspecies = tOriginalSubspecies.getEvolvedInto();
            if (tEvolvedSubspecies != null)
            {
                tNewActorAssetId = tEvolvedSubspecies.getActorAsset().id;
            }
        }
        if (tEvolvedSubspecies == null)
        {
            bool tNewAsset = false;
            if (pTargetActor.asset.can_evolve_into_new_species)
            {
                tNewAsset = Randy.randomBool();
                if (tNewAsset)
                {
                    tNewActorAssetId = pTargetActor.asset.evolution_id;
                }
            }
            if (!tNewAsset)
            {
                Subspecies subspecies = World.world.subspecies.newSpecies(pTargetActor.asset, pTargetActor.current_tile, true);
                tNewSubspecies = true;
                subspecies.mutateFrom(tOriginalSubspecies);
                tEvolvedSubspecies = subspecies;
            }
        }
        if (tEvolvedSubspecies == null)
        {
            tEvolvedSubspecies = World.world.subspecies.newSpecies(AssetManager.actor_library.get(tNewActorAssetId), pTargetActor.current_tile, false);
            tNewSubspecies = true;
            tEvolvedSubspecies.mutateFrom(tOriginalSubspecies);
        }
        if (tNewSubspecies)
        {
            tEvolvedSubspecies.addTrait("uplifted", false);
            tEvolvedSubspecies.makeSapient();
            tEvolvedSubspecies.data.biome_variant = tOriginalSubspecies.data.biome_variant;
        }
        ActorAsset tAsset = AssetManager.actor_library.get(tNewActorAssetId);
        pTargetActor.setAsset(tAsset);
        pTargetActor.setSubspecies(tEvolvedSubspecies);
        tOriginalSubspecies.setEvolutionSubspecies(tEvolvedSubspecies);
        tEvolvedSubspecies.data.parent_subspecies = tOriginalSubspecies.id;
        if (pAscension && !tEvolvedSubspecies.name.Contains("Ascentus"))
        {
            SubspeciesData data = tEvolvedSubspecies.data;
            data.name += " Ascentus";
        }
        if (pWithBiomeEffect && Randy.randomChance(0.1f))
        {
            BiomeAsset tBiome = pTargetActor.current_tile.getBiome();
            if (tBiome != null && tBiome.evolution_trait_subspecies != null && tBiome.evolution_trait_subspecies.Count > 0)
            {
                SubspeciesTrait tTrait = AssetManager.subspecies_traits.get(tBiome.evolution_trait_subspecies.GetRandom<string>());
                if (tTrait != null)
                {
                    tEvolvedSubspecies.addTrait(tTrait, false);
                }
            }
        }
        pTargetActor.clearGraphicsFully();
        pTargetActor.makeConfused(-1f, false);
        pTargetActor.increaseEvolutions();
        return pTargetActor;
    }

    // Token: 0x0600112A RID: 4394 RVA: 0x000CC9DC File Offset: 0x000CABDC
    public bool cloneUnit(Actor pCloneFrom, WorldTile pTileTarget = null)
    {
        if (pCloneFrom == null)
        {
            return false;
        }
        if (!pCloneFrom.asset.can_be_cloned)
        {
            return false;
        }
        pCloneFrom.prepareForSave();
        ActorData tOriginalData = pCloneFrom.data;
        string tName = pCloneFrom.getName();
        ActorData tNewBabyData = new ActorData();
        ActorTool.copyImportantData(tOriginalData, tNewBabyData, true);
        tNewBabyData.created_time = World.world.getCurWorldTime();
        tNewBabyData.id = World.world.map_stats.getNextId("unit");
        tNewBabyData.name = tName;
        tNewBabyData.age_overgrowth = tOriginalData.getAge();
        if (pTileTarget == null)
        {
            pTileTarget = pCloneFrom.current_tile.neighboursAll.GetRandom<WorldTile>();
        }
        tNewBabyData.x = pTileTarget.x;
        tNewBabyData.y = pTileTarget.y;
        Actor tCloneActor = World.world.units.loadObject(tNewBabyData);
        tCloneActor.addTrait("fragile_health", false);
        foreach (ActorTrait tTrait in pCloneFrom.getTraits())
        {
            tCloneActor.addTrait(tTrait, false);
        }
        tCloneActor.addTrait("miracle_born", false);
        if (!pCloneFrom.hasFamily() && pCloneFrom.asset.create_family_at_spawn)
        {
            World.world.families.newFamily(pCloneFrom, pCloneFrom.current_tile, null);
        }
        tCloneActor.data.cloneCustomDataFrom(pCloneFrom.data);
        tCloneActor.setReligion(pCloneFrom.religion);
        tCloneActor.setClan(pCloneFrom.clan);
        tCloneActor.setCulture(pCloneFrom.culture);
        tCloneActor.setSubspecies(pCloneFrom.subspecies);
        tCloneActor.joinLanguage(pCloneFrom.language);
        tCloneActor.setFamily(pCloneFrom.family);
        tCloneActor.setHealth(tOriginalData.health, false);
        tCloneActor.setMana(tOriginalData.mana, false);
        tCloneActor.setStamina(tOriginalData.stamina, false);
        tCloneActor.setHappiness(tOriginalData.happiness, false);
        tCloneActor.setNutrition(tOriginalData.nutrition, false);
        tCloneActor.setParent1(pCloneFrom, false);
        tCloneActor.addTrait("clone", false);
        if (tOriginalData.saved_items != null)
        {
            foreach (long tID in tOriginalData.saved_items)
            {
                Item tItem = World.world.items.get(tID);
                if (tItem != null)
                {
                    Item tNewItem = World.world.items.generateItem(tItem.getAsset(), null, null, 1, pCloneFrom, 0, false);
                    tNewItem.data.modifiers.Clear();
                    tNewItem.data.modifiers.AddRange(tItem.data.modifiers);
                    tNewItem.data.modifiers.Remove("eternal");
                    tNewItem.initItem();
                    tCloneActor.equipment.setItem(tNewItem, tCloneActor);
                }
            }
        }
        tCloneActor.applyRandomForce(1.5f, 2f);
        if (tCloneActor.isRendered())
        {
            EffectsLibrary.spawn("fx_spawn", pTileTarget, null, null, 0f, -1f, -1f, null);
        }
        if (tCloneActor.asset.has_sound_spawn)
        {
            MusicBox.playSound(tCloneActor.asset.sound_spawn, pTileTarget, false, false);
        }
        return true;
    }

    // Token: 0x0600112B RID: 4395 RVA: 0x000CCD10 File Offset: 0x000CAF10
    public Actor createNewUnit(string pStatsID, WorldTile pTile, bool pMiracleSpawn = false, float pSpawnHeight = 0f, Subspecies pSubspecies = null, Subspecies pSubspeciesMutateFrom = null, bool pSpawnWithItems = true, bool pAdultAge = false, bool pGiveOwnerlessItems = false)
    {
        ActorAsset tAsset = AssetManager.actor_library.get(pStatsID);
        if (tAsset == null)
        {
            return null;
        }
        Actor tActor = base.newObject();
        tActor.setAsset(tAsset);
        if (!pSubspecies.isRekt())
        {
            tActor.setSubspecies(pSubspecies);
        }
        else
        {
            this.checkNewSpecies(tAsset, pTile, tActor, false, pSubspeciesMutateFrom);
        }
        this.addRandomTraitFromBiomeToActor(tActor, pTile);
        this.finalizeActor(pStatsID, tActor, pTile, pSpawnHeight);
        if (pMiracleSpawn || pAdultAge)
        {
            if (pMiracleSpawn)
            {
                tActor.addTrait("miracle_born", false);
            }
            if (tActor.hasSubspecies())
            {
                tActor.data.age_overgrowth = (int)Math.Ceiling((double)tActor.subspecies.age_breeding);
            }
            else
            {
                tActor.data.age_overgrowth = tAsset.age_spawn;
            }
            if (HotkeyLibrary.isHoldingAlt())
            {
                tActor.data.age_overgrowth = 0;
            }
        }
        tActor.newCreature();
        if (pSpawnWithItems)
        {
            tActor.generateDefaultSpawnWeapons(pGiveOwnerlessItems);
        }
        tActor.clearSprites();
        return tActor;
    }

    // Token: 0x0600112C RID: 4396 RVA: 0x000CCDEC File Offset: 0x000CAFEC
    private void finalizeActor(string pStats, Actor pActor, WorldTile pTile, float pZHeight = 0f)
    {
        ActorAsset tAsset = AssetManager.actor_library.get(pStats);
        pActor.setAsset(tAsset);
        ActorData tData = pActor.data;
        pActor.spawnOn(pTile, pZHeight);
        if (tData.subspecies.hasValue())
        {
            pActor.setSubspecies(World.world.subspecies.get(tData.subspecies));
        }
        if (tData.family.hasValue())
        {
            pActor.setFamily(World.world.families.get(tData.family));
        }
        if (tData.language.hasValue())
        {
            pActor.setLanguage(World.world.languages.get(tData.language));
        }
        if (tData.plot.hasValue())
        {
            pActor.setPlot(World.world.plots.get(tData.plot));
        }
        if (tData.religion.hasValue())
        {
            pActor.setReligion(World.world.religions.get(tData.religion));
        }
        if (tData.clan.hasValue())
        {
            pActor.setClan(World.world.clans.get(tData.clan));
        }
        if (tData.culture.hasValue())
        {
            pActor.setCulture(World.world.cultures.get(tData.culture));
        }
        if (tData.army.hasValue())
        {
            pActor.setArmy(World.world.armies.get(tData.army));
        }
        pActor.create();
        pActor.checkDefaultKingdom();
        pActor.checkDefaultProfession();
        pActor.updateStats();
        if (pActor.asset.can_be_killed_by_stuff)
        {
            pActor.batch.c_main_tile_action.Add(pActor);
        }
    }

    // Token: 0x0600112D RID: 4397 RVA: 0x000CCF94 File Offset: 0x000CB194
    public Actor createActorFromData(ActorData pData, WorldTile pTile, City pCity)
    {
        ActorAsset tStats = AssetManager.actor_library.get(pData.asset_id);
        Actor tActor = base.loadObject(pData);
        tActor.setData(pData);
        this.finalizeActor(tStats.id, tActor, pTile, 0f);
        tActor.setCity(pCity);
        return tActor;
    }

    // Token: 0x0600112E RID: 4398 RVA: 0x000CCFDC File Offset: 0x000CB1DC
    public Actor spawnNewUnitByPlayer(string pStatsID, WorldTile pTile, bool pSpawnSound = false, bool pMiracleSpawn = false, float pSpawnHeight = 6f, Subspecies pSubspecies = null)
    {
        Actor tActor = this.spawnNewUnit(pStatsID, pTile, pSpawnSound, pMiracleSpawn, pSpawnHeight, pSubspecies, true);
        if (tActor.current_zone.hasCity() && tActor.isSapient())
        {
            City tCity = tActor.current_zone.city;
            if (!tCity.isNeutral() && tCity.isPossibleToJoin(tActor))
            {
                tActor.joinCity(tCity);
            }
        }
        return tActor;
    }

    // Token: 0x0600112F RID: 4399 RVA: 0x000CD034 File Offset: 0x000CB234
    public Actor spawnNewUnit(string pStatsID, WorldTile pTile, bool pSpawnSound = false, bool pMiracleSpawn = false, float pSpawnHeight = 6f, Subspecies pSubspecies = null, bool pGiveOwnerlessItems = false)
    {
        Actor tUnit = this.createNewUnit(pStatsID, pTile, pMiracleSpawn, pSpawnHeight, pSubspecies, null, true, false, pGiveOwnerlessItems);
        if (pSpawnSound && tUnit.asset.has_sound_spawn)
        {
            MusicBox.playSound(tUnit.asset.sound_spawn, (float)pTile.pos.x, (float)pTile.pos.y, false, false);
        }
        Kingdom tNomadKingdom = World.world.kingdoms_wild.get(tUnit.asset.kingdom_id_wild);
        tUnit.setKingdom(tNomadKingdom);
        tUnit.setStatsDirty();
        tUnit.setNutrition(SimGlobals.m.nutrition_level_on_spawn, true);
        return tUnit;
    }

    // Token: 0x06001130 RID: 4400 RVA: 0x000CD0D0 File Offset: 0x000CB2D0
    private void checkNewSpecies(ActorAsset pAsset, WorldTile pTile, Actor pActor, bool pGlobalSearch = false, Subspecies pSubspeciesMutateFrom = null)
    {
        if (!pAsset.can_have_subspecies)
        {
            return;
        }
        Subspecies tSubspecies = null;
        if (pGlobalSearch)
        {
            foreach (Subspecies tExistingSubspecies in World.world.subspecies)
            {
                if (tExistingSubspecies.isSpecies(pAsset.id))
                {
                    tSubspecies = tExistingSubspecies;
                    break;
                }
            }
        }
        if (tSubspecies == null)
        {
            Actor tClosestActor;
            tSubspecies = World.world.subspecies.getNearbySpecies(pAsset, pTile, out tClosestActor, true);
        }
        if (tSubspecies == null)
        {
            tSubspecies = World.world.subspecies.newSpecies(pAsset, pTile, false);
            if (pSubspeciesMutateFrom != null)
            {
                tSubspecies.mutateFrom(pSubspeciesMutateFrom);
            }
            tSubspecies.forceRecalcBaseStats();
        }
        pActor.setSubspecies(tSubspecies);
        pActor.event_full_stats = true;
        pActor.setStatsDirty();
    }

    // Token: 0x06001131 RID: 4401 RVA: 0x000CD190 File Offset: 0x000CB390
    public ActorTrait addRandomTraitFromBiomeToActor(Actor pActor, WorldTile pTile)
    {
        if (!pTile.Type.is_biome)
        {
            return null;
        }
        BiomeAsset tBiomeAsset = pTile.Type.biome_asset;
        List<string> spawn_trait_actor = tBiomeAsset.spawn_trait_actor;
        if (spawn_trait_actor != null && spawn_trait_actor.Count > 0 && Randy.randomBool())
        {
            string tRandomTraitID = tBiomeAsset.spawn_trait_actor.GetRandom<string>();
            ActorTrait tTrait = AssetManager.traits.get(tRandomTraitID);
            pActor.addTrait(tTrait, false);
            return tTrait;
        }
        return null;
    }

    // Token: 0x06001132 RID: 4402 RVA: 0x000CD1FC File Offset: 0x000CB3FC
    public override Actor loadObject(ActorData pData)
    {
        if (this.dict.ContainsKey(pData.id))
        {
            Debug.Log("Trying to load unit with same ID, that already is loaded. " + pData.id.ToString());
            return null;
        }
        WorldTile tTile = World.world.GetTile(pData.x, pData.y);
        if (tTile == null)
        {
            return null;
        }
        ActorAsset tAsset = AssetManager.actor_library.get(pData.asset_id);
        if (tAsset == null)
        {
            return null;
        }
        int tSavedHealth = pData.health;
        int tSavedNutrition = pData.nutrition;
        int tSavedStamina = pData.stamina;
        int tSavedMana = pData.mana;
        Actor tActor = base.loadObject(pData);
        tActor.setData(pData);
        this.finalizeActor(tAsset.id, tActor, tTile, 0f);
        if (tActor.canUseItems())
        {
            tActor.equipment.load(pData.saved_items, tActor);
        }
        if (tActor.isSapient())
        {
            tActor.reloadInventory();
        }
        tActor.loadFromSave();
        tActor.updateStats();
        tActor.setHealth(tSavedHealth, true);
        tActor.setNutrition(tSavedNutrition, true);
        tActor.setStamina(tSavedStamina, true);
        tActor.setMana(tSavedMana, true);
        if (tActor.asset.can_have_subspecies && !tActor.hasSubspecies())
        {
            this.checkNewSpecies(tActor.asset, tActor.current_tile, tActor, true, null);
        }
        tActor.makeWait(Randy.randomFloat(0.1f, 2f));
        return tActor;
    }

    // Token: 0x06001133 RID: 4403 RVA: 0x000CD359 File Offset: 0x000CB559
    protected override void addObject(Actor pObject)
    {
        base.addObject(pObject);
        this._job_manager.addNewObject(pObject);
    }

    // Token: 0x06001134 RID: 4404 RVA: 0x000CD370 File Offset: 0x000CB570
    private void clearLists()
    {
        for (int i = 0; i < this._unit_visible_lists.Count; i++)
        {
            this._unit_visible_lists[i].count = 0;
        }
    }

    // Token: 0x06001135 RID: 4405 RVA: 0x000CD3A8 File Offset: 0x000CB5A8
    private void prepareLists()
    {
        for (int i = 0; i < this._unit_visible_lists.Count; i++)
        {
            this._unit_visible_lists[i].prepare(this.Count);
        }
        this.render_data.checkSize(this.Count);
        base.checkContainer();
    }

    // Token: 0x06001136 RID: 4406 RVA: 0x000CD3FC File Offset: 0x000CB5FC
    public override void clear()
    {
        this._job_manager.clear();
        this.cached_sleeping_units.Clear();
        this.clearLists();
        base.checkContainer();
        foreach (Actor tActor in this)
        {
            base.scheduleDestroy(tActor);
        }
        base.checkObjectsToDestroy();
        base.clear();
    }

    // Token: 0x06001137 RID: 4407 RVA: 0x000CD474 File Offset: 0x000CB674
    public void debugJobManager(DebugTool pTool)
    {
        this._job_manager.debug(pTool);
    }

    // Token: 0x06001138 RID: 4408 RVA: 0x000CD482 File Offset: 0x000CB682
    public JobManagerActors getJobManager()
    {
        return this._job_manager;
    }

    // Token: 0x06001139 RID: 4409 RVA: 0x000CD48C File Offset: 0x000CB68C
    public void checkSleepingUnits()
    {
        if (World.world.getWorldTimeElapsedSince(this._timestamp_sleeping_units) < 10f)
        {
            return;
        }
        this.cached_sleeping_units.Clear();
        this._timestamp_sleeping_units = World.world.getCurWorldTime();
        foreach (Status tStatus in World.world.statuses.list.LoopRandom<Status>())
        {
            if (!tStatus.is_finished && !(tStatus.asset.id != "sleeping"))
            {
                Actor tActor = tStatus.sim_object.a;
                if (tActor.isAlive())
                {
                    this.cached_sleeping_units.Add(tActor);
                    if (this.cached_sleeping_units.Count > 10)
                    {
                        break;
                    }
                }
            }
        }
    }

    // Token: 0x04000F7A RID: 3962
    private JobManagerActors _job_manager;

    // Token: 0x04000F7B RID: 3963
    public ActorRenderData render_data = new ActorRenderData(4096);

    // Token: 0x04000F7C RID: 3964
    public ActorVisibleDataArray visible_units_avatars = new ActorVisibleDataArray();

    // Token: 0x04000F7D RID: 3965
    public ActorVisibleDataArray visible_units = new ActorVisibleDataArray();

    // Token: 0x04000F7E RID: 3966
    public ActorVisibleDataArray visible_units_alive = new ActorVisibleDataArray();

    // Token: 0x04000F7F RID: 3967
    public ActorVisibleDataArray visible_units_with_status = new ActorVisibleDataArray();

    // Token: 0x04000F80 RID: 3968
    public ActorVisibleDataArray visible_units_with_favorite = new ActorVisibleDataArray();

    // Token: 0x04000F81 RID: 3969
    public ActorVisibleDataArray visible_units_with_banner = new ActorVisibleDataArray();

    // Token: 0x04000F82 RID: 3970
    public ActorVisibleDataArray visible_units_just_ate = new ActorVisibleDataArray();

    // Token: 0x04000F83 RID: 3971
    public ActorVisibleDataArray visible_units_socialize = new ActorVisibleDataArray();

    // Token: 0x04000F84 RID: 3972
    private double _timestamp_sleeping_units;

    // Token: 0x04000F85 RID: 3973
    public List<Actor> cached_sleeping_units = new List<Actor>();

    // Token: 0x04000F86 RID: 3974
    private List<ActorVisibleDataArray> _unit_visible_lists = new List<ActorVisibleDataArray>();

    // Token: 0x04000F87 RID: 3975
    public bool have_dying_units;

    // Token: 0x04000F88 RID: 3976
    public List<Actor> units_only_wild = new List<Actor>();

    // Token: 0x04000F89 RID: 3977
    public List<Actor> units_only_civ = new List<Actor>();

    // Token: 0x04000F8A RID: 3978
    public List<Actor> units_only_alive = new List<Actor>();

    // Token: 0x04000F8B RID: 3979
    public List<Actor> units_only_dying = new List<Actor>();
}
using System;
using System.Collections.Generic;

// Token: 0x02000179 RID: 377
public class StatusManager : CoreSystemManager<Status, StatusData>
{
    // Token: 0x06000B32 RID: 2866 RVA: 0x000A1801 File Offset: 0x0009FA01
    public StatusManager()
    {
        this.type_id = "statuses";
    }

    // Token: 0x06000B33 RID: 2867 RVA: 0x000A1814 File Offset: 0x0009FA14
    public Status newStatus(BaseSimObject pSimObject, StatusAsset pAsset, float pOverrideTimer)
    {
        Status tStatus = base.newObject();
        tStatus.start(pSimObject, pAsset);
        if (pOverrideTimer > 0f)
        {
            tStatus.setDuration(pOverrideTimer);
        }
        return tStatus;
    }

    // Token: 0x06000B34 RID: 2868 RVA: 0x000A1840 File Offset: 0x0009FA40
    public override void update(float pElapsed)
    {
        base.update(pElapsed);
        this.updateStatuses(pElapsed);
        this.checkDead();
    }

    // Token: 0x06000B35 RID: 2869 RVA: 0x000A1856 File Offset: 0x0009FA56
    public override void removeObject(Status pObject)
    {
        base.removeObject(pObject);
        pObject.sim_object.removeFinishedStatusEffect(pObject);
    }

    // Token: 0x06000B36 RID: 2870 RVA: 0x000A186C File Offset: 0x0009FA6C
    private void updateStatuses(float pElapsed)
    {
        float tWorldTime = (float)World.world.getCurWorldTime();
        bool tPaused = World.world.isPaused();
        List<Status> tList = this.list;
        for (int i = 0; i < tList.Count; i++)
        {
            Status tStatus = tList[i];
            if (!tStatus.is_finished)
            {
                if (!tPaused)
                {
                    tStatus.update(pElapsed, tWorldTime);
                }
                if (!tPaused || tStatus.asset.is_animated_in_pause)
                {
                    tStatus.updateAnimationFrame(pElapsed);
                }
            }
        }
    }

    // Token: 0x06000B37 RID: 2871 RVA: 0x000A18E0 File Offset: 0x0009FAE0
    private void checkDead()
    {
        for (int i = this.list.Count - 1; i >= 0; i--)
        {
            Status Status = this.list[i];
            if (Status.is_finished)
            {
                this.removeObject(Status);
            }
        }
    }
}
using System;
using System.Runtime.CompilerServices;

// Token: 0x0200016C RID: 364
public class Status : CoreSystemObject<StatusData>
{
    // Token: 0x1700003E RID: 62
    // (get) Token: 0x06000AD9 RID: 2777 RVA: 0x0009E070 File Offset: 0x0009C270
    public int get_sprites_count
    {
        get
        {
            return this._asset.get_sprites_count(this._sim_object, this._asset);
        }
    }

    // Token: 0x06000ADA RID: 2778 RVA: 0x0009E08E File Offset: 0x0009C28E
    public void setDuration(float pDuration)
    {
        this._end_time = World.world.getCurWorldTime() + (double)pDuration;
        this.duration = pDuration;
        this._finished = false;
    }

    // Token: 0x06000ADB RID: 2779 RVA: 0x0009E0B1 File Offset: 0x0009C2B1
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public double getRemainingTime()
    {
        return this._end_time - World.world.getCurWorldTime();
    }

    // Token: 0x06000ADC RID: 2780 RVA: 0x0009E0C4 File Offset: 0x0009C2C4
    protected override void setDefaultValues()
    {
        this._finished = false;
        this._action_timer = 0f;
        this._anim_frame = 0;
        this._anim_time_between_frames = 0f;
        this._anim_timer = 0f;
        this.flip_x = false;
        this._end_time = 0.0;
        this.duration = 0f;
        this._sim_object = null;
        this._has_action = false;
        this._is_animated = false;
    }

    // Token: 0x06000ADD RID: 2781 RVA: 0x0009E138 File Offset: 0x0009C338
    public void start(BaseSimObject pSimObject, StatusAsset pAsset)
    {
        this._sim_object = pSimObject;
        this._asset = pAsset;
        this._action_timer = this._asset.action_interval;
        this.setDuration(this._asset.duration);
        if (this._asset.random_frame)
        {
            this._anim_frame = Randy.randomInt(0, this.get_sprites_count);
        }
        if (this._asset.random_flip)
        {
            this.flip_x = Randy.randomBool();
        }
        if (this._asset.sprite_list != null)
        {
            this._anim_time_between_frames = this._asset.animation_speed + Randy.randomFloat(0f, this._asset.animation_speed_random);
            this._anim_timer = this._anim_time_between_frames;
        }
        this._has_action = this._asset.action != null;
        this._is_animated = this._asset.animated && this._asset.texture != null;
    }

    // Token: 0x06000ADE RID: 2782 RVA: 0x0009E228 File Offset: 0x0009C428
    internal void updateAnimationFrame(float pElapsed)
    {
        if (!this._is_animated)
        {
            return;
        }
        this._anim_timer -= pElapsed;
        if (this._anim_timer <= 0f)
        {
            int tFrameCount = this.get_sprites_count;
            this._anim_timer = this._anim_time_between_frames;
            this._anim_frame++;
            if (this._anim_frame >= tFrameCount && this._asset.loop)
            {
                this._anim_frame = 0;
                return;
            }
            if (this._anim_frame >= tFrameCount)
            {
                this._anim_frame = tFrameCount - 1;
            }
        }
    }

    // Token: 0x06000ADF RID: 2783 RVA: 0x0009E2AC File Offset: 0x0009C4AC
    private void updateActionTimer(float pElapsed)
    {
        float tActionInterval = this._asset.action_interval;
        if (this._action_timer > 0f)
        {
            this._action_timer -= pElapsed;
            return;
        }
        this._action_timer = tActionInterval;
        if (this._sim_object.isAlive())
        {
            WorldAction action = this._asset.action;
            if (action == null)
            {
                return;
            }
            action(this._sim_object, this._sim_object.current_tile);
        }
    }

    // Token: 0x06000AE0 RID: 2784 RVA: 0x0009E31C File Offset: 0x0009C51C
    public void update(float pElapsed, float pWorldTime)
    {
        if (this._has_action)
        {
            this.updateActionTimer(pElapsed);
        }
        if ((double)pWorldTime >= this._end_time)
        {
            this.finish();
            if (this._sim_object.isAlive())
            {
                WorldAction action_finish = this._asset.action_finish;
                if (action_finish == null)
                {
                    return;
                }
                action_finish(this._sim_object, this._sim_object.current_tile);
            }
        }
    }

    // Token: 0x06000AE1 RID: 2785 RVA: 0x0009E37C File Offset: 0x0009C57C
    public void finish()
    {
        this._finished = true;
    }

    // Token: 0x1700003F RID: 63
    // (get) Token: 0x06000AE2 RID: 2786 RVA: 0x0009E385 File Offset: 0x0009C585
    public BaseSimObject sim_object
    {
        get
        {
            return this._sim_object;
        }
    }

    // Token: 0x17000040 RID: 64
    // (get) Token: 0x06000AE3 RID: 2787 RVA: 0x0009E38D File Offset: 0x0009C58D
    public bool is_finished
    {
        get
        {
            return this._finished;
        }
    }

    // Token: 0x17000041 RID: 65
    // (get) Token: 0x06000AE4 RID: 2788 RVA: 0x0009E395 File Offset: 0x0009C595
    public StatusAsset asset
    {
        get
        {
            return this._asset;
        }
    }

    // Token: 0x17000042 RID: 66
    // (get) Token: 0x06000AE5 RID: 2789 RVA: 0x0009E39D File Offset: 0x0009C59D
    public int anim_frame
    {
        get
        {
            return this._anim_frame;
        }
    }

    // Token: 0x04000A8B RID: 2699
    private float _action_timer;

    // Token: 0x04000A8C RID: 2700
    private StatusAsset _asset;

    // Token: 0x04000A8D RID: 2701
    private bool _finished;

    // Token: 0x04000A8E RID: 2702
    private BaseSimObject _sim_object;

    // Token: 0x04000A8F RID: 2703
    private int _anim_frame;

    // Token: 0x04000A90 RID: 2704
    private float _anim_time_between_frames;

    // Token: 0x04000A91 RID: 2705
    private float _anim_timer;

    // Token: 0x04000A92 RID: 2706
    public bool flip_x;

    // Token: 0x04000A93 RID: 2707
    private double _end_time;

    // Token: 0x04000A94 RID: 2708
    public float duration;

    // Token: 0x04000A95 RID: 2709
    private bool _has_action;

    // Token: 0x04000A96 RID: 2710
    private bool _is_animated;
}
using System;
using System.Collections.Generic;
using Beebyte.Obfuscator;
using UnityEngine;

// Token: 0x02000178 RID: 376
[ObfuscateLiterals]
public class StatusLibrary : AssetLibrary<StatusAsset>
{
    // Token: 0x06000B10 RID: 2832 RVA: 0x0009E4E4 File Offset: 0x0009C6E4
    public override void init()
    {
        base.init();
        this.add(new StatusAsset
        {
            id = "recovery_plot",
            locale_id = "status_title_recovery_plot",
            locale_description = "status_description_recovery_plot",
            duration = 60f,
            path_icon = "ui/Icons/iconRecoveryPlot"
        });
        this.add(new StatusAsset
        {
            id = "voices_in_my_head",
            locale_id = "status_title_voices_in_my_head",
            locale_description = "status_description_voices_in_my_head",
            duration = 180f,
            path_icon = "ui/Icons/iconVoicesInMyHead"
        });
        this.t.base_stats["diplomacy"] = -5f;
        this.t.base_stats["personality_rationality"] = -0.3f;
        this.t.base_stats["opinion"] = -5f;
        this.add(new StatusAsset
        {
            id = "recovery_spell",
            locale_id = "status_title_recovery_spell",
            locale_description = "status_description_recovery_spell",
            duration = 5f,
            path_icon = "ui/Icons/iconRecoverySpell"
        });
        this.add(new StatusAsset
        {
            id = "recovery_social",
            locale_id = "status_title_recovery_social",
            locale_description = "status_description_recovery_social",
            duration = 60f,
            path_icon = "ui/Icons/iconRecoverySocial"
        });
        this.add(new StatusAsset
        {
            id = "recovery_combat_action",
            locale_id = "status_title_recovery_combat_action",
            locale_description = "status_description_recovery_combat_action",
            duration = 1f,
            path_icon = "ui/Icons/iconRecoveryCombatAction"
        });
        StatusAsset statusAsset = new StatusAsset();
        statusAsset.id = "starving";
        statusAsset.locale_id = "status_title_starvation";
        statusAsset.locale_description = "status_description_starvation";
        statusAsset.duration = 60f;
        statusAsset.path_icon = "ui/Icons/iconHungry";
        statusAsset.action_on_receive = (BaseSimObject pActor, WorldTile _) => pActor.a.changeHappiness("starving", 0);
        statusAsset.action_interval = 5f;
        statusAsset.action = delegate (BaseSimObject pObject, WorldTile pTile)
        {
            Actor tActor = pObject.a;
            if (!tActor.isAlive())
            {
                return false;
            }
            if (!tActor.hasCity())
            {
                return false;
            }
            if (tActor.isFighting())
            {
                return false;
            }
            City tCity = tActor.city;
            if (tActor.hasTask() && tActor.ai.task.diet)
            {
                return false;
            }
            if (!tCity.hasSuitableFood(tActor.subspecies))
            {
                tActor.cancelAllBeh();
                return false;
            }
            tActor.setTask("try_to_eat_city_food", true, false, false);
            return true;
        };
        this.add(statusAsset);
        this.t.tier = StatusTier.Advanced;
        this.add(new StatusAsset
        {
            id = "sleeping",
            render_priority = 8,
            locale_id = "status_title_sleeping",
            locale_description = "status_description_sleeping",
            duration = 60f,
            animated = true,
            is_animated_in_pause = true,
            can_be_flipped = false,
            use_parent_rotation = false,
            removed_on_damage = true,
            texture = "fx_status_sleeping_t",
            path_icon = "ui/Icons/iconSleep",
            action_finish = delegate (BaseSimObject pActor, WorldTile _)
            {
                string tRandomStatus = this._pot_dreams.GetRandom<string>();
                if (!string.IsNullOrEmpty(tRandomStatus))
                {
                    pActor.a.addStatusEffect(tRandomStatus, 0f, true);
                }
                return pActor.a.changeHappiness("just_slept", 0);
            }
        });
        this.t.remove_status = AssetLibrary<StatusAsset>.a<string>(new string[] { "tantrum", "surprised" });
        this.t.tier = StatusTier.Advanced;
        this.t.base_stats.addTag("unconscious");
        StatusAsset statusAsset2 = new StatusAsset();
        statusAsset2.id = "laughing";
        statusAsset2.render_priority = 4;
        statusAsset2.locale_id = "status_title_laughing";
        statusAsset2.locale_description = "status_description_laughing";
        statusAsset2.duration = 60f;
        statusAsset2.animated = true;
        statusAsset2.is_animated_in_pause = true;
        statusAsset2.can_be_flipped = false;
        statusAsset2.use_parent_rotation = false;
        statusAsset2.removed_on_damage = true;
        statusAsset2.texture = "fx_status_laughing_t";
        statusAsset2.path_icon = "ui/Icons/iconLaughing";
        statusAsset2.action_on_receive = delegate (BaseSimObject pActor, WorldTile _)
        {
            pActor.a.playIdleSound();
            return true;
        };
        this.add(statusAsset2);
        this.t.tier = StatusTier.Advanced;
        StatusAsset statusAsset3 = new StatusAsset();
        statusAsset3.id = "singing";
        statusAsset3.render_priority = 4;
        statusAsset3.locale_id = "status_title_singing";
        statusAsset3.locale_description = "status_description_singing";
        statusAsset3.duration = 60f;
        statusAsset3.animated = true;
        statusAsset3.is_animated_in_pause = true;
        statusAsset3.can_be_flipped = false;
        statusAsset3.use_parent_rotation = false;
        statusAsset3.removed_on_damage = true;
        statusAsset3.texture = "fx_status_singing_t";
        statusAsset3.path_icon = "ui/Icons/iconSinging";
        statusAsset3.action_on_receive = delegate (BaseSimObject pActor, WorldTile _)
        {
            pActor.a.playIdleSound();
            return true;
        };
        this.add(statusAsset3);
        this.t.tier = StatusTier.Advanced;
        StatusAsset statusAsset4 = new StatusAsset();
        statusAsset4.id = "swearing";
        statusAsset4.render_priority = 4;
        statusAsset4.locale_id = "status_title_swearing";
        statusAsset4.locale_description = "status_description_swearing";
        statusAsset4.duration = 60f;
        statusAsset4.animated = true;
        statusAsset4.is_animated_in_pause = true;
        statusAsset4.can_be_flipped = false;
        statusAsset4.use_parent_rotation = false;
        statusAsset4.removed_on_damage = true;
        statusAsset4.texture = "fx_status_swearing_t";
        statusAsset4.path_icon = "ui/Icons/iconSwearing";
        statusAsset4.action_on_receive = delegate (BaseSimObject pActor, WorldTile _)
        {
            pActor.a.playIdleSound();
            return true;
        };
        this.add(statusAsset4);
        this.t.opposite_traits = AssetLibrary<StatusAsset>.a<string>(new string[] { "peaceful" });
        this.t.tier = StatusTier.Advanced;
        StatusAsset statusAsset5 = new StatusAsset();
        statusAsset5.id = "crying";
        statusAsset5.render_priority = 4;
        statusAsset5.locale_id = "status_title_crying";
        statusAsset5.locale_description = "status_description_crying";
        statusAsset5.duration = 60f;
        statusAsset5.animated = true;
        statusAsset5.is_animated_in_pause = true;
        statusAsset5.can_be_flipped = false;
        statusAsset5.use_parent_rotation = false;
        statusAsset5.removed_on_damage = true;
        statusAsset5.texture = "fx_status_crying_t";
        statusAsset5.path_icon = "ui/Icons/iconCrying";
        statusAsset5.action_on_receive = delegate (BaseSimObject pActor, WorldTile _)
        {
            pActor.a.playIdleSound();
            return true;
        };
        this.add(statusAsset5);
        this.t.tier = StatusTier.Advanced;
        StatusAsset statusAsset6 = new StatusAsset();
        statusAsset6.id = "possessed";
        statusAsset6.locale_id = "status_title_possessed";
        statusAsset6.locale_description = "status_description_possessed";
        statusAsset6.duration = 10f;
        statusAsset6.animated = true;
        statusAsset6.path_icon = "ui/Icons/iconPossessed";
        statusAsset6.action_on_receive = (BaseSimObject pActor, WorldTile _) => pActor.a.changeHappiness("just_possessed", 0);
        statusAsset6.action_interval = 0f;
        statusAsset6.action = new WorldAction(this.possessedAction);
        this.add(statusAsset6);
        this.add(new StatusAsset
        {
            id = "possessed_follower",
            locale_id = "status_title_possessed_follower",
            locale_description = "status_description_possessed_follower",
            duration = 200f,
            affects_mind = true,
            animated = true,
            is_animated_in_pause = true,
            texture = "fx_status_possessed_follower_t",
            path_icon = "ui/Icons/iconPossessed",
            decision_id = "possessed_following"
        });
        StatusAsset statusAsset7 = new StatusAsset();
        statusAsset7.id = "strange_urge";
        statusAsset7.locale_id = "status_title_strange_urge";
        statusAsset7.locale_description = "status_description_strange_urge";
        statusAsset7.duration = 100f;
        statusAsset7.animated = true;
        statusAsset7.path_icon = "ui/Icons/iconStrangeUrge";
        statusAsset7.action_on_receive = (BaseSimObject pActor, WorldTile _) => !Randy.randomChance(0.7f) && pActor.a.changeHappiness("strange_urge", 0);
        this.add(statusAsset7);
        StatusAsset statusAsset8 = new StatusAsset();
        statusAsset8.id = "tantrum";
        statusAsset8.locale_id = "status_title_tantrum";
        statusAsset8.locale_description = "status_description_tantrum";
        statusAsset8.duration = 120f;
        statusAsset8.affects_mind = true;
        statusAsset8.path_icon = "ui/Icons/iconTantrum";
        statusAsset8.action_finish = (BaseSimObject pActor, WorldTile _) => pActor.a.changeHappiness("just_had_tantrum", 0);
        statusAsset8.decision_id = "do_tantrum";
        this.add(statusAsset8);
        StatusAsset statusAsset9 = new StatusAsset();
        statusAsset9.id = "egg";
        statusAsset9.locale_id = "status_egg";
        statusAsset9.locale_description = "status_description_egg";
        statusAsset9.duration = 5f;
        statusAsset9.animated = false;
        statusAsset9.path_icon = "ui/Icons/iconEgg";
        statusAsset9.can_be_cured = true;
        statusAsset9.action_finish = delegate (BaseSimObject pActor, WorldTile _)
        {
            pActor.a.makeStunned(5f);
            if (pActor.a.isRendered())
            {
                EffectsLibrary.spawn("fx_spawn", pActor.current_tile, null, null, 0f, pActor.current_position.x, pActor.current_position.y, null);
            }
            return true;
        };
        this.add(statusAsset9);
        this.t.base_stats.addTag("immovable");
        this.t.base_stats.addTag("frozen_ai");
        this.t.base_stats["armor"] = 10f;
        StatusAsset statusAsset10 = new StatusAsset();
        statusAsset10.id = "cursed";
        statusAsset10.locale_id = "status_title_cursed";
        statusAsset10.locale_description = "status_description_cursed";
        statusAsset10.duration = 300f;
        statusAsset10.animated = false;
        statusAsset10.path_icon = "ui/Icons/iconCursed";
        statusAsset10.can_be_cured = true;
        statusAsset10.action_on_receive = (BaseSimObject pActor, WorldTile _) => pActor.a.changeHappiness("just_cursed", 0);
        this.add(statusAsset10);
        this.t.opposite_traits = AssetLibrary<StatusAsset>.a<string>(new string[] { "evil" });
        StatusAsset t = this.t;
        t.action_death = (WorldAction)Delegate.Combine(t.action_death, new WorldAction(ActionLibrary.turnIntoSkeleton));
        this.t.base_stats["loyalty_traits"] = -100f;
        this.t.base_stats["multiplier_damage"] = -0.5f;
        this.t.base_stats["multiplier_health"] = -0.5f;
        this.t.base_stats["multiplier_speed"] = -0.2f;
        this.t.base_stats["multiplier_diplomacy"] = -0.9f;
        this.t.base_stats["lifespan"] = -10f;
        this.t.base_stats["multiplier_offspring"] = -2f;
        this.add(new StatusAsset
        {
            id = "spell_silence",
            locale_id = "status_spell_silence",
            locale_description = "status_description_spell_silence",
            duration = 60f,
            animated = false,
            path_icon = "ui/Icons/iconSpellSilence"
        });
        this.add(new StatusAsset
        {
            id = "spell_boost",
            locale_id = "status_spell_boost",
            locale_description = "status_description_spell_boost",
            duration = 180f,
            animated = false,
            path_icon = "ui/Icons/iconSpellBoost"
        });
        this.t.base_stats["mana"] = 100f;
        this.t.base_stats["skill_spell"] = 0.2f;
        StatusAsset statusAsset11 = new StatusAsset();
        statusAsset11.id = "inspired";
        statusAsset11.locale_id = "status_title_inspired";
        statusAsset11.locale_description = "status_description_inspired";
        statusAsset11.duration = 60f;
        statusAsset11.animated = false;
        statusAsset11.path_icon = "ui/Icons/iconInspired";
        statusAsset11.action_finish = (BaseSimObject pActor, WorldTile _) => pActor.a.changeHappiness("just_inspired", 0);
        this.add(statusAsset11);
        this.t.base_stats["multiplier_speed"] = 0.3f;
        this.t.base_stats["multiplier_crit"] = 0.3f;
        this.t.base_stats["multiplier_attack_speed"] = 0.3f;
        this.add(new StatusAsset
        {
            id = "confused",
            locale_id = "status_title_confused",
            locale_description = "status_description_confused",
            duration = 10f,
            animated = false,
            affects_mind = true,
            path_icon = "ui/Icons/iconConfused",
            decision_id = "status_confused"
        });
        this.t.opposite_status = AssetLibrary<StatusAsset>.a<string>(new string[] { "egg" });
        this.add(new StatusAsset
        {
            id = "soul_harvested",
            locale_id = "status_title_soul_harvested",
            locale_description = "status_description_soul_harvested",
            duration = 666f,
            animated = false,
            path_icon = "ui/Icons/iconSoulHarvested",
            decision_id = "status_soul_harvested"
        });
        StatusAsset statusAsset12 = new StatusAsset();
        statusAsset12.id = "magnetized";
        statusAsset12.locale_id = "status_title_magnetized";
        statusAsset12.locale_description = "status_description_magnetized";
        statusAsset12.duration = 4f;
        statusAsset12.animated = false;
        statusAsset12.path_icon = "ui/Icons/iconMagnetized";
        statusAsset12.action_on_receive = (BaseSimObject pSelf, WorldTile _) => pSelf.a.changeHappiness("just_magnetised", 0);
        this.add(statusAsset12);
        this.add(new StatusAsset
        {
            id = "rage",
            locale_id = "status_title_rage",
            locale_description = "status_description_rage",
            duration = 300f,
            animated = false,
            affects_mind = true,
            path_icon = "ui/Icons/iconRage"
        });
        this.t.base_stats["multiplier_damage"] = 1f;
        StatusAsset statusAsset13 = new StatusAsset();
        statusAsset13.id = "surprised";
        statusAsset13.render_priority = 9;
        statusAsset13.locale_id = "status_title_surprised";
        statusAsset13.locale_description = "status_description_surprised";
        statusAsset13.duration = 2f;
        statusAsset13.texture = "fx_status_surprised_t";
        statusAsset13.animated = true;
        statusAsset13.is_animated_in_pause = true;
        statusAsset13.loop = false;
        statusAsset13.use_parent_rotation = false;
        statusAsset13.path_icon = "ui/Icons/iconSurprised";
        statusAsset13.offset_y = 1f;
        statusAsset13.offset_y_ui = 0.65f;
        statusAsset13.action_on_receive = (BaseSimObject pSelf, WorldTile _) => pSelf.a.changeHappiness("just_surprised", 0);
        this.add(statusAsset13);
        this.add(new StatusAsset
        {
            id = "on_guard",
            render_priority = 8,
            locale_id = "status_title_on_guard",
            locale_description = "status_description_on_guard",
            duration = 60f,
            use_parent_rotation = false,
            path_icon = "ui/Icons/iconOnGuard"
        });
        StatusAsset statusAsset14 = new StatusAsset();
        statusAsset14.id = "angry";
        statusAsset14.locale_id = "status_title_angry";
        statusAsset14.locale_description = "status_description_angry";
        statusAsset14.duration = 60f;
        statusAsset14.use_parent_rotation = false;
        statusAsset14.path_icon = "ui/Icons/iconAngry";
        statusAsset14.animated = true;
        statusAsset14.is_animated_in_pause = true;
        statusAsset14.texture = "fx_status_angry_t";
        statusAsset14.action_finish = delegate (BaseSimObject pActor, WorldTile _)
        {
            pActor.a.finishAngryStatus();
            return true;
        };
        this.add(statusAsset14);
        this.t.opposite_traits = AssetLibrary<StatusAsset>.a<string>(new string[] { "peaceful" });
        this.add(new StatusAsset
        {
            id = "just_ate",
            locale_id = "status_title_just_ate",
            locale_description = "status_description_just_ate",
            duration = 200f,
            path_icon = "ui/Icons/iconHunger",
            decision_id = "try_to_poop"
        });
        this.add(new StatusAsset
        {
            id = "festive_spirit",
            locale_id = "status_title_festive_spirit",
            locale_description = "status_description_festive_spirit",
            duration = 100f,
            path_icon = "ui/Icons/iconFireworks",
            decision_id = "try_to_launch_fireworks"
        });
        this.add(new StatusAsset
        {
            id = "being_suspicious",
            locale_id = "status_title_being_suspicious",
            locale_description = "status_description_being_suspicious",
            duration = 20f,
            path_icon = "ui/Icons/iconSuspicious",
            decision_id = "run_away_being_sus"
        });
        StatusAsset statusAsset15 = new StatusAsset();
        statusAsset15.id = "had_good_dream";
        statusAsset15.locale_id = "status_title_had_good_dream";
        statusAsset15.locale_description = "status_description_had_good_dream";
        statusAsset15.duration = 90f;
        statusAsset15.path_icon = "ui/Icons/iconDreamGood";
        statusAsset15.action_on_receive = (BaseSimObject pSelf, WorldTile _) => pSelf.a.changeHappiness("had_good_dream", 0);
        this.add(statusAsset15);
        StatusAsset statusAsset16 = new StatusAsset();
        statusAsset16.id = "had_bad_dream";
        statusAsset16.locale_id = "status_title_had_bad_dream";
        statusAsset16.locale_description = "status_description_had_bad_dream";
        statusAsset16.duration = 90f;
        statusAsset16.path_icon = "ui/Icons/iconDreamBad";
        statusAsset16.action_on_receive = (BaseSimObject pSelf, WorldTile _) => pSelf.a.changeHappiness("had_bad_dream", 0);
        this.add(statusAsset16);
        StatusAsset statusAsset17 = new StatusAsset();
        statusAsset17.id = "had_nightmare";
        statusAsset17.locale_id = "status_title_had_nightmare";
        statusAsset17.locale_description = "status_description_had_nightmare";
        statusAsset17.duration = 90f;
        statusAsset17.path_icon = "ui/Icons/iconDreamNightmare";
        statusAsset17.action_on_receive = (BaseSimObject pSelf, WorldTile _) => pSelf.a.changeHappiness("had_nightmare", 0);
        this.add(statusAsset17);
        this.add(new StatusAsset
        {
            id = "stunned",
            render_priority = 10,
            locale_id = "status_title_stunned",
            locale_description = "status_description_stunned",
            duration = 4f,
            texture = "fx_status_stunned_t",
            animated = true,
            is_animated_in_pause = true,
            use_parent_rotation = false,
            path_icon = "ui/Icons/iconStunned"
        });
        this.t.remove_status = AssetLibrary<StatusAsset>.a<string>(new string[] { "sleeping", "tantrum", "surprised", "singing", "laughing", "being_suspicious" });
        this.t.tier = StatusTier.Advanced;
        this.t.opposite_traits = AssetLibrary<StatusAsset>.a<string>(new string[] { "tough" });
        this.t.opposite_status = AssetLibrary<StatusAsset>.a<string>(new string[] { "egg" });
        this.t.base_stats.addTag("unconscious");
        this.add(new StatusAsset
        {
            id = "afterglow",
            locale_id = "status_title_afterglow",
            locale_description = "status_description_afterglow",
            duration = 90f,
            animated = true,
            is_animated_in_pause = true,
            use_parent_rotation = false,
            path_icon = "ui/Icons/iconAfterglow",
            offset_y = 1f
        });
        StatusAsset statusAsset18 = new StatusAsset();
        statusAsset18.id = "fell_in_love";
        statusAsset18.locale_id = "status_title_fell_in_love";
        statusAsset18.locale_description = "status_description_fell_in_love";
        statusAsset18.duration = 180f;
        statusAsset18.use_parent_rotation = false;
        statusAsset18.path_icon = "ui/Icons/iconLovers";
        statusAsset18.offset_y = 1f;
        statusAsset18.action_interval = 2f;
        statusAsset18.action_on_receive = (BaseSimObject pSelf, WorldTile _) => pSelf.a.changeHappiness("fallen_in_love", 0);
        statusAsset18.action = delegate (BaseSimObject pTarget, WorldTile _)
        {
            EffectsLibrary.spawnAt("fx_hearts", pTarget.current_position, pTarget.current_scale.y);
            return true;
        };
        this.add(statusAsset18);
        this.add(new StatusAsset
        {
            id = "pregnant",
            locale_id = "status_title_pregnant",
            locale_description = "status_description_pregnant",
            duration = 45f,
            path_icon = "ui/Icons/iconPregnant",
            animated = true,
            is_animated_in_pause = true,
            use_parent_rotation = false,
            texture = "fx_status_pregnant_t",
            action_finish = new WorldAction(this.actionPregnancyFinish)
        });
        this.t.base_stats["multiplier_speed"] = -0.2f;
        this.add(new StatusAsset
        {
            id = "powerup",
            locale_id = "status_title_powerup",
            locale_description = "status_description_powerup",
            duration = 300f,
            animated = true,
            path_icon = "ui/Icons/iconPowerup"
        });
        this.t.draw_light_area = true;
        this.t.draw_light_size = 0.05f;
        this.t.base_stats["armor"] = 1f;
        this.t.base_stats["damage"] = 5f;
        this.t.base_stats["multiplier_damage"] = 0.5f;
        this.t.base_stats["multiplier_crit"] = 0.5f;
        this.t.base_stats["scale"] = 0.1f;
        StatusAsset statusAsset19 = new StatusAsset();
        statusAsset19.id = "enchanted";
        statusAsset19.locale_id = "status_title_enchanted";
        statusAsset19.locale_description = "status_description_enchanted";
        statusAsset19.duration = 120f;
        statusAsset19.path_icon = "ui/Icons/iconEnchanted";
        statusAsset19.action_on_receive = (BaseSimObject pSelf, WorldTile _) => pSelf.a.changeHappiness("just_enchanted", 0);
        this.add(statusAsset19);
        this.t.draw_light_area = true;
        this.t.draw_light_size = 0.05f;
        this.t.base_stats["multiplier_damage"] = 0.77f;
        this.t.base_stats["multiplier_speed"] = 0.1f;
        this.t.base_stats["multiplier_diplomacy"] = 0.1f;
        this.t.base_stats["multiplier_crit"] = 0.1f;
        this.t.base_stats["lifespan"] = 10f;
        this.add(new StatusAsset
        {
            id = "slowness",
            locale_id = "status_title_slowness",
            locale_description = "status_description_slowness",
            texture = "fx_status_slowness_t",
            duration = 30f,
            animated = true,
            path_icon = "ui/Icons/iconSlowness"
        });
        this.t.base_stats["speed"] = -100f;
        this.t.remove_status = AssetLibrary<StatusAsset>.a<string>(new string[] { "caffeinated" });
        this.add(new StatusAsset
        {
            id = "motivated",
            locale_id = "status_title_motivated",
            locale_description = "status_description_motivated",
            texture = "fx_status_motivated_t",
            duration = 120f,
            animated = true,
            is_animated_in_pause = true,
            path_icon = "ui/Icons/iconMotivated"
        });
        this.t.base_stats["speed"] = 10f;
        this.t.base_stats["attack_speed"] = 2f;
        this.add(new StatusAsset
        {
            id = "cough",
            locale_id = "status_title_cough",
            locale_description = "status_description_cough",
            duration = 200f,
            path_icon = "ui/Icons/iconCough",
            can_be_cured = true
        });
        this.t.opposite_traits = AssetLibrary<StatusAsset>.a<string>(new string[] { "immune" });
        this.t.base_stats["lifespan"] = -15f;
        this.t.base_stats["multiplier_speed"] = -0.1f;
        this.t.base_stats["multiplier_health"] = -0.1f;
        this.t.tier = StatusTier.Advanced;
        this.add(new StatusAsset
        {
            id = "ash_fever",
            locale_id = "status_title_ash_fever",
            locale_description = "status_description_ash_fever",
            duration = 500f,
            path_icon = "ui/Icons/iconAshFever",
            action = new WorldAction(StatusLibrary.ashFeverEffect),
            action_interval = 10f,
            can_be_cured = true
        });
        this.t.opposite_traits = AssetLibrary<StatusAsset>.a<string>(new string[] { "immune" });
        this.t.tier = StatusTier.Advanced;
        this.t.base_stats["diplomacy"] = -5f;
        this.t.base_stats["intelligence"] = -5f;
        this.t.base_stats["stewardship"] = -5f;
        this.t.base_stats["warfare"] = 5f;
        this.t.base_stats["multiplier_speed"] = -0.1f;
        this.t.base_stats["multiplier_health"] = -0.6f;
        this.t.base_stats["lifespan"] = -45f;
        this.add(new StatusAsset
        {
            id = "caffeinated",
            locale_id = "status_title_caffeinated",
            locale_description = "status_description_caffeinated",
            texture = "fx_status_caffeinated_t",
            duration = 60f,
            animated = true,
            is_animated_in_pause = true,
            path_icon = "ui/Icons/iconCoffee"
        });
        this.t.base_stats["intelligence"] = 222f;
        this.t.base_stats["speed"] = 200f;
        this.t.remove_status = AssetLibrary<StatusAsset>.a<string>(new string[] { "frozen" });
        this.add(new StatusAsset
        {
            id = "frozen",
            locale_id = "status_title_frozen",
            locale_description = "status_description_frozen",
            texture = "fx_status_frozen_t",
            duration = 15f,
            allow_timer_reset = false,
            random_frame = true,
            sound_idle = "event:/SFX/STATUS/StatusFrozen",
            path_icon = "ui/Icons/iconFrozen"
        });
        this.t.base_stats["mass"] = 100f;
        this.t.base_stats["armor"] = -20f;
        this.t.base_stats["speed"] = -10000f;
        this.t.base_stats.addTag("immovable");
        this.t.base_stats.addTag("frozen_ai");
        this.t.base_stats.addTag("stop_idle_animation");
        this.t.remove_status = AssetLibrary<StatusAsset>.a<string>(new string[] { "burning", "tantrum" });
        this.t.opposite_status = AssetLibrary<StatusAsset>.a<string>(new string[] { "shield" });
        this.t.opposite_traits = AssetLibrary<StatusAsset>.a<string>(new string[] { "freeze_proof" });
        this.t.opposite_tags = AssetLibrary<StatusAsset>.a<string>(new string[] { "immunity_cold" });
        this.t.tier = StatusTier.Advanced;
        this.add(new StatusAsset
        {
            id = "shield",
            locale_id = "status_title_shield",
            locale_description = "status_description_shield",
            texture = "fx_status_shield_t",
            duration = 60f,
            animated = true,
            is_animated_in_pause = true,
            sound_idle = "event:/SFX/STATUS/StatusShield",
            path_icon = "ui/Icons/iconBubbleShield"
        });
        this.t.draw_light_area = true;
        this.t.draw_light_size = 0.1f;
        this.t.base_stats["mass"] = 100f;
        this.t.base_stats["armor"] = 90f;
        this.t.remove_status = AssetLibrary<StatusAsset>.a<string>(new string[] { "burning" });
        this.t.opposite_status = AssetLibrary<StatusAsset>.a<string>(new string[] { "frozen" });
        StatusAsset t2 = this.t;
        t2.action_get_hit = (GetHitAction)Delegate.Combine(t2.action_get_hit, new GetHitAction(StatusLibrary.spawnShieldHitEffect));
        this.t.tier = StatusTier.Advanced;
        this.add(new StatusAsset
        {
            id = "burning",
            locale_id = "status_title_burning",
            locale_description = "status_description_burning",
            texture = "fx_status_burning_t",
            duration = 30f,
            render_priority = 100,
            allow_timer_reset = false,
            action = new WorldAction(StatusLibrary.burningEffect),
            action_interval = 2f,
            animated = true,
            animation_speed = 0.1f,
            animation_speed_random = 0.08f,
            random_frame = true,
            random_flip = true,
            cancel_actor_job = true,
            material_id = "mat_world_object_lit",
            draw_light_area = true,
            draw_light_size = 0.2f,
            sound_idle = "event:/SFX/STATUS/StatusBurningBuilding",
            path_icon = "ui/Icons/iconFire",
            decision_id = "run_to_water_when_on_fire"
        });
        this.t.opposite_status = AssetLibrary<StatusAsset>.a<string>(new string[] { "shield", "tantrum" });
        this.t.opposite_traits = AssetLibrary<StatusAsset>.a<string>(new string[] { "fire_proof" });
        this.t.opposite_tags = AssetLibrary<StatusAsset>.a<string>(new string[] { "immunity_fire" });
        this.t.remove_status = AssetLibrary<StatusAsset>.a<string>(new string[] { "frozen" });
        this.t.tier = StatusTier.Advanced;
        this.add(new StatusAsset
        {
            id = "poisoned",
            locale_id = "status_title_poisoned",
            locale_description = "status_description_poisoned",
            duration = 90f,
            allow_timer_reset = false,
            action = new WorldAction(StatusLibrary.poisonedEffect),
            action_interval = 1f,
            path_icon = "ui/Icons/iconPoisoned"
        });
        this.t.tier = StatusTier.Advanced;
        this.t.opposite_traits = AssetLibrary<StatusAsset>.a<string>(new string[] { "poison_immune" });
        this.add(new StatusAsset
        {
            id = "invincible",
            locale_id = "status_title_invincible",
            locale_description = "status_description_invincible",
            duration = 5f,
            path_icon = "ui/Icons/iconInvincible"
        });
        this.add(new StatusAsset
        {
            id = "dodge",
            locale_id = "status_title_dodge",
            locale_description = "status_description_dodge",
            duration = 1f,
            path_icon = "ui/Icons/skills/iconSkillDodge"
        });
        this.add(new StatusAsset
        {
            id = "dash",
            locale_id = "status_title_dash",
            locale_description = "status_description_dash",
            duration = 2f,
            path_icon = "ui/Icons/skills/iconSkillDash"
        });
        this.t.base_stats["multiplier_speed"] = 1.55f;
        this.add(new StatusAsset
        {
            id = "taking_roots",
            locale_id = "status_title_taking_roots",
            locale_description = "status_description_taking_roots",
            sound_idle = "event:/SFX/NATURE/TreeFall",
            duration = 120f,
            path_icon = "ui/Icons/iconTakingRoots",
            texture = "fx_status_taking_roots_t",
            animated = true,
            can_be_cured = true,
            use_parent_rotation = false
        });
        this.t.base_stats["mass"] = 100f;
        this.t.base_stats["armor"] = 10f;
        this.t.base_stats["speed"] = -10000f;
        this.t.base_stats["multiplier_speed"] = -0.3f;
        this.t.base_stats["multiplier_damage"] = -0.3f;
        this.t.base_stats["multiplier_health"] = -0.3f;
        this.t.base_stats.addTag("immovable");
        this.t.base_stats.addTag("stop_idle_animation");
        this.t.base_stats.addTag("frozen_ai");
        this.t.tier = StatusTier.Advanced;
        StatusAsset t3 = this.t;
        t3.action_finish = (WorldAction)Delegate.Combine(t3.action_finish, new WorldAction(this.actionTakingRootsFinish));
        this.add(new StatusAsset
        {
            id = "uprooting",
            locale_id = "status_title_uprooting",
            locale_description = "status_description_uprooting",
            sound_idle = "event:/SFX/CIVILIZATIONS/CropsGrow",
            duration = 120f,
            path_icon = "ui/Icons/iconUprooting",
            texture = "fx_status_uprooting_t",
            animated = true,
            can_be_cured = true,
            use_parent_rotation = false,
            offset_y_ui = 0.1f
        });
        this.t.base_stats["armor"] = 20f;
        this.t.base_stats["speed"] = -10000f;
        this.t.base_stats["multiplier_speed"] = -0.3f;
        this.t.base_stats["multiplier_damage"] = -0.3f;
        this.t.base_stats["multiplier_health"] = -0.3f;
        this.t.base_stats.addTag("immovable");
        this.t.base_stats.addTag("frozen_ai");
        this.t.base_stats.addTag("stop_idle_animation");
        this.t.tier = StatusTier.Advanced;
        StatusAsset statusAsset20 = new StatusAsset();
        statusAsset20.id = "budding";
        statusAsset20.locale_id = "status_title_budding";
        statusAsset20.locale_description = "status_description_budding";
        statusAsset20.duration = 60f;
        statusAsset20.path_icon = "ui/Icons/iconStatusBudding";
        statusAsset20.animated = true;
        statusAsset20.animation_speed = 0f;
        statusAsset20.scale = 0.7f;
        statusAsset20.position_z = -0.01f;
        statusAsset20.rotation_z = -30f;
        statusAsset20.use_parent_rotation = true;
        statusAsset20.get_override_sprite = delegate (BaseSimObject pActor, int pIndex)
        {
            Sprite tFrame = pActor.a.animation_container.walking.frames[0];
            return pActor.a.calculateColoredSprite(tFrame, false);
        };
        statusAsset20.get_override_sprite_position = delegate (BaseSimObject pActor, int pIndex)
        {
            AnimationFrameData tData = pActor.a.getAnimationFrameData();
            ref Vector3 tCurrentScale = ref pActor.a.current_scale;
            Vector3 tResult;
            if (tData.show_head)
            {
                ref Vector2 tPosHead = ref tData.pos_head_new;
                float tScaleMod = pActor.a.getScaleMod();
                tResult = new Vector2(-0.4f * tScaleMod + tPosHead.x * tCurrentScale.x, -0.25f * tScaleMod + tPosHead.y * tCurrentScale.y);
            }
            else
            {
                float tSize = Mathf.Max((float)pActor.a.asset.actor_size, 3f) / 13f;
                float tHeight;
                if (pActor.a.isInLiquid())
                {
                    tHeight = 1f;
                }
                else
                {
                    tHeight = 5f;
                }
                tResult = new Vector2(0f, tHeight * tSize * tCurrentScale.y);
            }
            return tResult;
        };
        statusAsset20.get_override_sprite_rotation_z = delegate (BaseSimObject pActor, int pIndex)
        {
            float tRotation;
            if (pActor.a.has_rendered_sprite_head)
            {
                tRotation = -30f;
            }
            else
            {
                tRotation = 0f;
            }
            return tRotation;
        };
        statusAsset20.get_override_sprite_ui = delegate (AvatarEffect pEffect, int pIndex)
        {
            UnitAvatarLoader avatar = pEffect.getAvatar();
            ActorAvatarData tData = avatar.getData();
            AnimationContainerUnit tContainer = avatar.getAnimationContainer();
            Sprite tSprite = tContainer.walking.frames[0];
            return tData.getColoredSprite(tSprite, tContainer);
        };
        statusAsset20.get_override_sprite_position_ui = delegate (AvatarEffect pEffect, int pIndex)
        {
            UnitAvatarLoader tAvatar = pEffect.getAvatar();
            ActorAvatarData tAvatarData = tAvatar.getData();
            Vector2 tPos = default(Vector2);
            int tIndex = tAvatar.getActualSpriteIndex();
            if (tAvatarData.hasRenderedSpriteHead())
            {
                AnimationContainerUnit tContainer = tAvatar.getAnimationContainer();
                string tState = ((tAvatarData.is_touching_liquid && tContainer.has_swimming) ? tContainer.swimming.frames[tIndex].name : tContainer.walking.frames[tIndex].name);
                ref Vector2 tPosHead = ref tContainer.dict_frame_data[tState].pos_head;
                ref float tScale = ref pEffect.getAsset().scale;
                tPos = new Vector2(-0.4f + tPosHead.x * tScale, -0.25f + tPosHead.y * tScale);
            }
            else
            {
                float tSize = Mathf.Max((float)tAvatarData.asset.actor_size, 3f) / 13f;
                float tHeight;
                if (tAvatarData.is_touching_liquid)
                {
                    tHeight = 1f;
                }
                else
                {
                    tHeight = 5f;
                }
                tPos = new Vector2(0f, tHeight * tSize);
            }
            return tPos;
        };
        statusAsset20.get_override_sprite_rotation_z_ui = delegate (AvatarEffect pEffect, int pIndex)
        {
            float tRotation;
            if (pEffect.getAvatar().getData().hasRenderedSpriteHead())
            {
                tRotation = -30f;
            }
            else
            {
                tRotation = 0f;
            }
            return tRotation;
        };
        statusAsset20.get_sprites_count = (BaseSimObject _, StatusAsset _) => 1;
        this.add(statusAsset20);
        this.t.render_check = (ActorAsset pAsset) => pAsset.render_budding;
        StatusAsset t4 = this.t;
        t4.action_finish = (WorldAction)Delegate.Combine(t4.action_finish, new WorldAction(this.actionBuddingFinish));
        StatusAsset statusAsset21 = new StatusAsset();
        statusAsset21.id = "flicked";
        statusAsset21.locale_id = "status_title_flicked";
        statusAsset21.locale_description = "status_description_flicked";
        statusAsset21.duration = 3f;
        statusAsset21.path_icon = "ui/Icons/iconFingerFlick";
        statusAsset21.action_death = delegate (BaseSimObject pActor, WorldTile pTile)
        {
            if (pActor.a.getActorAsset().id != "beetle")
            {
                return false;
            }
            if (!pActor.current_tile.Type.lava)
            {
                return false;
            }
            AchievementLibrary.achievementFlickIt.check(null, null, null);
            return true;
        };
        this.add(statusAsset21);
    }

    // Token: 0x06000B11 RID: 2833 RVA: 0x000A08C8 File Offset: 0x0009EAC8
    public override void linkAssets()
    {
        base.linkAssets();
        this.setupBools();
        this.setupCachedSprites();
    }

    // Token: 0x06000B12 RID: 2834 RVA: 0x000A08DC File Offset: 0x0009EADC
    private void setupCachedSprites()
    {
        foreach (StatusAsset tAsset in this.list)
        {
            if (tAsset.texture != null && tAsset.sprite_list == null)
            {
                tAsset.sprite_list = SpriteTextureLoader.getSpriteList("effects/" + tAsset.texture, false);
            }
        }
    }

    // Token: 0x06000B13 RID: 2835 RVA: 0x000A0954 File Offset: 0x0009EB54
    public override void editorDiagnostic()
    {
        base.editorDiagnostic();
        foreach (StatusAsset tAsset in this.list)
        {
            if (!string.IsNullOrEmpty(tAsset.texture))
            {
                base.checkSpriteExists("texture", "effects/" + tAsset.texture, tAsset);
            }
            base.checkSpriteExists("path_icon", tAsset.path_icon, tAsset);
        }
    }

    // Token: 0x06000B14 RID: 2836 RVA: 0x000A09E4 File Offset: 0x0009EBE4
    public override void editorDiagnosticLocales()
    {
        foreach (StatusAsset tAsset in this.list)
        {
            this.checkLocale(tAsset, tAsset.getLocaleID());
            this.checkLocale(tAsset, tAsset.getDescriptionID());
        }
        base.editorDiagnosticLocales();
    }

    // Token: 0x06000B15 RID: 2837 RVA: 0x000A0A50 File Offset: 0x0009EC50
    private void setupBools()
    {
        foreach (StatusAsset tAsset in this.list)
        {
            if (tAsset.get_override_sprite != null)
            {
                tAsset.has_override_sprite = true;
                tAsset.need_visual_render = true;
            }
            if (tAsset.get_override_sprite_position != null)
            {
                tAsset.has_override_sprite_position = true;
            }
            if (tAsset.get_override_sprite_rotation_z != null)
            {
                tAsset.has_override_sprite_rotation_z = true;
            }
            if (tAsset.texture != null)
            {
                tAsset.need_visual_render = true;
            }
        }
    }

    // Token: 0x06000B16 RID: 2838 RVA: 0x000A0AE0 File Offset: 0x0009ECE0
    private bool actionPregnancyFinish(BaseSimObject pTarget, WorldTile pTile)
    {
        if (!pTarget.isAlive())
        {
            return false;
        }
        BabyMaker.makeBabyFromPregnancy(pTarget.a);
        return true;
    }

    // Token: 0x06000B17 RID: 2839 RVA: 0x000A0AF8 File Offset: 0x0009ECF8
    private bool actionTakingRootsFinish(BaseSimObject pTarget, WorldTile pTile)
    {
        if (!pTarget.isAlive())
        {
            return false;
        }
        BabyMaker.makeBabyViaVegetative(pTarget.a);
        return true;
    }

    // Token: 0x06000B18 RID: 2840 RVA: 0x000A0B11 File Offset: 0x0009ED11
    private bool actionBuddingFinish(BaseSimObject pTarget, WorldTile pTile)
    {
        if (!pTarget.isAlive())
        {
            return false;
        }
        Actor a = pTarget.a;
        BabyMaker.makeBabyViaBudding(pTarget as Actor).applyRandomForce(1.5f, 2f);
        a.applyRandomForce(1.5f, 2f);
        return true;
    }

    // Token: 0x06000B19 RID: 2841 RVA: 0x000A0B50 File Offset: 0x0009ED50
    public static bool ashFeverEffect(BaseSimObject pTarget, WorldTile pTile = null)
    {
        int tDamage = pTarget.getMaxHealthPercent(0.01f);
        pTarget.getHit((float)tDamage, true, AttackType.AshFever, null, true, false, true);
        return true;
    }

    // Token: 0x06000B1A RID: 2842 RVA: 0x000A0B78 File Offset: 0x0009ED78
    public static bool burningEffect(BaseSimObject pTarget, WorldTile pTile = null)
    {
        if (pTarget.isActor() && pTarget.a.asset.has_skin && Randy.randomBool())
        {
            pTarget.a.addInjuryTrait("skin_burns");
        }
        int tDamage = pTarget.getMaxHealthPercent(0.1f);
        if (pTarget.isBuilding() && pTarget.b.isRuin())
        {
            tDamage = (int)((float)tDamage * 0.25f + 1f);
        }
        pTarget.getHit((float)tDamage, true, AttackType.Fire, null, true, false, true);
        if (MapBox.isRenderGameplay() && Randy.randomChance(0.1f))
        {
            World.world.particles_fire.spawn(pTarget.current_position.x, pTarget.current_position.y, true);
        }
        return true;
    }

    // Token: 0x06000B1B RID: 2843 RVA: 0x000A0C30 File Offset: 0x0009EE30
    public static bool spawnShieldHitEffect(BaseSimObject pSelf, BaseSimObject pAttackedBy, WorldTile pTile = null)
    {
        if (!pSelf.isAlive())
        {
            return false;
        }
        BaseEffect tEffect = EffectsLibrary.spawnAt("fx_shield_hit", pSelf.current_position, 1f);
        if (tEffect == null)
        {
            return false;
        }
        tEffect.attachTo(pSelf.a);
        return true;
    }

    // Token: 0x06000B1C RID: 2844 RVA: 0x000A0C78 File Offset: 0x0009EE78
    public static bool poisonedEffect(BaseSimObject pTarget, WorldTile pTile = null)
    {
        float tDamage = Mathf.Max((float)pTarget.getHealth() * 0.01f, 1f);
        if (Randy.randomBool() && pTarget.getHealth() > 1)
        {
            pTarget.getHit(tDamage, true, AttackType.Poison, null, true, false, true);
        }
        pTarget.a.spawnParticle(Toolbox.color_infected);
        pTarget.a.startShake(0.4f, 0.2f, true, false);
        return true;
    }

    // Token: 0x06000B1D RID: 2845 RVA: 0x000A0CE4 File Offset: 0x0009EEE4
    public void linkMaterials()
    {
        foreach (StatusAsset tAsset in this.list)
        {
            Material tMaterial = LibraryMaterials.instance.dict[tAsset.material_id];
            tAsset.material = tMaterial;
        }
    }

    // Token: 0x06000B1E RID: 2846 RVA: 0x000A0D50 File Offset: 0x0009EF50
    public string addToGameplayReport(string pWhat)
    {
        string tResult = string.Empty;
        tResult = tResult + pWhat + "\n";
        foreach (StatusAsset statusAsset in this.list)
        {
            string tName = statusAsset.getLocaleID().Localize();
            string tDescription = statusAsset.getDescriptionID().Localize();
            string tLineInfo = "\n" + tName;
            tLineInfo += "\n";
            if (!string.IsNullOrEmpty(tDescription))
            {
                tLineInfo = tLineInfo + "1: " + tDescription;
            }
            tResult += tLineInfo;
        }
        tResult += "\n\n";
        return tResult;
    }

    // Token: 0x06000B1F RID: 2847 RVA: 0x000A0E10 File Offset: 0x0009F010
    private bool possessedAction(BaseSimObject pTarget, WorldTile _)
    {
        Actor tActor = pTarget.a;
        if (tActor.asset.id == "crabzilla")
        {
            return false;
        }
        if (tActor.is_unconscious)
        {
            return false;
        }
        this.checkPossessedMovement(tActor);
        this.checkPossessedAttackLeft(tActor);
        this.checkPossessedAttackRight(tActor);
        this.checkPossessedFlip(tActor);
        this.checkBonusActions(tActor);
        return true;
    }

    // Token: 0x06000B20 RID: 2848 RVA: 0x000A0E6C File Offset: 0x0009F06C
    private void checkBonusActions(Actor pActor)
    {
        if (pActor.is_immovable)
        {
            return;
        }
        if (ControllableUnit.isActionPressedJump())
        {
            this.checkJump(pActor);
        }
        if (ControllableUnit.isActionPressedTalk())
        {
            this.checkTalk(pActor);
        }
        if (ControllableUnit.isActionPressedDash())
        {
            this.checkDash(pActor);
        }
        if (ControllableUnit.isActionPressedBackstep())
        {
            this.checkBackstep(pActor);
        }
        if (ControllableUnit.isActionPressedSteal())
        {
            this.checkSteal(pActor);
        }
        if (ControllableUnit.isActionPressedSwear())
        {
            this.checkSwear(pActor);
        }
    }

    // Token: 0x06000B21 RID: 2849 RVA: 0x000A0ED8 File Offset: 0x0009F0D8
    private void checkTalk(Actor pActor)
    {
        if (pActor.under_forces)
        {
            return;
        }
        if (!pActor.asset.control_can_talk)
        {
            return;
        }
        if (pActor.hasTrait("mute"))
        {
            return;
        }
        if (!pActor.isAttackReady())
        {
            return;
        }
        Vector2 tPosition = pActor.getPossessionControlTargetPosition();
        pActor.spawnSlashTalk(tPosition);
        pActor.punchTargetAnimation(tPosition, false, false, -20f);
        pActor.lookTowardsPosition(tPosition);
        pActor.setActionTimeout(1f);
        Actor tActorTarget = this.getActorTargetRaycast(pActor);
        if (tActorTarget == null)
        {
            tActorTarget = this.getActorTargetNearCursor(pActor);
        }
        if (tActorTarget == null)
        {
            return;
        }
        if (tActorTarget.is_unconscious)
        {
            return;
        }
        if (!tActorTarget.asset.can_talk_with)
        {
            return;
        }
        if (tActorTarget.hasStatus("possessed"))
        {
            return;
        }
        if (ControllableUnit.isControllingUnit(tActorTarget))
        {
            return;
        }
        if (Randy.randomChance(0.3f))
        {
            tActorTarget.getSurprised(pActor.current_tile, true);
        }
        tActorTarget.cancelAllBeh();
        tActorTarget.tryToConvertActorToMetaFromActor(pActor, false);
        tActorTarget.addStatusEffect("possessed_follower", 0f, true);
        tActorTarget.lookTowardsPosition(pActor.current_position);
        tActorTarget.setTask("socialize_receiving", true, false, true);
        pActor.clearLastTopicSprite();
        tActorTarget.clearLastTopicSprite();
        float tTalkTime = 2f + Randy.randomFloat(0f, 3f);
        tActorTarget.makeWait(tTalkTime);
        pActor.setTask("socialize_receiving", true, false, true);
        pActor.makeWait(tTalkTime);
    }

    // Token: 0x06000B22 RID: 2850 RVA: 0x000A101C File Offset: 0x0009F21C
    private void checkSteal(Actor pActor)
    {
        if (pActor.under_forces)
        {
            return;
        }
        if (!pActor.asset.control_can_steal)
        {
            return;
        }
        if (!pActor.isAttackReady())
        {
            return;
        }
        Vector2 tPosition = pActor.getPossessionControlTargetPosition();
        pActor.spawnSlashSteal(tPosition);
        pActor.punchTargetAnimation(tPosition, false, false, 40f);
        pActor.lookTowardsPosition(tPosition);
        pActor.setActionTimeout(1f);
        Actor tActorTarget = this.getActorTargetRaycast(pActor);
        if (tActorTarget == null)
        {
            return;
        }
        if (Vector2.Distance(pActor.current_position, tActorTarget.current_position) < 2f)
        {
            pActor.stealActionFrom(tActorTarget, 5f, 1f, true);
        }
    }

    // Token: 0x06000B23 RID: 2851 RVA: 0x000A10B4 File Offset: 0x0009F2B4
    private void checkSwear(Actor pActor)
    {
        if (!pActor.asset.control_can_swear)
        {
            return;
        }
        if (pActor.hasTrait("mute"))
        {
            return;
        }
        if (!pActor.isAttackReady())
        {
            return;
        }
        Vector2 tPosition = pActor.getPossessionControlTargetPosition();
        pActor.addStatusEffect("swearing", 2f, false);
        pActor.punchTargetAnimation(tPosition, false, false, -40f);
        pActor.spawnSlashSwear(tPosition);
        pActor.lookTowardsPosition(tPosition);
        pActor.setActionTimeout(1f);
        Actor tActorTarget = this.getActorTargetRaycast(pActor);
        if (tActorTarget == null)
        {
            tActorTarget = this.getActorTargetNearCursor(pActor);
        }
        if (tActorTarget == null)
        {
            return;
        }
        tActorTarget.tryToGetSurprised(pActor.current_tile, true);
        tActorTarget.addAggro(pActor);
    }

    // Token: 0x06000B24 RID: 2852 RVA: 0x000A1158 File Offset: 0x0009F358
    private void checkBackstep(Actor pActor)
    {
        if (!pActor.asset.control_can_backstep)
        {
            return;
        }
        CombatActionAsset combat_action_backstep = CombatActionLibrary.combat_action_backstep;
        Vector2 tPosition = pActor.getPossessionControlTargetPositionMovementVector();
        combat_action_backstep.action_actor_target_position(pActor, tPosition, null);
    }

    // Token: 0x06000B25 RID: 2853 RVA: 0x000A1190 File Offset: 0x0009F390
    private void checkDash(Actor pActor)
    {
        if (!pActor.asset.control_can_dash)
        {
            return;
        }
        CombatActionAsset combat_action_dash = CombatActionLibrary.combat_action_dash;
        Vector2 tPosition = pActor.getPossessionControlTargetPositionMovementVector();
        combat_action_dash.action_actor_target_position(pActor, tPosition, null);
    }

    // Token: 0x06000B26 RID: 2854 RVA: 0x000A11C8 File Offset: 0x0009F3C8
    private void checkJump(Actor pActor)
    {
        if (pActor.under_forces)
        {
            return;
        }
        if (!pActor.asset.control_can_jump)
        {
            return;
        }
        float num = SimGlobals.m.gravity * 0.5f;
        float tMassUnit = pActor.stats["mass_2"] * pActor.actor_scale;
        float tForceAmount = num / tMassUnit;
        tForceAmount = Mathf.Clamp(tForceAmount, 1.5f, 2.5f);
        if (pActor.hasTrait("weightless"))
        {
            tForceAmount += tForceAmount * 0.5f;
        }
        float tForceHeight = tForceAmount;
        Vector2 tTargetPosition = pActor.current_position - ControllableUnit.getMovementVector();
        Vector2 tCurPosition = pActor.current_position;
        EffectsLibrary.spawnAt("fx_jump", tCurPosition, 0.1f);
        pActor.calculateForce(tCurPosition.x, tCurPosition.y, tTargetPosition.x, tTargetPosition.y, tForceAmount, tForceHeight, true);
    }

    // Token: 0x06000B27 RID: 2855 RVA: 0x000A1290 File Offset: 0x0009F490
    private void checkPossessedAttackLeft(Actor pActor)
    {
        if (!ControllableUnit.isAttackPressedLeft())
        {
            return;
        }
        if (Config.joyControls && !TouchPossessionController.isSelectedActionAttack())
        {
            return;
        }
        if (pActor.asset.skip_fight_logic)
        {
            return;
        }
        if (!pActor.isAttackReady())
        {
            return;
        }
        Actor tActorTarget = this.getActorTargetAttack(pActor, 0f);
        float tAttackRange = pActor.getAttackRange();
        Vector3 tAttackPos = this.getAttackPos(pActor, 0f);
        if (tActorTarget != null && pActor.hasMeleeAttack())
        {
            Vector3 tTargetPos = tActorTarget.current_position;
            float tDistToActor = Vector2.Distance(pActor.current_position, tTargetPos);
            if (tDistToActor > tAttackRange)
            {
                tDistToActor = tAttackRange;
            }
            tAttackPos = Toolbox.getNewPointVec2(pActor.current_position, tAttackPos, tDistToActor, true);
        }
        Kingdom tKingdomPossessed = World.world.kingdoms_wild.get("possessed");
        pActor.tryToAttack(null, false, null, tAttackPos, tKingdomPossessed, (tActorTarget != null) ? tActorTarget.current_tile : null, tAttackRange * 0.2f);
    }

    // Token: 0x06000B28 RID: 2856 RVA: 0x000A1374 File Offset: 0x0009F574
    private void checkPossessedAttackRight(Actor pActor)
    {
        if (!ControllableUnit.isAttackJustPressedRight())
        {
            return;
        }
        if (!pActor.asset.control_can_kick)
        {
            return;
        }
        if (pActor.asset.skip_fight_logic)
        {
            return;
        }
        if (!pActor.isAttackReady())
        {
            return;
        }
        Vector2 tPosition = pActor.getPossessionControlTargetPosition();
        pActor.punchTargetAnimation(tPosition, false, false, -20f);
        pActor.setActionTimeout(1f);
        pActor.spawnSlashKick(tPosition);
        pActor.lookTowardsPosition(tPosition);
        Actor tActorToHit = this.getActorTargetAttack(pActor, 2f);
        if (tActorToHit == null)
        {
            return;
        }
        if (Vector2.Distance(pActor.current_position, tActorToHit.current_position) < 2f)
        {
            tActorToHit.makeStunned(5f);
            Vector2 tStartPos = pActor.current_position;
            tStartPos.y += pActor.current_scale.y;
            Vector2 tDirection = tPosition;
            float tForceDirection = Randy.randomFloat(1.5f, 3f);
            float tForceHeight = Randy.randomFloat(1.5f, 3f);
            if (pActor.under_forces || pActor.hasStatus("dash"))
            {
                tForceDirection *= 2f;
                tForceHeight *= 1.5f;
            }
            tActorToHit.calculateForce(tDirection.x, tDirection.y, tStartPos.x, tStartPos.y, tForceDirection, tForceHeight, true);
            tActorToHit.addAggro(pActor);
        }
    }

    // Token: 0x06000B29 RID: 2857 RVA: 0x000A14AC File Offset: 0x0009F6AC
    private Vector2 getAttackPos(Actor pActorFor, float pRange = 0f)
    {
        Vector2 tActorPos = pActorFor.current_position;
        Vector2 tMousePosTarget = this.mouse_pos;
        Vector2 tAttackPos = tMousePosTarget;
        float tRangeAttack = ((pRange != 0f) ? pRange : pActorFor.getAttackRange());
        if (pActorFor.hasMeleeAttack())
        {
            tAttackPos = Toolbox.getNewPointVec2(tActorPos, tMousePosTarget, tRangeAttack, true);
        }
        return tAttackPos;
    }

    // Token: 0x06000B2A RID: 2858 RVA: 0x000A14F0 File Offset: 0x0009F6F0
    private Actor getActorTargetAttack(Actor pActorFor, float pRange = 0f)
    {
        float tRangeAttack = ((pRange != 0f) ? pRange : pActorFor.getAttackRange());
        Vector2 tAttackPos = this.getAttackPos(pActorFor, tRangeAttack);
        WorldTile tTileTarget = World.world.GetTile((int)tAttackPos.x, (int)tAttackPos.y);
        if (tTileTarget == null)
        {
            tTileTarget = pActorFor.current_tile;
        }
        float tBestDist = float.MaxValue;
        Actor tBestObject = null;
        float tRangeAttackSquared = tRangeAttack * tRangeAttack;
        foreach (Actor tActor in Finder.getUnitsFromChunk(tTileTarget, 0, tRangeAttack, true))
        {
            if (pActorFor != tActor)
            {
                float tDist = Toolbox.SquaredDistVec2Float(tAttackPos, tActor.current_position);
                if (tDist <= tRangeAttackSquared && tDist < tBestDist)
                {
                    tBestObject = tActor;
                    tBestDist = tDist;
                }
            }
        }
        return tBestObject;
    }

    // Token: 0x06000B2B RID: 2859 RVA: 0x000A15B4 File Offset: 0x0009F7B4
    private Actor getActorTargetRaycast(Actor pActorFor)
    {
        Vector2 tActorPos = pActorFor.current_position;
        Vector2 tMousePosTarget = this.mouse_pos;
        List<WorldTile> list = PathfinderTools.raycast(tActorPos, tMousePosTarget, 0.99f);
        float tDistance = float.MaxValue;
        Actor tActorTarget = null;
        Action<Actor> <> 9__0;
        foreach (WorldTile tTile in list)
        {
            if (tTile.hasUnits())
            {
                WorldTile worldTile = tTile;
                Action<Actor> pAction;
                if ((pAction = <> 9__0) == null)
                {
                    pAction = (<> 9__0 = delegate (Actor tActor)
                    {
                        if (tActor == pActorFor)
                        {
                            return;
                        }
                        float tDist = Toolbox.SquaredDistVec2Float(tActorPos, tActor.current_position);
                        if (tDist < tDistance)
                        {
                            tDistance = tDist;
                            tActorTarget = tActor;
                        }
                    });
                }
                worldTile.doUnits(pAction);
                if (tActorTarget != null)
                {
                    break;
                }
            }
        }
        if (tActorTarget == null || tActorTarget == pActorFor)
        {
            return null;
        }
        return tActorTarget;
    }

    // Token: 0x06000B2C RID: 2860 RVA: 0x000A169C File Offset: 0x0009F89C
    private Actor getActorTargetNearCursor(Actor pActorFor)
    {
        Actor tActorToHit = World.world.getActorNearCursor();
        if (tActorToHit == null || tActorToHit == pActorFor)
        {
            return null;
        }
        return tActorToHit;
    }

    // Token: 0x06000B2D RID: 2861 RVA: 0x000A16C0 File Offset: 0x0009F8C0
    private void checkPossessedMovement(Actor pActor)
    {
        if (!ControllableUnit.isMovementActionActive())
        {
            pActor.setPossessedMovement(false);
            return;
        }
        if (pActor.is_immovable)
        {
            return;
        }
        Vector2 tMovementVector = ControllableUnit.getMovementVector();
        if (tMovementVector == Vector2.zero)
        {
            return;
        }
        pActor.setPossessedMovement(true);
        Vector2 tUnitPos = pActor.current_position;
        pActor.next_step_position_possession = tUnitPos + tMovementVector * 2f;
        tMovementVector += tUnitPos;
        float tSpeedDelta = pActor.updatePossessedMovementTowards(World.world.elapsed, tMovementVector);
        if (!pActor.isInAir() && !pActor.under_forces && tSpeedDelta >= 0.03f)
        {
            BaseEffect tEffect = EffectsLibrary.spawnAt("fx_walk", tUnitPos, 0.1f);
            if (tEffect != null)
            {
                tEffect.GetComponent<SpriteRenderer>().flipX = !pActor.flip;
            }
        }
    }

    // Token: 0x06000B2E RID: 2862 RVA: 0x000A177E File Offset: 0x0009F97E
    private void checkPossessedFlip(Actor pActor)
    {
        pActor.updateMovementPossessedFlip();
    }

    // Token: 0x17000044 RID: 68
    // (get) Token: 0x06000B2F RID: 2863 RVA: 0x000A1786 File Offset: 0x0009F986
    public Vector2 mouse_pos
    {
        get
        {
            return ControllableUnit.getClickVector();
        }
    }

    // Token: 0x06000B30 RID: 2864 RVA: 0x000A178D File Offset: 0x0009F98D
    public StatusLibrary()
    {
        string[] array = new string[23];
        array[0] = "had_bad_dream";
        array[1] = "had_good_dream";
        array[2] = "had_nightmare";
        this._pot_dreams = array;
        base..ctor();
    }

    // Token: 0x04000AD6 RID: 2774
    public const float DURATION_STRANGE_URGE = 100f;

    // Token: 0x04000AD7 RID: 2775
    private string[] _pot_dreams;
}
using System;
using System.Collections.Generic;
using UnityEngine;

// Token: 0x0200026D RID: 621
public class Item : CoreSystemObject<ItemData>
{
    // Token: 0x17000151 RID: 337
    // (get) Token: 0x06001667 RID: 5735 RVA: 0x000E0473 File Offset: 0x000DE673
    protected override MetaType meta_type
    {
        get
        {
            return MetaType.Item;
        }
    }

    // Token: 0x06001668 RID: 5736 RVA: 0x000E0477 File Offset: 0x000DE677
    public override void setFavorite(bool pState)
    {
        base.setFavorite(pState);
        if (this.isReadyForRemoval())
        {
            World.world.items.setDirty();
        }
    }

    // Token: 0x06001669 RID: 5737 RVA: 0x000E0497 File Offset: 0x000DE697
    public bool isCursed()
    {
        return this.hasMod("cursed");
    }

    // Token: 0x0600166A RID: 5738 RVA: 0x000E04A4 File Offset: 0x000DE6A4
    public bool isEternal()
    {
        return this.hasMod("eternal");
    }

    // Token: 0x0600166B RID: 5739 RVA: 0x000E04B1 File Offset: 0x000DE6B1
    public bool isDestroyable()
    {
        return !base.isFavorite() && !this.isEternal();
    }

    // Token: 0x0600166C RID: 5740 RVA: 0x000E04C6 File Offset: 0x000DE6C6
    public bool isReadyForRemoval()
    {
        return !this.hasCity() && !this.hasActor() && this.isDestroyable();
    }

    // Token: 0x0600166D RID: 5741 RVA: 0x000E04E0 File Offset: 0x000DE6E0
    public void fullRepair()
    {
        this.data.durability = 100;
    }

    // Token: 0x0600166E RID: 5742 RVA: 0x000E04EF File Offset: 0x000DE6EF
    public void getDamaged(int pDamage)
    {
        if (this.hasMod("eternal"))
        {
            return;
        }
        this.data.durability -= pDamage;
        if (this.data.durability < 0)
        {
            this.data.durability = 0;
        }
    }

    // Token: 0x0600166F RID: 5743 RVA: 0x000E052C File Offset: 0x000DE72C
    public void newItem(EquipmentAsset pAsset)
    {
        this.setAsset(pAsset);
        this.data.durability = pAsset.durability;
    }

    // Token: 0x06001670 RID: 5744 RVA: 0x000E0546 File Offset: 0x000DE746
    public bool needRepair()
    {
        return this.getDurabilityCurrent() < this.getDurabilityMax();
    }

    // Token: 0x06001671 RID: 5745 RVA: 0x000E0556 File Offset: 0x000DE756
    public int getDurabilityCurrent()
    {
        return this.data.durability;
    }

    // Token: 0x06001672 RID: 5746 RVA: 0x000E0563 File Offset: 0x000DE763
    public int getDurabilityMax()
    {
        return this._asset.durability;
    }

    // Token: 0x06001673 RID: 5747 RVA: 0x000E0570 File Offset: 0x000DE770
    public string getDurabilityString()
    {
        return this.getDurabilityCurrent().ToString() + "/" + this.getDurabilityMax().ToString();
    }

    // Token: 0x06001674 RID: 5748 RVA: 0x000E05A3 File Offset: 0x000DE7A3
    private void setAsset(EquipmentAsset pAsset)
    {
        this._asset = pAsset;
        this.data.asset_id = this._asset.id;
        this.recalculateTexturePath();
    }

    // Token: 0x06001675 RID: 5749 RVA: 0x000E05C8 File Offset: 0x000DE7C8
    private void recalculateTexturePath()
    {
        this._texture_id = this.asset.path_gameplay_sprite;
    }

    // Token: 0x06001676 RID: 5750 RVA: 0x000E05DB File Offset: 0x000DE7DB
    protected sealed override void setDefaultValues()
    {
        base.setDefaultValues();
        this._asset = null;
        this.unit_has_it = false;
        this.city_has_it = false;
        this.shouldbe_removed = false;
        this._item_value = 0;
        this._quality = Rarity.R0_Normal;
    }

    // Token: 0x06001677 RID: 5751 RVA: 0x000E0610 File Offset: 0x000DE810
    public void reforge(int pTries)
    {
        this.clearForReforge();
        World.world.items.generateModsFor(this, pTries, null, true);
        this.data.name = NameGenerator.getName("reforged_item", ActorSex.Male, false, null, null, false);
        this.calculateValues();
        if (this._actor != null)
        {
            this._actor.addTrait("scar_of_divinity", false);
        }
    }

    // Token: 0x06001678 RID: 5752 RVA: 0x000E0678 File Offset: 0x000DE878
    private void clearForReforge()
    {
        this.data.modifiers.Clear();
    }

    // Token: 0x06001679 RID: 5753 RVA: 0x000E068C File Offset: 0x000DE88C
    public void transmute()
    {
        this.clearForReforge();
        bool tIsCheatEnabled = this.isCheatEnabled();
        using (ListPool<EquipmentAsset> tPossibleAssets = new ListPool<EquipmentAsset>())
        {
            List<EquipmentAsset> tPotAssets;
            if (this._asset.is_pool_weapon)
            {
                if (tIsCheatEnabled)
                {
                    tPotAssets = AssetManager.items.pot_weapon_assets_all;
                }
                else
                {
                    tPotAssets = AssetManager.items.pot_weapon_assets_unlocked;
                }
            }
            else if (tIsCheatEnabled)
            {
                tPotAssets = AssetManager.items.pot_equipment_by_groups_all[this._asset.group_id];
            }
            else
            {
                tPotAssets = AssetManager.items.pot_equipment_by_groups_unlocked[this._asset.group_id];
            }
            foreach (EquipmentAsset tEquipmentAsset in tPotAssets)
            {
                if (tEquipmentAsset.isAvailable())
                {
                    tPossibleAssets.Add(tEquipmentAsset);
                }
            }
            tPossibleAssets.Shuffle<EquipmentAsset>();
            foreach (EquipmentAsset ptr in tPossibleAssets)
            {
                EquipmentAsset tAsset = ptr;
                if (this._asset != tAsset)
                {
                    this.setAsset(tAsset);
                    break;
                }
            }
            this.reforge(5);
            this.calculateValues();
        }
    }

    // Token: 0x0600167A RID: 5754 RVA: 0x000E07D8 File Offset: 0x000DE9D8
    public bool hasMod(string pID)
    {
        return this.data.modifiers.Contains(pID);
    }

    // Token: 0x0600167B RID: 5755 RVA: 0x000E07F0 File Offset: 0x000DE9F0
    public bool hasMod(ItemModAsset pModAsset)
    {
        return this.hasMod(pModAsset.id);
    }

    // Token: 0x0600167C RID: 5756 RVA: 0x000E0800 File Offset: 0x000DEA00
    public bool addMod(string pModId)
    {
        ItemModAsset tNewMod = AssetManager.items_modifiers.get(pModId);
        return this.addMod(tNewMod);
    }

    // Token: 0x0600167D RID: 5757 RVA: 0x000E0820 File Offset: 0x000DEA20
    public bool addMod(ItemModAsset pModAsset)
    {
        if (this.hasMod(pModAsset))
        {
            return false;
        }
        foreach (string ptr in this.data.modifiers)
        {
            string tModID = ptr;
            if (AssetManager.items_modifiers.get(tModID).mod_type == pModAsset.mod_type)
            {
                return false;
            }
        }
        this.data.modifiers.Add(pModAsset.id);
        World.world.items.setDirty();
        return true;
    }

    // Token: 0x0600167E RID: 5758 RVA: 0x000E08C8 File Offset: 0x000DEAC8
    public bool removeMod(string pModId)
    {
        World.world.items.setDirty();
        return this.data.modifiers.Remove(pModId);
    }

    // Token: 0x0600167F RID: 5759 RVA: 0x000E08EA File Offset: 0x000DEAEA
    public void setUnitHasIt(Actor pActor)
    {
        this._actor = pActor;
        this._city = null;
        this.unit_has_it = true;
        this.city_has_it = false;
    }

    // Token: 0x06001680 RID: 5760 RVA: 0x000E0908 File Offset: 0x000DEB08
    public void setInCityStorage(City pCity)
    {
        this._actor = null;
        this._city = pCity;
        this.unit_has_it = false;
        this.city_has_it = true;
    }

    // Token: 0x06001681 RID: 5761 RVA: 0x000E0926 File Offset: 0x000DEB26
    public void setShouldBeRemoved()
    {
        this.shouldbe_removed = true;
    }

    // Token: 0x06001682 RID: 5762 RVA: 0x000E092F File Offset: 0x000DEB2F
    public void clearUnit()
    {
        this._actor = null;
        this.unit_has_it = false;
        World.world.items.setDirty();
    }

    // Token: 0x06001683 RID: 5763 RVA: 0x000E094E File Offset: 0x000DEB4E
    public void clearCity()
    {
        this._city = null;
        this.city_has_it = false;
        World.world.items.setDirty();
    }

    // Token: 0x06001684 RID: 5764 RVA: 0x000E096D File Offset: 0x000DEB6D
    public Actor getActor()
    {
        return this._actor;
    }

    // Token: 0x06001685 RID: 5765 RVA: 0x000E0975 File Offset: 0x000DEB75
    public City getCity()
    {
        return this._city;
    }

    // Token: 0x06001686 RID: 5766 RVA: 0x000E097D File Offset: 0x000DEB7D
    public void calculateValues()
    {
        this.recalculateTexturePath();
        ItemTools.calcItemValues(this, this._total_stats);
        this._item_value = ItemTools.s_value;
        this._quality = ItemTools.s_quality;
        this.data.durability = this._asset.durability;
    }

    // Token: 0x06001687 RID: 5767 RVA: 0x000E09BD File Offset: 0x000DEBBD
    public void initItem()
    {
        this.initFields();
        this.calculateValues();
    }

    // Token: 0x06001688 RID: 5768 RVA: 0x000E09CB File Offset: 0x000DEBCB
    public override void loadData(ItemData pData)
    {
        base.loadData(pData);
        this.initFields();
        this.calculateValues();
    }

    // Token: 0x06001689 RID: 5769 RVA: 0x000E09E0 File Offset: 0x000DEBE0
    private void initFields()
    {
        EquipmentAsset tAsset = AssetManager.items.get(this.data.asset_id);
        this.setAsset(tAsset);
    }

    // Token: 0x0600168A RID: 5770 RVA: 0x000E0A0A File Offset: 0x000DEC0A
    public EquipmentAsset getAsset()
    {
        return this._asset;
    }

    // Token: 0x17000152 RID: 338
    // (get) Token: 0x0600168B RID: 5771 RVA: 0x000E0A12 File Offset: 0x000DEC12
    public EquipmentAsset asset
    {
        get
        {
            return this.getAsset();
        }
    }

    // Token: 0x0600168C RID: 5772 RVA: 0x000E0A1C File Offset: 0x000DEC1C
    public string getItemDescription()
    {
        string tLocaleKey;
        if (this.data.created_by_player)
        {
            tLocaleKey = "item_template_description_full_player";
        }
        else
        {
            tLocaleKey = "item_template_description_full";
        }
        string tTemplateHistory = LocalizedTextManager.getText(tLocaleKey, null, false);
        string tTemplateUnknown = LocalizedTextManager.getText("item_template_description_age_only", null, false);
        if (string.IsNullOrEmpty(this.data.by))
        {
            tTemplateHistory = tTemplateUnknown;
        }
        int tAge = this.getAge();
        tTemplateHistory = tTemplateHistory.Replace("$item_creator_name$", Toolbox.coloredString(this.data.by, this.data.byColor));
        tTemplateHistory = tTemplateHistory.Replace("$item_creator_kingdom$", Toolbox.coloredString(this.data.from, this.data.fromColor));
        tTemplateHistory = tTemplateHistory.Replace("$item_creator_years$", tAge.ToString() ?? "");
        if (tAge == 1)
        {
            tTemplateHistory = tTemplateHistory.Replace("$year_ending$", LocalizedTextManager.getText("item_template_description_year", null, false) ?? "");
        }
        else
        {
            tTemplateHistory = tTemplateHistory.Replace("$year_ending$", LocalizedTextManager.getText("item_template_description_years", null, false) ?? "");
        }
        return tTemplateHistory;
    }

    // Token: 0x0600168D RID: 5773 RVA: 0x000E0B28 File Offset: 0x000DED28
    public string getItemKeyType()
    {
        return this._asset.getLocaleRarity(this.getQuality());
    }

    // Token: 0x0600168E RID: 5774 RVA: 0x000E0B3B File Offset: 0x000DED3B
    public void countKill()
    {
        this.data.kills++;
    }

    // Token: 0x0600168F RID: 5775 RVA: 0x000E0B50 File Offset: 0x000DED50
    public bool isRangeAttack()
    {
        return this.getAsset().attack_type == WeaponType.Range;
    }

    // Token: 0x06001690 RID: 5776 RVA: 0x000E0B60 File Offset: 0x000DED60
    public BaseStats getFullStats()
    {
        return this._total_stats;
    }

    // Token: 0x06001691 RID: 5777 RVA: 0x000E0B68 File Offset: 0x000DED68
    public int getValue()
    {
        return this._item_value;
    }

    // Token: 0x06001692 RID: 5778 RVA: 0x000E0B70 File Offset: 0x000DED70
    public Rarity getQuality()
    {
        return this._quality;
    }

    // Token: 0x06001693 RID: 5779 RVA: 0x000E0B78 File Offset: 0x000DED78
    public string getTextureID()
    {
        return this._texture_id;
    }

    // Token: 0x17000153 RID: 339
    // (get) Token: 0x06001694 RID: 5780 RVA: 0x000E0B80 File Offset: 0x000DED80
    public override string name
    {
        get
        {
            return this.getName(false);
        }
    }

    // Token: 0x06001695 RID: 5781 RVA: 0x000E0B8C File Offset: 0x000DED8C
    public string getName(bool pWithMaterial = true)
    {
        string tName;
        string tMaterial;
        ItemTools.getTooltipTitle(this.getAsset(), out tName, out tMaterial);
        if (!string.IsNullOrEmpty(this.data.name))
        {
            tName = this.data.name;
        }
        else
        {
            tName = tMaterial + tName;
        }
        return tName;
    }

    // Token: 0x06001696 RID: 5782 RVA: 0x000E0BD1 File Offset: 0x000DEDD1
    public string getQualityColor()
    {
        return this.getQuality().getRarityColorHex();
    }

    // Token: 0x06001697 RID: 5783 RVA: 0x000E0BE0 File Offset: 0x000DEDE0
    public static string getQualityString(Rarity pRarity)
    {
        string tQuality = "";
        switch (pRarity)
        {
            case Rarity.R0_Normal:
                tQuality = "";
                break;
            case Rarity.R1_Rare:
                tQuality = "_rare";
                break;
            case Rarity.R2_Epic:
                tQuality = "_epic";
                break;
            case Rarity.R3_Legendary:
                tQuality = "_legendary";
                break;
        }
        return tQuality;
    }

    // Token: 0x06001698 RID: 5784 RVA: 0x000E0C2A File Offset: 0x000DEE2A
    public Sprite getSprite()
    {
        return this._asset.getSprite();
    }

    // Token: 0x06001699 RID: 5785 RVA: 0x000E0C37 File Offset: 0x000DEE37
    public bool hasActor()
    {
        return this.getActor() != null;
    }

    // Token: 0x0600169A RID: 5786 RVA: 0x000E0C42 File Offset: 0x000DEE42
    public bool hasCity()
    {
        return this.getCity() != null;
    }

    // Token: 0x0600169B RID: 5787 RVA: 0x000E0C4D File Offset: 0x000DEE4D
    public override void Dispose()
    {
        this._asset = null;
        this._texture_id = null;
        this._total_stats.reset();
        this._actor = null;
        this.action_attack_target = null;
        base.Dispose();
    }

    // Token: 0x0600169C RID: 5788 RVA: 0x000E0C7C File Offset: 0x000DEE7C
    private bool isCheatEnabled()
    {
        return DebugConfig.isOn(DebugOption.UnlockAllEquipment) || WorldLawLibrary.world_law_cursed_world.isEnabled();
    }

    // Token: 0x040012C7 RID: 4807
    private EquipmentAsset _asset;

    // Token: 0x040012C8 RID: 4808
    private string _texture_id;

    // Token: 0x040012C9 RID: 4809
    public bool unit_has_it;

    // Token: 0x040012CA RID: 4810
    public bool city_has_it;

    // Token: 0x040012CB RID: 4811
    public bool shouldbe_removed;

    // Token: 0x040012CC RID: 4812
    private Actor _actor;

    // Token: 0x040012CD RID: 4813
    private City _city;

    // Token: 0x040012CE RID: 4814
    private int _item_value;

    // Token: 0x040012CF RID: 4815
    private readonly BaseStats _total_stats = new BaseStats();

    // Token: 0x040012D0 RID: 4816
    private Rarity _quality;

    // Token: 0x040012D1 RID: 4817
    public AttackAction action_attack_target;
}
using System;
using UnityEngine;

// Token: 0x0200010D RID: 269
[Serializable]
public class EquipmentAsset : ItemAsset, IHandRenderer
{
    // Token: 0x06000837 RID: 2103 RVA: 0x0007209D File Offset: 0x0007029D
    public Sprite[] getSprites()
    {
        return this.gameplay_sprites;
    }

    // Token: 0x1700002B RID: 43
    // (get) Token: 0x06000838 RID: 2104 RVA: 0x000720A5 File Offset: 0x000702A5
    public bool is_colored
    {
        get
        {
            return this.colored;
        }
    }

    // Token: 0x1700002C RID: 44
    // (get) Token: 0x06000839 RID: 2105 RVA: 0x000720AD File Offset: 0x000702AD
    public bool is_animated
    {
        get
        {
            return this.animated;
        }
    }
}
using System;
using System.Collections;
using System.Collections.Generic;

// Token: 0x0200010B RID: 267
public class ActorEquipment : IEnumerable<ActorEquipmentSlot>, IEnumerable
{
    // Token: 0x06000824 RID: 2084 RVA: 0x00071D04 File Offset: 0x0006FF04
    public ActorEquipment()
    {
        this.initDictionary();
    }

    // Token: 0x06000825 RID: 2085 RVA: 0x00071D68 File Offset: 0x0006FF68
    public void destroyAllEquipment()
    {
        foreach (ActorEquipmentSlot tSlot in this._dictionary.Values)
        {
            if (!tSlot.isEmpty())
            {
                tSlot.takeAwayItem();
            }
        }
    }

    // Token: 0x06000826 RID: 2086 RVA: 0x00071DC8 File Offset: 0x0006FFC8
    private void initDictionary()
    {
        this._dictionary = new Dictionary<EquipmentType, ActorEquipmentSlot>();
        this._dictionary.Add(EquipmentType.Helmet, this.helmet);
        this._dictionary.Add(EquipmentType.Armor, this.armor);
        this._dictionary.Add(EquipmentType.Weapon, this.weapon);
        this._dictionary.Add(EquipmentType.Boots, this.boots);
        this._dictionary.Add(EquipmentType.Ring, this.ring);
        this._dictionary.Add(EquipmentType.Amulet, this.amulet);
    }

    // Token: 0x06000827 RID: 2087 RVA: 0x00071E4C File Offset: 0x0007004C
    public bool hasItems()
    {
        using (Dictionary<EquipmentType, ActorEquipmentSlot>.ValueCollection.Enumerator enumerator = this._dictionary.Values.GetEnumerator())
        {
            while (enumerator.MoveNext())
            {
                if (!enumerator.Current.isEmpty())
                {
                    return true;
                }
            }
        }
        return false;
    }

    // Token: 0x06000828 RID: 2088 RVA: 0x00071EAC File Offset: 0x000700AC
    public IEnumerable<Item> getItems()
    {
        foreach (ActorEquipmentSlot tSlot in this._dictionary.Values)
        {
            if (!tSlot.isEmpty())
            {
                yield return tSlot.getItem();
            }
        }
        Dictionary<EquipmentType, ActorEquipmentSlot>.ValueCollection.Enumerator enumerator = default(Dictionary<EquipmentType, ActorEquipmentSlot>.ValueCollection.Enumerator);
        yield break;
        yield break;
    }

    // Token: 0x06000829 RID: 2089 RVA: 0x00071EBC File Offset: 0x000700BC
    public List<long> getDataForSave()
    {
        List<long> tItemsIDs = new List<long>();
        foreach (ActorEquipmentSlot tSlot in this)
        {
            tItemsIDs.Add(tSlot.getItem().data.id);
        }
        if (tItemsIDs.Count == 0)
        {
            return null;
        }
        return tItemsIDs;
    }

    // Token: 0x0600082A RID: 2090 RVA: 0x00071F24 File Offset: 0x00070124
    public void load(List<long> pList, Actor pActor)
    {
        if (pList == null || pList.Count == 0)
        {
            return;
        }
        foreach (long tID in pList)
        {
            Item tItem = World.world.items.get(tID);
            if (tItem != null)
            {
                EquipmentAsset tAsset = tItem.getAsset();
                if (tAsset != null)
                {
                    this.getSlot(tAsset.equipment_type).setItem(tItem, pActor);
                }
            }
        }
        this.initDictionary();
    }

    // Token: 0x0600082B RID: 2091 RVA: 0x00071FB0 File Offset: 0x000701B0
    public void setItem(Item pItem, Actor pActor)
    {
        this.getSlot(pItem.getAsset().equipment_type).setItem(pItem, pActor);
    }

    // Token: 0x0600082C RID: 2092 RVA: 0x00071FCA File Offset: 0x000701CA
    public ActorEquipmentSlot getSlot(EquipmentType pType)
    {
        return this._dictionary[pType];
    }

    // Token: 0x0600082D RID: 2093 RVA: 0x00071FD8 File Offset: 0x000701D8
    public IEnumerator<ActorEquipmentSlot> GetEnumerator()
    {
        foreach (ActorEquipmentSlot tSlot in this._dictionary.Values)
        {
            if (!tSlot.isEmpty())
            {
                yield return tSlot;
            }
        }
        Dictionary<EquipmentType, ActorEquipmentSlot>.ValueCollection.Enumerator enumerator = default(Dictionary<EquipmentType, ActorEquipmentSlot>.ValueCollection.Enumerator);
        yield break;
        yield break;
    }

    // Token: 0x0600082E RID: 2094 RVA: 0x00071FE7 File Offset: 0x000701E7
    IEnumerator IEnumerable.GetEnumerator()
    {
        return this.GetEnumerator();
    }

    // Token: 0x04000877 RID: 2167
    public const int SLOTS_AMOUNT = 6;

    // Token: 0x04000878 RID: 2168
    public const string NONE = "none";

    // Token: 0x04000879 RID: 2169
    public ActorEquipmentSlot helmet = new ActorEquipmentSlot(EquipmentType.Helmet);

    // Token: 0x0400087A RID: 2170
    public ActorEquipmentSlot armor = new ActorEquipmentSlot(EquipmentType.Armor);

    // Token: 0x0400087B RID: 2171
    public ActorEquipmentSlot weapon = new ActorEquipmentSlot(EquipmentType.Weapon);

    // Token: 0x0400087C RID: 2172
    public ActorEquipmentSlot boots = new ActorEquipmentSlot(EquipmentType.Boots);

    // Token: 0x0400087D RID: 2173
    public ActorEquipmentSlot ring = new ActorEquipmentSlot(EquipmentType.Ring);

    // Token: 0x0400087E RID: 2174
    public ActorEquipmentSlot amulet = new ActorEquipmentSlot(EquipmentType.Amulet);

    // Token: 0x0400087F RID: 2175
    private Dictionary<EquipmentType, ActorEquipmentSlot> _dictionary;
}
using System;
using UnityEngine;

// Token: 0x0200010C RID: 268
public class ActorEquipmentSlot
{
    // Token: 0x0600082F RID: 2095 RVA: 0x00071FEF File Offset: 0x000701EF
    public ActorEquipmentSlot(EquipmentType pType = EquipmentType.Armor)
    {
        this.type = pType;
    }

    // Token: 0x06000830 RID: 2096 RVA: 0x00071FFE File Offset: 0x000701FE
    public Item getItem()
    {
        return this._item;
    }

    // Token: 0x06000831 RID: 2097 RVA: 0x00072006 File Offset: 0x00070206
    public bool isEmpty()
    {
        if (this._item == null)
        {
            return true;
        }
        if (this._item.shouldbe_removed)
        {
            Debug.LogError("Item should be removed but it's still in the slot!");
            return true;
        }
        return false;
    }

    // Token: 0x1700002A RID: 42
    // (get) Token: 0x06000832 RID: 2098 RVA: 0x0007202C File Offset: 0x0007022C
    public bool is_empty
    {
        get
        {
            return this.isEmpty();
        }
    }

    // Token: 0x06000833 RID: 2099 RVA: 0x00072034 File Offset: 0x00070234
    public void takeAwayItem()
    {
        if (this.isEmpty())
        {
            return;
        }
        this._item.clearUnit();
        this._item = null;
    }

    // Token: 0x06000834 RID: 2100 RVA: 0x00072051 File Offset: 0x00070251
    public void setEmptyDebug()
    {
        this._item = null;
    }

    // Token: 0x06000835 RID: 2101 RVA: 0x0007205A File Offset: 0x0007025A
    internal void setItem(Item pItem, Actor pActor)
    {
        if (!this.isEmpty())
        {
            this.takeAwayItem();
        }
        this._item = pItem;
        this._item.setUnitHasIt(pActor);
        pActor.setStatsDirty();
    }

    // Token: 0x06000836 RID: 2102 RVA: 0x00072083 File Offset: 0x00070283
    public bool canChangeSlot()
    {
        return this.isEmpty() || !this.getItem().isCursed();
    }

    // Token: 0x04000880 RID: 2176
    private Item _item;

    // Token: 0x04000881 RID: 2177
    public EquipmentType type;
}
using System;
using UnityEngine;

// Token: 0x02000469 RID: 1129
public class WorldTimer
{
    // Token: 0x06002638 RID: 9784 RVA: 0x00136DF4 File Offset: 0x00134FF4
    public WorldTimer(float pInterval, Action pCallback)
    {
        this.interval = pInterval;
        this.callback = pCallback;
        this.timer = this.interval;
    }

    // Token: 0x06002639 RID: 9785 RVA: 0x00136E16 File Offset: 0x00135016
    public void setTime(float pNewTime)
    {
        this.timer = pNewTime;
    }

    // Token: 0x0600263A RID: 9786 RVA: 0x00136E1F File Offset: 0x0013501F
    internal void setInterval(float pInterval)
    {
        this.interval = pInterval;
    }

    // Token: 0x0600263B RID: 9787 RVA: 0x00136E28 File Offset: 0x00135028
    public WorldTimer(float pInterval, bool pStopWatch)
    {
        this.isStopWatch = pStopWatch;
        this.interval = pInterval;
        this.timer = 0f;
        this.isActive = false;
    }

    // Token: 0x0600263C RID: 9788 RVA: 0x00136E50 File Offset: 0x00135050
    public void startTimer(float pRate = -1f)
    {
        if (pRate != -1f)
        {
            this.interval = pRate;
        }
        this.timer = this.interval;
    }

    // Token: 0x0600263D RID: 9789 RVA: 0x00136E6D File Offset: 0x0013506D
    public void stop()
    {
        this.isActive = false;
    }

    // Token: 0x0600263E RID: 9790 RVA: 0x00136E78 File Offset: 0x00135078
    public void update(float pElapsed = -1f)
    {
        if (pElapsed == -1f)
        {
            pElapsed = Time.deltaTime;
        }
        if (this.isStopWatch)
        {
            if (this.timer > 0f)
            {
                this.timer -= pElapsed;
                this.isActive = true;
                return;
            }
            this.isActive = false;
            return;
        }
        else
        {
            if (this.timer > 0f)
            {
                this.timer -= pElapsed;
                return;
            }
            this.timer = this.interval;
            this.callback();
            return;
        }
    }

    // Token: 0x04001D7C RID: 7548
    public bool isActive;

    // Token: 0x04001D7D RID: 7549
    private bool isStopWatch;

    // Token: 0x04001D7E RID: 7550
    private Action callback;

    // Token: 0x04001D7F RID: 7551
    private float interval;

    // Token: 0x04001D80 RID: 7552
    internal float timer;
}
using System;
using System.IO;
using Newtonsoft.Json;
using UnityEngine;

// Token: 0x020001C5 RID: 453
public class GameStats : MonoBehaviour
{
    // Token: 0x06000D46 RID: 3398 RVA: 0x000B8B78 File Offset: 0x000B6D78
    private void Start()
    {
        this.dataPath = Application.persistentDataPath + "/stats.json";
        this.loadData();
        if (this.data == null)
        {
            this.data = new GameStatsData();
        }
        else
        {
            this.checkDataForErrors();
        }
        this.saveTimer = new WorldTimer(30f, new Action(this.saveData));
        this.data.gameLaunches += 1L;
    }

    // Token: 0x06000D47 RID: 3399 RVA: 0x000B8BEB File Offset: 0x000B6DEB
    internal bool goodForAds()
    {
        return true;
    }

    // Token: 0x06000D48 RID: 3400 RVA: 0x000B8BF0 File Offset: 0x000B6DF0
    private void saveData()
    {
        string tWhat = "Stats";
        bool hasError = false;
        string tPathSaveData = this.dataPath;
        string tTempPath = this.dataPath + ".tmp";
        try
        {
            if (!Directory.Exists(Application.persistentDataPath))
            {
                Directory.CreateDirectory(Application.persistentDataPath);
            }
        }
        catch (Exception message)
        {
            WorldTip.showNow("Error creating directory to save stats in! Check console for details", false, "top", 3f, "#F3961F");
            Debug.Log("Error creating directory: " + Application.persistentDataPath);
            Debug.Log(message);
        }
        try
        {
            using (FileStream fs = new FileStream(tTempPath, FileMode.Create, FileAccess.Write))
            {
                using (StreamWriter sw = new StreamWriter(fs))
                {
                    using (JsonWriter writer = new JsonTextWriter(sw))
                    {
                        new JsonSerializer().Serialize(writer, this.data);
                    }
                }
            }
        }
        catch (IOException e)
        {
            if (Toolbox.IsDiskFull(e))
            {
                WorldTip.showNow("Error saving " + tWhat + " : Disk full!", false, "top", 3f, "#F3961F");
            }
            else
            {
                Debug.Log("Could not save " + tWhat + " due to hard drive / IO Error : ");
                Debug.Log(e);
                WorldTip.showNow("Error saving " + tWhat + " due to IOError! Check console for details", false, "top", 3f, "#F3961F");
            }
            hasError = true;
        }
        catch (Exception message2)
        {
            Debug.Log("Could not save " + tWhat + " due to error : ");
            Debug.Log(message2);
            WorldTip.showNow("Error saving " + tWhat + "! Check console for errors", false, "top", 3f, "#F3961F");
            hasError = true;
        }
        if (hasError)
        {
            if (File.Exists(tTempPath))
            {
                File.Delete(tTempPath);
            }
        }
        else
        {
            Toolbox.MoveSafely(tTempPath, tPathSaveData);
        }
        AchievementLibrary.achievementLifeIsASim.check(null, null, null);
    }

    // Token: 0x06000D49 RID: 3401 RVA: 0x000B8DF8 File Offset: 0x000B6FF8
    private void checkDataForErrors()
    {
        if (double.IsNaN(this.data.gameTime) || double.IsInfinity(this.data.gameTime) || this.data.gameTime < 0.0)
        {
            Debug.Log(this.data.gameTime);
            Debug.LogError("Game time is NaN or Infinity! Resetting to 0");
            this.data.gameTime = 0.0;
        }
        if (this.data.creaturesBorn < 0L)
        {
            this.data.creaturesBorn = Math.Max(0L, this.data.creaturesDied - this.data.creaturesCreated);
        }
    }

    // Token: 0x06000D4A RID: 3402 RVA: 0x000B8EAC File Offset: 0x000B70AC
    private void loadData()
    {
        if (!File.Exists(this.dataPath))
        {
            return;
        }
        try
        {
            using (FileStream fs = new FileStream(this.dataPath, FileMode.Open, FileAccess.Read))
            {
                using (StreamReader sr = new StreamReader(fs))
                {
                    using (JsonReader reader = new JsonTextReader(sr))
                    {
                        JsonSerializer serializer = new JsonSerializer();
                        this.data = serializer.Deserialize<GameStatsData>(reader);
                    }
                }
            }
        }
        catch (Exception message)
        {
            Debug.Log("exception caught when loading stats");
            Debug.LogError(message);
        }
        if (this.data == null)
        {
            Debug.LogError("(!) stats not has been loaded");
        }
    }

    // Token: 0x06000D4B RID: 3403 RVA: 0x000B8F74 File Offset: 0x000B7174
    public void updateStats(float pTime)
    {
        this.data.gameTime = this.data.gameTime + (double)pTime;
        this.saveTimer.update(-1f);
    }

    // Token: 0x04000D50 RID: 3408
    internal GameStatsData data;

    // Token: 0x04000D51 RID: 3409
    private string dataPath;

    // Token: 0x04000D52 RID: 3410
    private WorldTimer saveTimer;
}
using System;

// Token: 0x020001C4 RID: 452
[Serializable]
public class GameStatsData
{
    // Token: 0x04000D23 RID: 3363
    public double gameTime;

    // Token: 0x04000D24 RID: 3364
    public long treesGrown;

    // Token: 0x04000D25 RID: 3365
    public long floraGrown;

    // Token: 0x04000D26 RID: 3366
    public long meteoritesLaunched;

    // Token: 0x04000D27 RID: 3367
    public long pixelsExploded;

    // Token: 0x04000D28 RID: 3368
    public long creaturesBorn;

    // Token: 0x04000D29 RID: 3369
    public long creaturesCreated;

    // Token: 0x04000D2A RID: 3370
    public long creaturesDied;

    // Token: 0x04000D2B RID: 3371
    public long subspeciesCreated;

    // Token: 0x04000D2C RID: 3372
    public long subspeciesExtinct;

    // Token: 0x04000D2D RID: 3373
    public long languagesCreated;

    // Token: 0x04000D2E RID: 3374
    public long languagesForgotten;

    // Token: 0x04000D2F RID: 3375
    public long booksWritten;

    // Token: 0x04000D30 RID: 3376
    public long booksRead;

    // Token: 0x04000D31 RID: 3377
    public long booksBurnt;

    // Token: 0x04000D32 RID: 3378
    public long culturesCreated;

    // Token: 0x04000D33 RID: 3379
    public long culturesForgotten;

    // Token: 0x04000D34 RID: 3380
    public long religionsCreated;

    // Token: 0x04000D35 RID: 3381
    public long religionsForgotten;

    // Token: 0x04000D36 RID: 3382
    public long kingdomsCreated;

    // Token: 0x04000D37 RID: 3383
    public long kingdomsDestroyed;

    // Token: 0x04000D38 RID: 3384
    public long citiesCreated;

    // Token: 0x04000D39 RID: 3385
    public long citiesConquered;

    // Token: 0x04000D3A RID: 3386
    public long citiesRebelled;

    // Token: 0x04000D3B RID: 3387
    public long citiesDestroyed;

    // Token: 0x04000D3C RID: 3388
    public long alliancesMade;

    // Token: 0x04000D3D RID: 3389
    public long alliancesDissolved;

    // Token: 0x04000D3E RID: 3390
    public long warsStarted;

    // Token: 0x04000D3F RID: 3391
    public long peacesMade;

    // Token: 0x04000D40 RID: 3392
    public long plotsStarted;

    // Token: 0x04000D41 RID: 3393
    public long plotsSucceeded;

    // Token: 0x04000D42 RID: 3394
    public long plotsForgotten;

    // Token: 0x04000D43 RID: 3395
    public long familiesCreated;

    // Token: 0x04000D44 RID: 3396
    public long familiesDestroyed;

    // Token: 0x04000D45 RID: 3397
    public long clansCreated;

    // Token: 0x04000D46 RID: 3398
    public long clansDestroyed;

    // Token: 0x04000D47 RID: 3399
    public long armiesCreated;

    // Token: 0x04000D48 RID: 3400
    public long creaturesSacrificed;

    // Token: 0x04000D49 RID: 3401
    public long elvesSacrificed;

    // Token: 0x04000D4A RID: 3402
    public long boatsDestroyedByMagnet;

    // Token: 0x04000D4B RID: 3403
    public long gameLaunches;

    // Token: 0x04000D4C RID: 3404
    public long bombsDropped;

    // Token: 0x04000D4D RID: 3405
    public long wallsPlaced;

    // Token: 0x04000D4E RID: 3406
    public long workshopUploads;

    // Token: 0x04000D4F RID: 3407
    public long mapsCreated;
}
using System;
using System.Collections.Generic;
using UnityEngine;

// Token: 0x020002D2 RID: 722
public class WarManager : MetaSystemManager<War, WarData>
{
    // Token: 0x06001B1B RID: 6939 RVA: 0x000F719A File Offset: 0x000F539A
    public WarManager()
    {
        this.type_id = "war";
    }

    // Token: 0x06001B1C RID: 6940 RVA: 0x000F71C3 File Offset: 0x000F53C3
    protected override void updateDirtyUnits()
    {
    }

    // Token: 0x06001B1D RID: 6941 RVA: 0x000F71C5 File Offset: 0x000F53C5
    public override void clear()
    {
        base.clear();
        this.warStateChanged();
    }

    // Token: 0x06001B1E RID: 6942 RVA: 0x000F71D4 File Offset: 0x000F53D4
    public override void checkDeadObjects()
    {
        if (this.Count <= 20)
        {
            return;
        }
        foreach (War tWar in this)
        {
            if (!tWar.isFavorite() && tWar.hasEnded())
            {
                this._end_wars.Add(tWar);
            }
        }
        if (this._end_wars.Count == 0)
        {
            return;
        }
        int tToRemove = this.Count - 20;
        this._end_wars.Sort((War a, War b) => a.data.died_time.CompareTo(b.data.died_time));
        int tLength = Mathf.Min(this._end_wars.Count, tToRemove);
        for (int i = 0; i < tLength; i++)
        {
            War tWar2 = this._end_wars[i];
            this.removeObject(tWar2);
        }
        this._end_wars.Clear();
    }

    // Token: 0x06001B1F RID: 6943 RVA: 0x000F72C4 File Offset: 0x000F54C4
    public void warStateChanged()
    {
        this.cache_war_check.clear();
        Kingdom.cache_enemy_check.clear();
    }

    // Token: 0x06001B20 RID: 6944 RVA: 0x000F72DC File Offset: 0x000F54DC
    public override void update(float pElapsed)
    {
        base.update(pElapsed);
        int i = this.list.Count;
        while (i-- > 0)
        {
            this.list[i].update();
        }
    }

    // Token: 0x06001B21 RID: 6945 RVA: 0x000F7317 File Offset: 0x000F5517
    public void stopAllWars()
    {
        this._end_wars.AddRange(this);
        this.endWars(WarWinner.Peace);
    }

    // Token: 0x06001B22 RID: 6946 RVA: 0x000F732C File Offset: 0x000F552C
    private void endWars(WarWinner pWinner = WarWinner.Nobody)
    {
        if (this._end_wars.Count == 0)
        {
            return;
        }
        foreach (War tWar in this._end_wars)
        {
            this.endWar(tWar, pWinner);
        }
        this._end_wars.Clear();
    }

    // Token: 0x06001B23 RID: 6947 RVA: 0x000F739C File Offset: 0x000F559C
    public bool isInWarWith(Kingdom pKingdom, Kingdom pKingdomTarget)
    {
        long tHashCode = this.cache_war_check.getHash(pKingdom, pKingdomTarget);
        bool tCacheResult;
        if (this.cache_war_check.dict.TryGetValue(tHashCode, out tCacheResult))
        {
            return tCacheResult;
        }
        using (IEnumerator<War> enumerator = pKingdom.getWars(false).GetEnumerator())
        {
            while (enumerator.MoveNext())
            {
                if (enumerator.Current.isInWarWith(pKingdom, pKingdomTarget))
                {
                    this.cache_war_check.dict.Add(tHashCode, true);
                    return true;
                }
            }
        }
        this.cache_war_check.dict.Add(tHashCode, false);
        return false;
    }

    // Token: 0x06001B24 RID: 6948 RVA: 0x000F743C File Offset: 0x000F563C
    public War getWar(Kingdom pAttacker, Kingdom pDefender, bool pOnlyMain = true)
    {
        foreach (War tWar in this)
        {
            if (!tWar.hasEnded())
            {
                if (tWar.isMainAttacker(pAttacker) && tWar.isMainDefender(pDefender))
                {
                    return tWar;
                }
                if (tWar.isMainAttacker(pDefender) && tWar.isMainDefender(pAttacker))
                {
                    return tWar;
                }
            }
        }
        if (!pOnlyMain)
        {
            foreach (War tWar2 in this)
            {
                if (!tWar2.hasEnded() && tWar2.isInWarWith(pAttacker, pDefender))
                {
                    return tWar2;
                }
            }
        }
        return null;
    }

    // Token: 0x06001B25 RID: 6949 RVA: 0x000F7500 File Offset: 0x000F5700
    public War getForcedWar(Kingdom pKingdom)
    {
        foreach (War tWar in this)
        {
            if (!tWar.hasEnded() && tWar.getAsset().forced_war && tWar.isMainDefender(pKingdom))
            {
                return tWar;
            }
        }
        return null;
    }

    // Token: 0x06001B26 RID: 6950 RVA: 0x000F7568 File Offset: 0x000F5768
    public IEnumerable<War> getWars(Kingdom pKingdom, bool pRandom = false)
    {
        foreach (War tWar in (pRandom ? this.list.LoopRandom<War>() : this))
        {
            if (!tWar.hasEnded() && tWar.hasKingdom(pKingdom))
            {
                yield return tWar;
            }
        }
        IEnumerator<War> enumerator = null;
        yield break;
        yield break;
    }

    // Token: 0x06001B27 RID: 6951 RVA: 0x000F7586 File Offset: 0x000F5786
    public IEnumerable<War> getWars(Alliance pAlliance, bool pRandom = false)
    {
        foreach (War tWar in (pRandom ? this.list.LoopRandom<War>() : this))
        {
            if (!tWar.hasEnded())
            {
                foreach (Kingdom tKingdom in pAlliance.kingdoms_list)
                {
                    if (tWar.hasKingdom(tKingdom))
                    {
                        yield return tWar;
                        break;
                    }
                }
                List<Kingdom>.Enumerator enumerator2 = default(List<Kingdom>.Enumerator);
            }
        }
        IEnumerator<War> enumerator = null;
        yield break;
        yield break;
    }

    // Token: 0x06001B28 RID: 6952 RVA: 0x000F75A4 File Offset: 0x000F57A4
    public bool hasWars(Kingdom pKingdom)
    {
        using (IEnumerator<War> enumerator = this.getWars(pKingdom, false).GetEnumerator())
        {
            if (enumerator.MoveNext())
            {
                War war = enumerator.Current;
                return true;
            }
        }
        return false;
    }

    // Token: 0x06001B29 RID: 6953 RVA: 0x000F75F4 File Offset: 0x000F57F4
    public bool hasWars(Alliance pAlliance)
    {
        using (IEnumerator<War> enumerator = this.getWars(pAlliance, false).GetEnumerator())
        {
            if (enumerator.MoveNext())
            {
                War war = enumerator.Current;
                return true;
            }
        }
        return false;
    }

    // Token: 0x06001B2A RID: 6954 RVA: 0x000F7644 File Offset: 0x000F5844
    public bool haveCommonEnemy(Kingdom pKingdom1, Kingdom pKingdom2)
    {
        bool result;
        using (ListPool<Kingdom> tEnemies = pKingdom1.getEnemiesKingdoms())
        {
            using (ListPool<Kingdom> tEnemies2 = pKingdom2.getEnemiesKingdoms())
            {
                foreach (Kingdom ptr in tEnemies)
                {
                    Kingdom tKingdom = ptr;
                    foreach (Kingdom ptr2 in tEnemies2)
                    {
                        Kingdom tKingdom2 = ptr2;
                        if (tKingdom == tKingdom2)
                        {
                            return true;
                        }
                    }
                }
                result = false;
            }
        }
        return result;
    }

    // Token: 0x06001B2B RID: 6955 RVA: 0x000F7710 File Offset: 0x000F5910
    public War getRandomWarFor(Kingdom pKingdom)
    {
        using (IEnumerator<War> enumerator = this.getWars(pKingdom, true).GetEnumerator())
        {
            if (enumerator.MoveNext())
            {
                return enumerator.Current;
            }
        }
        return null;
    }

    // Token: 0x06001B2C RID: 6956 RVA: 0x000F7760 File Offset: 0x000F5960
    public void getWarCities(Kingdom pKingdom, ListPool<City> pCities)
    {
        using (ListPool<Kingdom> tEnemiesKingdoms = this.getEnemiesOf(pKingdom))
        {
            for (int i = 0; i < tEnemiesKingdoms.Count; i++)
            {
                Kingdom tKingdom = tEnemiesKingdoms[i];
                pCities.AddRange(tKingdom.cities);
            }
        }
    }

    // Token: 0x06001B2D RID: 6957 RVA: 0x000F77B8 File Offset: 0x000F59B8
    public ListPool<Kingdom> getNeutralKingdoms(Kingdom pKingdom, bool pOnlyWithoutWars = false, bool pOnlyWithoutAlliances = false)
    {
        ListPool<Kingdom> tListKingdoms = new ListPool<Kingdom>(World.world.kingdoms.Count);
        Alliance tAllianceMain = pKingdom.getAlliance();
        foreach (Kingdom iKingdom in World.world.kingdoms)
        {
            if (iKingdom != pKingdom && !this.isInWarWith(pKingdom, iKingdom) && (!pOnlyWithoutWars || !iKingdom.hasEnemies()))
            {
                Alliance tAlliance2 = iKingdom.getAlliance();
                if ((!pOnlyWithoutAlliances || tAlliance2 == null) && !Alliance.isSame(tAllianceMain, tAlliance2))
                {
                    tListKingdoms.Add(iKingdom);
                }
            }
        }
        return tListKingdoms;
    }

    // Token: 0x06001B2E RID: 6958 RVA: 0x000F7858 File Offset: 0x000F5A58
    public ListPool<Kingdom> getEnemiesOf(Kingdom pKingdom)
    {
        ListPool<Kingdom> tListKingdoms = new ListPool<Kingdom>(World.world.kingdoms.Count);
        foreach (Kingdom tKingdom in World.world.kingdoms)
        {
            if (tKingdom != pKingdom && pKingdom.isEnemy(tKingdom))
            {
                tListKingdoms.Add(tKingdom);
            }
        }
        return tListKingdoms;
    }

    // Token: 0x06001B2F RID: 6959 RVA: 0x000F78CC File Offset: 0x000F5ACC
    public void endWar(War pWar, WarWinner pWinner = WarWinner.Nobody)
    {
        if (!pWar.isAlive())
        {
            return;
        }
        if (pWar.hasEnded())
        {
            return;
        }
        World.world.game_stats.data.peacesMade += 1L;
        World.world.map_stats.peacesMade += 1L;
        pWar.setWinner(pWinner);
        this.warStateChanged();
        WorldLog.logWarEnded(pWar);
        pWar.endForSides(pWinner);
        pWar.data.died_time = World.world.getCurWorldTime();
    }

    // Token: 0x06001B30 RID: 6960 RVA: 0x000F7950 File Offset: 0x000F5B50
    public War newWar(Kingdom pAttacker, Kingdom pDefender, WarTypeAsset pType)
    {
        World.world.game_stats.data.warsStarted += 1L;
        World.world.map_stats.warsStarted += 1L;
        this.warStateChanged();
        War war = base.newObject();
        war.newWar(pAttacker, pDefender, pType);
        WarData data = war.data;
        Actor king = pAttacker.king;
        data.started_by_actor_name = ((king != null) ? king.getName() : null);
        WarData data2 = war.data;
        Actor king2 = pAttacker.king;
        data2.started_by_actor_id = ((king2 != null) ? king2.getID() : (-1L));
        war.data.started_by_kingdom_name = pAttacker.data.name;
        war.data.started_by_kingdom_id = pAttacker.data.id;
        string tTemplateID = pType.name_template;
        Kingdom tKingdomForName;
        if (pType.kingdom_for_name_attacker)
        {
            tKingdomForName = pAttacker;
        }
        else
        {
            tKingdomForName = pDefender;
        }
        war.data.name = NameGenerator.generateNameFromTemplate(tTemplateID, null, tKingdomForName, false);
        WarManager.checkHappinessFromStartOfWar(pAttacker);
        return war;
    }

    // Token: 0x06001B31 RID: 6961 RVA: 0x000F7A40 File Offset: 0x000F5C40
    public static void checkHappinessFromStartOfWar(Kingdom pKingdom)
    {
        if (pKingdom.hasCulture() && pKingdom.culture.hasTrait("happiness_from_war"))
        {
            for (int i = 0; i < pKingdom.units.Count; i++)
            {
                Actor tActor = pKingdom.units[i];
                if (tActor.hasCulture() && tActor.culture.hasTrait("happiness_from_war"))
                {
                    tActor.changeHappiness("just_started_war", 0);
                }
            }
        }
    }

    // Token: 0x06001B32 RID: 6962 RVA: 0x000F7AB4 File Offset: 0x000F5CB4
    public long countActiveWars()
    {
        long tCount = 0L;
        foreach (War war in this.getActiveWars())
        {
            tCount += 1L;
        }
        return tCount;
    }

    // Token: 0x06001B33 RID: 6963 RVA: 0x000F7B04 File Offset: 0x000F5D04
    public IEnumerable<War> getActiveWars()
    {
        foreach (War tWar in this)
        {
            if (!tWar.hasEnded())
            {
                yield return tWar;
            }
        }
        IEnumerator<War> enumerator = null;
        yield break;
        yield break;
    }

    // Token: 0x06001B34 RID: 6964 RVA: 0x000F7B14 File Offset: 0x000F5D14
    public override bool hasAny()
    {
        if (this.Count == 0)
        {
            return false;
        }
        using (IEnumerator<War> enumerator = this.getActiveWars().GetEnumerator())
        {
            if (enumerator.MoveNext())
            {
                War war = enumerator.Current;
                return true;
            }
        }
        return false;
    }

    // Token: 0x0400152B RID: 5419
    public KingdomCheckCache cache_war_check = new KingdomCheckCache();

    // Token: 0x0400152C RID: 5420
    private List<War> _end_wars = new List<War>();
}
using System;
using System.Collections.Generic;
using System.Linq;
using db;
using UnityEngine;

// Token: 0x020002D0 RID: 720
public class War : MetaObject<WarData>
{
    // Token: 0x170001A4 RID: 420
    // (get) Token: 0x06001AB9 RID: 6841 RVA: 0x000F5AD0 File Offset: 0x000F3CD0
    protected override MetaType meta_type
    {
        get
        {
            return MetaType.War;
        }
    }

    // Token: 0x170001A5 RID: 421
    // (get) Token: 0x06001ABA RID: 6842 RVA: 0x000F5AD4 File Offset: 0x000F3CD4
    public Kingdom main_attacker
    {
        get
        {
            return this.getMainAttacker();
        }
    }

    // Token: 0x170001A6 RID: 422
    // (get) Token: 0x06001ABB RID: 6843 RVA: 0x000F5ADC File Offset: 0x000F3CDC
    public Kingdom main_defender
    {
        get
        {
            return this.getMainDefender();
        }
    }

    // Token: 0x06001ABC RID: 6844 RVA: 0x000F5AE4 File Offset: 0x000F3CE4
    public Kingdom getMainAttacker()
    {
        return World.world.kingdoms.get(this.data.main_attacker) ?? World.world.kingdoms.db_get(this.data.main_attacker);
    }

    // Token: 0x06001ABD RID: 6845 RVA: 0x000F5B1E File Offset: 0x000F3D1E
    public Kingdom getMainDefender()
    {
        return World.world.kingdoms.get(this.data.main_defender) ?? World.world.kingdoms.db_get(this.data.main_defender);
    }

    // Token: 0x06001ABE RID: 6846 RVA: 0x000F5B58 File Offset: 0x000F3D58
    public bool isMainAttacker(Kingdom pKingdom)
    {
        return pKingdom.getID() == this.data.main_attacker;
    }

    // Token: 0x06001ABF RID: 6847 RVA: 0x000F5B6D File Offset: 0x000F3D6D
    public bool isMainDefender(Kingdom pKingdom)
    {
        return pKingdom.getID() == this.data.main_defender;
    }

    // Token: 0x06001AC0 RID: 6848 RVA: 0x000F5B82 File Offset: 0x000F3D82
    protected sealed override void setDefaultValues()
    {
        base.setDefaultValues();
    }

    // Token: 0x06001AC1 RID: 6849 RVA: 0x000F5B8C File Offset: 0x000F3D8C
    public override ColorAsset getColor()
    {
        Kingdom tMainAttacker = this.getMainAttacker();
        if (!tMainAttacker.isRekt())
        {
            return tMainAttacker.getColor();
        }
        using (IEnumerator<Kingdom> enumerator = (this.hasEnded() ? this.getAllAttackers() : this.getAttackers()).GetEnumerator())
        {
            if (enumerator.MoveNext())
            {
                return enumerator.Current.getColor();
            }
        }
        Kingdom tMainDefender = this.getMainDefender();
        if (!tMainDefender.isRekt())
        {
            return tMainDefender.getColor();
        }
        using (IEnumerator<Kingdom> enumerator = (this.hasEnded() ? this.getAllDefenders() : this.getDefenders()).GetEnumerator())
        {
            if (enumerator.MoveNext())
            {
                return enumerator.Current.getColor();
            }
        }
        return null;
    }

    // Token: 0x06001AC2 RID: 6850 RVA: 0x000F5C64 File Offset: 0x000F3E64
    public WarTypeAsset getAsset()
    {
        if (this._asset == null)
        {
            this._asset = AssetManager.war_types_library.get(this.data.war_type);
        }
        return this._asset;
    }

    // Token: 0x06001AC3 RID: 6851 RVA: 0x000F5C90 File Offset: 0x000F3E90
    public void newWar(Kingdom pAttacker, Kingdom pDefender, WarTypeAsset pAsset)
    {
        this.data.main_attacker = pAttacker.id;
        if (pDefender != null)
        {
            this.data.main_defender = pDefender.id;
        }
        this._asset = pAsset;
        this.data.war_type = pAsset.id;
        this.joinAttackers(pAttacker);
        if (pDefender != null)
        {
            this.joinDefenders(pDefender);
        }
        this.prepare();
    }

    // Token: 0x06001AC4 RID: 6852 RVA: 0x000F5CF1 File Offset: 0x000F3EF1
    public override void clearLastYearStats()
    {
        base.addRenown(1);
    }

    // Token: 0x06001AC5 RID: 6853 RVA: 0x000F5CFA File Offset: 0x000F3EFA
    public override void increaseBirths()
    {
        throw new NotImplementedException(base.GetType().Name);
    }

    // Token: 0x06001AC6 RID: 6854 RVA: 0x000F5D0C File Offset: 0x000F3F0C
    public override void increaseKills()
    {
        throw new NotImplementedException(base.GetType().Name);
    }

    // Token: 0x06001AC7 RID: 6855 RVA: 0x000F5D20 File Offset: 0x000F3F20
    public void increaseDeathsDefenders(AttackType pAttackType)
    {
        WarData data = this.data;
        int dead_defenders = data.dead_defenders;
        data.dead_defenders = dead_defenders + 1;
        this.increaseDeaths(pAttackType);
        base.addRenown(1);
    }

    // Token: 0x06001AC8 RID: 6856 RVA: 0x000F5D50 File Offset: 0x000F3F50
    public void increaseDeathsAttackers(AttackType pAttackType)
    {
        WarData data = this.data;
        int dead_attackers = data.dead_attackers;
        data.dead_attackers = dead_attackers + 1;
        this.increaseDeaths(pAttackType);
        base.addRenown(1);
    }

    // Token: 0x06001AC9 RID: 6857 RVA: 0x000F5D80 File Offset: 0x000F3F80
    public void leaveWar(Kingdom pKingdom)
    {
        base.addRenown(25);
        this.removeFromWar(pKingdom, true);
    }

    // Token: 0x06001ACA RID: 6858 RVA: 0x000F5D92 File Offset: 0x000F3F92
    public void lostWar(Kingdom pKingdom)
    {
        base.addRenown(50);
        this.removeFromWar(pKingdom, false);
        this.update();
    }

    // Token: 0x06001ACB RID: 6859 RVA: 0x000F5DAC File Offset: 0x000F3FAC
    internal void removeFromWar(Kingdom pKingdom, bool pInPeace)
    {
        if (this.isAttacker(pKingdom))
        {
            using (HashSet<Kingdom>.Enumerator enumerator = this._hashset_defenders.GetEnumerator())
            {
                while (enumerator.MoveNext())
                {
                    Kingdom tKDefender = enumerator.Current;
                    World.world.diplomacy.getRelation(pKingdom, tKDefender).data.timestamp_last_war_ended = World.world.getCurWorldTime();
                }
                goto IL_B1;
            }
        }
        foreach (Kingdom tKAttacker in this._hashset_attackers)
        {
            World.world.diplomacy.getRelation(pKingdom, tKAttacker).data.timestamp_last_war_ended = World.world.getCurWorldTime();
        }
    IL_B1:
        this.removeAttacker(pKingdom, pInPeace);
        this.removeDefender(pKingdom, pInPeace);
        if (this.isMainAttacker(pKingdom) && !this.trySelectNewMainAttacker())
        {
            World.world.wars.endWar(this, pInPeace ? WarWinner.Peace : WarWinner.Defenders);
        }
        else if (this.isMainDefender(pKingdom) && !this.trySelectNewMainDefender())
        {
            World.world.wars.endWar(this, pInPeace ? WarWinner.Peace : WarWinner.Attackers);
        }
        else
        {
            pKingdom.checkEndWar();
            if (pInPeace)
            {
                pKingdom.madePeace(this);
            }
            else
            {
                pKingdom.lostWar(this);
            }
        }
        this.prepare();
    }

    // Token: 0x06001ACC RID: 6860 RVA: 0x000F5F0C File Offset: 0x000F410C
    public int countAttackers()
    {
        return this._list_attackers.Count;
    }

    // Token: 0x06001ACD RID: 6861 RVA: 0x000F5F1C File Offset: 0x000F411C
    public bool trySelectNewMainAttacker()
    {
        if (this.countAttackers() <= 1)
        {
            return false;
        }
        this._list_attackers.Sort(new Comparison<Kingdom>(KingdomListComponent.sortByArmy));
        foreach (Kingdom tKingdom in this._list_attackers)
        {
            if (tKingdom.id != this.data.main_attacker)
            {
                this.data.main_attacker = tKingdom.id;
                return true;
            }
        }
        return false;
    }

    // Token: 0x06001ACE RID: 6862 RVA: 0x000F5FB8 File Offset: 0x000F41B8
    public bool trySelectNewMainDefender()
    {
        if (this.countDefenders() <= 1)
        {
            return false;
        }
        this._list_defenders.Sort(new Comparison<Kingdom>(KingdomListComponent.sortByArmy));
        foreach (Kingdom tKingdom in this._list_defenders)
        {
            if (tKingdom.id != this.data.main_defender)
            {
                this.data.main_defender = tKingdom.id;
                return true;
            }
        }
        return false;
    }

    // Token: 0x06001ACF RID: 6863 RVA: 0x000F6054 File Offset: 0x000F4254
    public IEnumerable<Kingdom> getAttackers()
    {
        if (this.hasEnded())
        {
            return this.getHistoricAttackers();
        }
        return this._list_attackers;
    }

    // Token: 0x06001AD0 RID: 6864 RVA: 0x000F606B File Offset: 0x000F426B
    public IEnumerable<Kingdom> getHistoricAttackers()
    {
        foreach (long tId in this.data.list_attackers)
        {
            Kingdom tKingdom = World.world.kingdoms.get(tId);
            if (tKingdom != null)
            {
                yield return tKingdom;
            }
            else
            {
                DeadKingdom tDeadKingdom = World.world.kingdoms.db_get(tId);
                if (tDeadKingdom != null)
                {
                    yield return tDeadKingdom;
                }
            }
        }
        List<long>.Enumerator enumerator = default(List<long>.Enumerator);
        yield break;
        yield break;
    }

    // Token: 0x06001AD1 RID: 6865 RVA: 0x000F607B File Offset: 0x000F427B
    public IEnumerable<Kingdom> getAllAttackers()
    {
        foreach (Kingdom tKingdom in this.getAttackers())
        {
            yield return tKingdom;
        }
        IEnumerator<Kingdom> enumerator = null;
        foreach (Kingdom tKingdom2 in this.getPastAttackers())
        {
            yield return tKingdom2;
        }
        enumerator = null;
        foreach (Kingdom tKingdom3 in this.getDiedAttackers())
        {
            yield return tKingdom3;
        }
        enumerator = null;
        yield break;
        yield break;
    }

    // Token: 0x06001AD2 RID: 6866 RVA: 0x000F608B File Offset: 0x000F428B
    public IEnumerable<Kingdom> getAllDefenders()
    {
        foreach (Kingdom tKingdom in this.getDefenders())
        {
            yield return tKingdom;
        }
        IEnumerator<Kingdom> enumerator = null;
        foreach (Kingdom tKingdom2 in this.getPastDefenders())
        {
            yield return tKingdom2;
        }
        enumerator = null;
        foreach (Kingdom tKingdom3 in this.getDiedDefenders())
        {
            yield return tKingdom3;
        }
        enumerator = null;
        yield break;
        yield break;
    }

    // Token: 0x06001AD3 RID: 6867 RVA: 0x000F609B File Offset: 0x000F429B
    public IEnumerable<Kingdom> getPastAttackers()
    {
        foreach (long tId in this.data.past_attackers)
        {
            Kingdom tKingdom = World.world.kingdoms.get(tId);
            if (tKingdom != null)
            {
                yield return tKingdom;
            }
            else
            {
                DeadKingdom tDeadKingdom = World.world.kingdoms.db_get(tId);
                if (tDeadKingdom != null)
                {
                    yield return tDeadKingdom;
                }
            }
        }
        List<long>.Enumerator enumerator = default(List<long>.Enumerator);
        yield break;
        yield break;
    }

    // Token: 0x06001AD4 RID: 6868 RVA: 0x000F60AB File Offset: 0x000F42AB
    public IEnumerable<Kingdom> getDiedAttackers()
    {
        foreach (long tId in this.data.died_attackers)
        {
            Kingdom tKingdom = World.world.kingdoms.get(tId);
            if (tKingdom != null)
            {
                yield return tKingdom;
            }
            else
            {
                DeadKingdom tDeadKingdom = World.world.kingdoms.db_get(tId);
                if (tDeadKingdom != null)
                {
                    yield return tDeadKingdom;
                }
            }
        }
        List<long>.Enumerator enumerator = default(List<long>.Enumerator);
        yield break;
        yield break;
    }

    // Token: 0x06001AD5 RID: 6869 RVA: 0x000F60BB File Offset: 0x000F42BB
    public IEnumerable<Kingdom> getActiveParties()
    {
        bool tAttackersFirst = Randy.randomBool();
        foreach (Kingdom tKingdom in (tAttackersFirst ? this.getAttackers() : this.getDefenders()))
        {
            if (tKingdom.isAlive())
            {
                yield return tKingdom;
            }
        }
        IEnumerator<Kingdom> enumerator = null;
        foreach (Kingdom tKingdom2 in (tAttackersFirst ? this.getDefenders() : this.getAttackers()))
        {
            if (tKingdom2.isAlive())
            {
                yield return tKingdom2;
            }
        }
        enumerator = null;
        yield break;
        yield break;
    }

    // Token: 0x06001AD6 RID: 6870 RVA: 0x000F60CC File Offset: 0x000F42CC
    public string getAttackersColorTextString()
    {
        Kingdom tMainAttacker = this.getMainAttacker();
        if (tMainAttacker != null)
        {
            return tMainAttacker.getColor().color_text;
        }
        using (IEnumerator<Kingdom> enumerator = (this.hasEnded() ? this.getAllAttackers() : this.getAttackers()).GetEnumerator())
        {
            if (enumerator.MoveNext())
            {
                return enumerator.Current.getColor().color_text;
            }
        }
        return "#F3961F";
    }

    // Token: 0x06001AD7 RID: 6871 RVA: 0x000F614C File Offset: 0x000F434C
    public string getDefendersColorTextString()
    {
        if (this.isTotalWar())
        {
            return "#F3961F";
        }
        Kingdom tMainDefender = this.getMainDefender();
        if (tMainDefender != null)
        {
            return tMainDefender.getColor().color_text;
        }
        return "#F3961F";
    }

    // Token: 0x06001AD8 RID: 6872 RVA: 0x000F6182 File Offset: 0x000F4382
    public int countDefenders()
    {
        if (!this.isTotalWar())
        {
            return this._list_defenders.Count;
        }
        return World.world.kingdoms.Count - 1;
    }

    // Token: 0x06001AD9 RID: 6873 RVA: 0x000F61A9 File Offset: 0x000F43A9
    public IEnumerable<Kingdom> getDefenders()
    {
        if (this.hasEnded())
        {
            foreach (Kingdom tKingdom in this.getHistoricDefenders())
            {
                yield return tKingdom;
            }
            IEnumerator<Kingdom> enumerator = null;
            yield break;
        }
        if (!this.isTotalWar())
        {
            foreach (Kingdom tKingdom2 in this._list_defenders)
            {
                yield return tKingdom2;
            }
            List<Kingdom>.Enumerator enumerator2 = default(List<Kingdom>.Enumerator);
        }
        else
        {
            foreach (Kingdom tKingdom3 in World.world.kingdoms)
            {
                if (!this.isMainAttacker(tKingdom3))
                {
                    yield return tKingdom3;
                }
            }
            IEnumerator<Kingdom> enumerator = null;
        }
        yield break;
        yield break;
    }

    // Token: 0x06001ADA RID: 6874 RVA: 0x000F61B9 File Offset: 0x000F43B9
    public IEnumerable<Kingdom> getHistoricDefenders()
    {
        foreach (long tId in this.data.list_defenders)
        {
            Kingdom tKingdom = World.world.kingdoms.get(tId);
            if (tKingdom != null)
            {
                yield return tKingdom;
            }
            else
            {
                DeadKingdom tDeadKingdom = World.world.kingdoms.db_get(tId);
                if (tDeadKingdom != null)
                {
                    yield return tDeadKingdom;
                }
            }
        }
        List<long>.Enumerator enumerator = default(List<long>.Enumerator);
        yield break;
        yield break;
    }

    // Token: 0x06001ADB RID: 6875 RVA: 0x000F61C9 File Offset: 0x000F43C9
    public IEnumerable<Kingdom> getPastDefenders()
    {
        foreach (long tId in this.data.past_defenders)
        {
            Kingdom tKingdom = World.world.kingdoms.get(tId);
            if (tKingdom != null)
            {
                yield return tKingdom;
            }
            else
            {
                DeadKingdom tDeadKingdom = World.world.kingdoms.db_get(tId);
                if (tDeadKingdom != null)
                {
                    yield return tDeadKingdom;
                }
            }
        }
        List<long>.Enumerator enumerator = default(List<long>.Enumerator);
        yield break;
        yield break;
    }

    // Token: 0x06001ADC RID: 6876 RVA: 0x000F61D9 File Offset: 0x000F43D9
    public IEnumerable<Kingdom> getDiedDefenders()
    {
        foreach (long tId in this.data.died_defenders)
        {
            Kingdom tKingdom = World.world.kingdoms.get(tId);
            if (tKingdom != null)
            {
                yield return tKingdom;
            }
            else
            {
                DeadKingdom tDeadKingdom = World.world.kingdoms.db_get(tId);
                if (tDeadKingdom != null)
                {
                    yield return tDeadKingdom;
                }
            }
        }
        List<long>.Enumerator enumerator = default(List<long>.Enumerator);
        yield break;
        yield break;
    }

    // Token: 0x06001ADD RID: 6877 RVA: 0x000F61EC File Offset: 0x000F43EC
    public void update()
    {
        if (this.hasEnded())
        {
            return;
        }
        if (!this.main_attacker.isAlive())
        {
            this.lostWar(this.main_attacker);
            return;
        }
        if (this.isTotalWar())
        {
            if (World.world.kingdoms.Count <= 1)
            {
                World.world.wars.endWar(this, WarWinner.Attackers);
                return;
            }
        }
        else if (!this.main_defender.isAlive())
        {
            this.lostWar(this.main_defender);
            return;
        }
        if (this.getAge() > 10 && !this.isTotalWar())
        {
            if (this.main_attacker.countCities() == 0)
            {
                this.lostWar(this.main_attacker);
                return;
            }
            if (this.main_defender.countCities() == 0)
            {
                this.lostWar(this.main_defender);
                return;
            }
        }
        for (int i = 0; i < this._list_attackers.Count; i++)
        {
            Kingdom tKingdom = this._list_attackers[i];
            if (!tKingdom.isAlive())
            {
                this.lostWar(tKingdom);
                return;
            }
        }
        if (!this.isTotalWar())
        {
            for (int i = 0; i < this._list_defenders.Count; i++)
            {
                Kingdom tKingdom2 = this._list_defenders[i];
                if (!tKingdom2.isAlive())
                {
                    this.lostWar(tKingdom2);
                    return;
                }
            }
        }
        if (this.isTotalWar())
        {
            if (this._list_attackers.Count == 0 || World.world.kingdoms.Count == 1)
            {
                Debug.LogError("[1] should never happen here");
                return;
            }
        }
        else if (this._list_attackers.Count == 0 || this._list_defenders.Count == 0)
        {
            Debug.LogError("[2] should never happen here");
        }
    }

    // Token: 0x06001ADE RID: 6878 RVA: 0x000F636C File Offset: 0x000F456C
    public bool isAttacker(Kingdom pKingdom)
    {
        return this._hashset_attackers.Contains(pKingdom);
    }

    // Token: 0x06001ADF RID: 6879 RVA: 0x000F637A File Offset: 0x000F457A
    public bool isDefender(Kingdom pKingdom)
    {
        return (this.isTotalWar() && !this.isMainAttacker(pKingdom)) || this._hashset_defenders.Contains(pKingdom);
    }

    // Token: 0x06001AE0 RID: 6880 RVA: 0x000F639B File Offset: 0x000F459B
    public List<Kingdom> getOppositeSideKingdom(Kingdom pKingdom)
    {
        if (this.isAttacker(pKingdom))
        {
            return this._list_defenders;
        }
        if (this.isDefender(pKingdom))
        {
            return this._list_attackers;
        }
        return null;
    }

    // Token: 0x06001AE1 RID: 6881 RVA: 0x000F63BE File Offset: 0x000F45BE
    public bool isTotalWar()
    {
        return this.getAsset().total_war;
    }

    // Token: 0x06001AE2 RID: 6882 RVA: 0x000F63CC File Offset: 0x000F45CC
    public bool isInWarWith(Kingdom pKingdom, Kingdom pTarget)
    {
        if (this.isTotalWar())
        {
            return this.isMainAttacker(pKingdom) || this.isMainAttacker(pTarget);
        }
        return (this.isAttacker(pKingdom) && this.isDefender(pTarget)) || (this.isDefender(pKingdom) && this.isAttacker(pTarget));
    }

    // Token: 0x06001AE3 RID: 6883 RVA: 0x000F6422 File Offset: 0x000F4622
    public bool onTheSameSide(Kingdom pKingdom1, Kingdom pKingdom2)
    {
        return (this.isAttacker(pKingdom1) && this.isAttacker(pKingdom2)) || (this.isDefender(pKingdom1) && this.isDefender(pKingdom2));
    }

    // Token: 0x06001AE4 RID: 6884 RVA: 0x000F644D File Offset: 0x000F464D
    public bool hasKingdom(Kingdom pKingdom)
    {
        return this.isTotalWar() || this.isAttacker(pKingdom) || this.isDefender(pKingdom);
    }

    // Token: 0x06001AE5 RID: 6885 RVA: 0x000F6470 File Offset: 0x000F4670
    public void joinAttackers(Kingdom pKingdom)
    {
        if (this.data.list_attackers.Contains(pKingdom.id))
        {
            return;
        }
        base.addRenown(5);
        this.data.past_attackers.Remove(pKingdom.id);
        this.data.list_attackers.Add(pKingdom.id);
        this.prepare();
    }

    // Token: 0x06001AE6 RID: 6886 RVA: 0x000F64D0 File Offset: 0x000F46D0
    public void joinDefenders(Kingdom pKingdom)
    {
        if (this.isTotalWar())
        {
            return;
        }
        if (this.data.list_defenders.Contains(pKingdom.id))
        {
            return;
        }
        base.addRenown(5);
        this.data.past_defenders.Remove(pKingdom.id);
        this.data.list_defenders.Add(pKingdom.id);
        this.prepare();
    }

    // Token: 0x06001AE7 RID: 6887 RVA: 0x000F6539 File Offset: 0x000F4739
    public override void loadData(WarData pData)
    {
        base.loadData(pData);
        this.prepare();
    }

    // Token: 0x06001AE8 RID: 6888 RVA: 0x000F6548 File Offset: 0x000F4748
    public void prepare()
    {
        this._list_attackers.Clear();
        this._list_defenders.Clear();
        this._hashset_attackers.Clear();
        this._hashset_defenders.Clear();
        if (this.data.died_attackers == null)
        {
            this.data.died_attackers = new List<long>();
        }
        if (this.data.died_defenders == null)
        {
            this.data.died_defenders = new List<long>();
        }
        if (this.data.past_attackers == null)
        {
            this.data.past_attackers = new List<long>();
        }
        if (this.data.past_defenders == null)
        {
            this.data.past_defenders = new List<long>();
        }
        foreach (long tId in this.data.list_attackers)
        {
            Kingdom tKingdom = World.world.kingdoms.get(tId);
            if (tKingdom != null)
            {
                this._list_attackers.Add(tKingdom);
                this._hashset_attackers.Add(tKingdom);
            }
        }
        foreach (long tId2 in this.data.list_defenders)
        {
            Kingdom tKingdom2 = World.world.kingdoms.get(tId2);
            if (tKingdom2 != null)
            {
                this._list_defenders.Add(tKingdom2);
                this._hashset_defenders.Add(tKingdom2);
            }
        }
        World.world.wars.warStateChanged();
    }

    // Token: 0x06001AE9 RID: 6889 RVA: 0x000F66E8 File Offset: 0x000F48E8
    public int getDeadAttackers()
    {
        return this.data.dead_attackers;
    }

    // Token: 0x06001AEA RID: 6890 RVA: 0x000F66F5 File Offset: 0x000F48F5
    public int getDeadDefenders()
    {
        return this.data.dead_defenders;
    }

    // Token: 0x06001AEB RID: 6891 RVA: 0x000F6704 File Offset: 0x000F4904
    public void endForSides(WarWinner pWinner)
    {
        foreach (Kingdom tAttacker in this._hashset_attackers)
        {
            tAttacker.checkEndWar();
            switch (pWinner)
            {
                case WarWinner.Attackers:
                    tAttacker.wonWar(this);
                    break;
                case WarWinner.Defenders:
                    tAttacker.lostWar(this);
                    break;
                case WarWinner.Peace:
                    tAttacker.madePeace(this);
                    break;
            }
        }
        foreach (Kingdom tDefender in this._hashset_defenders)
        {
            tDefender.checkEndWar();
            switch (pWinner)
            {
                case WarWinner.Attackers:
                    tDefender.lostWar(this);
                    break;
                case WarWinner.Defenders:
                    tDefender.wonWar(this);
                    break;
                case WarWinner.Peace:
                    tDefender.madePeace(this);
                    break;
            }
        }
        if (pWinner == WarWinner.Merged)
        {
            return;
        }
        foreach (Kingdom tKAttackers in this._hashset_attackers)
        {
            foreach (Kingdom tKDefenders in this._hashset_defenders)
            {
                World.world.diplomacy.getRelation(tKAttackers, tKDefenders).data.timestamp_last_war_ended = World.world.getCurWorldTime();
            }
        }
    }

    // Token: 0x06001AEC RID: 6892 RVA: 0x000F6898 File Offset: 0x000F4A98
    public int countKingdoms()
    {
        if (this.isTotalWar())
        {
            return World.world.kingdoms.Count;
        }
        return 0 + this.countAttackers() + this.countDefenders();
    }

    // Token: 0x06001AED RID: 6893 RVA: 0x000F68C1 File Offset: 0x000F4AC1
    public int countCities()
    {
        return this.countAttackersCities() + this.countDefendersCities();
    }

    // Token: 0x06001AEE RID: 6894 RVA: 0x000F68D0 File Offset: 0x000F4AD0
    public int countAttackersCities()
    {
        int tResult = 0;
        foreach (Kingdom tKingdom in (this.hasEnded() ? this.getAllAttackers() : this.getAttackers()))
        {
            tResult += tKingdom.cities.Count;
        }
        return tResult;
    }

    // Token: 0x06001AEF RID: 6895 RVA: 0x000F6938 File Offset: 0x000F4B38
    public int countDefendersCities()
    {
        int tResult = 0;
        foreach (Kingdom tKingdom in (this.hasEnded() ? this.getAllDefenders() : this.getDefenders()))
        {
            tResult += tKingdom.cities.Count;
        }
        return tResult;
    }

    // Token: 0x06001AF0 RID: 6896 RVA: 0x000F69A0 File Offset: 0x000F4BA0
    public int countDefendersPopulation()
    {
        int tResult = 0;
        foreach (Kingdom tKingdom in (this.hasEnded() ? this.getAllDefenders() : this.getDefenders()))
        {
            tResult += tKingdom.getPopulationPeople();
        }
        return tResult;
    }

    // Token: 0x06001AF1 RID: 6897 RVA: 0x000F6A04 File Offset: 0x000F4C04
    public int countDefendersWarriors()
    {
        int tResult = 0;
        foreach (Kingdom tKingdom in (this.hasEnded() ? this.getAllDefenders() : this.getDefenders()))
        {
            tResult += tKingdom.countTotalWarriors();
        }
        return tResult;
    }

    // Token: 0x06001AF2 RID: 6898 RVA: 0x000F6A68 File Offset: 0x000F4C68
    public int countDefendersMoney()
    {
        int tResult = 0;
        foreach (Kingdom tKingdom in (this.hasEnded() ? this.getAllDefenders() : this.getDefenders()))
        {
            tResult += tKingdom.countTotalMoney();
        }
        return tResult;
    }

    // Token: 0x06001AF3 RID: 6899 RVA: 0x000F6ACC File Offset: 0x000F4CCC
    public int countAttackersPopulation()
    {
        int tResult = 0;
        foreach (Kingdom tKingdom in (this.hasEnded() ? this.getAllAttackers() : this.getAttackers()))
        {
            tResult += tKingdom.getPopulationPeople();
        }
        return tResult;
    }

    // Token: 0x06001AF4 RID: 6900 RVA: 0x000F6B30 File Offset: 0x000F4D30
    public int countAttackersWarriors()
    {
        int tResult = 0;
        foreach (Kingdom tKingdom in (this.hasEnded() ? this.getAllAttackers() : this.getAttackers()))
        {
            tResult += tKingdom.countTotalWarriors();
        }
        return tResult;
    }

    // Token: 0x06001AF5 RID: 6901 RVA: 0x000F6B94 File Offset: 0x000F4D94
    public int countAttackersMoney()
    {
        int tResult = 0;
        foreach (Kingdom tKingdom in (this.hasEnded() ? this.getAllAttackers() : this.getAttackers()))
        {
            tResult += tKingdom.countTotalMoney();
        }
        return tResult;
    }

    // Token: 0x06001AF6 RID: 6902 RVA: 0x000F6BF8 File Offset: 0x000F4DF8
    public int countTotalPopulation()
    {
        return this.countAttackersPopulation() + this.countDefendersPopulation();
    }

    // Token: 0x06001AF7 RID: 6903 RVA: 0x000F6C07 File Offset: 0x000F4E07
    public int countTotalArmy()
    {
        return this.countAttackersWarriors() + this.countDefendersWarriors();
    }

    // Token: 0x06001AF8 RID: 6904 RVA: 0x000F6C16 File Offset: 0x000F4E16
    public override int countUnits()
    {
        return this.countTotalPopulation();
    }

    // Token: 0x06001AF9 RID: 6905 RVA: 0x000F6C1E File Offset: 0x000F4E1E
    public override IEnumerable<Actor> getUnits()
    {
        foreach (Kingdom tKingdom in this.getAttackers())
        {
            foreach (Actor tActor in tKingdom.getUnits())
            {
                yield return tActor;
            }
            IEnumerator<Actor> enumerator2 = null;
        }
        IEnumerator<Kingdom> enumerator = null;
        foreach (Kingdom tKingdom2 in this.getDefenders())
        {
            foreach (Actor tActor2 in tKingdom2.getUnits())
            {
                yield return tActor2;
            }
            IEnumerator<Actor> enumerator2 = null;
        }
        enumerator = null;
        yield break;
        yield break;
    }

    // Token: 0x06001AFA RID: 6906 RVA: 0x000F6C30 File Offset: 0x000F4E30
    public override Actor getRandomUnit()
    {
        Actor result;
        using (ListPool<Kingdom> tRandomKingdoms = new ListPool<Kingdom>(this.getActiveParties()))
        {
            foreach (Kingdom kingdom in tRandomKingdoms.LoopRandom<Kingdom>())
            {
                Actor tUnit = kingdom.getRandomUnit();
                if (tUnit != null)
                {
                    return tUnit;
                }
            }
            result = null;
        }
        return result;
    }

    // Token: 0x06001AFB RID: 6907 RVA: 0x000F6CAC File Offset: 0x000F4EAC
    public override bool isReadyForRemoval()
    {
        return false;
    }

    // Token: 0x06001AFC RID: 6908 RVA: 0x000F6CAF File Offset: 0x000F4EAF
    public bool hasEnded()
    {
        return !base.isAlive() || this.hasDied();
    }

    // Token: 0x06001AFD RID: 6909 RVA: 0x000F6CC4 File Offset: 0x000F4EC4
    public bool isSameAs(War pWar)
    {
        return !this.hasEnded() && pWar != null && !pWar.hasEnded() && (this._hashset_attackers.SetEquals(pWar._hashset_attackers) || this._hashset_defenders.SetEquals(pWar._hashset_attackers)) && (this._hashset_defenders.SetEquals(pWar._hashset_defenders) || this._hashset_attackers.SetEquals(pWar._hashset_defenders));
    }

    // Token: 0x06001AFE RID: 6910 RVA: 0x000F6D3B File Offset: 0x000F4F3B
    public int getYearEnded()
    {
        return Date.getYear(this.data.died_time);
    }

    // Token: 0x06001AFF RID: 6911 RVA: 0x000F6D4D File Offset: 0x000F4F4D
    public int getYearStarted()
    {
        return Date.getYear(this.data.created_time);
    }

    // Token: 0x06001B00 RID: 6912 RVA: 0x000F6D5F File Offset: 0x000F4F5F
    public int getDuration()
    {
        if (this.hasEnded())
        {
            return this.getYearEnded() - this.getYearStarted();
        }
        return Date.getYearsSince(this.data.created_time);
    }

    // Token: 0x06001B01 RID: 6913 RVA: 0x000F6D87 File Offset: 0x000F4F87
    public void setWinner(WarWinner pWinner)
    {
        if (pWinner == WarWinner.Nobody)
        {
            return;
        }
        this.data.winner = pWinner;
    }

    // Token: 0x06001B02 RID: 6914 RVA: 0x000F6D9C File Offset: 0x000F4F9C
    public void removeAttacker(Kingdom pKingdom, bool pInPeace)
    {
        if (!this.data.list_attackers.Contains(pKingdom.id))
        {
            return;
        }
        this.data.list_attackers.Remove(pKingdom.id);
        if (!pInPeace || !pKingdom.isAlive())
        {
            this.data.died_attackers.Add(pKingdom.id);
            return;
        }
        this.data.past_attackers.Add(pKingdom.id);
    }

    // Token: 0x06001B03 RID: 6915 RVA: 0x000F6E14 File Offset: 0x000F5014
    public void removeDefender(Kingdom pKingdom, bool pInPeace)
    {
        if (!this.data.list_defenders.Contains(pKingdom.id))
        {
            return;
        }
        this.data.list_defenders.Remove(pKingdom.id);
        if (!pInPeace || !pKingdom.isAlive())
        {
            this.data.died_defenders.Add(pKingdom.id);
            return;
        }
        this.data.past_defenders.Add(pKingdom.id);
    }

    // Token: 0x06001B04 RID: 6916 RVA: 0x000F6E8C File Offset: 0x000F508C
    public override void Dispose()
    {
        DBInserter.deleteData(this.getID(), "war");
        this._list_attackers.Clear();
        this._list_defenders.Clear();
        this._hashset_attackers.Clear();
        this._hashset_defenders.Clear();
        this._asset = null;
        base.Dispose();
    }

    // Token: 0x06001B05 RID: 6917 RVA: 0x000F6EE4 File Offset: 0x000F50E4
    public override string ToString()
    {
        string tResult = "War: ";
        tResult += (base.isAlive() ? "alive " : "dead ");
        if (base.isAlive())
        {
            tResult = tResult + base.id.ToString() + " ";
            tResult += " a:";
            tResult += string.Join<long>(",", from tKingdom in this.getAttackers()
                                              select tKingdom.id);
            tResult += " d:";
            tResult += string.Join<long>(",", from tKingdom in this.getDefenders()
                                              select tKingdom.id);
            tResult = tResult + " t:" + this.data.war_type;
            tResult = tResult + " w:" + this.data.winner.ToString();
            tResult = tResult + " e:" + this.hasEnded().ToString();
        }
        return tResult;
    }

    // Token: 0x04001516 RID: 5398
    private readonly List<Kingdom> _list_attackers = new List<Kingdom>();

    // Token: 0x04001517 RID: 5399
    private readonly List<Kingdom> _list_defenders = new List<Kingdom>();

    // Token: 0x04001518 RID: 5400
    private readonly HashSet<Kingdom> _hashset_attackers = new HashSet<Kingdom>();

    // Token: 0x04001519 RID: 5401
    private readonly HashSet<Kingdom> _hashset_defenders = new HashSet<Kingdom>();

    // Token: 0x0400151A RID: 5402
    private WarTypeAsset _asset;
}
using System;

// Token: 0x02000089 RID: 137
public class WarTypeLibrary : AssetLibrary<WarTypeAsset>
{
    // Token: 0x06000490 RID: 1168 RVA: 0x00031970 File Offset: 0x0002FB70
    public override void init()
    {
        base.init();
        WarTypeLibrary.normal = this.add(new WarTypeAsset
        {
            id = "normal",
            name_template = "war_conquest",
            localized_type = "war_type_conquest",
            localized_war_name = "war_name_conquest",
            path_icon = "wars/war_conquest",
            kingdom_for_name_attacker = true,
            alliance_join = true,
            can_end_with_plot = true
        });
        WarTypeLibrary.spite = this.add(new WarTypeAsset
        {
            id = "spite",
            name_template = "war_spite",
            localized_type = "war_type_spite",
            localized_war_name = "war_name_spite",
            path_icon = "wars/war_spite",
            kingdom_for_name_attacker = true,
            forced_war = true,
            total_war = true,
            alliance_join = false
        });
        WarTypeLibrary.inspire = this.add(new WarTypeAsset
        {
            id = "inspire",
            name_template = "war_inspire",
            localized_type = "war_type_inspire",
            localized_war_name = "war_name_inspire",
            path_icon = "wars/war_rebellion",
            kingdom_for_name_attacker = false,
            alliance_join = false,
            rebellion = true,
            can_end_with_plot = true
        });
        WarTypeLibrary.rebellion = this.add(new WarTypeAsset
        {
            id = "rebellion",
            name_template = "war_rebellion",
            localized_type = "war_type_rebellion",
            localized_war_name = "war_name_rebellion",
            path_icon = "wars/war_rebellion",
            kingdom_for_name_attacker = false,
            alliance_join = false,
            rebellion = true,
            can_end_with_plot = true
        });
        WarTypeLibrary.whisper_of_war = this.add(new WarTypeAsset
        {
            id = "whisper_of_war",
            name_template = "war_whisper",
            localized_type = "war_type_whisper",
            localized_war_name = "war_name_whisper",
            path_icon = "wars/war_whisper",
            kingdom_for_name_attacker = true,
            alliance_join = true
        });
    }

    // Token: 0x06000491 RID: 1169 RVA: 0x00031B60 File Offset: 0x0002FD60
    public override void editorDiagnosticLocales()
    {
        base.editorDiagnosticLocales();
        foreach (WarTypeAsset tAsset in this.list)
        {
            foreach (string tLocaleID in tAsset.getLocaleIDs())
            {
                this.checkLocale(tAsset, tLocaleID);
            }
        }
    }

    // Token: 0x040004DC RID: 1244
    public static WarTypeAsset normal;

    // Token: 0x040004DD RID: 1245
    public static WarTypeAsset spite;

    // Token: 0x040004DE RID: 1246
    public static WarTypeAsset inspire;

    // Token: 0x040004DF RID: 1247
    public static WarTypeAsset rebellion;

    // Token: 0x040004E0 RID: 1248
    public static WarTypeAsset whisper_of_war;

    // Token: 0x040004E1 RID: 1249
    public static WarTypeAsset clash;
}
using System;
using System.Collections.Generic;
using db;
using SQLite;

// Token: 0x02000277 RID: 631
public class KingdomManager : MetaSystemManager<Kingdom, KingdomData>
{
    // Token: 0x0600177C RID: 6012 RVA: 0x000E4031 File Offset: 0x000E2231
    public KingdomManager()
    {
        this.type_id = "kingdom";
    }

    // Token: 0x0600177D RID: 6013 RVA: 0x000E4060 File Offset: 0x000E2260
    public Kingdom makeNewCivKingdom(Actor pActor, string pID = null, bool pLog = true)
    {
        World.world.game_stats.data.kingdomsCreated += 1L;
        World.world.map_stats.kingdomsCreated += 1L;
        Kingdom tKingdom = base.newObject();
        tKingdom.newCivKingdom(pActor);
        pActor.joinKingdom(tKingdom);
        tKingdom.setKing(pActor, true);
        tKingdom.location = pActor.current_position;
        if (pLog)
        {
            WorldLog.logNewKingdom(tKingdom);
        }
        return tKingdom;
    }

    // Token: 0x0600177E RID: 6014 RVA: 0x000E40DA File Offset: 0x000E22DA
    protected override void addObject(Kingdom pObject)
    {
        base.addObject(pObject);
        ZoneCalculator zone_calculator = World.world.zone_calculator;
        if (zone_calculator != null)
        {
            zone_calculator.setDrawnZonesDirty();
        }
        pObject.createAI();
    }

    // Token: 0x0600177F RID: 6015 RVA: 0x000E4100 File Offset: 0x000E2300
    public override void removeObject(Kingdom pKingdom)
    {
        World.world.game_stats.data.kingdomsDestroyed += 1L;
        World.world.map_stats.kingdomsDestroyed += 1L;
        WorldLog.logKingdomDestroyed(pKingdom);
        World.world.diplomacy.removeRelationsFor(pKingdom);
        if (World.world.isSelectedPower("relations") && Config.selected_kingdom == pKingdom)
        {
            World.world.selected_buttons.unselectAll();
        }
        if (Config.whisper_A == pKingdom)
        {
            Config.whisper_A = null;
        }
        if (Config.unity_A == pKingdom)
        {
            Config.unity_A = null;
        }
        pKingdom.makeSurvivorsToNomads();
        World.world.zone_calculator.setDrawnZonesDirty();
        using (ListPool<War> tWarList = new ListPool<War>(pKingdom.getWars(false)))
        {
            foreach (War ptr in tWarList)
            {
                ptr.removeFromWar(pKingdom, false);
            }
            Alliance tAlliance = pKingdom.getAlliance();
            if (tAlliance != null)
            {
                tAlliance.leave(pKingdom, true);
            }
            World.world.cultures.setDirtyKingdoms();
            World.world.languages.setDirtyKingdoms();
            World.world.religions.setDirtyKingdoms();
            base.removeObject(pKingdom);
            DBInserter.insertData(pKingdom.data, this.type_id);
        }
    }

    // Token: 0x06001780 RID: 6016 RVA: 0x000E4270 File Offset: 0x000E2470
    public Kingdom getCivOrWildViaID(long pID)
    {
        if (pID < 0L)
        {
            return World.world.kingdoms_wild.get(pID);
        }
        return World.world.kingdoms.get(pID);
    }

    // Token: 0x06001781 RID: 6017 RVA: 0x000E4298 File Offset: 0x000E2498
    public override void update(float pElapsed)
    {
        base.update(pElapsed);
        foreach (Kingdom kingdom in this)
        {
            kingdom.clearCursorOver();
        }
        if (World.world.isPaused())
        {
            return;
        }
        this.updateCivKingdoms(pElapsed);
    }

    // Token: 0x06001782 RID: 6018 RVA: 0x000E42F8 File Offset: 0x000E24F8
    private void updateCivKingdoms(float pElapsed)
    {
        int i = 0;
        int tLength = this.list.Count;
        while (i < tLength)
        {
            this.list[i].updateCiv(pElapsed);
            i++;
        }
    }

    // Token: 0x06001783 RID: 6019 RVA: 0x000E4330 File Offset: 0x000E2530
    public void updateAge()
    {
        foreach (Kingdom kingdom in this)
        {
            kingdom.updateAge();
        }
    }

    // Token: 0x06001784 RID: 6020 RVA: 0x000E4378 File Offset: 0x000E2578
    public DeadKingdom db_get(long pID)
    {
        if (Config.disable_db)
        {
            return null;
        }
        DeadKingdom tDeadKingdom;
        if (this._dead_kingdoms.TryGetValue(pID, out tDeadKingdom))
        {
            return tDeadKingdom;
        }
        SQLiteConnectionWithLock tDBConn = DBManager.getSyncConnection();
        DeadKingdom result;
        using (tDBConn.Lock())
        {
            KingdomData tData = tDBConn.Find<KingdomData>(pID);
            if (tData == null)
            {
                result = null;
            }
            else
            {
                tData.from_db = true;
                tDeadKingdom = new DeadKingdom();
                tDeadKingdom.loadData(tData);
                this._dead_kingdoms[pID] = tDeadKingdom;
                result = tDeadKingdom;
            }
        }
        return result;
    }

    // Token: 0x06001785 RID: 6021 RVA: 0x000E4408 File Offset: 0x000E2608
    public override void clear()
    {
        foreach (DeadKingdom deadKingdom in this._dead_kingdoms.Values)
        {
            deadKingdom.Dispose();
        }
        this._dead_kingdoms.Clear();
        base.clear();
    }

    // Token: 0x06001786 RID: 6022 RVA: 0x000E4470 File Offset: 0x000E2670
    protected override void updateDirtyUnits()
    {
        for (int i = 0; i < World.world.units.units_only_dying.Count; i++)
        {
            World.world.units.units_only_dying[i].kingdom.preserveAlive();
        }
        List<Actor> tActorList = World.world.units.units_only_civ;
        for (int j = 0; j < tActorList.Count; j++)
        {
            Actor tUnit = tActorList[j];
            if (tUnit.kingdom.isDirtyUnits())
            {
                tUnit.kingdom.listUnit(tUnit);
            }
        }
    }

    // Token: 0x06001787 RID: 6023 RVA: 0x000E44FD File Offset: 0x000E26FD
    public void beginChecksCities()
    {
        if (this._dirty_cities)
        {
            this.updateDirtyCities();
        }
        this._dirty_cities = false;
    }

    // Token: 0x06001788 RID: 6024 RVA: 0x000E4514 File Offset: 0x000E2714
    public void updateDirtyCities()
    {
        this.clearAllCitiesLists();
        foreach (City tCity in World.world.cities)
        {
            tCity.kingdom.listCity(tCity);
        }
    }

    // Token: 0x06001789 RID: 6025 RVA: 0x000E4570 File Offset: 0x000E2770
    public void clearAllCitiesLists()
    {
        foreach (Kingdom kingdom in this)
        {
            kingdom.clearListCities();
        }
        WildKingdomsManager.neutral.clearListCities();
    }

    // Token: 0x0600178A RID: 6026 RVA: 0x000E45C0 File Offset: 0x000E27C0
    public void setDirtyCities()
    {
        this._dirty_cities = true;
    }

    // Token: 0x0600178B RID: 6027 RVA: 0x000E45C9 File Offset: 0x000E27C9
    public void beginChecksBuildings()
    {
        if (this._dirty_buildings)
        {
            this.updateDirtyBuildings();
        }
        this._dirty_buildings = false;
    }

    // Token: 0x0600178C RID: 6028 RVA: 0x000E45E0 File Offset: 0x000E27E0
    private void updateDirtyBuildings()
    {
        this.clearAllBuildingLists();
        foreach (Kingdom tKingdom in this)
        {
            List<City> tCities = tKingdom.cities;
            for (int i = 0; i < tCities.Count; i++)
            {
                City tCity = tCities[i];
                tKingdom.addBuildings(tCity.buildings);
            }
        }
    }

    // Token: 0x0600178D RID: 6029 RVA: 0x000E4658 File Offset: 0x000E2858
    public void setDirtyBuildings()
    {
        this._dirty_buildings = true;
    }

    // Token: 0x0600178E RID: 6030 RVA: 0x000E4664 File Offset: 0x000E2864
    private void clearAllBuildingLists()
    {
        foreach (Kingdom kingdom in this)
        {
            kingdom.clearBuildingList();
        }
    }

    // Token: 0x0400130E RID: 4878
    private bool _dirty_cities = true;

    // Token: 0x0400130F RID: 4879
    private bool _dirty_buildings = true;

    // Token: 0x04001310 RID: 4880
    protected readonly Dictionary<long, DeadKingdom> _dead_kingdoms = new Dictionary<long, DeadKingdom>();
}
using System;
using System.Collections.Generic;
using System.Runtime.CompilerServices;
using db;
using UnityEngine;

// Token: 0x02000274 RID: 628
public class Kingdom : MetaObjectWithTraits<KingdomData, KingdomTrait>
{
    // Token: 0x17000156 RID: 342
    // (get) Token: 0x060016CD RID: 5837 RVA: 0x000E21B0 File Offset: 0x000E03B0
    protected override MetaType meta_type
    {
        get
        {
            return MetaType.Kingdom;
        }
    }

    // Token: 0x17000157 RID: 343
    // (get) Token: 0x060016CE RID: 5838 RVA: 0x000E21B3 File Offset: 0x000E03B3
    protected override bool track_death_types
    {
        get
        {
            return true;
        }
    }

    // Token: 0x060016CF RID: 5839 RVA: 0x000E21B8 File Offset: 0x000E03B8
    protected override void recalcBaseStats()
    {
        base.recalcBaseStats();
        this._cached_tax_local = SimGlobals.m.base_tax_rate_local;
        this._cached_tax_tribute = SimGlobals.m.base_tax_rate_tribute;
        foreach (KingdomTrait tTrait in base.getTraits())
        {
            if (tTrait.is_local_tax_trait)
            {
                this._cached_tax_local = tTrait.tax_rate;
            }
            if (tTrait.is_tribute_tax_trait)
            {
                this._cached_tax_tribute = tTrait.tax_rate;
            }
        }
    }

    // Token: 0x17000158 RID: 344
    // (get) Token: 0x060016D0 RID: 5840 RVA: 0x000E224C File Offset: 0x000E044C
    protected override AssetLibrary<KingdomTrait> trait_library
    {
        get
        {
            return AssetManager.kingdoms_traits;
        }
    }

    // Token: 0x17000159 RID: 345
    // (get) Token: 0x060016D1 RID: 5841 RVA: 0x000E2253 File Offset: 0x000E0453
    protected override List<string> default_traits
    {
        get
        {
            return this.getActorAsset().default_kingdom_traits;
        }
    }

    // Token: 0x1700015A RID: 346
    // (get) Token: 0x060016D2 RID: 5842 RVA: 0x000E2260 File Offset: 0x000E0460
    protected override List<string> saved_traits
    {
        get
        {
            return this.data.saved_traits;
        }
    }

    // Token: 0x060016D3 RID: 5843 RVA: 0x000E226D File Offset: 0x000E046D
    protected sealed override void setDefaultValues()
    {
        base.setDefaultValues();
        this.power = 1;
        this.timer_action = 5f;
    }

    // Token: 0x060016D4 RID: 5844 RVA: 0x000E2287 File Offset: 0x000E0487
    protected override ColorLibrary getColorLibrary()
    {
        return AssetManager.kingdom_colors_library;
    }

    // Token: 0x060016D5 RID: 5845 RVA: 0x000E228E File Offset: 0x000E048E
    public void clearListCities()
    {
        this.cities.Clear();
    }

    // Token: 0x060016D6 RID: 5846 RVA: 0x000E229B File Offset: 0x000E049B
    public void clearBuildingList()
    {
        this.buildings.Clear();
    }

    // Token: 0x060016D7 RID: 5847 RVA: 0x000E22A8 File Offset: 0x000E04A8
    public override void increaseDeaths(AttackType pType)
    {
        if (!base.isAlive())
        {
            return;
        }
        base.increaseDeaths(pType);
        if (this.hasAlliance())
        {
            this.getAlliance().increaseDeaths(pType);
        }
    }

    // Token: 0x060016D8 RID: 5848 RVA: 0x000E22CE File Offset: 0x000E04CE
    public override void increaseKills()
    {
        if (!base.isAlive())
        {
            return;
        }
        base.increaseKills();
        if (this.hasAlliance())
        {
            this.getAlliance().increaseKills();
        }
    }

    // Token: 0x060016D9 RID: 5849 RVA: 0x000E22F2 File Offset: 0x000E04F2
    public override void increaseBirths()
    {
        if (!base.isAlive())
        {
            return;
        }
        base.increaseBirths();
        if (this.hasAlliance())
        {
            this.getAlliance().increaseBirths();
        }
        base.addRenown(1);
    }

    // Token: 0x060016DA RID: 5850 RVA: 0x000E2320 File Offset: 0x000E0520
    public void increaseLeft()
    {
        if (!base.isAlive())
        {
            return;
        }
        KingdomData data = this.data;
        long left = data.left;
        data.left = left + 1L;
    }

    // Token: 0x060016DB RID: 5851 RVA: 0x000E234C File Offset: 0x000E054C
    public void increaseJoined()
    {
        if (!base.isAlive())
        {
            return;
        }
        KingdomData data = this.data;
        long joined = data.joined;
        data.joined = joined + 1L;
        base.addRenown(1);
    }

    // Token: 0x060016DC RID: 5852 RVA: 0x000E2380 File Offset: 0x000E0580
    public void increaseMoved()
    {
        if (!base.isAlive())
        {
            return;
        }
        KingdomData data = this.data;
        long moved = data.moved;
        data.moved = moved + 1L;
        base.addRenown(2);
    }

    // Token: 0x060016DD RID: 5853 RVA: 0x000E23B4 File Offset: 0x000E05B4
    public void increaseMigrants()
    {
        if (!base.isAlive())
        {
            return;
        }
        KingdomData data = this.data;
        long migrated = data.migrated;
        data.migrated = migrated + 1L;
    }

    // Token: 0x060016DE RID: 5854 RVA: 0x000E23E0 File Offset: 0x000E05E0
    public long getTotalLeft()
    {
        return this.data.left;
    }

    // Token: 0x060016DF RID: 5855 RVA: 0x000E23ED File Offset: 0x000E05ED
    public long getTotalJoined()
    {
        return this.data.joined;
    }

    // Token: 0x060016E0 RID: 5856 RVA: 0x000E23FA File Offset: 0x000E05FA
    public long getTotalMoved()
    {
        return this.data.moved;
    }

    // Token: 0x060016E1 RID: 5857 RVA: 0x000E2407 File Offset: 0x000E0607
    public long getTotalMigrated()
    {
        return this.data.migrated;
    }

    // Token: 0x060016E2 RID: 5858 RVA: 0x000E2414 File Offset: 0x000E0614
    public override bool isReadyForRemoval()
    {
        return this.buildings.Count <= 0 && this.getPopulationTotal() <= 0 && !this.hasCities() && !World.world.projectiles.hasActiveProjectiles(this) && base.isReadyForRemoval();
    }

    // Token: 0x060016E3 RID: 5859 RVA: 0x000E2465 File Offset: 0x000E0665
    public bool hasBuildings()
    {
        return this.buildings.Count > 0;
    }

    // Token: 0x060016E4 RID: 5860 RVA: 0x000E2475 File Offset: 0x000E0675
    public void addBuildings(List<Building> pListBuildings)
    {
        this.buildings.AddRange(pListBuildings);
    }

    // Token: 0x060016E5 RID: 5861 RVA: 0x000E2483 File Offset: 0x000E0683
    public void listCity(City pCity)
    {
        this.cities.Add(pCity);
    }

    // Token: 0x060016E6 RID: 5862 RVA: 0x000E2491 File Offset: 0x000E0691
    public void listBuilding(Building pBuilding)
    {
        this.buildings.Add(pBuilding);
    }

    // Token: 0x060016E7 RID: 5863 RVA: 0x000E249F File Offset: 0x000E069F
    public Subspecies getMainSubspecies()
    {
        if (this.hasKing())
        {
            return this.king.subspecies;
        }
        if (base.units.Count == 0)
        {
            return null;
        }
        return base.units[0].subspecies;
    }

    // Token: 0x060016E8 RID: 5864 RVA: 0x000E24D5 File Offset: 0x000E06D5
    public void createWildKingdom()
    {
        this.asset.default_kingdom_color.initColor();
        this.wild = true;
    }

    // Token: 0x060016E9 RID: 5865 RVA: 0x000E24F0 File Offset: 0x000E06F0
    public void createAI()
    {
        if (!Globals.AI_TEST_ACTIVE)
        {
            return;
        }
        if (this.ai == null)
        {
            this.ai = new AiSystemKingdom(this);
        }
        this.ai.nextJobDelegate = new GetNextJobID(this.getNextJob);
        this.ai.jobs_library = AssetManager.job_kingdom;
        this.ai.task_library = AssetManager.tasks_kingdom;
    }

    // Token: 0x060016EA RID: 5866 RVA: 0x000E2550 File Offset: 0x000E0750
    public bool isOpinionTowardsKingdomGood(Kingdom pKingdom)
    {
        return this == pKingdom || World.world.diplomacy.getOpinion(this, pKingdom).total >= 0;
    }

    // Token: 0x060016EB RID: 5867 RVA: 0x000E2574 File Offset: 0x000E0774
    public string getNextJob()
    {
        return "kingdom";
    }

    // Token: 0x060016EC RID: 5868 RVA: 0x000E257B File Offset: 0x000E077B
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public bool isCiv()
    {
        return this.asset.civ;
    }

    // Token: 0x060016ED RID: 5869 RVA: 0x000E2588 File Offset: 0x000E0788
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public bool isMobs()
    {
        return this.asset.mobs;
    }

    // Token: 0x060016EE RID: 5870 RVA: 0x000E2595 File Offset: 0x000E0795
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public bool isNeutral()
    {
        return this.asset.neutral;
    }

    // Token: 0x060016EF RID: 5871 RVA: 0x000E25A2 File Offset: 0x000E07A2
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public bool isNature()
    {
        return this.asset.nature;
    }

    // Token: 0x060016F0 RID: 5872 RVA: 0x000E25AF File Offset: 0x000E07AF
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public bool isNomads()
    {
        return this.asset.nomads;
    }

    // Token: 0x060016F1 RID: 5873 RVA: 0x000E25BC File Offset: 0x000E07BC
    public override void save()
    {
        base.save();
        if (this.hasCulture())
        {
            this.data.id_culture = this.culture.id;
        }
        if (this.hasReligion())
        {
            this.data.id_religion = this.religion.id;
        }
        if (this.hasLanguage())
        {
            this.data.id_language = this.language.id;
        }
        if (this.hasKing())
        {
            this.data.kingID = this.king.data.id;
        }
        else
        {
            this.data.kingID = -1L;
        }
        this.data.saved_traits = base.getTraitsAsStrings();
    }

    // Token: 0x060016F2 RID: 5874 RVA: 0x000E266C File Offset: 0x000E086C
    public IEnumerable<War> getWars(bool pRandom = false)
    {
        return World.world.wars.getWars(this, pRandom);
    }

    // Token: 0x060016F3 RID: 5875 RVA: 0x000E2680 File Offset: 0x000E0880
    public bool isAttacker()
    {
        using (IEnumerator<War> enumerator = this.getWars(false).GetEnumerator())
        {
            while (enumerator.MoveNext())
            {
                if (enumerator.Current.isAttacker(this))
                {
                    return true;
                }
            }
        }
        return false;
    }

    // Token: 0x060016F4 RID: 5876 RVA: 0x000E26D8 File Offset: 0x000E08D8
    public bool isDefender()
    {
        using (IEnumerator<War> enumerator = this.getWars(false).GetEnumerator())
        {
            while (enumerator.MoveNext())
            {
                if (enumerator.Current.isDefender(this))
                {
                    return true;
                }
            }
        }
        return false;
    }

    // Token: 0x060016F5 RID: 5877 RVA: 0x000E2730 File Offset: 0x000E0930
    public bool isInWarWith(Kingdom pKingdom)
    {
        return World.world.wars.isInWarWith(this, pKingdom);
    }

    // Token: 0x060016F6 RID: 5878 RVA: 0x000E2744 File Offset: 0x000E0944
    public bool isInWarOnSameSide(Kingdom pKingdom)
    {
        using (IEnumerator<War> enumerator = this.getWars(false).GetEnumerator())
        {
            while (enumerator.MoveNext())
            {
                if (enumerator.Current.onTheSameSide(pKingdom, this))
                {
                    return true;
                }
            }
        }
        return false;
    }

    // Token: 0x060016F7 RID: 5879 RVA: 0x000E279C File Offset: 0x000E099C
    public bool isEnemy(Kingdom pKingdomTarget)
    {
        if (pKingdomTarget == null)
        {
            return true;
        }
        long tHashCode = Kingdom.cache_enemy_check.getHash(this, pKingdomTarget);
        bool tCacheResult;
        if (Kingdom.cache_enemy_check.dict.TryGetValue(tHashCode, out tCacheResult))
        {
            return tCacheResult;
        }
        if (this.isCiv() && pKingdomTarget.isCiv())
        {
            if (pKingdomTarget == this)
            {
                Kingdom.cache_enemy_check.dict[tHashCode] = false;
                return false;
            }
            if (World.world.wars.isInWarWith(this, pKingdomTarget))
            {
                Kingdom.cache_enemy_check.dict[tHashCode] = true;
                return true;
            }
            Kingdom.cache_enemy_check.dict[tHashCode] = false;
            return false;
        }
        else
        {
            if (this.asset.isFoe(pKingdomTarget.asset))
            {
                Kingdom.cache_enemy_check.dict[tHashCode] = true;
                return true;
            }
            Kingdom.cache_enemy_check.dict[tHashCode] = false;
            return false;
        }
    }

    // Token: 0x060016F8 RID: 5880 RVA: 0x000E286C File Offset: 0x000E0A6C
    public bool isGettingCaptured()
    {
        using (List<City>.Enumerator enumerator = this.cities.GetEnumerator())
        {
            while (enumerator.MoveNext())
            {
                if (enumerator.Current.isGettingCaptured())
                {
                    return true;
                }
            }
        }
        return false;
    }

    // Token: 0x1700015B RID: 347
    // (get) Token: 0x060016F9 RID: 5881 RVA: 0x000E28C8 File Offset: 0x000E0AC8
    public ColorAsset kingdomColor
    {
        get
        {
            return this.getColor();
        }
    }

    // Token: 0x060016FA RID: 5882 RVA: 0x000E28D0 File Offset: 0x000E0AD0
    public override ColorAsset getColor()
    {
        if (this.isCiv())
        {
            return base.getColor();
        }
        return this.asset.default_kingdom_color;
    }

    // Token: 0x060016FB RID: 5883 RVA: 0x000E28EC File Offset: 0x000E0AEC
    internal void newCivKingdom(Actor pActor)
    {
        this.asset = AssetManager.kingdoms.get(pActor.asset.kingdom_id_civilization);
        this.data.original_actor_asset = pActor.asset.id;
        this.data.name = pActor.generateName(MetaType.Kingdom, this.getID(), ActorSex.None);
        BaseSystemData data = this.data;
        Culture culture = this.culture;
        data.name_culture_id = ((culture != null) ? culture.id : (-1L));
        this.generateNewMetaObject();
    }

    // Token: 0x060016FC RID: 5884 RVA: 0x000E2967 File Offset: 0x000E0B67
    public override ActorAsset getActorAsset()
    {
        if (this.hasKing())
        {
            return this.king.getActorAsset();
        }
        return this.getFounderSpecies();
    }

    // Token: 0x060016FD RID: 5885 RVA: 0x000E2983 File Offset: 0x000E0B83
    public ActorAsset getFounderSpecies()
    {
        return AssetManager.actor_library.get(this.data.original_actor_asset);
    }

    // Token: 0x060016FE RID: 5886 RVA: 0x000E299C File Offset: 0x000E0B9C
    public string getSpecies()
    {
        if (string.IsNullOrEmpty(this.data.original_actor_asset))
        {
            return null;
        }
        ActorAsset tAsset = this.getActorAsset();
        if (tAsset == null)
        {
            return null;
        }
        return tAsset.id;
    }

    // Token: 0x060016FF RID: 5887 RVA: 0x000E29D0 File Offset: 0x000E0BD0
    public void trySetRoyalClan()
    {
        if (this.hasKing() && this.king.hasClan() && this.king.clan.id != this.data.royal_clan_id)
        {
            long tOldClanID = this.data.royal_clan_id;
            Clan tOldClan = World.world.clans.get(tOldClanID);
            if (tOldClan != null && tOldClan.isAlive())
            {
                this.logNewRoyalClanChanged(tOldClan, this.king.clan);
            }
            else if (this.king.clan.getRenown() >= 10)
            {
                this.logNewRoyalClan(this.king.clan);
            }
            this.data.royal_clan_id = this.king.clan.id;
        }
    }

    // Token: 0x06001700 RID: 5888 RVA: 0x000E2A91 File Offset: 0x000E0C91
    public void checkEndWar()
    {
        this.data.timestamp_last_war = World.world.getCurWorldTime();
    }

    // Token: 0x06001701 RID: 5889 RVA: 0x000E2AA8 File Offset: 0x000E0CA8
    public void madePeace(War pWar)
    {
        base.addRenown((int)((float)pWar.getRenown() * 0.25f));
        foreach (Actor actor in base.units)
        {
            actor.madePeace(pWar);
        }
    }

    // Token: 0x06001702 RID: 5890 RVA: 0x000E2B10 File Offset: 0x000E0D10
    public void wonWar(War pWar)
    {
        base.addRenown(pWar.getRenown());
        foreach (Actor actor in base.units)
        {
            actor.warWon(pWar);
        }
    }

    // Token: 0x06001703 RID: 5891 RVA: 0x000E2B70 File Offset: 0x000E0D70
    public void lostWar(War pWar)
    {
        base.addRenown((int)((float)pWar.getRenown() * 0.1f));
        foreach (Actor actor in base.units)
        {
            actor.warLost(pWar);
        }
    }

    // Token: 0x06001704 RID: 5892 RVA: 0x000E2BD8 File Offset: 0x000E0DD8
    internal void updateCiv(float pElapsed)
    {
        if (this.data.timer_new_king > 0f)
        {
            this.data.timer_new_king -= pElapsed;
        }
        if (this.ai != null)
        {
            if (this.timer_action > 0f)
            {
                this.timer_action -= pElapsed;
                return;
            }
            this.ai.update();
        }
    }

    // Token: 0x06001705 RID: 5893 RVA: 0x000E2C3C File Offset: 0x000E0E3C
    public void setCapital(City pCity)
    {
        this.capital = pCity;
        if (this.capital != null && this.capital.isAlive())
        {
            this.data.capitalID = (this.data.last_capital_id = pCity.data.id);
            this.location = this.capital.city_center;
            return;
        }
        this.data.capitalID = -1L;
    }

    // Token: 0x06001706 RID: 5894 RVA: 0x000E2CB0 File Offset: 0x000E0EB0
    public void setKing(Actor pActor, bool pNewKing = true)
    {
        this.king = pActor;
        this.king.setProfession(UnitProfession.King, true);
        if (pNewKing)
        {
            this.data.total_kings++;
            this.data.addRuler(pActor);
            this.data.timestamp_king_rule = World.world.getCurWorldTime();
            this.king.changeHappiness("become_king", 0);
        }
        this.trySetRoyalClan();
    }

    // Token: 0x06001707 RID: 5895 RVA: 0x000E2D20 File Offset: 0x000E0F20
    internal void kingLeftEvent()
    {
        if (!this.hasKing())
        {
            return;
        }
        if (this.king.isAlive())
        {
            this.king.changeHappiness("lost_crown", 0);
        }
        this.logKingLeft(this.king);
        this.removeKing();
    }

    // Token: 0x06001708 RID: 5896 RVA: 0x000E2D5C File Offset: 0x000E0F5C
    internal void removeKing()
    {
        if (!this.king.isRekt())
        {
            this.king.setProfession(UnitProfession.Unit, true);
        }
        this.data.rulerLeft();
        this.king = null;
        this.data.timer_new_king = Randy.randomFloat(5f, 20f);
    }

    // Token: 0x06001709 RID: 5897 RVA: 0x000E2DAF File Offset: 0x000E0FAF
    public void logKingDead(Actor pActor)
    {
        if (!pActor.attackedBy.isRekt() && pActor.attackedBy.isActor())
        {
            WorldLog.logKingMurder(this, pActor, pActor.attackedBy.a);
            return;
        }
        WorldLog.logKingDead(this, pActor);
    }

    // Token: 0x0600170A RID: 5898 RVA: 0x000E2DE5 File Offset: 0x000E0FE5
    public void logKingLeft(Actor pActor)
    {
        WorldLog.logKingLeft(this, pActor);
    }

    // Token: 0x0600170B RID: 5899 RVA: 0x000E2DEE File Offset: 0x000E0FEE
    public void logNewRoyalClanChanged(Clan pOldClan, Clan pNewClan)
    {
        WorldLog.logRoyalClanChanged(this, pOldClan, pNewClan);
    }

    // Token: 0x0600170C RID: 5900 RVA: 0x000E2DF8 File Offset: 0x000E0FF8
    public void logNewRoyalClan(Clan pClan)
    {
        WorldLog.logRoyalClanNew(this, pClan);
    }

    // Token: 0x0600170D RID: 5901 RVA: 0x000E2E01 File Offset: 0x000E1001
    public void logRoyalClanLost(Clan pClan)
    {
        WorldLog.logRoyalClanNoMore(this, pClan);
    }

    // Token: 0x0600170E RID: 5902 RVA: 0x000E2E0A File Offset: 0x000E100A
    internal void checkClearCapital(City pCity)
    {
        if (pCity.isCapitalCity())
        {
            this.clearCapital();
        }
    }

    // Token: 0x0600170F RID: 5903 RVA: 0x000E2E1A File Offset: 0x000E101A
    public void clearCapital()
    {
        this.data.capitalID = -1L;
        this.capital = null;
    }

    // Token: 0x06001710 RID: 5904 RVA: 0x000E2E30 File Offset: 0x000E1030
    public bool hasNearbyKingdoms()
    {
        using (List<City>.Enumerator enumerator = this.cities.GetEnumerator())
        {
            while (enumerator.MoveNext())
            {
                if (enumerator.Current.neighbours_kingdoms.Count > 0)
                {
                    return true;
                }
            }
        }
        return false;
    }

    // Token: 0x06001711 RID: 5905 RVA: 0x000E2E90 File Offset: 0x000E1090
    public void capturedFrom(Kingdom pKingdom)
    {
        World.world.diplomacy.getRelation(this, pKingdom);
    }

    // Token: 0x06001712 RID: 5906 RVA: 0x000E2EA4 File Offset: 0x000E10A4
    public virtual string getMotto()
    {
        if (string.IsNullOrEmpty(this.data.motto))
        {
            this.data.motto = NameGenerator.getName("kingdom_mottos", ActorSex.Male, false, null, null, false);
        }
        return this.data.motto;
    }

    // Token: 0x06001713 RID: 5907 RVA: 0x000E2EF0 File Offset: 0x000E10F0
    public override void generateBanner()
    {
        BannerAsset tAsset = AssetManager.kingdom_banners_library.get(this.getActorAsset().banner_id);
        this.data.banner_icon_id = Randy.randomInt(0, tAsset.icons.Count);
        this.data.banner_background_id = Randy.randomInt(0, tAsset.backgrounds.Count);
    }

    // Token: 0x06001714 RID: 5908 RVA: 0x000E2F4C File Offset: 0x000E114C
    public override void loadData(KingdomData pData)
    {
        base.loadData(pData);
        if (this.data.id_culture.hasValue())
        {
            this.setCulture(World.world.cultures.get(this.data.id_culture));
        }
        if (this.data.id_language.hasValue())
        {
            this.setLanguage(World.world.languages.get(this.data.id_language));
        }
        if (this.data.id_religion.hasValue())
        {
            this.setReligion(World.world.religions.get(this.data.id_religion));
        }
        ActorAsset tAsset = this.getActorAsset();
        this.asset = AssetManager.kingdoms.get(tAsset.kingdom_id_civilization);
    }

    // Token: 0x06001715 RID: 5909 RVA: 0x000E3014 File Offset: 0x000E1214
    internal void load2()
    {
        City tLoadedCapital = World.world.cities.get(this.data.capitalID);
        if (tLoadedCapital != null)
        {
            this.setCapital(tLoadedCapital);
        }
        if (this.data.kingID.hasValue())
        {
            Actor tLoadedUnitForKing = World.world.units.get(this.data.kingID);
            if (tLoadedUnitForKing != null)
            {
                this.setKing(tLoadedUnitForKing, false);
                tLoadedUnitForKing.setProfession(UnitProfession.King, true);
            }
        }
    }

    // Token: 0x06001716 RID: 5910 RVA: 0x000E3088 File Offset: 0x000E1288
    public override bool updateColor(ColorAsset pColor)
    {
        bool tResult = base.updateColor(pColor);
        if (tResult)
        {
            foreach (Building building in this.buildings)
            {
                building.updateKingdomColors();
            }
        }
        return tResult;
    }

    // Token: 0x06001717 RID: 5911 RVA: 0x000E30E4 File Offset: 0x000E12E4
    public static float distanceBetweenKingdom(Kingdom pKingdom, Kingdom pTarget)
    {
        if (pKingdom.cities.Count == 0 || pTarget.cities.Count == 0)
        {
            return -1f;
        }
        float tBestFastDist = float.MaxValue;
        List<City> tCities = pKingdom.cities;
        List<City> tTargetCities = pTarget.cities;
        for (int i = 0; i < tCities.Count; i++)
        {
            City tCity = tCities[i];
            for (int j = 0; j < tTargetCities.Count; j++)
            {
                City tCity2 = tTargetCities[j];
                float tFastDist = Toolbox.SquaredDistVec2Float(tCity.city_center, tCity2.city_center);
                if (tFastDist < tBestFastDist)
                {
                    tBestFastDist = tFastDist;
                }
            }
        }
        return tBestFastDist;
    }

    // Token: 0x06001718 RID: 5912 RVA: 0x000E317C File Offset: 0x000E137C
    public void clear()
    {
        this.buildings.Clear();
        this.cities.Clear();
        base.units.Clear();
        Kingdom.cache_enemy_check.clear();
        this.clearCapital();
    }

    // Token: 0x06001719 RID: 5913 RVA: 0x000E31B0 File Offset: 0x000E13B0
    public override void Dispose()
    {
        DBInserter.deleteData(this.getID(), "kingdom");
        this.clear();
        this.asset = null;
        this.king = null;
        this.capital = null;
        this.culture = null;
        this.language = null;
        this.religion = null;
        AiSystemKingdom aiSystemKingdom = this.ai;
        if (aiSystemKingdom != null)
        {
            aiSystemKingdom.reset();
        }
        base.Dispose();
    }

    // Token: 0x0600171A RID: 5914 RVA: 0x000E3214 File Offset: 0x000E1414
    public bool hasEnemies()
    {
        return World.world.wars.hasWars(this);
    }

    // Token: 0x0600171B RID: 5915 RVA: 0x000E3226 File Offset: 0x000E1426
    public ListPool<Kingdom> getEnemiesKingdoms()
    {
        return World.world.wars.getEnemiesOf(this);
    }

    // Token: 0x0600171C RID: 5916 RVA: 0x000E3238 File Offset: 0x000E1438
    public void makeSurvivorsToNomads()
    {
        if (base.units.Count == 0)
        {
            return;
        }
        for (int i = 0; i < base.units.Count; i++)
        {
            Actor tActor = base.units[i];
            if (tActor.isAlive())
            {
                if (tActor.asset.is_boat)
                {
                    tActor.getHitFullHealth(AttackType.None);
                }
                else
                {
                    tActor.cancelAllBeh();
                    tActor.removeFromPreviousFaction();
                    tActor.joinKingdom(World.world.kingdoms_wild.get(tActor.asset.kingdom_id_wild));
                }
            }
        }
        base.units.Clear();
    }

    // Token: 0x0600171D RID: 5917 RVA: 0x000E32CC File Offset: 0x000E14CC
    public void clearKingData()
    {
        this.king = null;
    }

    // Token: 0x0600171E RID: 5918 RVA: 0x000E32D5 File Offset: 0x000E14D5
    public void updateAge()
    {
        if (this.hasKing() && this.king.hasClan())
        {
            this.king.clan.addRenown(1);
        }
    }

    // Token: 0x0600171F RID: 5919 RVA: 0x000E3300 File Offset: 0x000E1500
    public override int countCouples()
    {
        int tResult = 0;
        foreach (City tCity in this.cities)
        {
            tResult += tCity.countCouples();
        }
        return tResult;
    }

    // Token: 0x06001720 RID: 5920 RVA: 0x000E3358 File Offset: 0x000E1558
    public override int countSingleMales()
    {
        int tResult = 0;
        foreach (City tCity in this.cities)
        {
            tResult += tCity.countSingleMales();
        }
        return tResult;
    }

    // Token: 0x06001721 RID: 5921 RVA: 0x000E33B0 File Offset: 0x000E15B0
    public override int countSingleFemales()
    {
        int tResult = 0;
        foreach (City tCity in this.cities)
        {
            tResult += tCity.countSingleFemales();
        }
        return tResult;
    }

    // Token: 0x06001722 RID: 5922 RVA: 0x000E3408 File Offset: 0x000E1608
    public int countZones()
    {
        int tResult = 0;
        foreach (City tCity in this.cities)
        {
            tResult += tCity.countZones();
        }
        return tResult;
    }

    // Token: 0x06001723 RID: 5923 RVA: 0x000E3460 File Offset: 0x000E1660
    public int countBuildings()
    {
        int tResult = 0;
        foreach (City tCity in this.cities)
        {
            tResult += tCity.countBuildings();
        }
        return tResult;
    }

    // Token: 0x06001724 RID: 5924 RVA: 0x000E34B8 File Offset: 0x000E16B8
    public int countCities()
    {
        return this.cities.Count;
    }

    // Token: 0x06001725 RID: 5925 RVA: 0x000E34C8 File Offset: 0x000E16C8
    public int getPopulationPeople()
    {
        if (!this._has_boats)
        {
            return base.units.Count;
        }
        int tResult = 0;
        int tBoats = 0;
        foreach (City tCity in this.cities)
        {
            tResult += tCity.getPopulationPeople();
            tBoats += tCity.countBoats();
        }
        if (tResult + tBoats == base.units.Count)
        {
            return tResult;
        }
        tResult = 0;
        using (List<Actor>.Enumerator enumerator2 = base.units.GetEnumerator())
        {
            while (enumerator2.MoveNext())
            {
                if (!enumerator2.Current.asset.is_boat)
                {
                    tResult++;
                }
            }
        }
        return tResult;
    }

    // Token: 0x06001726 RID: 5926 RVA: 0x000E35A0 File Offset: 0x000E17A0
    public override int countUnits()
    {
        return this.getPopulationPeople();
    }

    // Token: 0x06001727 RID: 5927 RVA: 0x000E35A8 File Offset: 0x000E17A8
    public override IEnumerable<Actor> getUnits()
    {
        foreach (Actor tActor in base.units)
        {
            if (tActor.isAlive() && !tActor.asset.is_boat)
            {
                yield return tActor;
            }
        }
        List<Actor>.Enumerator enumerator = default(List<Actor>.Enumerator);
        yield break;
        yield break;
    }

    // Token: 0x06001728 RID: 5928 RVA: 0x000E35B8 File Offset: 0x000E17B8
    public override Actor getRandomUnit()
    {
        foreach (Actor tActor in base.units.LoopRandom<Actor>())
        {
            if (tActor.isAlive() && !tActor.asset.is_boat)
            {
                return tActor;
            }
        }
        return null;
    }

    // Token: 0x06001729 RID: 5929 RVA: 0x000E3620 File Offset: 0x000E1820
    public int getPopulationTotal()
    {
        return base.units.Count;
    }

    // Token: 0x0600172A RID: 5930 RVA: 0x000E3630 File Offset: 0x000E1830
    public int countBoats()
    {
        int tResult = 0;
        for (int i = 0; i < this.cities.Count; i++)
        {
            City tCity = this.cities[i];
            tResult += tCity.countBoats();
        }
        return tResult;
    }

    // Token: 0x0600172B RID: 5931 RVA: 0x000E366C File Offset: 0x000E186C
    public int getPopulationTotalPossible()
    {
        int tResult = 0;
        for (int i = 0; i < this.cities.Count; i++)
        {
            City tCity = this.cities[i];
            tResult += tCity.getPopulationMaximum();
        }
        return tResult;
    }

    // Token: 0x0600172C RID: 5932 RVA: 0x000E36A8 File Offset: 0x000E18A8
    public int countWeapons()
    {
        int tResult = 0;
        for (int i = 0; i < this.cities.Count; i++)
        {
            City tCity = this.cities[i];
            tResult += tCity.countWeapons();
        }
        return tResult;
    }

    // Token: 0x0600172D RID: 5933 RVA: 0x000E36E4 File Offset: 0x000E18E4
    public int countTotalFood()
    {
        int tResult = 0;
        for (int i = 0; i < this.cities.Count; i++)
        {
            City tCity = this.cities[i];
            tResult += tCity.getTotalFood();
        }
        return tResult;
    }

    // Token: 0x0600172E RID: 5934 RVA: 0x000E3720 File Offset: 0x000E1920
    public int countTotalWarriors()
    {
        int tResult = 0;
        for (int i = 0; i < this.cities.Count; i++)
        {
            City tCity = this.cities[i];
            tResult += tCity.countWarriors();
        }
        return tResult;
    }

    // Token: 0x0600172F RID: 5935 RVA: 0x000E375C File Offset: 0x000E195C
    public int countWarriorsMax()
    {
        int tResult = 0;
        for (int i = 0; i < this.cities.Count; i++)
        {
            City tCity = this.cities[i];
            tResult += tCity.getMaxWarriors();
        }
        return tResult;
    }

    // Token: 0x06001730 RID: 5936 RVA: 0x000E3798 File Offset: 0x000E1998
    public int getMaxCities()
    {
        int tResult = this.getActorAsset().civ_base_cities;
        if (this.hasKing())
        {
            tResult += (int)this.king.stats["cities"];
        }
        if (tResult < 1)
        {
            tResult = 1;
        }
        return tResult;
    }

    // Token: 0x06001731 RID: 5937 RVA: 0x000E37DC File Offset: 0x000E19DC
    public bool diceAgressionSuccess()
    {
        return this.hasKing() && (this.cities.Count < this.getMaxCities() || (this.cities.Count >= this.getMaxCities() && Randy.randomChance(this.king.stats["personality_aggression"])));
    }

    // Token: 0x06001732 RID: 5938 RVA: 0x000E383A File Offset: 0x000E1A3A
    public bool isSupreme()
    {
        return DiplomacyManager.kingdom_supreme == this;
    }

    // Token: 0x06001733 RID: 5939 RVA: 0x000E3844 File Offset: 0x000E1A44
    public bool isSecondBest()
    {
        return DiplomacyManager.kingdom_second == this;
    }

    // Token: 0x06001734 RID: 5940 RVA: 0x000E384E File Offset: 0x000E1A4E
    public bool hasAlliance()
    {
        return this.getAlliance() != null;
    }

    // Token: 0x06001735 RID: 5941 RVA: 0x000E3859 File Offset: 0x000E1A59
    public Alliance getAlliance()
    {
        if (!this.data.allianceID.hasValue())
        {
            return null;
        }
        Alliance alliance = World.world.alliances.get(this.data.allianceID);
        if (alliance == null)
        {
            this.data.allianceID = -1L;
        }
        return alliance;
    }

    // Token: 0x06001736 RID: 5942 RVA: 0x000E3899 File Offset: 0x000E1A99
    public void allianceLeave(Alliance pAlliance)
    {
        this.data.allianceID = -1L;
        this.data.timestamp_alliance = World.world.getCurWorldTime();
    }

    // Token: 0x06001737 RID: 5943 RVA: 0x000E38BD File Offset: 0x000E1ABD
    public void allianceJoin(Alliance pAlliance)
    {
        this.data.allianceID = pAlliance.data.id;
        this.data.timestamp_alliance = World.world.getCurWorldTime();
    }

    // Token: 0x06001738 RID: 5944 RVA: 0x000E38EC File Offset: 0x000E1AEC
    public void calculateNeighbourCities()
    {
        foreach (City city in this.cities)
        {
            city.recalculateNeighbourCities();
        }
    }

    // Token: 0x06001739 RID: 5945 RVA: 0x000E393C File Offset: 0x000E1B3C
    public Culture getCulture()
    {
        return this.culture;
    }

    // Token: 0x0600173A RID: 5946 RVA: 0x000E3944 File Offset: 0x000E1B44
    public void setCulture(Culture pCulture)
    {
        if (this.culture == pCulture)
        {
            return;
        }
        this.culture = pCulture;
        World.world.cultures.setDirtyKingdoms();
    }

    // Token: 0x0600173B RID: 5947 RVA: 0x000E3966 File Offset: 0x000E1B66
    public bool hasCulture()
    {
        if (this.culture != null && !this.culture.isAlive())
        {
            this.setCulture(null);
        }
        return this.culture != null;
    }

    // Token: 0x0600173C RID: 5948 RVA: 0x000E398D File Offset: 0x000E1B8D
    public void setLanguage(Language pLanguage)
    {
        this.language = pLanguage;
        World.world.languages.setDirtyKingdoms();
    }

    // Token: 0x0600173D RID: 5949 RVA: 0x000E39A5 File Offset: 0x000E1BA5
    public Language getLanguage()
    {
        return this.language;
    }

    // Token: 0x0600173E RID: 5950 RVA: 0x000E39AD File Offset: 0x000E1BAD
    public bool hasLanguage()
    {
        if (this.language != null && !this.language.isAlive())
        {
            this.setLanguage(null);
        }
        return this.language != null;
    }

    // Token: 0x0600173F RID: 5951 RVA: 0x000E39D4 File Offset: 0x000E1BD4
    public void setReligion(Religion pReligion)
    {
        if (this.religion == pReligion)
        {
            return;
        }
        this.religion = pReligion;
        World.world.religions.setDirtyKingdoms();
    }

    // Token: 0x06001740 RID: 5952 RVA: 0x000E39F6 File Offset: 0x000E1BF6
    public Religion getReligion()
    {
        return this.religion;
    }

    // Token: 0x06001741 RID: 5953 RVA: 0x000E39FE File Offset: 0x000E1BFE
    public bool hasReligion()
    {
        if (this.religion != null && !this.religion.isAlive())
        {
            this.setReligion(null);
        }
        return this.religion != null;
    }

    // Token: 0x06001742 RID: 5954 RVA: 0x000E3A28 File Offset: 0x000E1C28
    public bool isEnemyAroundZone(TileZone pZone)
    {
        foreach (TileZone tZone in pZone.neighbours)
        {
            if (tZone.city == null)
            {
                return true;
            }
            Kingdom tKingdom = tZone.city.kingdom;
            if (tKingdom != this)
            {
                return true;
            }
            if (tKingdom != this && tKingdom.isEnemy(this))
            {
                return true;
            }
        }
        return false;
    }

    // Token: 0x06001743 RID: 5955 RVA: 0x000E3A7A File Offset: 0x000E1C7A
    public bool hasCities()
    {
        return this.cities.Count > 0;
    }

    // Token: 0x06001744 RID: 5956 RVA: 0x000E3A8A File Offset: 0x000E1C8A
    public bool hasCapital()
    {
        return this.capital != null;
    }

    // Token: 0x06001745 RID: 5957 RVA: 0x000E3A95 File Offset: 0x000E1C95
    public bool hasKing()
    {
        if (this.king == null)
        {
            return false;
        }
        if (!this.king.isAlive())
        {
            this.removeKing();
            return false;
        }
        return true;
    }

    // Token: 0x06001746 RID: 5958 RVA: 0x000E3AB7 File Offset: 0x000E1CB7
    public void affectKingByPowers()
    {
        if (!this.hasKing())
        {
            return;
        }
        this.king.addStatusEffect("voices_in_my_head", 0f, true);
    }

    // Token: 0x06001747 RID: 5959 RVA: 0x000E3ADC File Offset: 0x000E1CDC
    public int countUnhappyCities()
    {
        int tResult = 0;
        using (List<City>.Enumerator enumerator = this.cities.GetEnumerator())
        {
            while (enumerator.MoveNext())
            {
                if (!enumerator.Current.isHappy())
                {
                    tResult++;
                }
            }
        }
        return tResult;
    }

    // Token: 0x06001748 RID: 5960 RVA: 0x000E3B38 File Offset: 0x000E1D38
    public Sprite getSpeciesIcon()
    {
        return this.getActorAsset().getSpriteIcon();
    }

    // Token: 0x06001749 RID: 5961 RVA: 0x000E3B45 File Offset: 0x000E1D45
    public Sprite getElementIcon()
    {
        return AssetManager.kingdom_banners_library.getSpriteIcon(this.data.banner_icon_id, this.getActorAsset().banner_id);
    }

    // Token: 0x0600174A RID: 5962 RVA: 0x000E3B67 File Offset: 0x000E1D67
    public Sprite getElementBackground()
    {
        return AssetManager.kingdom_banners_library.getSpriteBackground(this.data.banner_background_id, this.getActorAsset().banner_id);
    }

    // Token: 0x0600174B RID: 5963 RVA: 0x000E3B8C File Offset: 0x000E1D8C
    public void increaseHappinessFromNewCityCapture()
    {
        foreach (Actor tActor in base.units)
        {
            if (!tActor.hasHappinessEntry("was_conquered", 400f))
            {
                tActor.changeHappiness("conquered_city", 0);
            }
        }
    }

    // Token: 0x0600174C RID: 5964 RVA: 0x000E3BF8 File Offset: 0x000E1DF8
    public int getLootMin()
    {
        return 5;
    }

    // Token: 0x0600174D RID: 5965 RVA: 0x000E3BFB File Offset: 0x000E1DFB
    public float getTaxRateTribute()
    {
        return this._cached_tax_tribute;
    }

    // Token: 0x0600174E RID: 5966 RVA: 0x000E3C03 File Offset: 0x000E1E03
    public float getTaxRateLocal()
    {
        return this._cached_tax_local;
    }

    // Token: 0x0600174F RID: 5967 RVA: 0x000E3C0B File Offset: 0x000E1E0B
    public void copyMetasFromOtherKingdom(Kingdom pKingdom)
    {
        if (pKingdom.hasCulture())
        {
            this.setCulture(pKingdom.culture);
        }
        if (pKingdom.hasLanguage())
        {
            this.setLanguage(pKingdom.language);
        }
        if (pKingdom.hasReligion())
        {
            this.setReligion(pKingdom.religion);
        }
    }

    // Token: 0x06001750 RID: 5968 RVA: 0x000E3C49 File Offset: 0x000E1E49
    public void setUnitMetas(Actor pActor)
    {
        if (pActor.hasCulture())
        {
            this.setCulture(pActor.culture);
        }
        if (pActor.hasLanguage())
        {
            this.setLanguage(pActor.language);
        }
        if (pActor.hasReligion())
        {
            this.setReligion(pActor.religion);
        }
    }

    // Token: 0x06001751 RID: 5969 RVA: 0x000E3C87 File Offset: 0x000E1E87
    public void setCityMetas(City pCity)
    {
        if (pCity.hasCulture())
        {
            this.setCulture(pCity.culture);
        }
        if (pCity.hasLanguage())
        {
            this.setLanguage(pCity.language);
        }
        if (pCity.hasReligion())
        {
            this.setReligion(pCity.religion);
        }
    }

    // Token: 0x06001752 RID: 5970 RVA: 0x000E3CC5 File Offset: 0x000E1EC5
    public Clan getKingClan()
    {
        if (this.hasKing() && this.king.hasClan())
        {
            return this.king.clan;
        }
        return null;
    }

    // Token: 0x06001753 RID: 5971 RVA: 0x000E3CE9 File Offset: 0x000E1EE9
    public override void listUnit(Actor pActor)
    {
        if (pActor.asset.is_boat)
        {
            this._has_boats = true;
        }
        base.listUnit(pActor);
    }

    // Token: 0x06001754 RID: 5972 RVA: 0x000E3D06 File Offset: 0x000E1F06
    internal override void clearListUnits()
    {
        this._has_boats = false;
        base.clearListUnits();
    }

    // Token: 0x040012E1 RID: 4833
    public static KingdomCheckCache cache_enemy_check = new KingdomCheckCache();

    // Token: 0x040012E2 RID: 4834
    public KingdomAsset asset;

    // Token: 0x040012E3 RID: 4835
    public bool wild;

    // Token: 0x040012E4 RID: 4836
    public float timer_action;

    // Token: 0x040012E5 RID: 4837
    public Actor king;

    // Token: 0x040012E6 RID: 4838
    public City capital;

    // Token: 0x040012E7 RID: 4839
    public Culture culture;

    // Token: 0x040012E8 RID: 4840
    public Language language;

    // Token: 0x040012E9 RID: 4841
    public Religion religion;

    // Token: 0x040012EA RID: 4842
    public readonly List<Building> buildings = new List<Building>();

    // Token: 0x040012EB RID: 4843
    public readonly List<City> cities = new List<City>();

    // Token: 0x040012EC RID: 4844
    public int power;

    // Token: 0x040012ED RID: 4845
    public AiSystemKingdom ai;

    // Token: 0x040012EE RID: 4846
    public Vector3 location;

    // Token: 0x040012EF RID: 4847
    private float _cached_tax_local;

    // Token: 0x040012F0 RID: 4848
    private float _cached_tax_tribute;

    // Token: 0x040012F1 RID: 4849
    private bool _has_boats;
}
using System;
using System.Collections.Generic;

// Token: 0x0200011D RID: 285
public class KingdomTraitLibrary : BaseTraitLibrary<KingdomTrait>
{
    // Token: 0x060008A8 RID: 2216 RVA: 0x0007DCBD File Offset: 0x0007BEBD
    protected override List<string> getDefaultTraitsForMeta(ActorAsset pAsset)
    {
        return pAsset.default_kingdom_traits;
    }

    // Token: 0x060008A9 RID: 2217 RVA: 0x0007DCC8 File Offset: 0x0007BEC8
    public override void init()
    {
        base.init();
        this.add(new KingdomTrait
        {
            id = "tax_rate_local_high",
            group_id = "local_tax",
            is_local_tax_trait = true,
            tax_rate = 0.7f
        });
        this.t.addOpposite("tax_rate_local_low");
        this.add(new KingdomTrait
        {
            id = "tax_rate_local_low",
            group_id = "local_tax",
            is_local_tax_trait = true,
            tax_rate = 0.2f
        });
        this.t.addOpposite("tax_rate_local_high");
        this.add(new KingdomTrait
        {
            id = "tax_rate_tribute_high",
            group_id = "tribute",
            is_tribute_tax_trait = true,
            tax_rate = 0.7f
        });
        this.t.addOpposite("tax_rate_tribute_low");
        this.add(new KingdomTrait
        {
            id = "tax_rate_tribute_low",
            group_id = "tribute",
            is_tribute_tax_trait = true,
            tax_rate = 0.2f
        });
        this.t.addOpposite("tax_rate_tribute_high");
    }

    // Token: 0x17000034 RID: 52
    // (get) Token: 0x060008AA RID: 2218 RVA: 0x0007DDEB File Offset: 0x0007BFEB
    protected override string icon_path
    {
        get
        {
            return "ui/Icons/kingdom_traits/";
        }
    }
}
using System;
using System.Collections.Generic;

// Token: 0x020002EE RID: 750
public class CitiesManager : MetaSystemManager<City, CityData>
{
    // Token: 0x06001BB9 RID: 7097 RVA: 0x000FACCE File Offset: 0x000F8ECE
    public CitiesManager()
    {
        this.type_id = "city";
    }

    // Token: 0x06001BBA RID: 7098 RVA: 0x000FACE4 File Offset: 0x000F8EE4
    public City newCity(Kingdom pKingdom, TileZone pZone, Actor pOriginalActor)
    {
        World.world.game_stats.data.citiesCreated += 1L;
        World.world.map_stats.citiesCreated += 1L;
        City tCity = base.newObject();
        tCity.data.founder_id = pOriginalActor.getID();
        tCity.data.original_actor_asset = pOriginalActor.asset.id;
        tCity.data.equipment = new CityEquipment();
        tCity.setKingdom(pKingdom, true);
        tCity.addZone(pZone);
        foreach (TileZone tZone in pZone.neighbours_all)
        {
            if (tZone.city == null)
            {
                tCity.addZone(tZone);
            }
        }
        World.world.city_zone_helper.city_place_finder.setDirty();
        return tCity;
    }

    // Token: 0x06001BBB RID: 7099 RVA: 0x000FADB0 File Offset: 0x000F8FB0
    public City buildNewCity(Actor pActor, TileZone pZone)
    {
        Kingdom tKingdom = pActor.kingdom;
        City city = World.world.cities.newCity(tKingdom, pZone, pActor);
        city.setUnitMetas(pActor);
        city.newCityEvent(pActor);
        WorldLog.logNewCity(city);
        return city;
    }

    // Token: 0x06001BBC RID: 7100 RVA: 0x000FADEA File Offset: 0x000F8FEA
    public bool tryToCreateCity(Actor pActor, ListPool<Building> pBuildingList)
    {
        return !pActor.current_tile.zone.hasCity();
    }

    // Token: 0x06001BBD RID: 7101 RVA: 0x000FAE04 File Offset: 0x000F9004
    public bool canStartNewCityCivilizationHere(Actor pActor)
    {
        if (pActor.kingdom.asset.is_forced_by_trait)
        {
            return false;
        }
        if (!pActor.canBuildNewCity())
        {
            return false;
        }
        KingdomAsset tPossibleKingdomAsset = AssetManager.kingdoms.get(pActor.asset.kingdom_id_civilization);
        if (tPossibleKingdomAsset == null || !tPossibleKingdomAsset.civ)
        {
            return false;
        }
        WorldTile tActorTile = pActor.current_tile;
        TileZone tActorZone = tActorTile.zone;
        foreach (TileZone tNeighbourZone in tActorZone.neighbours)
        {
            if (tNeighbourZone.hasCity())
            {
                WorldTile tTile = tNeighbourZone.city.getTile(false);
                if (tTile != null && tTile.isSameIsland(tActorTile))
                {
                    tNeighbourZone.city.addZone(tActorZone);
                    return false;
                }
            }
        }
        return true;
    }

    // Token: 0x06001BBE RID: 7102 RVA: 0x000FAEB8 File Offset: 0x000F90B8
    public City buildFirstCivilizationCity(Actor pActor)
    {
        City tNewCity = this.buildNewCity(pActor, pActor.current_zone);
        pActor.joinCity(tNewCity);
        tNewCity.setUnitMetas(pActor);
        tNewCity.convertSameSpeciesAroundUnit(pActor, false);
        return tNewCity;
    }

    // Token: 0x06001BBF RID: 7103 RVA: 0x000FAEEC File Offset: 0x000F90EC
    protected override void updateDirtyUnits()
    {
        List<Actor> tActorList = World.world.units.units_only_alive;
        for (int i = 0; i < tActorList.Count; i++)
        {
            Actor tUnit = tActorList[i];
            City tCity = tUnit.city;
            if (tCity != null && tCity.isDirtyUnits())
            {
                tCity.listUnit(tUnit);
            }
        }
    }

    // Token: 0x06001BC0 RID: 7104 RVA: 0x000FAF3B File Offset: 0x000F913B
    public void beginChecksBuildings()
    {
        if (this._dirty_buildings)
        {
            this.updateDirtyBuildings();
        }
        this._dirty_buildings = false;
    }

    // Token: 0x06001BC1 RID: 7105 RVA: 0x000FAF54 File Offset: 0x000F9154
    private void updateDirtyBuildings()
    {
        this.clearAllBuildingLists();
        foreach (City tCity in this)
        {
            Kingdom tKingdomCiv = tCity.kingdom;
            for (int i = 0; i < tCity.zones.Count; i++)
            {
                foreach (Building tBuilding in tCity.zones[i].buildings_all)
                {
                    if (tBuilding.asset.city_building && tBuilding.isUsable())
                    {
                        tBuilding.setKingdomCiv(tKingdomCiv);
                        tCity.listBuilding(tBuilding);
                    }
                }
            }
        }
    }

    // Token: 0x06001BC2 RID: 7106 RVA: 0x000FB030 File Offset: 0x000F9230
    public void setDirtyBuildings(City pCity)
    {
        this._dirty_buildings = true;
        World.world.kingdoms.setDirtyBuildings();
    }

    // Token: 0x06001BC3 RID: 7107 RVA: 0x000FB048 File Offset: 0x000F9248
    private void clearAllBuildingLists()
    {
        foreach (City city in this)
        {
            city.clearBuildingList();
        }
    }

    // Token: 0x06001BC4 RID: 7108 RVA: 0x000FB090 File Offset: 0x000F9290
    protected override void addObject(City pObject)
    {
        pObject.init();
        base.addObject(pObject);
    }

    // Token: 0x06001BC5 RID: 7109 RVA: 0x000FB09F File Offset: 0x000F929F
    public override City loadObject(CityData pData)
    {
        City city = base.loadObject(pData);
        city.loadCity(pData);
        return city;
    }

    // Token: 0x06001BC6 RID: 7110 RVA: 0x000FB0B0 File Offset: 0x000F92B0
    public override void update(float pElapsed)
    {
        base.update(pElapsed);
        foreach (City city in this)
        {
            city.update(pElapsed);
            city.clearCursorOver();
        }
    }

    // Token: 0x06001BC7 RID: 7111 RVA: 0x000FB104 File Offset: 0x000F9304
    protected override void finishDirtyUnits()
    {
        base.finishDirtyUnits();
        foreach (City tCity in this.list)
        {
            if (!tCity.kingdom.wild && tCity.countUnits() == 0)
            {
                tCity.setKingdom(WildKingdomsManager.neutral, true);
                tCity.forceBuildingsToKingdom(tCity.buildings, WildKingdomsManager.neutral);
            }
        }
    }

    // Token: 0x06001BC8 RID: 7112 RVA: 0x000FB188 File Offset: 0x000F9388
    public void updateAge()
    {
        foreach (City city in this)
        {
            city.updateAge();
        }
    }

    // Token: 0x06001BC9 RID: 7113 RVA: 0x000FB1D0 File Offset: 0x000F93D0
    public override List<CityData> save(List<City> pList = null)
    {
        List<CityData> tSavingList = new List<CityData>();
        foreach (City tCity in this)
        {
            tCity.save();
            tSavingList.Add(tCity.data);
        }
        return tSavingList;
    }

    // Token: 0x06001BCA RID: 7114 RVA: 0x000FB22C File Offset: 0x000F942C
    private void checkForCityErrors(SavedMap pSaveData)
    {
        List<CityData> tCityData = new List<CityData>();
        for (int i = 0; i < pSaveData.cities.Count; i++)
        {
            CityData tData = pSaveData.cities[i];
            if (tData.zones.Count != 0)
            {
                TileZone tFirstZone = World.world.zone_calculator.getZone(tData.zones[0].x, tData.zones[0].y);
                if (pSaveData.saveVersion < 7)
                {
                    tFirstZone = this.findZoneViaBuilding(tData.id, pSaveData.buildings);
                }
                if (tFirstZone != null)
                {
                    tCityData.Add(tData);
                }
            }
        }
        pSaveData.cities = tCityData;
    }

    // Token: 0x06001BCB RID: 7115 RVA: 0x000FB2D4 File Offset: 0x000F94D4
    public void loadCities(SavedMap pSaveData)
    {
        this.checkForCityErrors(pSaveData);
        for (int i = 0; i < pSaveData.cities.Count; i++)
        {
            CityData tData = pSaveData.cities[i];
            World.world.zone_calculator.getZone(tData.zones[0].x, tData.zones[0].y);
            if (pSaveData.saveVersion < 7)
            {
                this.findZoneViaBuilding(tData.id, pSaveData.buildings);
            }
            City tCity = this.loadObject(tData);
            if (tCity != null && pSaveData.saveVersion >= 7)
            {
                for (int j = 0; j < tData.zones.Count; j++)
                {
                    ZoneData tZoneData = tData.zones[j];
                    TileZone tZone = World.world.zone_calculator.getZone(tZoneData.x, tZoneData.y);
                    if (tZone != null)
                    {
                        tCity.addZone(tZone);
                    }
                }
            }
        }
    }

    // Token: 0x06001BCC RID: 7116 RVA: 0x000FB3C4 File Offset: 0x000F95C4
    public override void removeObject(City pObject)
    {
        World.world.game_stats.data.citiesDestroyed += 1L;
        World.world.map_stats.citiesDestroyed += 1L;
        WorldLog.logCityDestroyed(pObject);
        pObject.destroyCity();
        base.removeObject(pObject);
        World.world.city_zone_helper.city_place_finder.setDirty();
        World.world.cultures.setDirtyCities();
        World.world.kingdoms.setDirtyCities();
        World.world.languages.setDirtyCities();
        World.world.religions.setDirtyCities();
    }

    // Token: 0x06001BCD RID: 7117 RVA: 0x000FB46C File Offset: 0x000F966C
    private TileZone findZoneViaBuilding(long pID, List<BuildingData> pList)
    {
        for (int i = 0; i < pList.Count; i++)
        {
            BuildingData tData = pList[i];
            if (tData.cityID == pID)
            {
                return World.world.GetTileSimple(tData.mainX, tData.mainY).zone;
            }
        }
        return null;
    }

    // Token: 0x0400156B RID: 5483
    private bool _dirty_buildings;
}
using System;
using System.Collections.Generic;
using System.Runtime.CompilerServices;
using db;
using JetBrains.Annotations;
using UnityEngine;

// Token: 0x020002F0 RID: 752
public class City : MetaObject<CityData>
{
    // Token: 0x170001B0 RID: 432
    // (get) Token: 0x06001BDA RID: 7130 RVA: 0x000FB67E File Offset: 0x000F987E
    protected override MetaType meta_type
    {
        get
        {
            return MetaType.City;
        }
    }

    // Token: 0x170001B1 RID: 433
    // (get) Token: 0x06001BDB RID: 7131 RVA: 0x000FB681 File Offset: 0x000F9881
    protected override bool track_death_types
    {
        get
        {
            return true;
        }
    }

    // Token: 0x06001BDC RID: 7132 RVA: 0x000FB684 File Offset: 0x000F9884
    public override void increaseBirths()
    {
        base.increaseBirths();
        base.addRenown(1);
    }

    // Token: 0x06001BDD RID: 7133 RVA: 0x000FB694 File Offset: 0x000F9894
    public void increaseLeft()
    {
        if (!base.isAlive())
        {
            return;
        }
        CityData data = this.data;
        long left = data.left;
        data.left = left + 1L;
    }

    // Token: 0x06001BDE RID: 7134 RVA: 0x000FB6C0 File Offset: 0x000F98C0
    public void increaseJoined()
    {
        if (!base.isAlive())
        {
            return;
        }
        CityData data = this.data;
        long joined = data.joined;
        data.joined = joined + 1L;
        base.addRenown(1);
    }

    // Token: 0x06001BDF RID: 7135 RVA: 0x000FB6F4 File Offset: 0x000F98F4
    public void increaseMoved()
    {
        if (!base.isAlive())
        {
            return;
        }
        CityData data = this.data;
        long moved = data.moved;
        data.moved = moved + 1L;
        base.addRenown(2);
    }

    // Token: 0x06001BE0 RID: 7136 RVA: 0x000FB728 File Offset: 0x000F9928
    public void increaseMigrants()
    {
        if (!base.isAlive())
        {
            return;
        }
        CityData data = this.data;
        long migrated = data.migrated;
        data.migrated = migrated + 1L;
    }

    // Token: 0x06001BE1 RID: 7137 RVA: 0x000FB754 File Offset: 0x000F9954
    public long getTotalLeft()
    {
        return this.data.left;
    }

    // Token: 0x06001BE2 RID: 7138 RVA: 0x000FB761 File Offset: 0x000F9961
    public long getTotalJoined()
    {
        return this.data.joined;
    }

    // Token: 0x06001BE3 RID: 7139 RVA: 0x000FB76E File Offset: 0x000F996E
    public long getTotalMoved()
    {
        return this.data.moved;
    }

    // Token: 0x06001BE4 RID: 7140 RVA: 0x000FB77B File Offset: 0x000F997B
    public long getTotalMigrated()
    {
        return this.data.migrated;
    }

    // Token: 0x06001BE5 RID: 7141 RVA: 0x000FB788 File Offset: 0x000F9988
    public bool isZoneToClaimStillGood(Actor pActor, TileZone pZone)
    {
        if (!pZone.canBeClaimedByCity(this))
        {
            return false;
        }
        if (!pZone.checkCanSettleInThisBiomes(pActor.subspecies))
        {
            return false;
        }
        foreach (TileZone tZone in pZone.neighbours)
        {
            if (tZone.hasCity() && tZone.city == this)
            {
                return true;
            }
        }
        return false;
    }

    // Token: 0x06001BE6 RID: 7142 RVA: 0x000FB7DD File Offset: 0x000F99DD
    internal override void clearListUnits()
    {
        base.clearListUnits();
        this._boats.Clear();
        this._species.Clear();
    }

    // Token: 0x06001BE7 RID: 7143 RVA: 0x000FB7FB File Offset: 0x000F99FB
    public override ActorAsset getActorAsset()
    {
        if (this.hasLeader())
        {
            return this.leader.getActorAsset();
        }
        return this.getFounderSpecies();
    }

    // Token: 0x06001BE8 RID: 7144 RVA: 0x000FB817 File Offset: 0x000F9A17
    public ActorAsset getFounderSpecies()
    {
        return AssetManager.actor_library.get(this.data.original_actor_asset);
    }

    // Token: 0x06001BE9 RID: 7145 RVA: 0x000FB830 File Offset: 0x000F9A30
    public CityLayoutTilePlacement getTilePlacementFromZone()
    {
        if (this.hasCulture())
        {
            if (this.culture.hasTrait("city_layout_the_grand_arrangement"))
            {
                return CityLayoutTilePlacement.CenterTile;
            }
            if (this.culture.hasTrait("city_layout_tile_wobbly_pattern"))
            {
                return CityLayoutTilePlacement.CenterTileDrunk;
            }
            if (this.culture.hasTrait("city_layout_tile_moonsteps"))
            {
                return CityLayoutTilePlacement.Moonsteps;
            }
        }
        return CityLayoutTilePlacement.Random;
    }

    // Token: 0x06001BEA RID: 7146 RVA: 0x000FB882 File Offset: 0x000F9A82
    public string getSpecies()
    {
        return this.getActorAsset().id;
    }

    // Token: 0x06001BEB RID: 7147 RVA: 0x000FB88F File Offset: 0x000F9A8F
    public override bool isReadyForRemoval()
    {
        return this.zones.Count == 0;
    }

    // Token: 0x06001BEC RID: 7148 RVA: 0x000FB8A4 File Offset: 0x000F9AA4
    public void clearBuildingList()
    {
        this.buildings.Clear();
        foreach (List<Building> list in this.buildings_dict_type.Values)
        {
            list.Clear();
        }
        foreach (List<Building> list2 in this.buildings_dict_id.Values)
        {
            list2.Clear();
        }
        this.stockpiles.Clear();
        this.storages.Clear();
        this._cached_book_ids.Clear();
        this._cached_buildings_with_book_slots.Clear();
    }

    // Token: 0x06001BED RID: 7149 RVA: 0x000FB974 File Offset: 0x000F9B74
    public override void listUnit(Actor pActor)
    {
        if (pActor.asset.is_boat)
        {
            this._boats.Add(pActor);
            return;
        }
        base.units.Add(pActor);
        if (pActor.hasSubspecies())
        {
            this._species[pActor.asset.id] = pActor.subspecies.id;
        }
    }

    // Token: 0x06001BEE RID: 7150 RVA: 0x000FB9D0 File Offset: 0x000F9BD0
    public Subspecies getSubspecies(string pSpeciesId)
    {
        long tSubspeciesId = this.getSubspeciesId(pSpeciesId);
        return World.world.subspecies.get(tSubspeciesId);
    }

    // Token: 0x06001BEF RID: 7151 RVA: 0x000FB9F8 File Offset: 0x000F9BF8
    public long getSubspeciesId(string pSpeciesId)
    {
        long tSubspeciesId;
        if (this._species.TryGetValue(pSpeciesId, out tSubspeciesId))
        {
            return tSubspeciesId;
        }
        return -1L;
    }

    // Token: 0x06001BF0 RID: 7152 RVA: 0x000FBA19 File Offset: 0x000F9C19
    public bool hasFreeHouseSlots()
    {
        return this.status.housing_free != 0;
    }

    // Token: 0x06001BF1 RID: 7153 RVA: 0x000FBA2B File Offset: 0x000F9C2B
    public bool hasReachedWorldLawLimit()
    {
        return WorldLawLibrary.world_law_civ_limit_population_100.isEnabled() && this.getPopulationPeople() >= 100;
    }

    // Token: 0x06001BF2 RID: 7154 RVA: 0x000FBA48 File Offset: 0x000F9C48
    public void listBuilding(Building pBuilding)
    {
        this.buildings.Add(pBuilding);
        BuildingAsset asset = pBuilding.asset;
        if (asset.type == "type_stockpile")
        {
            this.stockpiles.Add(pBuilding);
        }
        if (asset.storage)
        {
            this.storages.Add(pBuilding);
        }
        if (asset.book_slots > 0)
        {
            this._cached_buildings_with_book_slots.Add(pBuilding);
            if (pBuilding.data.books != null)
            {
                this._cached_book_ids.AddRange(pBuilding.data.books.list_books);
            }
        }
        this.setBuildingDictType(pBuilding);
        this.setBuildingDictID(pBuilding);
    }

    // Token: 0x06001BF3 RID: 7155 RVA: 0x000FBAE3 File Offset: 0x000F9CE3
    [CanBeNull]
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public WorldTile getTile(bool pForceRecalc = false)
    {
        if (this._city_tile == null || pForceRecalc)
        {
            this.recalculateCityTile();
        }
        return this._city_tile;
    }

    // Token: 0x06001BF4 RID: 7156 RVA: 0x000FBB00 File Offset: 0x000F9D00
    internal void recalculateCityTile()
    {
        this._city_tile = null;
        Building tMainBuilding = this.getBuildingOfType("type_bonfire", true, false, false);
        if (tMainBuilding != null)
        {
            this._city_tile = tMainBuilding.current_tile;
            return;
        }
        foreach (Building tBuilding in this.buildings.LoopRandom<Building>())
        {
            if (!tBuilding.asset.docks && !tBuilding.current_tile.Type.ocean)
            {
                if (tMainBuilding == null)
                {
                    tMainBuilding = tBuilding;
                }
                else if (tBuilding.asset.priority > tMainBuilding.asset.priority)
                {
                    tMainBuilding = tBuilding;
                }
            }
        }
        if (tMainBuilding != null)
        {
            this._city_tile = tMainBuilding.current_tile;
            return;
        }
        List<TileZone> tZones = this.zones;
        if (tZones.Count != 0)
        {
            for (int i = 0; i < tZones.Count; i++)
            {
                TileZone tZone = tZones[i];
                if (!tZone.centerTile.Type.ocean)
                {
                    this._city_tile = tZone.centerTile;
                    return;
                }
            }
        }
    }

    // Token: 0x06001BF5 RID: 7157 RVA: 0x000FBC10 File Offset: 0x000F9E10
    internal int countInHouses()
    {
        int ii = 0;
        List<Actor> tUnits = base.units;
        for (int i = 0; i < tUnits.Count; i++)
        {
            if (tUnits[i].is_inside_building)
            {
                ii++;
            }
        }
        return ii;
    }

    // Token: 0x06001BF6 RID: 7158 RVA: 0x000FBC4C File Offset: 0x000F9E4C
    public int countBookSlots()
    {
        int tSlotsTotal = 0;
        for (int i = 0; i < this._cached_buildings_with_book_slots.Count; i++)
        {
            Building tBuilding = this._cached_buildings_with_book_slots[i];
            tSlotsTotal += tBuilding.asset.book_slots;
        }
        return tSlotsTotal;
    }

    // Token: 0x06001BF7 RID: 7159 RVA: 0x000FBC90 File Offset: 0x000F9E90
    public bool hasBookSlots()
    {
        int tSlots = this.countBookSlots();
        return this.countBooks() < tSlots;
    }

    // Token: 0x06001BF8 RID: 7160 RVA: 0x000FBCB0 File Offset: 0x000F9EB0
    public Building getBuildingWithBookSlot()
    {
        foreach (Building tBuilding in this._cached_buildings_with_book_slots)
        {
            if (tBuilding.hasFreeBookSlot())
            {
                return tBuilding;
            }
        }
        return null;
    }

    // Token: 0x06001BF9 RID: 7161 RVA: 0x000FBD0C File Offset: 0x000F9F0C
    public int countBooks()
    {
        return this._cached_book_ids.Count;
    }

    // Token: 0x06001BFA RID: 7162 RVA: 0x000FBD19 File Offset: 0x000F9F19
    private void setKingdomTimestamp()
    {
        this.data.timestamp_kingdom = World.world.getCurWorldTime();
    }

    // Token: 0x06001BFB RID: 7163 RVA: 0x000FBD30 File Offset: 0x000F9F30
    public override ColorAsset getColor()
    {
        return this.kingdom.getColor();
    }

    // Token: 0x06001BFC RID: 7164 RVA: 0x000FBD40 File Offset: 0x000F9F40
    internal void setKingdom(Kingdom pKingdom, bool pSetTimestamp = true)
    {
        World.world.kingdoms.setDirtyCities();
        if (this.isCapitalCity())
        {
            this.kingdom.clearCapital();
        }
        this.kingdom = pKingdom;
        if (this.kingdom != null && this.kingdom != WildKingdomsManager.neutral)
        {
            this.data.last_kingdom_id = this.kingdom.id;
        }
    }

    // Token: 0x06001BFD RID: 7165 RVA: 0x000FBDA1 File Offset: 0x000F9FA1
    internal void newForceKingdomEvent(List<Actor> pUnits, List<Actor> pBoats, Kingdom pKingdom, string pHappinessEvent)
    {
        this.setKingdomTimestamp();
        this.forceUnitsIntoThisKingdom(pUnits, pKingdom, false, pHappinessEvent);
        this.forceUnitsIntoThisKingdom(pBoats, pKingdom, true, null);
    }

    // Token: 0x06001BFE RID: 7166 RVA: 0x000FBDC0 File Offset: 0x000F9FC0
    internal void forceBuildingsToKingdom(List<Building> pBuildings, Kingdom pKingdom)
    {
        for (int i = 0; i < pBuildings.Count; i++)
        {
            pBuildings[i].setKingdom(pKingdom);
        }
    }

    // Token: 0x06001BFF RID: 7167 RVA: 0x000FBDEC File Offset: 0x000F9FEC
    internal void forceUnitsIntoThisKingdom(List<Actor> pActors, Kingdom pKingdom, bool pBoats, string pHappinessEvent = null)
    {
        if (pBoats)
        {
            for (int i = 0; i < pActors.Count; i++)
            {
                Actor tActor = pActors[i];
                if (!tActor.isRekt())
                {
                    tActor.joinKingdom(pKingdom);
                }
            }
            return;
        }
        for (int j = 0; j < pActors.Count; j++)
        {
            Actor tActor2 = pActors[j];
            if (!tActor2.isRekt())
            {
                if (tActor2.isKing())
                {
                    tActor2.kingdom.kingLeftEvent();
                }
                tActor2.joinKingdom(pKingdom);
                if (pHappinessEvent != null)
                {
                    tActor2.changeHappiness(pHappinessEvent, 0);
                }
            }
        }
    }

    // Token: 0x06001C00 RID: 7168 RVA: 0x000FBE70 File Offset: 0x000FA070
    internal Building getStorageNear(WorldTile pTile, bool pOnlyFood = false)
    {
        Building tBest = null;
        int tDistBest = int.MaxValue;
        List<Building> tBuildings = this.storages;
        for (int i = 0; i < tBuildings.Count; i++)
        {
            Building tBuilding = tBuildings[i];
            if (tBuilding.isUsable() && tBuilding.current_tile.isSameIsland(pTile))
            {
                if (pOnlyFood && tBuilding.asset.storage_only_food)
                {
                    tBest = tBuilding;
                }
                else
                {
                    int tDist = Toolbox.SquaredDistVec2(tBuilding.current_tile.pos, pTile.pos);
                    if (tDist < tDistBest)
                    {
                        tDistBest = tDist;
                        tBest = tBuilding;
                    }
                }
            }
        }
        return tBest;
    }

    // Token: 0x06001C01 RID: 7169 RVA: 0x000FBEFC File Offset: 0x000FA0FC
    internal Building getStorageWithFoodNear(WorldTile pTile)
    {
        Building tBest = null;
        int tDistBest = int.MaxValue;
        List<Building> tBuildings = this.storages;
        for (int i = 0; i < tBuildings.Count; i++)
        {
            Building tBuilding = tBuildings[i];
            if (tBuilding.isUsable() && tBuilding.current_tile.isSameIsland(pTile) && tBuilding.countFood() != 0)
            {
                int tDist = Toolbox.SquaredDistVec2(tBuilding.current_tile.pos, pTile.pos);
                if (tDist < tDistBest)
                {
                    tDistBest = tDist;
                    tBest = tBuilding;
                }
            }
        }
        return tBest;
    }

    // Token: 0x06001C02 RID: 7170 RVA: 0x000FBF78 File Offset: 0x000FA178
    internal bool hasStorageBuilding()
    {
        List<Building> tBuildings = this.storages;
        for (int i = 0; i < tBuildings.Count; i++)
        {
            if (!tBuildings[i].isUnderConstruction())
            {
                return true;
            }
        }
        return false;
    }

    // Token: 0x06001C03 RID: 7171 RVA: 0x000FBFB0 File Offset: 0x000FA1B0
    public WorldTile getRoadTileToBuild(Actor pBuilder)
    {
        this.tiles_to_remove.Clear();
        for (int i = 0; i < this.road_tiles_to_build.Count; i++)
        {
            WorldTile tTile = this.road_tiles_to_build[i];
            if (tTile.Type.road)
            {
                this.tiles_to_remove.Add(tTile);
            }
        }
        for (int j = 0; j < this.tiles_to_remove.Count; j++)
        {
            WorldTile tTile2 = this.tiles_to_remove[j];
            this.road_tiles_to_build.Remove(tTile2);
        }
        this.tiles_to_remove.Clear();
        if (this.road_tiles_to_build.Count > 0)
        {
            return this.road_tiles_to_build[0];
        }
        return null;
    }

    // Token: 0x06001C04 RID: 7172 RVA: 0x000FC05B File Offset: 0x000FA25B
    internal void init()
    {
        this.createAI();
        this.setStatusDirty();
    }

    // Token: 0x06001C05 RID: 7173 RVA: 0x000FC06C File Offset: 0x000FA26C
    private void createAI()
    {
        if (!Globals.AI_TEST_ACTIVE)
        {
            return;
        }
        if (this.ai == null)
        {
            this.ai = new AiSystemCity(this);
        }
        this.ai.nextJobDelegate = new GetNextJobID(this.getNextJob);
        this.ai.jobs_library = AssetManager.job_city;
        this.ai.task_library = AssetManager.tasks_city;
        this.ai.addSingleTask("build");
    }

    // Token: 0x06001C06 RID: 7174 RVA: 0x000FC0DC File Offset: 0x000FA2DC
    protected sealed override void setDefaultValues()
    {
        base.setDefaultValues();
        this.mark_scale_effect = 1f;
        this.timer_build_boat = 10f;
        this.timer_build = 0f;
        this.timer_action = 0f;
        this._timer_capture = 0f;
        this._timer_warrior = 0f;
        this._capture_ticks = 0f;
        this.last_ticks = 0;
        this._dirty_citizens = true;
        this._dirty_city_status = false;
        this._dirty_abandoned_zones = false;
        this._current_total_food = 0;
        this._last_checked_job_id = 0;
        this._loyalty_last_time = -1.0;
        this._loyalty_cached = -1;
    }

    // Token: 0x06001C07 RID: 7175 RVA: 0x000FC17C File Offset: 0x000FA37C
    private string getNextJob()
    {
        return "city";
    }

    // Token: 0x06001C08 RID: 7176 RVA: 0x000FC183 File Offset: 0x000FA383
    public bool isValidTargetForWar()
    {
        return this.hasZones();
    }

    // Token: 0x06001C09 RID: 7177 RVA: 0x000FC190 File Offset: 0x000FA390
    public bool hasZones()
    {
        return this.zones.Count > 0;
    }

    // Token: 0x06001C0A RID: 7178 RVA: 0x000FC1A0 File Offset: 0x000FA3A0
    public bool needSettlers()
    {
        int tCurrentPop = this.getPopulationPeople();
        return this.getAge() < 5 || (tCurrentPop < 22 && (tCurrentPop >= 22 || this.status.housing_free != 0 || this.getAge() <= 10 || this.getHouseCurrent() <= 2));
    }

    // Token: 0x06001C0B RID: 7179 RVA: 0x000FC1EE File Offset: 0x000FA3EE
    internal void generateName(Actor pActor)
    {
        this.data.name = pActor.generateName(MetaType.City, this.getID(), ActorSex.None);
        BaseSystemData data = this.data;
        Culture culture = this.culture;
        data.name_culture_id = ((culture != null) ? culture.id : (-1L));
    }

    // Token: 0x06001C0C RID: 7180 RVA: 0x000FC228 File Offset: 0x000FA428
    public void loadLeader()
    {
        if (this.data.leaderID.hasValue())
        {
            Actor tActor = World.world.units.get(this.data.leaderID);
            this.setLeader(tActor, false);
        }
    }

    // Token: 0x06001C0D RID: 7181 RVA: 0x000FC26A File Offset: 0x000FA46A
    public void newCityEvent(Actor pActor)
    {
        this.recalculateCityTile();
        this.generateName(pActor);
    }

    // Token: 0x06001C0E RID: 7182 RVA: 0x000FC27C File Offset: 0x000FA47C
    public void loadCity(CityData pData)
    {
        this.setData(pData);
        if (this.data.id_culture.hasValue())
        {
            this.setCulture(World.world.cultures.get(this.data.id_culture));
        }
        if (this.data.id_language.hasValue())
        {
            this.setLanguage(World.world.languages.get(this.data.id_language));
        }
        if (this.data.id_religion.hasValue())
        {
            this.setReligion(World.world.religions.get(this.data.id_religion));
        }
        if (this.data.equipment == null)
        {
            this.data.equipment = new CityEquipment();
        }
        else
        {
            this.data.equipment.loadFromSave(this);
        }
        Kingdom tKingdom;
        if (pData.kingdomID.hasValue() && pData.kingdomID != 0L)
        {
            tKingdom = World.world.kingdoms.get(pData.kingdomID);
        }
        else
        {
            tKingdom = WildKingdomsManager.neutral;
        }
        this.setKingdom(tKingdom, false);
    }

    // Token: 0x06001C0F RID: 7183 RVA: 0x000FC391 File Offset: 0x000FA591
    public void forceDoChecks()
    {
        this.updateTotalFood();
        this.updateCitizens();
        this.updateCityStatus();
        AssetManager.tasks_city.get("do_initial_load_check").executeAllActionsForCity(this);
    }

    // Token: 0x06001C10 RID: 7184 RVA: 0x000FC3BA File Offset: 0x000FA5BA
    public void eventUnitAdded(Actor pActor)
    {
        if (!pActor.asset.is_boat)
        {
            this.setCitizensDirty();
        }
        this.setStatusDirty();
    }

    // Token: 0x06001C11 RID: 7185 RVA: 0x000FC3D5 File Offset: 0x000FA5D5
    public void eventUnitRemoved(Actor pActor)
    {
        this.setStatusDirty();
        this.setCitizensDirty();
        if (pActor.isCityLeader())
        {
            this.removeLeader();
        }
    }

    // Token: 0x06001C12 RID: 7186 RVA: 0x000FC3F1 File Offset: 0x000FA5F1
    public void setAbandonedZonesDirty()
    {
        this._dirty_abandoned_zones = true;
    }

    // Token: 0x06001C13 RID: 7187 RVA: 0x000FC3FA File Offset: 0x000FA5FA
    public void setCitizensDirty()
    {
        this._dirty_citizens = true;
    }

    // Token: 0x06001C14 RID: 7188 RVA: 0x000FC403 File Offset: 0x000FA603
    public void setStatusDirty()
    {
        this._dirty_city_status = true;
    }

    // Token: 0x06001C15 RID: 7189 RVA: 0x000FC40C File Offset: 0x000FA60C
    private void sortZonesByDistanceToCenter()
    {
        WorldTile tCenter = this.getTile(false);
        if (tCenter == null)
        {
            return;
        }
        Vector2Int tCenterPos = tCenter.pos;
        this.zones.Sort(delegate (TileZone a, TileZone b)
        {
            int tDistA = Toolbox.SquaredDistVec2(a.centerTile.pos, tCenterPos);
            int tDistB = Toolbox.SquaredDistVec2(b.centerTile.pos, tCenterPos);
            return tDistA.CompareTo(tDistB);
        });
    }

    // Token: 0x06001C16 RID: 7190 RVA: 0x000FC450 File Offset: 0x000FA650
    private void updateCityStatus()
    {
        this._dirty_city_status = false;
        this.status.clear();
        this.recalculateCityTile();
        this.sortZonesByDistanceToCenter();
        this.recalculateNeighbourZones();
        this.recalculateNeighbourCities();
        List<Building> tBuildings = this.buildings;
        int tPopBabies = this.countPopulationChildren();
        this.status.population = this.getPopulationPeople();
        this.status.population_adults = this.status.population - tPopBabies;
        this.status.population_children = tPopBabies;
        MetaObject<CityData>._family_counter.Clear();
        List<Actor> tUnits = base.units;
        for (int i = 0; i < tUnits.Count; i++)
        {
            Actor tActor = tUnits[i];
            if (tActor.isHungry())
            {
                this.status.hungry++;
            }
            if (tActor.isSexMale())
            {
                this.status.males++;
            }
            else
            {
                this.status.females++;
            }
            if (tActor.hasFamily())
            {
                MetaObject<CityData>._family_counter.Add(tActor.family);
            }
            if (tActor.isSick())
            {
                this.status.sick++;
            }
            if (tActor.hasHouse())
            {
                this.status.housed++;
            }
            else
            {
                this.status.homeless++;
            }
        }
        this.status.families = MetaObject<CityData>._family_counter.Count;
        MetaObject<CityData>._family_counter.Clear();
        for (int j = 0; j < tBuildings.Count; j++)
        {
            Building tBuilding = tBuildings[j];
            if (!tBuilding.isUnderConstruction() && tBuilding.asset.hasHousingSlots())
            {
                this.status.housing_total += tBuilding.asset.housing_slots;
            }
        }
        if (this.status.population > this.status.housing_total)
        {
            this.status.housing_occupied = this.status.housing_total;
        }
        else
        {
            this.status.housing_occupied = this.status.population;
        }
        this.status.housing_free = this.status.housing_total - this.status.housing_occupied;
        this.status.maximum_items = 15;
        this.recalculateMaxHouses();
        this.status.warrior_slots = this.jobs.countCurrentJobs(CitizenJobLibrary.attacker);
        this.status.warriors_current = this.countProfession(UnitProfession.Warrior);
        CityBehCheckFarms.check(this);
    }

    // Token: 0x06001C17 RID: 7191 RVA: 0x000FC6D4 File Offset: 0x000FA8D4
    private void recalculateMaxHouses()
    {
        if (DebugConfig.isOn(DebugOption.CityUnlimitedHouses))
        {
            this.status.houses_max = 9999;
            return;
        }
        float tHouseMax = (float)this.zones.Count;
        if (this.hasCulture())
        {
            if (this.culture.hasTrait("dense_dwellings"))
            {
                tHouseMax = (float)(this.zones.Count * 2);
            }
            if (this.culture.hasTrait("solitude_seekers"))
            {
                tHouseMax = (float)this.zones.Count / 3f;
            }
            if (this.culture.hasTrait("hive_society"))
            {
                tHouseMax = (float)this.zones.Count * 3f;
            }
        }
        foreach (Building tBuilding in this.buildings)
        {
            tHouseMax += (float)tBuilding.asset.max_houses;
        }
        this.status.houses_max = (int)tHouseMax;
    }

    // Token: 0x06001C18 RID: 7192 RVA: 0x000FC7DC File Offset: 0x000FA9DC
    public bool hasBooksToRead(Actor pActor)
    {
        if (pActor.hasTag("can_read_any_book"))
        {
            return this.countBooks() > 0;
        }
        return pActor.hasLanguage() && this.hasBooksOfLanguage(pActor.language);
    }

    // Token: 0x06001C19 RID: 7193 RVA: 0x000FC810 File Offset: 0x000FAA10
    public bool hasBooksOfLanguage(Language pLanguage)
    {
        int i = 0;
        int tLength = this.countBooks();
        while (i < tLength)
        {
            long tBookID = this._cached_book_ids[i];
            Book tBook = World.world.books.get(tBookID);
            if (tBook.isAlive() && tBook.isReadyToBeRead())
            {
                Language tBookLanguage = tBook.getLanguage();
                if (tBookLanguage.id == pLanguage.id || tBookLanguage.hasTrait("magic_words"))
                {
                    return true;
                }
            }
            i++;
        }
        return false;
    }

    // Token: 0x06001C1A RID: 7194 RVA: 0x000FC888 File Offset: 0x000FAA88
    public Book getRandomBookOfLanguage(Language pLanguage)
    {
        Book result;
        using (ListPool<Book> tBooks = new ListPool<Book>())
        {
            int i = 0;
            int tLength = this.countBooks();
            while (i < tLength)
            {
                long tBookID = this._cached_book_ids[i];
                Book tBook = World.world.books.get(tBookID);
                if (tBook.isReadyToBeRead())
                {
                    Language tBookLanguage = tBook.getLanguage();
                    if (tBookLanguage.id == pLanguage.id || tBookLanguage.hasTrait("magic_words"))
                    {
                        tBooks.Add(tBook);
                    }
                }
                i++;
            }
            if (tBooks.Count == 0)
            {
                result = null;
            }
            else
            {
                result = tBooks.GetRandom<Book>();
            }
        }
        return result;
    }

    // Token: 0x06001C1B RID: 7195 RVA: 0x000FC938 File Offset: 0x000FAB38
    public Book getRandomBook()
    {
        Book result;
        using (ListPool<Book> tBooks = new ListPool<Book>())
        {
            int i = 0;
            int tLength = this.countBooks();
            while (i < tLength)
            {
                long tBookID = this._cached_book_ids[i];
                Book tBook = World.world.books.get(tBookID);
                if (tBook.isReadyToBeRead())
                {
                    tBooks.Add(tBook);
                }
                i++;
            }
            if (tBooks.Count == 0)
            {
                result = null;
            }
            else
            {
                result = tBooks.GetRandom<Book>();
            }
        }
        return result;
    }

    // Token: 0x06001C1C RID: 7196 RVA: 0x000FC9C4 File Offset: 0x000FABC4
    public List<long> getBooks()
    {
        return this._cached_book_ids;
    }

    // Token: 0x06001C1D RID: 7197 RVA: 0x000FC9CC File Offset: 0x000FABCC
    public int getHouseCurrent()
    {
        return this.countBuildingsType("type_house", false);
    }

    // Token: 0x06001C1E RID: 7198 RVA: 0x000FC9DA File Offset: 0x000FABDA
    public int getHouseLimit()
    {
        return this.status.houses_max;
    }

    // Token: 0x06001C1F RID: 7199 RVA: 0x000FC9E8 File Offset: 0x000FABE8
    public bool isConnectedToCapital()
    {
        if (!this.kingdom.hasCapital())
        {
            return false;
        }
        this.recalculateNeighbourCities();
        if (this.neighbours_cities_kingdom.Contains(this))
        {
            return true;
        }
        this.kingdom.calculateNeighbourCities();
        City._connected_checked.Clear();
        City._connected_next_wave.Clear();
        City._connected_current_wave.Clear();
        City._connected_next_wave.UnionWith(this.kingdom.capital.neighbours_cities_kingdom);
        int iii = 0;
        while (City._connected_next_wave.Count > 0)
        {
            City._connected_current_wave.UnionWith(City._connected_next_wave);
            City._connected_next_wave.Clear();
            iii++;
            foreach (City tCity in City._connected_current_wave)
            {
                if (tCity == this)
                {
                    return true;
                }
                City._connected_checked.Add(tCity);
                foreach (City iCity in tCity.neighbours_cities_kingdom)
                {
                    if (!City._connected_checked.Contains(iCity))
                    {
                        City._connected_next_wave.Add(iCity);
                    }
                }
            }
            if (iii <= 30)
            {
                continue;
            }
            break;
        }
        return false;
    }

    // Token: 0x06001C20 RID: 7200 RVA: 0x000FCB48 File Offset: 0x000FAD48
    public void recalculateNeighbourCities()
    {
        this.neighbours_cities.Clear();
        this.neighbours_cities_kingdom.Clear();
        this.neighbours_kingdoms.Clear();
        foreach (TileZone tileZone in this.neighbour_zones)
        {
            City tZoneCity = tileZone.city;
            if (tZoneCity != this && tZoneCity != null)
            {
                this.neighbours_cities.Add(tZoneCity);
                if (tZoneCity.kingdom == this.kingdom)
                {
                    this.neighbours_cities_kingdom.Add(tZoneCity);
                }
                else
                {
                    this.neighbours_kingdoms.Add(tZoneCity.kingdom);
                }
            }
        }
    }

    // Token: 0x06001C21 RID: 7201 RVA: 0x000FCC00 File Offset: 0x000FAE00
    public void recalculateNeighbourZones()
    {
        this.border_zones.Clear();
        this.neighbour_zones.Clear();
        List<TileZone> tZones = this.zones;
        for (int i = 0; i < tZones.Count; i++)
        {
            TileZone tParentZone = tZones[i];
            foreach (TileZone tNeighbourZone in tParentZone.neighbours_all)
            {
                if (tNeighbourZone.city != this)
                {
                    this.border_zones.Add(tParentZone);
                    this.neighbour_zones.Add(tNeighbourZone);
                }
            }
        }
    }

    // Token: 0x06001C22 RID: 7202 RVA: 0x000FCC87 File Offset: 0x000FAE87
    public void removeLeader()
    {
        this.leader = null;
        this.data.leaderID = -1L;
        this.data.rulerLeft();
    }

    // Token: 0x06001C23 RID: 7203 RVA: 0x000FCCA8 File Offset: 0x000FAEA8
    internal void setCulture(Culture pCulture)
    {
        if (this.culture == pCulture)
        {
            return;
        }
        this.culture = pCulture;
        World.world.cultures.setDirtyCities();
    }

    // Token: 0x06001C24 RID: 7204 RVA: 0x000FCCCA File Offset: 0x000FAECA
    public Culture getCulture()
    {
        return this.culture;
    }

    // Token: 0x06001C25 RID: 7205 RVA: 0x000FCCD2 File Offset: 0x000FAED2
    public Language getLanguage()
    {
        return this.language;
    }

    // Token: 0x06001C26 RID: 7206 RVA: 0x000FCCDA File Offset: 0x000FAEDA
    public Religion getReligion()
    {
        return this.religion;
    }

    // Token: 0x06001C27 RID: 7207 RVA: 0x000FCCE2 File Offset: 0x000FAEE2
    public void checkAbandon()
    {
        if (!this._dirty_abandoned_zones)
        {
            return;
        }
        this._dirty_abandoned_zones = false;
        World.world.city_zone_helper.city_abandon.check(this, false, null);
    }

    // Token: 0x06001C28 RID: 7208 RVA: 0x000FCD0C File Offset: 0x000FAF0C
    public void update(float pElapsed)
    {
        if (this.timer_build > 0f)
        {
            this.timer_build -= pElapsed;
        }
        this.updateTotalFood();
        if (this.data.timer_supply > 0f)
        {
            this.data.timer_supply -= pElapsed;
        }
        if (this.data.timer_trade > 0f)
        {
            this.data.timer_trade -= pElapsed;
        }
        if (this._timer_warrior > 0f)
        {
            this._timer_warrior -= pElapsed;
        }
        if (this._dirty_city_status)
        {
            this.updateCityStatus();
        }
        if (this._dirty_citizens)
        {
            this.updateCitizens();
        }
        if (World.world.isPaused())
        {
            return;
        }
        if (this.timer_build_boat > 0f)
        {
            this.timer_build_boat -= pElapsed;
        }
        if (this.ai != null)
        {
            if (this.timer_action > 0f)
            {
                this.timer_action -= pElapsed;
            }
            else
            {
                this.ai.update();
            }
            this.ai.updateSingleTasks(pElapsed);
        }
        this.updateCapture(pElapsed);
    }

    // Token: 0x06001C29 RID: 7209 RVA: 0x000FCE26 File Offset: 0x000FB026
    private void updateTotalFood()
    {
        this._current_total_food = this.countFoodTotal();
    }

    // Token: 0x06001C2A RID: 7210 RVA: 0x000FCE34 File Offset: 0x000FB034
    private void updateCapture(float pElapsed)
    {
        if (this.last_ticks == 0 && !this.isGettingCaptured())
        {
            return;
        }
        if ((int)this._capture_ticks != this.last_ticks)
        {
            if ((int)this._capture_ticks > this.last_ticks)
            {
                this.last_ticks++;
            }
            else
            {
                this.last_ticks--;
            }
        }
        this.last_ticks = Mathf.Clamp(this.last_ticks, 0, 100);
        if (this._timer_capture > 0f)
        {
            this._timer_capture -= pElapsed;
            return;
        }
        this._timer_capture = 0.1f;
        if (this.hasBuildingType("type_watch_tower", true))
        {
            int tTowers = this.countBuildingsType("type_watch_tower", true);
            this.addCapturePoints(this.kingdom, 10 * tTowers);
        }
        Kingdom tDominating = null;
        foreach (Kingdom iKingdom in this._capturing_units.Keys)
        {
            if (tDominating == null)
            {
                tDominating = iKingdom;
            }
            else if (this._capturing_units[iKingdom] > this._capturing_units[tDominating])
            {
                tDominating = iKingdom;
            }
        }
        if (tDominating == null)
        {
            this._capture_ticks -= 0.5f;
            if (this._capture_ticks <= 0f)
            {
                this.clearCapture();
            }
            return;
        }
        bool haveDefenders = false;
        if (this._capturing_units.ContainsKey(this.kingdom) && this._capturing_units[this.kingdom] > 0 && this.countWarriors() > 0)
        {
            haveDefenders = true;
        }
        if (this.being_captured_by != null && !this.being_captured_by.isAlive())
        {
            this.being_captured_by = null;
        }
        bool tCaptureGoDown = false;
        if (this.kingdom == tDominating)
        {
            tCaptureGoDown = true;
        }
        if (haveDefenders && this._capturing_units.Count == 1)
        {
            tCaptureGoDown = true;
        }
        if (tCaptureGoDown)
        {
            this._capture_ticks -= 1f;
            if (this._capture_ticks <= 0f)
            {
                this.clearCapture();
            }
            return;
        }
        if (tDominating.isEnemy(this.kingdom) && (!haveDefenders || this._capture_ticks < 5f))
        {
            if (this.being_captured_by == null || this.being_captured_by == tDominating)
            {
                this._capture_ticks += 1f + 1f * pElapsed;
                this.being_captured_by = tDominating;
                if (this._capture_ticks >= 100f)
                {
                    this.finishCapture(tDominating);
                    return;
                }
            }
            else if (tDominating.isEnemy(this.being_captured_by))
            {
                this._capture_ticks -= 0.5f;
                if (this._capture_ticks <= 0f)
                {
                    this.clearCapture();
                    return;
                }
            }
            else
            {
                this._capture_ticks += 1f + 1f * pElapsed;
                if (this._capture_ticks >= 100f)
                {
                    this.finishCapture(this.being_captured_by);
                }
            }
        }
    }

    // Token: 0x06001C2B RID: 7211 RVA: 0x000FD0F8 File Offset: 0x000FB2F8
    public bool isGettingCaptured()
    {
        return this._capturing_units.Count != 0 && (this._capturing_units.Count != 1 || !this._capturing_units.ContainsKey(this.kingdom));
    }

    // Token: 0x06001C2C RID: 7212 RVA: 0x000FD130 File Offset: 0x000FB330
    public bool isGettingCapturedBy(Kingdom pKingdom)
    {
        int tCount;
        return this._capturing_units.TryGetValue(pKingdom, out tCount) && tCount > 0;
    }

    // Token: 0x06001C2D RID: 7213 RVA: 0x000FD154 File Offset: 0x000FB354
    private void clearCapture()
    {
        this._capture_ticks = 0f;
        this.being_captured_by = null;
    }

    // Token: 0x06001C2E RID: 7214 RVA: 0x000FD168 File Offset: 0x000FB368
    public float getCaptureTicks()
    {
        return this._capture_ticks;
    }

    // Token: 0x06001C2F RID: 7215 RVA: 0x000FD170 File Offset: 0x000FB370
    private void prepareProfessionDicts()
    {
        if (this._professions_dict.Count == 0)
        {
            for (int i = 0; i < ProfessionLibrary.list_enum_profession_ids.Length; i++)
            {
                UnitProfession tPro = ProfessionLibrary.list_enum_profession_ids[i];
                this._professions_dict.Add(tPro, new List<Actor>());
            }
        }
    }

    // Token: 0x06001C30 RID: 7216 RVA: 0x000FD1B8 File Offset: 0x000FB3B8
    private void updateCitizens()
    {
        this._dirty_citizens = false;
        this.prepareProfessionDicts();
        foreach (List<Actor> list in this._professions_dict.Values)
        {
            list.Clear();
        }
        List<Actor> tUnits = base.units;
        for (int i = 0; i < tUnits.Count; i++)
        {
            Actor tActor = tUnits[i];
            if (tActor != null && tActor.isAlive())
            {
                this._professions_dict[tActor.getProfession()].Add(tActor);
            }
        }
    }

    // Token: 0x06001C31 RID: 7217 RVA: 0x000FD25C File Offset: 0x000FB45C
    public bool canGrowZones()
    {
        return DebugConfig.isOn(DebugOption.SystemZoneGrowth) && !this._dirty_abandoned_zones && this.getPopulationPeople() != 0;
    }

    // Token: 0x06001C32 RID: 7218 RVA: 0x000FD280 File Offset: 0x000FB480
    internal int countProfession(UnitProfession pType)
    {
        List<Actor> tList;
        if (this._professions_dict.TryGetValue(pType, out tList))
        {
            return tList.Count;
        }
        return 0;
    }

    // Token: 0x06001C33 RID: 7219 RVA: 0x000FD2A8 File Offset: 0x000FB4A8
    public void destroyCity()
    {
        this.removeLeader();
        if (this.hasArmy())
        {
            this.army.disband();
        }
        foreach (TileZone tileZone in this.zones)
        {
            tileZone.setCity(null);
        }
        foreach (Actor tActor in World.world.units)
        {
            if (tActor.city == this)
            {
                tActor.setCity(null);
            }
        }
        this.data.equipment.clearItems();
        base.units.Clear();
        this._boats.Clear();
        this.zones.Clear();
        if (this.hasKingdom())
        {
            this.removeFromCurrentKingdom();
        }
    }

    // Token: 0x06001C34 RID: 7220 RVA: 0x000FD39C File Offset: 0x000FB59C
    public override void Dispose()
    {
        DBInserter.deleteData(this.getID(), "city");
        City._connected_checked.Clear();
        City._connected_next_wave.Clear();
        City._connected_current_wave.Clear();
        this.stockpiles.Clear();
        this.storages.Clear();
        this._cached_book_ids.Clear();
        this._cached_buildings_with_book_slots.Clear();
        base.units.Clear();
        this._boats.Clear();
        this.buildings.Clear();
        this.buildings_dict_id.Clear();
        this.buildings_dict_type.Clear();
        this.zones.Clear();
        this.road_tiles_to_build.Clear();
        this.calculated_place_for_farms.Clear();
        this.calculated_farm_fields.Clear();
        this.calculated_crops.Clear();
        this.calculated_grown_wheat.Clear();
        this._professions_dict.Clear();
        this.neighbour_zones.Clear();
        this.border_zones.Clear();
        this.neighbours_cities.Clear();
        this.neighbours_cities_kingdom.Clear();
        this.neighbours_kingdoms.Clear();
        this.tiles_to_remove.Clear();
        this.danger_zones.Clear();
        this._capturing_units.Clear();
        this._city_tile = null;
        this.target_attack_zone = null;
        this.target_attack_city = null;
        this.army = null;
        this.tasks.clear();
        this.jobs.clear();
        this.status.clear();
        this.under_construction_building = null;
        this.culture = null;
        this.language = null;
        this.religion = null;
        this.kingdom = null;
        this.leader = null;
        this.being_captured_by = null;
        this._debug_last_possible_build_orders = null;
        this._debug_last_possible_build_orders_no_resources = null;
        this._debug_last_build_order_try = null;
        this.timestamp_shrink = 0.0;
        this.ai.reset();
        base.Dispose();
    }

    // Token: 0x06001C35 RID: 7221 RVA: 0x000FD582 File Offset: 0x000FB782
    public bool hasAttackZoneOrder()
    {
        return this.target_attack_zone != null;
    }

    // Token: 0x06001C36 RID: 7222 RVA: 0x000FD590 File Offset: 0x000FB790
    internal void spendResourcesForBuildingAsset(ConstructionCost pCost)
    {
        this.takeResource("wood", pCost.wood);
        this.takeResource("gold", pCost.gold);
        this.takeResource("stone", pCost.stone);
        this.takeResource("common_metals", pCost.common_metals);
    }

    // Token: 0x06001C37 RID: 7223 RVA: 0x000FD5E4 File Offset: 0x000FB7E4
    internal bool hasEnoughResourcesFor(ConstructionCost pCost)
    {
        return DebugConfig.isOn(DebugOption.CityInfiniteResources) || (this.amount_wood >= pCost.wood && this.amount_common_metals >= pCost.common_metals && this.amount_stone >= pCost.stone && this.amount_gold >= pCost.gold);
    }

    // Token: 0x170001B2 RID: 434
    // (get) Token: 0x06001C38 RID: 7224 RVA: 0x000FD640 File Offset: 0x000FB840
    public int amount_wood
    {
        get
        {
            return this.getResourcesAmount("wood");
        }
    }

    // Token: 0x170001B3 RID: 435
    // (get) Token: 0x06001C39 RID: 7225 RVA: 0x000FD64D File Offset: 0x000FB84D
    public int amount_gold
    {
        get
        {
            return this.getResourcesAmount("gold");
        }
    }

    // Token: 0x170001B4 RID: 436
    // (get) Token: 0x06001C3A RID: 7226 RVA: 0x000FD65A File Offset: 0x000FB85A
    public int amount_stone
    {
        get
        {
            return this.getResourcesAmount("stone");
        }
    }

    // Token: 0x170001B5 RID: 437
    // (get) Token: 0x06001C3B RID: 7227 RVA: 0x000FD667 File Offset: 0x000FB867
    public int amount_common_metals
    {
        get
        {
            return this.getResourcesAmount("common_metals");
        }
    }

    // Token: 0x06001C3C RID: 7228 RVA: 0x000FD674 File Offset: 0x000FB874
    internal Building getBuildingToBuild()
    {
        if (this.under_construction_building != null && (!this.under_construction_building.isAlive() || !this.under_construction_building.isUnderConstruction()))
        {
            this.under_construction_building = null;
        }
        return this.under_construction_building;
    }

    // Token: 0x06001C3D RID: 7229 RVA: 0x000FD6A5 File Offset: 0x000FB8A5
    internal bool hasBuildingToBuild()
    {
        if (this.under_construction_building == null)
        {
            return false;
        }
        if (!this.under_construction_building.isAlive() || !this.under_construction_building.isUnderConstruction())
        {
            this.under_construction_building = null;
            return false;
        }
        return true;
    }

    // Token: 0x06001C3E RID: 7230 RVA: 0x000FD6D8 File Offset: 0x000FB8D8
    internal void setBuildingDictType(Building pBuilding)
    {
        List<Building> tList = this.getBuildingListOfType(pBuilding.asset.type);
        if (tList == null)
        {
            tList = new List<Building>();
            this.buildings_dict_type.Add(pBuilding.asset.type, tList);
        }
        tList.Add(pBuilding);
    }

    // Token: 0x06001C3F RID: 7231 RVA: 0x000FD720 File Offset: 0x000FB920
    internal List<Building> getBuildingListOfID(string pBuildingID)
    {
        List<Building> tList;
        this.buildings_dict_id.TryGetValue(pBuildingID, out tList);
        return tList;
    }

    // Token: 0x06001C40 RID: 7232 RVA: 0x000FD73D File Offset: 0x000FB93D
    public int countZones()
    {
        return this.zones.Count;
    }

    // Token: 0x06001C41 RID: 7233 RVA: 0x000FD74A File Offset: 0x000FB94A
    public int countBuildings()
    {
        return this.buildings.Count;
    }

    // Token: 0x06001C42 RID: 7234 RVA: 0x000FD758 File Offset: 0x000FB958
    public int countBuildingsOfID(string pBuildingID)
    {
        List<Building> tList = this.getBuildingListOfID(pBuildingID);
        if (tList == null)
        {
            return 0;
        }
        return tList.Count;
    }

    // Token: 0x06001C43 RID: 7235 RVA: 0x000FD778 File Offset: 0x000FB978
    internal void setBuildingDictID(Building pBuilding)
    {
        List<Building> tList;
        if (!this.buildings_dict_id.TryGetValue(pBuilding.asset.id, out tList))
        {
            this.buildings_dict_id.Add(pBuilding.asset.id, tList = new List<Building>());
        }
        tList.Add(pBuilding);
    }

    // Token: 0x06001C44 RID: 7236 RVA: 0x000FD7C4 File Offset: 0x000FB9C4
    public int countBuildingsType(string pBuildingTypeID, bool pCountOnlyFinished = true)
    {
        List<Building> tList = this.getBuildingListOfType(pBuildingTypeID);
        if (tList == null)
        {
            return 0;
        }
        if (pCountOnlyFinished)
        {
            int tCount = 0;
            using (List<Building>.Enumerator enumerator = tList.GetEnumerator())
            {
                while (enumerator.MoveNext())
                {
                    if (!enumerator.Current.isUnderConstruction())
                    {
                        tCount++;
                    }
                }
            }
            return tCount;
        }
        return tList.Count;
    }

    // Token: 0x06001C45 RID: 7237 RVA: 0x000FD830 File Offset: 0x000FBA30
    internal bool hasBuildingType(string pBuildingTypeID, bool pCountOnlyFinished = true)
    {
        List<Building> tList = this.getBuildingListOfType(pBuildingTypeID);
        if (tList == null)
        {
            return false;
        }
        if (tList.Count == 0)
        {
            return false;
        }
        if (pCountOnlyFinished)
        {
            foreach (Building tBuilding in tList)
            {
                if (!tBuilding.isUnderConstruction() && tBuilding.isUsable())
                {
                    return true;
                }
            }
            return false;
        }
        return true;
    }

    // Token: 0x06001C46 RID: 7238 RVA: 0x000FD8AC File Offset: 0x000FBAAC
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    internal List<Building> getBuildingListOfType(string pType)
    {
        List<Building> tList;
        this.buildings_dict_type.TryGetValue(pType, out tList);
        return tList;
    }

    // Token: 0x06001C47 RID: 7239 RVA: 0x000FD8CC File Offset: 0x000FBACC
    internal Building getBuildingOfType(string pBuildingTypeID, bool pCountOnlyFinished = true, bool pRandom = false, bool pOnlyFreeTile = false)
    {
        List<Building> tList = this.getBuildingListOfType(pBuildingTypeID);
        if (tList == null)
        {
            return null;
        }
        if (tList.Count == 0)
        {
            return null;
        }
        if (pCountOnlyFinished)
        {
            IEnumerable<Building> enumerable2;
            if (!pRandom)
            {
                IEnumerable<Building> enumerable = tList;
                enumerable2 = enumerable;
            }
            else
            {
                enumerable2 = tList.LoopRandom<Building>();
            }
            foreach (Building tBuilding in enumerable2)
            {
                if (!tBuilding.isUnderConstruction() && tBuilding.isUsable() && (!pOnlyFreeTile || !tBuilding.current_tile.isTargeted()))
                {
                    return tBuilding;
                }
            }
            return null;
        }
        if (pRandom)
        {
            return tList.GetRandom<Building>();
        }
        using (List<Building>.Enumerator enumerator2 = tList.GetEnumerator())
        {
            if (enumerator2.MoveNext())
            {
                return enumerator2.Current;
            }
        }
        return null;
    }

    // Token: 0x06001C48 RID: 7240 RVA: 0x000FD9A4 File Offset: 0x000FBBA4
    public void addRoads(List<WorldTile> pTiles)
    {
        for (int i = 0; i < pTiles.Count; i++)
        {
            WorldTile tTile = pTiles[i];
            if (!tTile.Type.road && !this.road_tiles_to_build.Contains(tTile))
            {
                this.road_tiles_to_build.Add(tTile);
            }
        }
    }

    // Token: 0x06001C49 RID: 7241 RVA: 0x000FD9F1 File Offset: 0x000FBBF1
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    private bool isArmyFull()
    {
        return this.status.warriors_current >= this.status.warrior_slots;
    }

    // Token: 0x06001C4A RID: 7242 RVA: 0x000FDA0E File Offset: 0x000FBC0E
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    private bool isArmyOverLimit()
    {
        return this.status.warriors_current > this.status.warrior_slots;
    }

    // Token: 0x06001C4B RID: 7243 RVA: 0x000FDA2C File Offset: 0x000FBC2C
    private bool tryToMakeWarrior(Actor pActor)
    {
        if (!this.checkCanMakeWarrior(pActor))
        {
            return false;
        }
        this.makeWarrior(pActor);
        this._timer_warrior = 15f;
        if (this.hasLeader())
        {
            float tDecrease = this.leader.stats["warfare"] / 2f;
            this._timer_warrior -= tDecrease;
            if (this._timer_warrior < 1f)
            {
                this._timer_warrior = 1f;
            }
        }
        if (this.hasBuildingType("type_barracks", true))
        {
            this._timer_warrior /= 2f;
        }
        return true;
    }

    // Token: 0x06001C4C RID: 7244 RVA: 0x000FDAC4 File Offset: 0x000FBCC4
    public bool checkCanMakeWarrior(Actor pActor)
    {
        if (this.isArmyFull())
        {
            return false;
        }
        if (pActor.isBaby())
        {
            return false;
        }
        if (this.hasCulture())
        {
            if (pActor.isSexFemale() && this.culture.hasTrait("conscription_male_only"))
            {
                return false;
            }
            if (pActor.isSexMale() && this.culture.hasTrait("conscription_female_only"))
            {
                return false;
            }
        }
        return true;
    }

    // Token: 0x06001C4D RID: 7245 RVA: 0x000FDB26 File Offset: 0x000FBD26
    public void makeWarrior(Actor pActor)
    {
        pActor.setProfession(UnitProfession.Warrior, true);
        if (pActor.equipment.weapon.isEmpty())
        {
            City.giveItem(pActor, this.getEquipmentList(EquipmentType.Weapon), this);
        }
        this.status.warriors_current++;
    }

    // Token: 0x06001C4E RID: 7246 RVA: 0x000FDB64 File Offset: 0x000FBD64
    public bool checkIfWarriorStillOk(Actor pActor)
    {
        bool tIsOk = true;
        if (this.isArmyOverLimit())
        {
            tIsOk = false;
        }
        if (tIsOk && !this.hasEnoughFoodForArmy())
        {
            tIsOk = false;
        }
        if (!tIsOk)
        {
            pActor.stopBeingWarrior();
            this._timer_warrior = 30f;
        }
        return tIsOk;
    }

    // Token: 0x06001C4F RID: 7247 RVA: 0x000FDBA0 File Offset: 0x000FBDA0
    public void setCitizenJob(Actor pActor)
    {
        if (!this.isGettingCaptured() && this._timer_warrior <= 0f && pActor.isProfession(UnitProfession.Unit) && this.getResourcesAmount("gold") > 10 && this.hasEnoughFoodForArmy() && this.tryToMakeWarrior(pActor))
        {
            return;
        }
        if (this.checkCitizenJobList(AssetManager.citizen_job_library.list_priority_high, pActor))
        {
            return;
        }
        if (!this.hasAnyFood() && this.checkCitizenJobList(AssetManager.citizen_job_library.list_priority_high_food, pActor))
        {
            return;
        }
        List<CitizenJobAsset> tJobList = AssetManager.citizen_job_library.list_priority_normal;
        for (int i = 0; i < tJobList.Count; i++)
        {
            this._last_checked_job_id++;
            if (this._last_checked_job_id > tJobList.Count - 1)
            {
                this._last_checked_job_id = 0;
            }
            CitizenJobAsset tCitizenJobAsset = tJobList[this._last_checked_job_id];
            if ((tCitizenJobAsset.ok_for_king || !pActor.isKing()) && (tCitizenJobAsset.ok_for_leader || !pActor.isCityLeader()) && this.checkCitizenJob(tCitizenJobAsset, this, pActor))
            {
                return;
            }
        }
    }

    // Token: 0x06001C50 RID: 7248 RVA: 0x000FDC98 File Offset: 0x000FBE98
    private bool checkCitizenJobList(List<CitizenJobAsset> pList, Actor pActor)
    {
        for (int i = 0; i < pList.Count; i++)
        {
            CitizenJobAsset tAsset = pList[i];
            if (this.checkCitizenJob(tAsset, this, pActor))
            {
                return true;
            }
        }
        return false;
    }

    // Token: 0x06001C51 RID: 7249 RVA: 0x000FDCCC File Offset: 0x000FBECC
    private bool checkCitizenJob(CitizenJobAsset pJobAsset, City pCity, Actor pActor)
    {
        if (pJobAsset.only_leaders && !pActor.isKing() && !pActor.isCityLeader())
        {
            return false;
        }
        if (pJobAsset.should_be_assigned != null && !pJobAsset.should_be_assigned(pActor))
        {
            return false;
        }
        if (this.jobs.hasJob(pJobAsset))
        {
            this.jobs.takeJob(pJobAsset);
            pActor.setCitizenJob(pJobAsset);
            return true;
        }
        return false;
    }

    // Token: 0x06001C52 RID: 7250 RVA: 0x000FDD30 File Offset: 0x000FBF30
    public bool hasSuitableFood(Subspecies pSubspecies)
    {
        HashSet<string> tAllowedFood = pSubspecies.getAllowedFoodByDiet();
        foreach (Building tStorage in this.storages)
        {
            if (tStorage.isUsable())
            {
                foreach (string tAllowedFoodID in tAllowedFood)
                {
                    if (tStorage.getResourcesAmount(tAllowedFoodID) != 0)
                    {
                        return true;
                    }
                }
            }
        }
        return false;
    }

    // Token: 0x06001C53 RID: 7251 RVA: 0x000FDDD8 File Offset: 0x000FBFD8
    internal ResourceAsset getFoodItem(Subspecies pSubspecies, string pFavoriteFood = null)
    {
        if (!string.IsNullOrEmpty(pFavoriteFood) && this.getResourcesAmount(pFavoriteFood) > 0)
        {
            return AssetManager.resources.get(pFavoriteFood);
        }
        return this.getRandomSuitableFood(pSubspecies);
    }

    // Token: 0x06001C54 RID: 7252 RVA: 0x000FDDFF File Offset: 0x000FBFFF
    internal void eatFoodItem(string pItem)
    {
        if (pItem == null)
        {
            return;
        }
        this.takeResource(pItem, 1);
        this.data.total_food_consumed++;
    }

    // Token: 0x06001C55 RID: 7253 RVA: 0x000FDE20 File Offset: 0x000FC020
    internal void removeZone(TileZone pZone)
    {
        this.setAbandonedZonesDirty();
        if (this.zones.Remove(pZone))
        {
            pZone.setCity(null);
            World.world.city_zone_helper.city_place_finder.setDirty();
        }
        this.updateCityCenter();
        this.setStatusDirty();
    }

    // Token: 0x06001C56 RID: 7254 RVA: 0x000FDE60 File Offset: 0x000FC060
    internal void addZone(TileZone pZone)
    {
        if (this.zones.Contains(pZone))
        {
            return;
        }
        if (pZone.city != null)
        {
            pZone.city.removeZone(pZone);
        }
        this.zones.Add(pZone);
        pZone.setCity(this);
        this.updateCityCenter();
        if (World.world.city_zone_helper.city_place_finder.hasPossibleZones())
        {
            World.world.city_zone_helper.city_place_finder.setDirty();
        }
        this.setStatusDirty();
    }

    // Token: 0x06001C57 RID: 7255 RVA: 0x000FDEDC File Offset: 0x000FC0DC
    public int getLoyalty(bool pForceRecalc = false)
    {
        if (World.world.getWorldTimeElapsedSince(this._loyalty_last_time) > 3f || pForceRecalc)
        {
            this._loyalty_cached = LoyaltyCalculator.calculate(this);
            this._loyalty_last_time = World.world.getCurWorldTime();
        }
        if (this.kingdom.isNeutral())
        {
            this._loyalty_cached = 0;
        }
        return this._loyalty_cached;
    }

    // Token: 0x06001C58 RID: 7256 RVA: 0x000FDF3A File Offset: 0x000FC13A
    public bool isCapitalCity()
    {
        return this.kingdom != null && this == this.kingdom.capital;
    }

    // Token: 0x06001C59 RID: 7257 RVA: 0x000FDF54 File Offset: 0x000FC154
    internal void updateAge()
    {
        if (this.hasLeader() && this.leader.hasClan())
        {
            this.leader.addRenown(1);
        }
    }

    // Token: 0x06001C5A RID: 7258 RVA: 0x000FDF78 File Offset: 0x000FC178
    private void updateCityCenter()
    {
        if (!this.hasZones())
        {
            this.city_center = Globals.POINT_IN_VOID_2;
            return;
        }
        float x = 0f;
        float y = 0f;
        float tBestDistance = float.MaxValue;
        TileZone tBestCenterZone = null;
        for (int i = 0; i < this.zones.Count; i++)
        {
            TileZone tZone = this.zones[i];
            x += tZone.centerTile.posV3.x;
            y += tZone.centerTile.posV3.y;
        }
        this.city_center.x = x / (float)this.zones.Count;
        this.city_center.y = y / (float)this.zones.Count;
        for (int j = 0; j < this.zones.Count; j++)
        {
            TileZone tZone2 = this.zones[j];
            float tDistance = Toolbox.SquaredDist((float)tZone2.centerTile.x, (float)tZone2.centerTile.y, this.city_center.x, this.city_center.y);
            if (tDistance < tBestDistance)
            {
                tBestCenterZone = tZone2;
                tBestDistance = tDistance;
            }
        }
        this.city_center.x = tBestCenterZone.centerTile.posV3.x;
        this.city_center.y = tBestCenterZone.centerTile.posV3.y + 2f;
        this.last_city_center = this.city_center;
    }

    // Token: 0x06001C5B RID: 7259 RVA: 0x000FE0E3 File Offset: 0x000FC2E3
    internal void removeFromCurrentKingdom()
    {
        this.kingdom.checkClearCapital(this);
    }

    // Token: 0x06001C5C RID: 7260 RVA: 0x000FE0F4 File Offset: 0x000FC2F4
    internal void switchedKingdom()
    {
        List<Building> tBuildings = this.buildings;
        for (int i = 0; i < tBuildings.Count; i++)
        {
            Building tBuilding = tBuildings[i];
            if (!tBuilding.isRemoved())
            {
                tBuilding.setKingdomCiv(this.kingdom);
            }
        }
        World.world.zone_calculator.setDrawnZonesDirty();
    }

    // Token: 0x06001C5D RID: 7261 RVA: 0x000FE144 File Offset: 0x000FC344
    internal void useInspire(Actor pActor)
    {
        Kingdom tOldKingdom = this.kingdom;
        this.makeOwnKingdom(pActor, true, false);
        World.world.diplomacy.startWar(tOldKingdom, this.kingdom, WarTypeLibrary.inspire, false);
    }

    // Token: 0x06001C5E RID: 7262 RVA: 0x000FE17F File Offset: 0x000FC37F
    internal void clearCurrentCaptureAmounts()
    {
        this._capturing_units.Clear();
    }

    // Token: 0x06001C5F RID: 7263 RVA: 0x000FE18C File Offset: 0x000FC38C
    internal void clearDangerZones()
    {
        this.danger_zones.Clear();
    }

    // Token: 0x06001C60 RID: 7264 RVA: 0x000FE199 File Offset: 0x000FC399
    public bool isInDanger()
    {
        return this.danger_zones.Count > 0;
    }

    // Token: 0x06001C61 RID: 7265 RVA: 0x000FE1AC File Offset: 0x000FC3AC
    private void checkDestruction()
    {
        bool tHaveOwnUnits = false;
        using (List<Actor>.Enumerator enumerator = base.units.GetEnumerator())
        {
            while (enumerator.MoveNext())
            {
                if (enumerator.Current.current_zone.city == this)
                {
                    tHaveOwnUnits = true;
                    break;
                }
            }
        }
        if (!tHaveOwnUnits)
        {
            foreach (Actor actor in base.units)
            {
                actor.removeFromArmy();
                actor.joinCity(null);
            }
            if (this.hasLeader())
            {
                this.removeLeader();
            }
        }
    }

    // Token: 0x06001C62 RID: 7266 RVA: 0x000FE264 File Offset: 0x000FC464
    internal void updateConquest(Actor pActor)
    {
        if (!pActor.isKingdomCiv())
        {
            return;
        }
        if (pActor.hasXenophobic() && pActor.kingdom.getSpecies() != this.kingdom.getSpecies())
        {
            this.checkDestruction();
            return;
        }
        if (pActor.kingdom != this.kingdom && !pActor.kingdom.isEnemy(this.kingdom))
        {
            return;
        }
        this.addCapturePoints(pActor, 1);
    }

    // Token: 0x06001C63 RID: 7267 RVA: 0x000FE2D0 File Offset: 0x000FC4D0
    public void addCapturePoints(BaseSimObject pObject, int pValue)
    {
        this.addCapturePoints(pObject.kingdom, pValue);
    }

    // Token: 0x06001C64 RID: 7268 RVA: 0x000FE2E0 File Offset: 0x000FC4E0
    public void addCapturePoints(Kingdom pKingdom, int pValue)
    {
        int tCurrentCount;
        this._capturing_units.TryGetValue(pKingdom, out tCurrentCount);
        this._capturing_units[pKingdom] = tCurrentCount + pValue;
    }

    // Token: 0x06001C65 RID: 7269 RVA: 0x000FE30C File Offset: 0x000FC50C
    public void debugCaptureUnits(DebugTool pTool)
    {
        pTool.setText("capture units:", this._capturing_units.Count, 0f, false, 0L, false, false, "");
        pTool.setText("isGettingCaptured()", this.isGettingCaptured(), 0f, false, 0L, false, false, "");
        foreach (Kingdom iKingdom in this._capturing_units.Keys)
        {
            pTool.setText("-" + iKingdom.name, this._capturing_units[iKingdom], 0f, false, 0L, false, false, "");
        }
    }

    // Token: 0x06001C66 RID: 7270 RVA: 0x000FE3E4 File Offset: 0x000FC5E4
    internal void finishCapture(Kingdom pNewKingdom)
    {
        this.clearCapture();
        this.recalculateNeighbourCities();
        pNewKingdom.increaseHappinessFromNewCityCapture();
        using (ListPool<War> tListWars = new ListPool<War>(pNewKingdom.getWars(false)))
        {
            Kingdom tKingdomToJoin = this.findKingdomToJoinAfterCapture(pNewKingdom, tListWars);
            if (!this.checkRebelWar(tKingdomToJoin, tListWars))
            {
                tKingdomToJoin.data.timestamp_new_conquest = World.world.getCurWorldTime();
            }
            this.joinAnotherKingdom(tKingdomToJoin, true, false);
            this.removeSoldiers();
        }
    }

    // Token: 0x06001C67 RID: 7271 RVA: 0x000FE464 File Offset: 0x000FC664
    private Kingdom findKingdomToJoinAfterCapture(Kingdom pKingdom, ListPool<War> pWars)
    {
        Kingdom tResultKingdom = null;
        for (int i = 0; i < pWars.Count; i++)
        {
            War tWar = pWars[i];
            if (!tWar.isTotalWar() && tWar.hasKingdom(this.kingdom) && tWar.isInWarWith(pKingdom, this.kingdom))
            {
                if (tWar.isMainAttacker(pKingdom) || tWar.isMainDefender(pKingdom))
                {
                    break;
                }
                if (tWar.isAttacker(this.kingdom))
                {
                    Kingdom tMainDefender = tWar.main_defender;
                    if (!tMainDefender.isRekt())
                    {
                        if (this.neighbours_kingdoms.Contains(tMainDefender))
                        {
                            tResultKingdom = tMainDefender;
                            break;
                        }
                        if (this.neighbours_kingdoms.Contains(pKingdom))
                        {
                            tResultKingdom = pKingdom;
                            break;
                        }
                        tResultKingdom = tMainDefender;
                        break;
                    }
                }
                if (tWar.isDefender(this.kingdom))
                {
                    Kingdom tMainAttacker = tWar.main_attacker;
                    if (!tMainAttacker.isRekt())
                    {
                        if (this.neighbours_kingdoms.Contains(tMainAttacker))
                        {
                            tResultKingdom = tMainAttacker;
                            break;
                        }
                        if (this.neighbours_kingdoms.Contains(pKingdom))
                        {
                            tResultKingdom = pKingdom;
                            break;
                        }
                        tResultKingdom = tMainAttacker;
                        break;
                    }
                }
            }
        }
        if (tResultKingdom == null)
        {
            tResultKingdom = pKingdom;
        }
        else if (tResultKingdom.getSpecies() != this.kingdom.getSpecies())
        {
            tResultKingdom = pKingdom;
        }
        return tResultKingdom;
    }

    // Token: 0x06001C68 RID: 7272 RVA: 0x000FE58C File Offset: 0x000FC78C
    private bool checkRebelWar(Kingdom pKingdomToJoin, ListPool<War> pWars)
    {
        foreach (War ptr in pWars)
        {
            War tWar = ptr;
            if (tWar.getAsset().rebellion && tWar.isMainAttacker(pKingdomToJoin) && tWar.isInWarWith(pKingdomToJoin, this.kingdom))
            {
                return true;
            }
        }
        return false;
    }

    // Token: 0x06001C69 RID: 7273 RVA: 0x000FE600 File Offset: 0x000FC800
    private void removeSoldiers()
    {
        foreach (Actor actor in this._professions_dict[UnitProfession.Warrior])
        {
            actor.setProfession(UnitProfession.Unit, true);
        }
        if (this.hasArmy())
        {
            this.army.disband();
        }
    }

    // Token: 0x06001C6A RID: 7274 RVA: 0x000FE66C File Offset: 0x000FC86C
    public void checkArmyExistance()
    {
        if (this.hasArmy() && !this.army.isAlive())
        {
            this.setArmy(null);
        }
    }

    // Token: 0x06001C6B RID: 7275 RVA: 0x000FE68A File Offset: 0x000FC88A
    public bool hasArmy()
    {
        return this.army != null;
    }

    // Token: 0x06001C6C RID: 7276 RVA: 0x000FE695 File Offset: 0x000FC895
    public void setArmy(Army pArmy)
    {
        this.army = pArmy;
    }

    // Token: 0x06001C6D RID: 7277 RVA: 0x000FE69E File Offset: 0x000FC89E
    public Actor getRandomWarrior()
    {
        return this._professions_dict[UnitProfession.Warrior].GetRandom<Actor>();
    }

    // Token: 0x06001C6E RID: 7278 RVA: 0x000FE6B4 File Offset: 0x000FC8B4
    internal Kingdom makeOwnKingdom(Actor pActor, bool pRebellion = false, bool pFellApart = false)
    {
        string tHappinessEvent = null;
        if (pRebellion)
        {
            World.world.game_stats.data.citiesRebelled += 1L;
            World.world.map_stats.citiesRebelled += 1L;
            tHappinessEvent = "just_rebelled";
        }
        if (pFellApart)
        {
            tHappinessEvent = "kingdom_fell_apart";
        }
        Kingdom tPrevKingdom = this.kingdom;
        this.removeFromCurrentKingdom();
        this.removeLeader();
        Kingdom tNewKingdom = World.world.kingdoms.makeNewCivKingdom(pActor, null, true);
        this.newForceKingdomEvent(base.units, this._boats, tNewKingdom, tHappinessEvent);
        this.setKingdom(tNewKingdom, true);
        this.switchedKingdom();
        tNewKingdom.copyMetasFromOtherKingdom(tPrevKingdom);
        tNewKingdom.setCityMetas(this);
        return tNewKingdom;
    }

    // Token: 0x06001C6F RID: 7279 RVA: 0x000FE761 File Offset: 0x000FC961
    public int getPopulationPeople()
    {
        return this.countUnits();
    }

    // Token: 0x06001C70 RID: 7280 RVA: 0x000FE769 File Offset: 0x000FC969
    public int getPopulationMaximum()
    {
        if (!WorldLawLibrary.world_law_civ_limit_population_100.isEnabled())
        {
            return this.status.housing_total;
        }
        if (this.status.housing_total >= 100)
        {
            return 100;
        }
        return this.status.housing_total;
    }

    // Token: 0x06001C71 RID: 7281 RVA: 0x000FE7A0 File Offset: 0x000FC9A0
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public int getUnitsTotal()
    {
        return this.countUnits() + this.countBoats();
    }

    // Token: 0x06001C72 RID: 7282 RVA: 0x000FE7B0 File Offset: 0x000FC9B0
    public int countPopulationChildren()
    {
        int tCount = 0;
        foreach (Actor tActor in base.units)
        {
            if (tActor.isAlive() && tActor.isBaby())
            {
                tCount++;
            }
        }
        return tCount;
    }

    // Token: 0x06001C73 RID: 7283 RVA: 0x000FE814 File Offset: 0x000FCA14
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public int countBoats()
    {
        return this._boats.Count;
    }

    // Token: 0x06001C74 RID: 7284 RVA: 0x000FE824 File Offset: 0x000FCA24
    public void joinAnotherKingdom(Kingdom pNewSetKingdom, bool pCaptured = false, bool pRebellion = false)
    {
        string tHappinessEvent = null;
        if (pCaptured)
        {
            World.world.game_stats.data.citiesConquered += 1L;
            World.world.map_stats.citiesConquered += 1L;
            tHappinessEvent = "was_conquered";
        }
        if (pRebellion)
        {
            World.world.game_stats.data.citiesRebelled += 1L;
            World.world.map_stats.citiesRebelled += 1L;
            tHappinessEvent = "just_rebelled";
        }
        Kingdom tOldKingdom = this.kingdom;
        this.removeFromCurrentKingdom();
        this.setKingdom(pNewSetKingdom, true);
        this.newForceKingdomEvent(base.units, this._boats, pNewSetKingdom, tHappinessEvent);
        this.switchedKingdom();
        pNewSetKingdom.capturedFrom(tOldKingdom);
    }

    // Token: 0x06001C75 RID: 7285 RVA: 0x000FE8E5 File Offset: 0x000FCAE5
    public int countWeapons()
    {
        return this.getEquipmentList(EquipmentType.Weapon).Count;
    }

    // Token: 0x06001C76 RID: 7286 RVA: 0x000FE8F3 File Offset: 0x000FCAF3
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public int countFoodTotal()
    {
        return this.countFood();
    }

    // Token: 0x06001C77 RID: 7287 RVA: 0x000FE8FB File Offset: 0x000FCAFB
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public bool hasEnoughFoodForArmy()
    {
        return true;
    }

    // Token: 0x06001C78 RID: 7288 RVA: 0x000FE8FE File Offset: 0x000FCAFE
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public int getTotalFood()
    {
        return this._current_total_food;
    }

    // Token: 0x06001C79 RID: 7289 RVA: 0x000FE906 File Offset: 0x000FCB06
    public bool hasAnyFood()
    {
        return this._current_total_food > 0;
    }

    // Token: 0x06001C7A RID: 7290 RVA: 0x000FE911 File Offset: 0x000FCB11
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public int countWarriors()
    {
        return this.countProfession(UnitProfession.Warrior);
    }

    // Token: 0x06001C7B RID: 7291 RVA: 0x000FE91A File Offset: 0x000FCB1A
    public bool hasAnyWarriors()
    {
        return this.countWarriors() > 0;
    }

    // Token: 0x06001C7C RID: 7292 RVA: 0x000FE925 File Offset: 0x000FCB25
    public bool isHappy()
    {
        return this.getLoyalty(false) >= 0;
    }

    // Token: 0x06001C7D RID: 7293 RVA: 0x000FE934 File Offset: 0x000FCB34
    public float getArmyMaxMultiplier()
    {
        float num = 0f + this.getActorAsset().civ_base_army_multiplier;
        float tFromleader = this.getArmyMaxLeaderMultiplier();
        return num + tFromleader;
    }

    // Token: 0x06001C7E RID: 7294 RVA: 0x000FE95C File Offset: 0x000FCB5C
    public float getArmyMaxLeaderMultiplier()
    {
        float tMultiplier = 0f;
        if (this.hasLeader())
        {
            tMultiplier += this.leader.stats["army"];
            float tWarfareBonus = this.leader.stats["warfare"] * 2f / 100f;
            tMultiplier += tWarfareBonus;
        }
        return tMultiplier;
    }

    // Token: 0x06001C7F RID: 7295 RVA: 0x000FE9B6 File Offset: 0x000FCBB6
    public int getMaxWarriors()
    {
        return this.status.warrior_slots;
    }

    // Token: 0x06001C80 RID: 7296 RVA: 0x000FE9C4 File Offset: 0x000FCBC4
    public void setLeader(Actor pActor, bool pNew)
    {
        if (pActor == null)
        {
            return;
        }
        if (this.kingdom.king == pActor)
        {
            return;
        }
        this.leader = pActor;
        this.leader.setProfession(UnitProfession.Leader, true);
        this.data.leaderID = (this.data.last_leader_id = pActor.data.id);
        if (pNew)
        {
            this.data.total_leaders++;
            this.leader.changeHappiness("become_leader", 0);
            this.data.addRuler(pActor);
        }
    }

    // Token: 0x06001C81 RID: 7297 RVA: 0x000FEA50 File Offset: 0x000FCC50
    public static bool nearbyBorders(City pA, City pB)
    {
        City tSmallest;
        City tCheck;
        if (pA.zones.Count > pB.zones.Count)
        {
            tSmallest = pB;
            tCheck = pA;
        }
        else
        {
            tSmallest = pA;
            tCheck = pB;
        }
        for (int i = 0; i < tSmallest.zones.Count; i++)
        {
            TileZone[] tNeighbours = tSmallest.zones[i].neighbours_all;
            for (int j = 0; j < tNeighbours.Length; j++)
            {
                if (tNeighbours[j].city == tCheck)
                {
                    return true;
                }
            }
        }
        return false;
    }

    // Token: 0x06001C82 RID: 7298 RVA: 0x000FEAC8 File Offset: 0x000FCCC8
    public static bool giveItem(Actor pActor, List<long> pItems, City pCity)
    {
        if (pItems.Count == 0)
        {
            return false;
        }
        if (!pActor.understandsHowToUseItems())
        {
            return false;
        }
        long tItemID = pItems.GetRandom<long>();
        Item tNewItem = World.world.items.get(tItemID);
        EquipmentAsset tAsset = tNewItem.getAsset();
        ActorEquipmentSlot tActorSlot = pActor.equipment.getSlot(tAsset.equipment_type);
        if (!tActorSlot.isEmpty())
        {
            int tCurItemValue = tActorSlot.getItem().getValue();
            if (tNewItem.getValue() <= tCurItemValue)
            {
                return false;
            }
        }
        Item tPrevItem = null;
        if (!tActorSlot.isEmpty())
        {
            tPrevItem = tActorSlot.getItem();
            tActorSlot.takeAwayItem();
        }
        pItems.Remove(tItemID);
        tActorSlot.setItem(tNewItem, pActor);
        pActor.setStatsDirty();
        if (tPrevItem != null)
        {
            pCity.data.equipment.addItem(pCity, tPrevItem, pItems);
        }
        return true;
    }

    // Token: 0x06001C83 RID: 7299 RVA: 0x000FEB84 File Offset: 0x000FCD84
    public int getLimitOfBuildingsType(BuildOrder pElement)
    {
        int tResult = pElement.limit_type;
        if (this.hasCulture())
        {
            string type = pElement.getBuildingAsset(this, null).type;
            if (!(type == "type_statue"))
            {
                if (type == "type_watch_tower")
                {
                    if (this.culture.hasTrait("tower_lovers"))
                    {
                        tResult += CultureTraitLibrary.getValue("tower_lovers");
                    }
                    if (this.hasLeader())
                    {
                        tResult += (int)this.leader.stats["bonus_towers"];
                    }
                }
            }
            else if (this.culture.hasTrait("statue_lovers"))
            {
                tResult += CultureTraitLibrary.getValue("statue_lovers");
            }
        }
        return tResult;
    }

    // Token: 0x06001C84 RID: 7300 RVA: 0x000FEC2F File Offset: 0x000FCE2F
    public Alliance getAlliance()
    {
        return this.kingdom.getAlliance();
    }

    // Token: 0x06001C85 RID: 7301 RVA: 0x000FEC3C File Offset: 0x000FCE3C
    public Clan getRoyalClan()
    {
        Clan tClan = null;
        if (tClan == null && this.hasLeader())
        {
            tClan = this.leader.clan;
        }
        if (tClan == null && this.kingdom.hasKing())
        {
            tClan = this.kingdom.king.clan;
        }
        return tClan;
    }

    // Token: 0x06001C86 RID: 7302 RVA: 0x000FEC84 File Offset: 0x000FCE84
    public bool isOkToSendArmy()
    {
        if (!this.hasArmy())
        {
            return false;
        }
        float tMaxArmy = (float)this.getMaxWarriors();
        return (float)this.army.countUnits() / tMaxArmy >= 0.7f;
    }

    // Token: 0x06001C87 RID: 7303 RVA: 0x000FECBC File Offset: 0x000FCEBC
    public void tryToPutItem(Item pItem)
    {
        List<long> tCityItemList = this.data.equipment.getEquipmentList(pItem.getAsset().equipment_type);
        if (tCityItemList.Count >= this.status.maximum_items)
        {
            this.tryToPutItemInStorage(pItem);
            return;
        }
        this.data.equipment.addItem(this, pItem, tCityItemList);
    }

    // Token: 0x06001C88 RID: 7304 RVA: 0x000FED14 File Offset: 0x000FCF14
    public void tryToPutItems(IEnumerable<Item> pItems)
    {
        foreach (Item tItem in pItems)
        {
            this.tryToPutItem(tItem);
        }
    }

    // Token: 0x06001C89 RID: 7305 RVA: 0x000FED5C File Offset: 0x000FCF5C
    private void tryToPutItemInStorage(Item pNewItem)
    {
        float tNewItemValue = (float)pNewItem.getValue();
        EquipmentType tListType = pNewItem.getAsset().equipment_type;
        List<long> tCityItemList = this.data.equipment.getEquipmentList(tListType);
        for (int i = 0; i < tCityItemList.Count; i++)
        {
            long tID = tCityItemList[i];
            Item tOldCityItem = World.world.items.get(tID);
            float tCurValue = (float)tOldCityItem.getValue();
            if (tNewItemValue > tCurValue)
            {
                tOldCityItem.clearCity();
                tCityItemList[i] = pNewItem.id;
                pNewItem.setInCityStorage(this);
                return;
            }
        }
    }

    // Token: 0x06001C8A RID: 7306 RVA: 0x000FEDE7 File Offset: 0x000FCFE7
    public int getZoneRange(bool pAllowCheat = true)
    {
        if (pAllowCheat && DebugConfig.isOn(DebugOption.CityUnlimitedZoneRange))
        {
            return 999;
        }
        return 13;
    }

    // Token: 0x06001C8B RID: 7307 RVA: 0x000FEE00 File Offset: 0x000FD000
    public bool reachableFrom(City pCity)
    {
        WorldTile tTile = this.getTile(false);
        if (tTile == null)
        {
            return false;
        }
        WorldTile tTile2 = pCity.getTile(false);
        return tTile2 != null && tTile.reachableFrom(tTile2);
    }

    // Token: 0x06001C8C RID: 7308 RVA: 0x000FEE2E File Offset: 0x000FD02E
    public bool hasLeader()
    {
        if (this.leader == null)
        {
            return false;
        }
        if (!this.leader.isAlive())
        {
            this.removeLeader();
            return false;
        }
        return true;
    }

    // Token: 0x06001C8D RID: 7309 RVA: 0x000FEE50 File Offset: 0x000FD050
    public override void convertSameSpeciesAroundUnit(Actor pActorMain, bool pOverride = false)
    {
        foreach (Actor tActor in Finder.getUnitsFromChunk(pActorMain.current_tile, 2, 0f, false))
        {
            if (!tActor.hasCity() && !tActor.isKingdomCiv() && tActor.isSameSpecies(pActorMain))
            {
                tActor.joinCity(this);
            }
        }
    }

    // Token: 0x06001C8E RID: 7310 RVA: 0x000FEEC4 File Offset: 0x000FD0C4
    public override void forceConvertSameSpeciesAroundUnit(Actor pActorMain)
    {
        this.convertSameSpeciesAroundUnit(pActorMain, true);
    }

    // Token: 0x06001C8F RID: 7311 RVA: 0x000FEECE File Offset: 0x000FD0CE
    public void setUnitMetas(Actor pActor)
    {
        if (pActor.hasCulture())
        {
            this.setCulture(pActor.culture);
        }
        if (pActor.hasLanguage())
        {
            this.setLanguage(pActor.language);
        }
        if (pActor.hasReligion())
        {
            this.setReligion(pActor.religion);
        }
    }

    // Token: 0x06001C90 RID: 7312 RVA: 0x000FEF0C File Offset: 0x000FD10C
    public override void save()
    {
        base.save();
        if (this.hasCulture())
        {
            this.data.id_culture = this.culture.id;
        }
        if (this.hasReligion())
        {
            this.data.id_religion = this.religion.id;
        }
        if (this.hasLanguage())
        {
            this.data.id_language = this.language.id;
        }
        if (this.kingdom == null)
        {
            this.data.kingdomID = -1L;
        }
        else
        {
            this.data.kingdomID = this.kingdom.id;
        }
        this.data.zones.Clear();
        foreach (TileZone tZone in this.zones)
        {
            ZoneData tZoneData = new ZoneData
            {
                x = tZone.x,
                y = tZone.y
            };
            this.data.zones.Add(tZoneData);
        }
    }

    // Token: 0x06001C91 RID: 7313 RVA: 0x000FF024 File Offset: 0x000FD224
    public bool hasCulture()
    {
        if (this.culture != null && !this.culture.isAlive())
        {
            this.setCulture(null);
        }
        return this.culture != null;
    }

    // Token: 0x06001C92 RID: 7314 RVA: 0x000FF04B File Offset: 0x000FD24B
    public bool hasLanguage()
    {
        if (this.language != null && !this.language.isAlive())
        {
            this.setLanguage(null);
        }
        return this.language != null;
    }

    // Token: 0x06001C93 RID: 7315 RVA: 0x000FF072 File Offset: 0x000FD272
    internal void setLanguage(Language pLanguage)
    {
        if (this.language == pLanguage)
        {
            return;
        }
        this.language = pLanguage;
        World.world.languages.setDirtyCities();
    }

    // Token: 0x06001C94 RID: 7316 RVA: 0x000FF094 File Offset: 0x000FD294
    internal void setReligion(Religion pReligion)
    {
        if (this.religion == pReligion)
        {
            return;
        }
        this.religion = pReligion;
        World.world.religions.setDirtyCities();
    }

    // Token: 0x06001C95 RID: 7317 RVA: 0x000FF0B6 File Offset: 0x000FD2B6
    public Subspecies getMainSubspecies()
    {
        if (this.hasLeader())
        {
            return this.leader.subspecies;
        }
        if (this.getPopulationPeople() == 0)
        {
            return null;
        }
        return base.units[0].subspecies;
    }

    // Token: 0x06001C96 RID: 7318 RVA: 0x000FF0E7 File Offset: 0x000FD2E7
    public bool hasReligion()
    {
        if (this.religion != null && !this.religion.isAlive())
        {
            this.setReligion(null);
        }
        return this.religion != null;
    }

    // Token: 0x06001C97 RID: 7319 RVA: 0x000FF10E File Offset: 0x000FD30E
    public bool hasStockpiles()
    {
        return this.stockpiles.Count > 0;
    }

    // Token: 0x06001C98 RID: 7320 RVA: 0x000FF11E File Offset: 0x000FD31E
    public bool hasStorages()
    {
        return this.storages.Count > 0;
    }

    // Token: 0x06001C99 RID: 7321 RVA: 0x000FF130 File Offset: 0x000FD330
    public Building getRandomStockpile()
    {
        if (!this.hasStockpiles())
        {
            return null;
        }
        foreach (Building tStockpile in this.stockpiles.LoopRandom<Building>())
        {
            if (tStockpile.isUsable())
            {
                return tStockpile;
            }
        }
        return null;
    }

    // Token: 0x06001C9A RID: 7322 RVA: 0x000FF194 File Offset: 0x000FD394
    public void takeResource(string pResourceID, int pAmount)
    {
        if (!this.hasStorages())
        {
            return;
        }
        int tLeftToTake = pAmount;
        foreach (Building tStorage in this.storages)
        {
            if (tStorage.isUsable())
            {
                int tAmountCanTake;
                if (tStorage.getResourcesAmount(pResourceID) >= tLeftToTake)
                {
                    tAmountCanTake = tLeftToTake;
                }
                else
                {
                    tAmountCanTake = tStorage.getResourcesAmount(pResourceID);
                }
                tStorage.takeResource(pResourceID, tAmountCanTake);
                tLeftToTake -= tAmountCanTake;
                if (tLeftToTake == 0)
                {
                    break;
                }
            }
        }
    }

    // Token: 0x06001C9B RID: 7323 RVA: 0x000FF220 File Offset: 0x000FD420
    public int getResourcesAmount(string pResourceID)
    {
        if (!this.hasStorages())
        {
            return 0;
        }
        int tResult = 0;
        foreach (Building tStorage in this.storages)
        {
            if (tStorage.isUsable())
            {
                tResult += tStorage.getResourcesAmount(pResourceID);
            }
        }
        return tResult;
    }

    // Token: 0x06001C9C RID: 7324 RVA: 0x000FF28C File Offset: 0x000FD48C
    public int addResourcesToRandomStockpile(string pResourceID, int pAmount = 1)
    {
        Building tStockpile = this.getRandomStockpile();
        if (tStockpile == null)
        {
            return 0;
        }
        return tStockpile.addResources(pResourceID, pAmount);
    }

    // Token: 0x06001C9D RID: 7325 RVA: 0x000FF2B0 File Offset: 0x000FD4B0
    public bool hasSpaceForResourceInStockpile(ResourceAsset pResourceAsset)
    {
        if (!this.hasStockpiles())
        {
            return false;
        }
        foreach (Building tStockpile in this.stockpiles)
        {
            if (tStockpile.isUsable() && tStockpile.hasSpaceForResource(pResourceAsset))
            {
                return true;
            }
        }
        return false;
    }

    // Token: 0x06001C9E RID: 7326 RVA: 0x000FF320 File Offset: 0x000FD520
    public bool hasResourcesForNewItems()
    {
        if (!this.hasStorages())
        {
            return false;
        }
        foreach (Building tStorage in this.storages)
        {
            if (tStorage.isUsable() && tStorage.hasResourcesForNewItems())
            {
                return true;
            }
        }
        return false;
    }

    // Token: 0x06001C9F RID: 7327 RVA: 0x000FF390 File Offset: 0x000FD590
    public ResourceAsset getRandomSuitableFood(Subspecies pSubspecies)
    {
        if (!this.hasStorages())
        {
            return null;
        }
        foreach (Building tStorage in this.storages)
        {
            if (tStorage.isUsable())
            {
                ResourceAsset tAsset = tStorage.getRandomSuitableFood(pSubspecies, null);
                if (tAsset != null)
                {
                    return tAsset;
                }
            }
        }
        return null;
    }

    // Token: 0x06001CA0 RID: 7328 RVA: 0x000FF404 File Offset: 0x000FD604
    public int countFood()
    {
        if (!this.hasStorages())
        {
            return 0;
        }
        int tResult = 0;
        foreach (Building tStorage in this.storages)
        {
            if (tStorage.isUsable())
            {
                tResult += tStorage.countFood();
            }
        }
        return tResult;
    }

    // Token: 0x06001CA1 RID: 7329 RVA: 0x000FF470 File Offset: 0x000FD670
    public ListPool<CityStorageSlot> getTotalResourceSlots(ResType[] pResTypes)
    {
        foreach (CityStorageSlot tSlot in this._total_resource_slots.Values)
        {
            ResourceAsset tAsset = tSlot.asset;
            if (pResTypes.IndexOf(tAsset.type) != -1)
            {
                tSlot.amount = 0;
            }
        }
        foreach (Building tBuilding in this.storages)
        {
            if (tBuilding.isUsable())
            {
                foreach (CityStorageSlot tSlot2 in tBuilding.resources.getSlots())
                {
                    CityStorageSlot tTotalSlot;
                    this._total_resource_slots.TryGetValue(tSlot2.id, out tTotalSlot);
                    if (tTotalSlot == null)
                    {
                        tTotalSlot = new CityStorageSlot(tSlot2.id);
                        this._total_resource_slots[tSlot2.id] = tTotalSlot;
                    }
                    tTotalSlot.amount += tSlot2.amount;
                }
            }
        }
        ListPool<CityStorageSlot> tResult = new ListPool<CityStorageSlot>(this._total_resource_slots.Count);
        foreach (CityStorageSlot tSlot3 in this._total_resource_slots.Values)
        {
            ResourceAsset tAsset2 = tSlot3.asset;
            if (pResTypes.IndexOf(tAsset2.type) != -1 && tSlot3.amount != 0)
            {
                tResult.Add(tSlot3);
            }
        }
        tResult.Sort((CityStorageSlot a, CityStorageSlot b) => a.asset.order.CompareTo(b.asset.order));
        return tResult;
    }

    // Token: 0x06001CA2 RID: 7330 RVA: 0x000FF660 File Offset: 0x000FD860
    public bool hasKingdom()
    {
        return this.kingdom != null;
    }

    // Token: 0x06001CA3 RID: 7331 RVA: 0x000FF66B File Offset: 0x000FD86B
    public float getTimerForNewWarrior()
    {
        return this._timer_warrior;
    }

    // Token: 0x06001CA4 RID: 7332 RVA: 0x000FF673 File Offset: 0x000FD873
    public List<long> getEquipmentList(EquipmentType pType)
    {
        return this.data.equipment.getEquipmentList(pType);
    }

    // Token: 0x06001CA5 RID: 7333 RVA: 0x000FF686 File Offset: 0x000FD886
    public bool planAllowsToPlaceBuildingInZone(TileZone pZone, TileZone pCenterZone)
    {
        return (this.status.housing_total < 10 && this.zones.Count < 20) || this.culture.planAllowsToPlaceBuildingInZone(pZone, pCenterZone);
    }

    // Token: 0x06001CA6 RID: 7334 RVA: 0x000FF6B5 File Offset: 0x000FD8B5
    public bool hasSpecialTownPlans()
    {
        return this.hasCulture() && this.culture.hasSpecialTownPlans();
    }

    // Token: 0x06001CA7 RID: 7335 RVA: 0x000FF6CC File Offset: 0x000FD8CC
    public bool isNeutral()
    {
        return this.kingdom.isNeutral();
    }

    // Token: 0x06001CA8 RID: 7336 RVA: 0x000FF6DC File Offset: 0x000FD8DC
    public bool isWelcomedToJoin(Actor pActor)
    {
        if (pActor.kingdom == this.kingdom)
        {
            return true;
        }
        if (pActor.isSameSubspecies(this.getMainSubspecies()))
        {
            return true;
        }
        if (!this.hasCulture())
        {
            return false;
        }
        if (this.culture.hasTrait("xenophobic"))
        {
            return false;
        }
        if (pActor.hasCultureTrait("xenophobic"))
        {
            return false;
        }
        if (this.culture.hasTrait("xenophiles"))
        {
            if (!pActor.hasCulture())
            {
                return true;
            }
            if (pActor.hasCultureTrait("xenophiles"))
            {
                return true;
            }
        }
        return this.isSameSpeciesAsActor(pActor);
    }

    // Token: 0x06001CA9 RID: 7337 RVA: 0x000FF76D File Offset: 0x000FD96D
    public bool isSameSpeciesAsActor(Actor pActor)
    {
        return pActor.isSameSpecies(this.getCurrentSpecies());
    }

    // Token: 0x06001CAA RID: 7338 RVA: 0x000FF780 File Offset: 0x000FD980
    public string getCurrentSpecies()
    {
        Subspecies tMainSubspecies = this.getMainSubspecies();
        if (tMainSubspecies != null)
        {
            return tMainSubspecies.getActorAsset().id;
        }
        return this.getActorAsset().id;
    }

    // Token: 0x06001CAB RID: 7339 RVA: 0x000FF7B0 File Offset: 0x000FD9B0
    public Sprite getCurrentSpeciesIcon()
    {
        Subspecies tMainSubspecies = this.getMainSubspecies();
        if (tMainSubspecies != null)
        {
            return tMainSubspecies.getSpriteIcon();
        }
        return this.getActorAsset().getSpriteIcon();
    }

    // Token: 0x06001CAC RID: 7340 RVA: 0x000FF7DC File Offset: 0x000FD9DC
    public bool hasTransportBoats()
    {
        using (List<Actor>.Enumerator enumerator = this._boats.GetEnumerator())
        {
            while (enumerator.MoveNext())
            {
                if (enumerator.Current.asset.is_boat_transport)
                {
                    return true;
                }
            }
        }
        return false;
    }

    // Token: 0x06001CAD RID: 7341 RVA: 0x000FF83C File Offset: 0x000FDA3C
    public bool isCityUnderDangerFire()
    {
        return (this.leader == null || !this.leader.isImmuneToFire()) && this.tasks.fire > 0;
    }

    // Token: 0x06001CAE RID: 7342 RVA: 0x000FF864 File Offset: 0x000FDA64
    public bool isPossibleToJoin(Actor pActor)
    {
        if (this == pActor.city)
        {
            return false;
        }
        if (this.isNeutral())
        {
            return true;
        }
        if (!this.isWelcomedToJoin(pActor))
        {
            return false;
        }
        if (pActor.city != null)
        {
            if (pActor.isKing())
            {
                return false;
            }
            if (pActor.isCityLeader())
            {
                return false;
            }
            if (pActor.city.getPopulationPeople() < this.getPopulationPeople())
            {
                return false;
            }
        }
        return true;
    }

    // Token: 0x0400156F RID: 5487
    private static readonly HashSet<City> _connected_checked = new HashSet<City>();

    // Token: 0x04001570 RID: 5488
    private static readonly HashSet<City> _connected_next_wave = new HashSet<City>();

    // Token: 0x04001571 RID: 5489
    private static readonly HashSet<City> _connected_current_wave = new HashSet<City>();

    // Token: 0x04001572 RID: 5490
    private readonly Dictionary<string, CityStorageSlot> _total_resource_slots = new Dictionary<string, CityStorageSlot>();

    // Token: 0x04001573 RID: 5491
    private readonly Dictionary<UnitProfession, List<Actor>> _professions_dict = new Dictionary<UnitProfession, List<Actor>>();

    // Token: 0x04001574 RID: 5492
    private readonly List<Actor> _boats = new List<Actor>();

    // Token: 0x04001575 RID: 5493
    private readonly Dictionary<string, long> _species = new Dictionary<string, long>();

    // Token: 0x04001576 RID: 5494
    public readonly List<Building> buildings = new List<Building>();

    // Token: 0x04001577 RID: 5495
    public readonly Dictionary<string, List<Building>> buildings_dict_type = new Dictionary<string, List<Building>>();

    // Token: 0x04001578 RID: 5496
    public readonly Dictionary<string, List<Building>> buildings_dict_id = new Dictionary<string, List<Building>>();

    // Token: 0x04001579 RID: 5497
    public readonly CityTasksData tasks = new CityTasksData();

    // Token: 0x0400157A RID: 5498
    public readonly CitizenJobs jobs = new CitizenJobs();

    // Token: 0x0400157B RID: 5499
    public readonly CityStatus status = new CityStatus();

    // Token: 0x0400157C RID: 5500
    public float mark_scale_effect;

    // Token: 0x0400157D RID: 5501
    [NonSerialized]
    internal Kingdom kingdom;

    // Token: 0x0400157E RID: 5502
    public Culture culture;

    // Token: 0x0400157F RID: 5503
    public Language language;

    // Token: 0x04001580 RID: 5504
    public Religion religion;

    // Token: 0x04001581 RID: 5505
    public Actor leader;

    // Token: 0x04001582 RID: 5506
    public Army army;

    // Token: 0x04001583 RID: 5507
    internal readonly List<TileZone> zones = new List<TileZone>();

    // Token: 0x04001584 RID: 5508
    internal readonly HashSet<TileZone> neighbour_zones = new HashSet<TileZone>();

    // Token: 0x04001585 RID: 5509
    internal readonly HashSet<TileZone> border_zones = new HashSet<TileZone>();

    // Token: 0x04001586 RID: 5510
    internal readonly HashSet<City> neighbours_cities = new HashSet<City>();

    // Token: 0x04001587 RID: 5511
    internal readonly HashSet<City> neighbours_cities_kingdom = new HashSet<City>();

    // Token: 0x04001588 RID: 5512
    internal readonly HashSet<Kingdom> neighbours_kingdoms = new HashSet<Kingdom>();

    // Token: 0x04001589 RID: 5513
    internal Building under_construction_building;

    // Token: 0x0400158A RID: 5514
    internal readonly List<Building> stockpiles = new List<Building>();

    // Token: 0x0400158B RID: 5515
    internal readonly List<Building> storages = new List<Building>();

    // Token: 0x0400158C RID: 5516
    internal float timer_build_boat;

    // Token: 0x0400158D RID: 5517
    internal float timer_build;

    // Token: 0x0400158E RID: 5518
    public float timer_action;

    // Token: 0x0400158F RID: 5519
    private float _timer_capture;

    // Token: 0x04001590 RID: 5520
    private float _timer_warrior;

    // Token: 0x04001591 RID: 5521
    internal readonly List<WorldTile> road_tiles_to_build = new List<WorldTile>();

    // Token: 0x04001592 RID: 5522
    private readonly List<WorldTile> tiles_to_remove = new List<WorldTile>();

    // Token: 0x04001593 RID: 5523
    internal TileZone target_attack_zone;

    // Token: 0x04001594 RID: 5524
    internal City target_attack_city;

    // Token: 0x04001595 RID: 5525
    internal WorldTile _city_tile;

    // Token: 0x04001596 RID: 5526
    internal string _debug_last_possible_build_orders;

    // Token: 0x04001597 RID: 5527
    internal string _debug_last_possible_build_orders_no_resources;

    // Token: 0x04001598 RID: 5528
    internal string _debug_last_build_order_try;

    // Token: 0x04001599 RID: 5529
    internal Kingdom being_captured_by;

    // Token: 0x0400159A RID: 5530
    private float _capture_ticks;

    // Token: 0x0400159B RID: 5531
    public int last_ticks;

    // Token: 0x0400159C RID: 5532
    private bool _dirty_citizens;

    // Token: 0x0400159D RID: 5533
    private bool _dirty_city_status;

    // Token: 0x0400159E RID: 5534
    private bool _dirty_abandoned_zones;

    // Token: 0x0400159F RID: 5535
    internal Vector2 city_center;

    // Token: 0x040015A0 RID: 5536
    internal Vector2 last_city_center;

    // Token: 0x040015A1 RID: 5537
    public readonly WorldTileContainer calculated_place_for_farms = new WorldTileContainer();

    // Token: 0x040015A2 RID: 5538
    public readonly WorldTileContainer calculated_farm_fields = new WorldTileContainer();

    // Token: 0x040015A3 RID: 5539
    public readonly WorldTileContainer calculated_crops = new WorldTileContainer();

    // Token: 0x040015A4 RID: 5540
    public readonly WorldTileContainer calculated_grown_wheat = new WorldTileContainer();

    // Token: 0x040015A5 RID: 5541
    private readonly Dictionary<Kingdom, int> _capturing_units = new Dictionary<Kingdom, int>();

    // Token: 0x040015A6 RID: 5542
    internal readonly HashSet<TileZone> danger_zones = new HashSet<TileZone>();

    // Token: 0x040015A7 RID: 5543
    public AiSystemCity ai;

    // Token: 0x040015A8 RID: 5544
    private int _current_total_food;

    // Token: 0x040015A9 RID: 5545
    private int _last_checked_job_id;

    // Token: 0x040015AA RID: 5546
    private double _loyalty_last_time;

    // Token: 0x040015AB RID: 5547
    private int _loyalty_cached;

    // Token: 0x040015AC RID: 5548
    private readonly List<long> _cached_book_ids = new List<long>();

    // Token: 0x040015AD RID: 5549
    private readonly List<Building> _cached_buildings_with_book_slots = new List<Building>();

    // Token: 0x040015AE RID: 5550
    public double timestamp_shrink;
}
using System;
using System.Collections.Generic;

// Token: 0x020002F9 RID: 761
public class CityZoneGrowth : CityZoneWorkerBase
{
    // Token: 0x06001D0E RID: 7438 RVA: 0x00100EE8 File Offset: 0x000FF0E8
    public TileZone getZoneToClaim(Actor pActor, City pCity, bool pDebug = false, HashSet<TileZone> pSetToFill = null, int pBonusRange = 0)
    {
        this.clearAll();
        WorldTile tTile = pCity.getTile(false);
        if (tTile == null)
        {
            return null;
        }
        bool tStopWaveWhenEmptyZoneFound = !pDebug;
        this.startWaveFromTile(pActor, tTile, pCity, tStopWaveWhenEmptyZoneFound, pBonusRange);
        if (pDebug && pSetToFill != null)
        {
            foreach (ZoneConnection tConnection in this._zones_checked)
            {
                pSetToFill.Add(tConnection.zone);
            }
            return null;
        }
        return this.checkGrowBorder(pCity);
    }

    // Token: 0x06001D0F RID: 7439 RVA: 0x00100F78 File Offset: 0x000FF178
    private TileZone checkGrowBorder(City pCity)
    {
        bool flag = Randy.randomChance(0.7f);
        TileZone tResultZone = null;
        if (flag)
        {
            TileZone tRandomZone = this.getRandomZone(pCity);
            if (tRandomZone != null)
            {
                tResultZone = tRandomZone;
            }
        }
        else
        {
            tResultZone = this.getRandomCheckedZone(pCity);
        }
        return tResultZone;
    }

    // Token: 0x06001D10 RID: 7440 RVA: 0x00100FAC File Offset: 0x000FF1AC
    private TileZone getRandomZone(City pCity)
    {
        TileZone result;
        using (ListPool<TileZone> tListZonesToCheck = new ListPool<TileZone>(pCity.border_zones))
        {
            WorldTile tMainCityTile = pCity.getTile(false);
            if (tMainCityTile == null)
            {
                result = null;
            }
            else
            {
                TileZone tMainCityZone = tMainCityTile.zone;
                float tMaxRadius = (float)pCity.getZoneRange(true) * 0.75f;
                tMaxRadius *= tMaxRadius;
                foreach (TileZone tileZone in tListZonesToCheck.LoopRandom<TileZone>())
                {
                    foreach (TileZone tZone in tileZone.neighbours.LoopRandom<TileZone>())
                    {
                        if (tZone.canBeClaimedByCity(pCity) && tZone.centerTile.isSameIsland(tMainCityTile) && (float)Toolbox.SquaredDist(tMainCityZone.x, tMainCityZone.y, tZone.x, tZone.y) <= tMaxRadius)
                        {
                            return tZone;
                        }
                    }
                }
                result = null;
            }
        }
        return result;
    }

    // Token: 0x06001D11 RID: 7441 RVA: 0x001010D0 File Offset: 0x000FF2D0
    private TileZone getBestZoneFromList(City pCity, List<TileZone> pList)
    {
        TileZone tResultZone = null;
        TileZone tMainCityZone = pCity.getTile(false).zone;
        int tBestDist = int.MaxValue;
        for (int i = 0; i < pList.Count; i++)
        {
            TileZone tZone = pList[i];
            int tCurrentDist = Toolbox.SquaredDist(tZone.x, tZone.y, tMainCityZone.x, tMainCityZone.y);
            if (tCurrentDist < tBestDist)
            {
                tResultZone = tZone;
                tBestDist = tCurrentDist;
            }
        }
        return tResultZone;
    }

    // Token: 0x06001D12 RID: 7442 RVA: 0x0010113C File Offset: 0x000FF33C
    private TileZone getRandomCheckedZone(City pCity)
    {
        TileZone result;
        using (ListPool<TileZone> tListZones = new ListPool<TileZone>(this._zones_checked.Count))
        {
            foreach (ZoneConnection zoneConnection in this._zones_checked)
            {
                TileZone tZone = zoneConnection.zone;
                if (tZone.canBeClaimedByCity(pCity))
                {
                    tListZones.Add(tZone);
                }
            }
            if (tListZones.Count > 0)
            {
                result = tListZones.GetRandom<TileZone>();
            }
            else
            {
                result = null;
            }
        }
        return result;
    }

    // Token: 0x06001D13 RID: 7443 RVA: 0x001011DC File Offset: 0x000FF3DC
    private void startWaveFromTile(Actor pActor, WorldTile pTile, City pCity, bool pStopWaveWhenEmptyZoneFound = true, int pBonusRange = 0)
    {
        base.prepareWave();
        if (pActor == null)
        {
            pActor = pCity.leader;
        }
        Queue<ZoneConnection> tWaveQ = this._wave;
        Queue<ZoneConnection> tNextWaveQ = this._next_wave;
        this.queueConnection(new ZoneConnection(pTile.zone, pTile.region), tWaveQ, true);
        using (ListPool<MapRegion> tListRegions = new ListPool<MapRegion>())
        {
            int tMaxWaves = pCity.getZoneRange(true) + pBonusRange;
            float tMaxRadius = (float)tMaxWaves * 0.75f;
            tMaxRadius *= tMaxRadius;
            int tWaveID = 0;
            bool tEmptyZoneFound = false;
            while (tNextWaveQ.Count > 0 || tWaveQ.Count > 0)
            {
                if (pStopWaveWhenEmptyZoneFound && tEmptyZoneFound)
                {
                    break;
                }
                if (tWaveQ.Count == 0)
                {
                    Queue<ZoneConnection> queue = tWaveQ;
                    tWaveQ = tNextWaveQ;
                    tNextWaveQ = queue;
                    tWaveID++;
                    if (tWaveID > tMaxWaves)
                    {
                        break;
                    }
                }
                ZoneConnection zoneConnection = tWaveQ.Dequeue();
                TileZone tMainZone = zoneConnection.zone;
                MapRegion tMainRegion = zoneConnection.region;
                for (int i = 0; i < tMainZone.neighbours.Length; i++)
                {
                    TileZone tZone = tMainZone.neighbours[i];
                    if ((!pStopWaveWhenEmptyZoneFound || !tZone.hasCity() || tZone.isSameCityHere(pCity)) && tZone.tiles_with_ground != 0 && (pActor == null || !pActor.hasSubspecies() || tZone.checkCanSettleInThisBiomes(pActor.subspecies)))
                    {
                        tListRegions.Clear();
                        if (TileZone.hasZonesConnectedViaRegions(tMainZone, tZone, tMainRegion, tListRegions))
                        {
                            for (int iReg = 0; iReg < tListRegions.Count; iReg++)
                            {
                                MapRegion tRegionToCheck = tListRegions[iReg];
                                ZoneConnection tNewConnection = new ZoneConnection(tZone, tRegionToCheck);
                                if (this._zones_checked.Add(tNewConnection))
                                {
                                    if (tZone.canBeClaimedByCity(pCity))
                                    {
                                        tEmptyZoneFound = true;
                                    }
                                    if ((float)Toolbox.SquaredDist(pTile.zone.x, pTile.zone.y, tZone.x, tZone.y) <= tMaxRadius)
                                    {
                                        if (pStopWaveWhenEmptyZoneFound && tEmptyZoneFound)
                                        {
                                            break;
                                        }
                                        this.queueConnection(tNewConnection, tNextWaveQ, false);
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }

    // Token: 0x040015F2 RID: 5618
    private const float MOD_RADIUS = 0.75f;
}
using System;
using ai.behaviours;

// Token: 0x020003B4 RID: 948
public class CityBehCheckFarms : BehaviourActionCity
{
    // Token: 0x06002099 RID: 8345 RVA: 0x00114CD4 File Offset: 0x00112ED4
    public override BehResult execute(City pCity)
    {
        CityBehCheckFarms.check(pCity);
        return BehResult.Continue;
    }

    // Token: 0x0600209A RID: 8346 RVA: 0x00114CE0 File Offset: 0x00112EE0
    public static void check(City pCity)
    {
        pCity.calculated_place_for_farms.Clear();
        pCity.calculated_grown_wheat.Clear();
        pCity.calculated_farm_fields.Clear();
        pCity.calculated_crops.Clear();
        CityBehCheckFarms.behFindTileForFarm(pCity);
        pCity.calculated_place_for_farms.checkAddRemove();
        pCity.calculated_farm_fields.checkAddRemove();
        pCity.calculated_crops.checkAddRemove();
        CityBehCheckFarms.behCheckWheat(pCity);
        pCity.calculated_grown_wheat.checkAddRemove();
    }

    // Token: 0x0600209B RID: 8347 RVA: 0x00114D54 File Offset: 0x00112F54
    private static void behCheckWheat(City pCity)
    {
        foreach (WorldTile tTile in pCity.calculated_crops)
        {
            if (tTile.hasBuilding() && tTile.building.asset.wheat && tTile.building.component_wheat.isMaxLevel())
            {
                pCity.calculated_grown_wheat.Add(tTile);
            }
        }
    }

    // Token: 0x0600209C RID: 8348 RVA: 0x00114DD4 File Offset: 0x00112FD4
    private static void behFindTileForFarm(City pCity)
    {
        Building tBuilding = pCity.getBuildingOfType("type_windmill", true, false, false);
        if (tBuilding == null)
        {
            return;
        }
        CityBehCheckFarms.checkRegion(tBuilding.current_tile.region, tBuilding, pCity);
        for (int i = 0; i < tBuilding.current_tile.region.neighbours.Count; i++)
        {
            CityBehCheckFarms.checkRegion(tBuilding.current_tile.region.neighbours[i], tBuilding, pCity);
        }
    }

    // Token: 0x0600209D RID: 8349 RVA: 0x00114E44 File Offset: 0x00113044
    private static void checkRegion(MapRegion pRegion, Building pBuilding, City pCity)
    {
        MapChunk tChunk = pRegion.chunk;
        for (int i = 0; i < tChunk.zones.Count; i++)
        {
            CityBehCheckFarms.checkZone(tChunk.zones[i], pBuilding, pCity);
        }
    }

    // Token: 0x0600209E RID: 8350 RVA: 0x00114E84 File Offset: 0x00113084
    private static void checkZone(TileZone pZone, Building pBuilding, City pCity)
    {
        if (!pZone.isSameCityHere(pCity))
        {
            return;
        }
        WorldTile[] tTiles = pZone.tiles;
        int tCount = tTiles.Length;
        for (int i = 0; i < tCount; i++)
        {
            WorldTile tTile = tTiles[i];
            if ((float)Toolbox.SquaredDistTile(pBuilding.current_tile, tTile) <= 81f)
            {
                if (tTile.Type.can_be_farm)
                {
                    pCity.calculated_place_for_farms.Add(tTile);
                }
                if (tTile.Type.farm_field)
                {
                    pCity.calculated_farm_fields.Add(tTile);
                    if (tTile.hasBuilding() && tTile.building.asset.wheat)
                    {
                        pCity.calculated_crops.Add(tTile);
                    }
                }
            }
        }
    }
}
using System;
using System.Runtime.CompilerServices;

// Token: 0x02000013 RID: 19
public static class World
{
    // Token: 0x17000007 RID: 7
    // (get) Token: 0x06000102 RID: 258 RVA: 0x000099D1 File Offset: 0x00007BD1
    public static MapBox world
    {
        [MethodImpl(MethodImplOptions.AggressiveInlining)]
        get
        {
            return MapBox.instance;
        }
    }

    // Token: 0x17000008 RID: 8
    // (get) Token: 0x06000103 RID: 259 RVA: 0x000099D8 File Offset: 0x00007BD8
    public static WorldAgeAsset world_era
    {
        [MethodImpl(MethodImplOptions.AggressiveInlining)]
        get
        {
            return MapBox.instance.era_manager.getCurrentAge();
        }
    }
}
using System;

// Token: 0x0200008B RID: 139
// (Invoke) Token: 0x06000498 RID: 1176
[Serializable]
public delegate bool WorldAction(BaseSimObject pTarget = null, WorldTile pTile = null);
using System;
using System.Collections.Generic;

// Token: 0x020003E9 RID: 1001
[Serializable]
public class WorldLaws
{
    // Token: 0x06002210 RID: 8720 RVA: 0x0011F304 File Offset: 0x0011D504
    public PlayerOptionData add(PlayerOptionData pData)
    {
        foreach (PlayerOptionData tData in this.list)
        {
            if (string.Equals(pData.name, tData.name))
            {
                this.dict.Add(tData.name, tData);
                tData.on_switch = pData.on_switch;
                return tData;
            }
        }
        this.list.Add(pData);
        this.dict.Add(pData.name, pData);
        return pData;
    }

    // Token: 0x06002211 RID: 8721 RVA: 0x0011F3A8 File Offset: 0x0011D5A8
    public void check()
    {
        this.init(true);
    }

    // Token: 0x06002212 RID: 8722 RVA: 0x0011F3B4 File Offset: 0x0011D5B4
    public void updateCaches()
    {
        foreach (WorldLawAsset worldLawAsset in AssetManager.world_laws_library.list)
        {
            worldLawAsset.updateCachedEnabled(this);
        }
    }

    // Token: 0x06002213 RID: 8723 RVA: 0x0011F40C File Offset: 0x0011D60C
    public void init(bool pUpdateCaches = true)
    {
        if (this.list == null)
        {
            this.list = new List<PlayerOptionData>();
        }
        if (this.dict == null)
        {
            this.dict = new Dictionary<string, PlayerOptionData>();
        }
        foreach (WorldLawAsset tAsset in AssetManager.world_laws_library.list)
        {
            this.add(new PlayerOptionData(tAsset.id)
            {
                boolVal = tAsset.default_state,
                on_switch = tAsset.on_state_change
            });
        }
        foreach (WorldAgeAsset tAsset2 in AssetManager.era_library.list)
        {
            this.add(new PlayerOptionData(tAsset2.id)
            {
                boolVal = true
            });
        }
        if (pUpdateCaches)
        {
            this.updateCaches();
        }
        PowerButton.checkActorSpawnButtons();
    }

    // Token: 0x06002214 RID: 8724 RVA: 0x0011F514 File Offset: 0x0011D714
    public bool isAgeEnabled(string pID)
    {
        return this.dict[pID].boolVal;
    }

    // Token: 0x06002215 RID: 8725 RVA: 0x0011F527 File Offset: 0x0011D727
    public void setAgeEnabled(string pID, bool pValue)
    {
        this.dict[pID].boolVal = pValue;
    }

    // Token: 0x06002216 RID: 8726 RVA: 0x0011F53C File Offset: 0x0011D73C
    public bool isEnabled(string pId)
    {
        PlayerOptionData tData;
        return this.dict.TryGetValue(pId, out tData) && tData.boolVal;
    }

    // Token: 0x06002217 RID: 8727 RVA: 0x0011F564 File Offset: 0x0011D764
    public void enable(string pID)
    {
        PlayerOptionData tData;
        if (!this.dict.TryGetValue(pID, out tData))
        {
            return;
        }
        tData.boolVal = true;
        this.updateCaches();
    }

    // Token: 0x04001936 RID: 6454
    public List<PlayerOptionData> list;

    // Token: 0x04001937 RID: 6455
    [NonSerialized]
    public Dictionary<string, PlayerOptionData> dict;
}
using System;

// Token: 0x020001AB RID: 427
public class WorldLawLibrary : BaseLibraryWithUnlockables<WorldLawAsset>
{
    // Token: 0x06000C52 RID: 3154 RVA: 0x000B37DC File Offset: 0x000B19DC
    public override void init()
    {
        base.init();
        this.addFlora();
        WorldLawLibrary.world_law_grin_reaper = this.add(new WorldLawAsset
        {
            id = "world_law_grin_reaper",
            group_id = "harmony",
            icon_path = "ui/Icons/worldrules/icon_grin_reaper",
            default_state = false
        });
        WorldLawLibrary.world_law_gene_spaghetti = this.add(new WorldLawAsset
        {
            id = "world_law_gene_spaghetti",
            group_id = "units",
            icon_path = "ui/Icons/worldrules/icon_gene_spaghetti",
            default_state = false
        });
        WorldLawLibrary.world_law_mutant_box = this.add(new WorldLawAsset
        {
            id = "world_law_mutant_box",
            group_id = "units",
            icon_path = "ui/Icons/worldrules/icon_mutant_box",
            default_state = false
        });
        WorldLawLibrary.world_law_glitched_noosphere = this.add(new WorldLawAsset
        {
            id = "world_law_glitched_noosphere",
            group_id = "civilizations",
            icon_path = "ui/Icons/worldrules/icon_glitched_noosphere",
            default_state = false
        });
        WorldLawLibrary.world_law_drop_of_thoughts = this.add(new WorldLawAsset
        {
            id = "world_law_drop_of_thoughts",
            group_id = "spawn",
            icon_path = "ui/Icons/worldrules/icon_drop_of_thoughts",
            default_state = false
        });
        WorldLawLibrary.world_law_diplomacy = this.add(new WorldLawAsset
        {
            id = "world_law_diplomacy",
            group_id = "diplomacy",
            icon_path = "ui/Icons/worldrules/icon_diplomacy",
            default_state = true,
            on_state_change = new PlayerOptionAction(this.checkDiplomacy)
        });
        WorldLawLibrary.world_law_rites = this.add(new WorldLawAsset
        {
            id = "world_law_rites",
            group_id = "diplomacy",
            icon_path = "ui/Icons/worldrules/icon_rites",
            default_state = true
        });
        WorldLawLibrary.world_law_peaceful_monsters = this.add(new WorldLawAsset
        {
            id = "world_law_peaceful_monsters",
            group_id = "mobs",
            icon_path = "ui/Icons/worldrules/icon_peacefulanimals",
            default_state = false,
            on_state_change = new PlayerOptionAction(this.checkPeacefulMonsters)
        });
        WorldLawLibrary.world_law_hunger = this.add(new WorldLawAsset
        {
            id = "world_law_hunger",
            group_id = "units",
            icon_path = "ui/Icons/worldrules/icon_hunger",
            default_state = true
        });
        WorldLawLibrary.world_law_vegetation_random_seeds = this.add(new WorldLawAsset
        {
            id = "world_law_vegetation_random_seeds",
            group_id = "nature",
            icon_path = "ui/Icons/worldrules/icon_random_seeds",
            default_state = true
        });
        WorldLawLibrary.world_law_roots_without_borders = this.add(new WorldLawAsset
        {
            id = "world_law_roots_without_borders",
            group_id = "nature",
            icon_path = "ui/Icons/worldrules/icon_roots_without_borders",
            default_state = false
        });
        WorldLawLibrary.world_law_grow_minerals = this.add(new WorldLawAsset
        {
            id = "world_law_grow_minerals",
            group_id = "nature",
            icon_path = "ui/Icons/iconStone",
            default_state = true
        });
        WorldLawLibrary.world_law_grow_grass = this.add(new WorldLawAsset
        {
            id = "world_law_grow_grass",
            group_id = "biomes",
            icon_path = "ui/Icons/worldrules/icon_growgrass",
            default_state = true
        });
        WorldLawLibrary.world_law_biome_overgrowth = this.add(new WorldLawAsset
        {
            id = "world_law_biome_overgrowth",
            group_id = "biomes",
            icon_path = "ui/Icons/worldrules/icon_overgrowth",
            default_state = true
        });
        WorldLawLibrary.world_law_terramorphing = this.add(new WorldLawAsset
        {
            id = "world_law_terramorphing",
            group_id = "civilizations",
            icon_path = "ui/Icons/worldrules/icon_terramorphing",
            default_state = true
        });
        WorldLawLibrary.world_law_kingdom_expansion = this.add(new WorldLawAsset
        {
            id = "world_law_kingdom_expansion",
            group_id = "civilizations",
            icon_path = "ui/Icons/worldrules/icon_kingdomexpansion",
            default_state = true
        });
        WorldLawLibrary.world_law_old_age = this.add(new WorldLawAsset
        {
            id = "world_law_old_age",
            group_id = "units",
            icon_path = "ui/Icons/worldrules/icon_oldage",
            default_state = true
        });
        WorldLawLibrary.world_law_animals_spawn = this.add(new WorldLawAsset
        {
            id = "world_law_animals_spawn",
            group_id = "spawn",
            icon_path = "ui/Icons/worldrules/icon_animalspawn",
            default_state = true
        });
        WorldLawLibrary.world_law_animals_babies = this.add(new WorldLawAsset
        {
            id = "world_law_animals_babies",
            group_id = "mobs",
            icon_path = "ui/Icons/iconChicken",
            default_state = true
        });
        WorldLawLibrary.world_law_rebellions = this.add(new WorldLawAsset
        {
            id = "world_law_rebellions",
            group_id = "diplomacy",
            icon_path = "ui/Icons/worldrules/icon_rebellion",
            default_state = true
        });
        WorldLawLibrary.world_law_border_stealing = this.add(new WorldLawAsset
        {
            id = "world_law_border_stealing",
            group_id = "diplomacy",
            icon_path = "ui/Icons/worldrules/icon_borderstealing",
            default_state = true
        });
        WorldLawLibrary.world_law_erosion = this.add(new WorldLawAsset
        {
            id = "world_law_erosion",
            group_id = "nature",
            icon_path = "ui/Icons/worldrules/icon_erosion",
            default_state = true
        });
        WorldLawLibrary.world_law_forever_lava = this.add(new WorldLawAsset
        {
            id = "world_law_forever_lava",
            group_id = "weather",
            icon_path = "ui/Icons/worldrules/icon_foreverlava",
            default_state = false
        });
        WorldLawLibrary.world_law_forever_cold = this.add(new WorldLawAsset
        {
            id = "world_law_forever_cold",
            group_id = "weather",
            icon_path = "ui/Icons/iconSnow",
            default_state = false
        });
        WorldLawLibrary.world_law_disasters_nature = this.add(new WorldLawAsset
        {
            id = "world_law_disasters_nature",
            group_id = "disasters",
            icon_path = "ui/Icons/worldrules/icon_disasters",
            default_state = true
        });
        WorldLawLibrary.world_law_clouds = this.add(new WorldLawAsset
        {
            id = "world_law_clouds",
            group_id = "spawn",
            icon_path = "ui/Icons/iconCloud",
            default_state = true
        });
        WorldLawLibrary.world_law_evolution_events = this.add(new WorldLawAsset
        {
            id = "world_law_evolution_events",
            group_id = "other",
            icon_path = "ui/Icons/iconMonolith",
            default_state = true
        });
        WorldLawLibrary.world_law_disasters_other = this.add(new WorldLawAsset
        {
            id = "world_law_disasters_other",
            group_id = "disasters",
            icon_path = "ui/Icons/iconEvilMage",
            default_state = true
        });
        WorldLawLibrary.world_law_rat_plague = this.add(new WorldLawAsset
        {
            id = "world_law_rat_plague",
            group_id = "disasters",
            icon_path = "ui/Icons/iconRatKing",
            default_state = false
        });
        WorldLawLibrary.world_law_angry_civilians = this.add(new WorldLawAsset
        {
            id = "world_law_angry_civilians",
            group_id = "civilizations",
            icon_path = "ui/Icons/worldrules/icon_angryvillagers",
            default_state = false
        });
        WorldLawLibrary.world_law_civ_babies = this.add(new WorldLawAsset
        {
            id = "world_law_civ_babies",
            group_id = "civilizations",
            icon_path = "ui/Icons/worldrules/icon_lastofus",
            default_state = true
        });
        WorldLawLibrary.world_law_civ_migrants = this.add(new WorldLawAsset
        {
            id = "world_law_civ_migrants",
            group_id = "civilizations",
            icon_path = "ui/Icons/worldrules/icon_migrants",
            default_state = true
        });
        WorldLawLibrary.world_law_forever_tumor_creep = this.add(new WorldLawAsset
        {
            id = "world_law_forever_tumor_creep",
            group_id = "mobs",
            icon_path = "ui/Icons/iconTumor",
            default_state = false
        });
        WorldLawLibrary.world_law_civ_army = this.add(new WorldLawAsset
        {
            id = "world_law_civ_army",
            group_id = "civilizations",
            icon_path = "ui/Icons/iconArmyList",
            default_state = true
        });
        WorldLawLibrary.world_law_civ_limit_population_100 = this.add(new WorldLawAsset
        {
            id = "world_law_civ_limit_population_100",
            group_id = "harmony",
            icon_path = "ui/Icons/iconPopulation100",
            default_state = false
        });
        WorldLawLibrary.world_law_gaias_covenant = this.add(new WorldLawAsset
        {
            id = "world_law_gaias_covenant",
            group_id = "harmony",
            icon_path = "ui/Icons/worldrules/icon_gaias_covenant",
            default_state = false
        });
        WorldLawLibrary.world_law_cursed_world = this.add(new WorldLawAsset
        {
            id = "world_law_cursed_world",
            icon_path = "ui/Icons/worldrules/icon_cursed_world",
            default_state = false,
            can_turn_off = false,
            requires_premium = true,
            on_state_change = new PlayerOptionAction(this.checkCursedWorld),
            on_state_enabled = new PlayerOptionAction(this.turnOnCursedWorld),
            on_world_load = new OnWorldLoadAction(this.checkAlreadyCursed)
        });
    }

    // Token: 0x06000C53 RID: 3155 RVA: 0x000B406C File Offset: 0x000B226C
    private void addFlora()
    {
        WorldLawLibrary.world_law_spread_trees = this.add(new WorldLawAsset
        {
            id = "world_law_spread_trees",
            group_id = "trees",
            icon_path = "ui/Icons/worldrules/icon_grow_trees",
            default_state = true
        });
        WorldLawLibrary.world_law_spread_fungi = this.add(new WorldLawAsset
        {
            id = "world_law_spread_fungi",
            group_id = "fungi",
            icon_path = "ui/Icons/worldrules/icon_grow_fungi",
            default_state = true
        });
        WorldLawLibrary.world_law_spread_plants = this.add(new WorldLawAsset
        {
            id = "world_law_spread_plants",
            group_id = "plants",
            icon_path = "ui/Icons/worldrules/icon_grow_plants_fast",
            default_state = true
        });
        WorldLawLibrary.world_law_spread_fast_trees = this.add(new WorldLawAsset
        {
            id = "world_law_spread_fast_trees",
            group_id = "trees",
            icon_path = "ui/Icons/worldrules/icon_grow_trees_fast",
            default_state = false
        });
        WorldLawLibrary.world_law_spread_fast_fungi = this.add(new WorldLawAsset
        {
            id = "world_law_spread_fast_fungi",
            group_id = "fungi",
            icon_path = "ui/Icons/worldrules/icon_grow_fungi_fast",
            default_state = false
        });
        WorldLawLibrary.world_law_spread_fast_plants = this.add(new WorldLawAsset
        {
            id = "world_law_spread_fast_plants",
            group_id = "plants",
            icon_path = "ui/Icons/worldrules/icon_grow_plants_fast",
            default_state = false
        });
        WorldLawLibrary.world_law_spread_density_high = this.add(new WorldLawAsset
        {
            id = "world_law_spread_density_high",
            group_id = "nature",
            icon_path = "ui/Icons/worldrules/icon_flora_density_high",
            default_state = false
        });
        WorldLawAsset worldLawAsset = new WorldLawAsset();
        worldLawAsset.id = "world_law_exploding_mushrooms";
        worldLawAsset.group_id = "fungi";
        worldLawAsset.icon_path = "ui/Icons/worldrules/icon_exploding_mushrooms";
        worldLawAsset.default_state = false;
        worldLawAsset.on_state_change = delegate (PlayerOptionData pOption)
        {
            if (!pOption.boolVal)
            {
                return;
            }
            World.world.map_stats.exploding_mushrooms_enabled_at = World.world.getCurWorldTime();
        };
        WorldLawLibrary.world_law_exploding_mushrooms = this.add(worldLawAsset);
        WorldLawLibrary.world_law_entanglewood = this.add(new WorldLawAsset
        {
            id = "world_law_entanglewood",
            group_id = "trees",
            icon_path = "ui/Icons/worldrules/icon_entanglewood",
            default_state = true
        });
        WorldLawLibrary.world_law_bark_bites_back = this.add(new WorldLawAsset
        {
            id = "world_law_bark_bites_back",
            group_id = "trees",
            icon_path = "ui/Icons/worldrules/icon_bark_bites_back",
            default_state = false
        });
        WorldLawLibrary.world_law_plants_tickles = this.add(new WorldLawAsset
        {
            id = "world_law_plants_tickles",
            group_id = "plants",
            icon_path = "ui/Icons/worldrules/icon_plants_tickles",
            default_state = false
        });
        WorldLawLibrary.world_law_root_pranks = this.add(new WorldLawAsset
        {
            id = "world_law_root_pranks",
            group_id = "plants",
            icon_path = "ui/Icons/worldrules/icon_root_pranks",
            default_state = false
        });
        WorldLawLibrary.world_law_nectar_nap = this.add(new WorldLawAsset
        {
            id = "world_law_nectar_nap",
            group_id = "plants",
            icon_path = "ui/Icons/worldrules/icon_nectar_nap",
            default_state = false
        });
    }

    // Token: 0x06000C54 RID: 3156 RVA: 0x000B4378 File Offset: 0x000B2578
    public override void editorDiagnostic()
    {
        base.editorDiagnostic();
        foreach (WorldLawAsset tAsset in this.list)
        {
            base.checkSpriteExists("icon_path", tAsset.icon_path, tAsset);
        }
    }

    // Token: 0x06000C55 RID: 3157 RVA: 0x000B43E0 File Offset: 0x000B25E0
    public override void editorDiagnosticLocales()
    {
        foreach (WorldLawAsset tAsset in this.list)
        {
            this.checkLocale(tAsset, tAsset.getLocaleID());
            this.checkLocale(tAsset, tAsset.getDescriptionID());
            this.checkLocale(tAsset, tAsset.getDescriptionID2());
        }
        base.editorDiagnosticLocales();
    }

    // Token: 0x06000C56 RID: 3158 RVA: 0x000B445C File Offset: 0x000B265C
    private void checkDiplomacy(PlayerOptionData pOption)
    {
        if (WorldLawLibrary.world_law_diplomacy.isEnabled())
        {
            return;
        }
        World.world.stopAttacksFor(false);
        World.world.wars.stopAllWars();
    }

    // Token: 0x06000C57 RID: 3159 RVA: 0x000B4485 File Offset: 0x000B2685
    private void checkPeacefulMonsters(PlayerOptionData pOption)
    {
        if (!WorldLawLibrary.world_law_diplomacy.isEnabled())
        {
            return;
        }
        World.world.stopAttacksFor(true);
    }

    // Token: 0x06000C58 RID: 3160 RVA: 0x000B449F File Offset: 0x000B269F
    private void turnOnCursedWorld(PlayerOptionData pOption)
    {
        CursedSacrifice.justCursedWorld();
    }

    // Token: 0x06000C59 RID: 3161 RVA: 0x000B44A6 File Offset: 0x000B26A6
    private void checkCursedWorld(PlayerOptionData pOption)
    {
        PowerButton.checkActorSpawnButtons();
    }

    // Token: 0x06000C5A RID: 3162 RVA: 0x000B44AD File Offset: 0x000B26AD
    private void checkAlreadyCursed()
    {
        if (!WorldLawLibrary.world_law_cursed_world.isEnabled())
        {
            return;
        }
        CursedSacrifice.loadAlreadyCursedState();
    }

    // Token: 0x06000C5B RID: 3163 RVA: 0x000B44C1 File Offset: 0x000B26C1
    public static float getIntervalSpreadTrees()
    {
        if (WorldLawLibrary.world_law_spread_fast_trees.isEnabled())
        {
            return 10f;
        }
        return 50f;
    }

    // Token: 0x06000C5C RID: 3164 RVA: 0x000B44DA File Offset: 0x000B26DA
    public static float getIntervalSpreadPlants()
    {
        if (WorldLawLibrary.world_law_spread_fast_plants.isEnabled())
        {
            return 10f;
        }
        return 40f;
    }

    // Token: 0x06000C5D RID: 3165 RVA: 0x000B44F3 File Offset: 0x000B26F3
    public static float getIntervalSpreadFungi()
    {
        if (WorldLawLibrary.world_law_spread_fast_fungi.isEnabled())
        {
            return 10f;
        }
        return 30f;
    }

    // Token: 0x06000C5E RID: 3166 RVA: 0x000B450C File Offset: 0x000B270C
    public string addToGameplayReport(string pWhatFor)
    {
        string tResult = string.Empty;
        tResult = tResult + pWhatFor + "\n";
        foreach (WorldLawAsset worldLawAsset in this.list)
        {
            string tName = worldLawAsset.getTranslatedName();
            string tDescription = worldLawAsset.getTranslatedDescription();
            string tDescription2 = worldLawAsset.getTranslatedDescription2();
            string tLineInfo = "\n" + tName;
            tLineInfo += "\n";
            if (!string.IsNullOrEmpty(tDescription))
            {
                tLineInfo = tLineInfo + "1: " + tDescription;
            }
            if (!string.IsNullOrEmpty(tDescription2))
            {
                tLineInfo = tLineInfo + "\n2: " + tDescription2;
            }
            tResult += tLineInfo;
        }
        tResult += "\n\n";
        return tResult;
    }

    // Token: 0x04000BDB RID: 3035
    public static WorldLawAsset world_law_diplomacy;

    // Token: 0x04000BDC RID: 3036
    public static WorldLawAsset world_law_rites;

    // Token: 0x04000BDD RID: 3037
    public static WorldLawAsset world_law_peaceful_monsters;

    // Token: 0x04000BDE RID: 3038
    public static WorldLawAsset world_law_hunger;

    // Token: 0x04000BDF RID: 3039
    public static WorldLawAsset world_law_vegetation_random_seeds;

    // Token: 0x04000BE0 RID: 3040
    public static WorldLawAsset world_law_roots_without_borders;

    // Token: 0x04000BE1 RID: 3041
    public static WorldLawAsset world_law_spread_trees;

    // Token: 0x04000BE2 RID: 3042
    public static WorldLawAsset world_law_spread_fungi;

    // Token: 0x04000BE3 RID: 3043
    public static WorldLawAsset world_law_spread_plants;

    // Token: 0x04000BE4 RID: 3044
    public static WorldLawAsset world_law_spread_fast_trees;

    // Token: 0x04000BE5 RID: 3045
    public static WorldLawAsset world_law_spread_fast_fungi;

    // Token: 0x04000BE6 RID: 3046
    public static WorldLawAsset world_law_spread_fast_plants;

    // Token: 0x04000BE7 RID: 3047
    public static WorldLawAsset world_law_exploding_mushrooms;

    // Token: 0x04000BE8 RID: 3048
    public static WorldLawAsset world_law_entanglewood;

    // Token: 0x04000BE9 RID: 3049
    public static WorldLawAsset world_law_bark_bites_back;

    // Token: 0x04000BEA RID: 3050
    public static WorldLawAsset world_law_plants_tickles;

    // Token: 0x04000BEB RID: 3051
    public static WorldLawAsset world_law_root_pranks;

    // Token: 0x04000BEC RID: 3052
    public static WorldLawAsset world_law_nectar_nap;

    // Token: 0x04000BED RID: 3053
    public static WorldLawAsset world_law_spread_density_high;

    // Token: 0x04000BEE RID: 3054
    public static WorldLawAsset world_law_grow_minerals;

    // Token: 0x04000BEF RID: 3055
    public static WorldLawAsset world_law_grow_grass;

    // Token: 0x04000BF0 RID: 3056
    public static WorldLawAsset world_law_biome_overgrowth;

    // Token: 0x04000BF1 RID: 3057
    public static WorldLawAsset world_law_kingdom_expansion;

    // Token: 0x04000BF2 RID: 3058
    public static WorldLawAsset world_law_old_age;

    // Token: 0x04000BF3 RID: 3059
    public static WorldLawAsset world_law_animals_spawn;

    // Token: 0x04000BF4 RID: 3060
    public static WorldLawAsset world_law_animals_babies;

    // Token: 0x04000BF5 RID: 3061
    public static WorldLawAsset world_law_rebellions;

    // Token: 0x04000BF6 RID: 3062
    public static WorldLawAsset world_law_border_stealing;

    // Token: 0x04000BF7 RID: 3063
    public static WorldLawAsset world_law_erosion;

    // Token: 0x04000BF8 RID: 3064
    public static WorldLawAsset world_law_forever_lava;

    // Token: 0x04000BF9 RID: 3065
    public static WorldLawAsset world_law_forever_cold;

    // Token: 0x04000BFA RID: 3066
    public static WorldLawAsset world_law_disasters_nature;

    // Token: 0x04000BFB RID: 3067
    public static WorldLawAsset world_law_disasters_other;

    // Token: 0x04000BFC RID: 3068
    public static WorldLawAsset world_law_rat_plague;

    // Token: 0x04000BFD RID: 3069
    public static WorldLawAsset world_law_angry_civilians;

    // Token: 0x04000BFE RID: 3070
    public static WorldLawAsset world_law_civ_babies;

    // Token: 0x04000BFF RID: 3071
    public static WorldLawAsset world_law_civ_migrants;

    // Token: 0x04000C00 RID: 3072
    public static WorldLawAsset world_law_forever_tumor_creep;

    // Token: 0x04000C01 RID: 3073
    public static WorldLawAsset world_law_civ_army;

    // Token: 0x04000C02 RID: 3074
    public static WorldLawAsset world_law_civ_limit_population_100;

    // Token: 0x04000C03 RID: 3075
    public static WorldLawAsset world_law_gaias_covenant;

    // Token: 0x04000C04 RID: 3076
    public static WorldLawAsset world_law_clouds;

    // Token: 0x04000C05 RID: 3077
    public static WorldLawAsset world_law_evolution_events;

    // Token: 0x04000C06 RID: 3078
    public static WorldLawAsset world_law_terramorphing;

    // Token: 0x04000C07 RID: 3079
    public static WorldLawAsset world_law_gene_spaghetti;

    // Token: 0x04000C08 RID: 3080
    public static WorldLawAsset world_law_mutant_box;

    // Token: 0x04000C09 RID: 3081
    public static WorldLawAsset world_law_glitched_noosphere;

    // Token: 0x04000C0A RID: 3082
    public static WorldLawAsset world_law_drop_of_thoughts;

    // Token: 0x04000C0B RID: 3083
    public static WorldLawAsset world_law_grin_reaper;

    // Token: 0x04000C0C RID: 3084
    public static WorldLawAsset world_law_cursed_world;
}
using System;
using UnityEngine;

// Token: 0x020001E5 RID: 485
public class WorldLog
{
    // Token: 0x06000DE9 RID: 3561 RVA: 0x000BCCEA File Offset: 0x000BAEEA
    public WorldLog()
    {
        WorldLog.instance = this;
    }

    // Token: 0x06000DEA RID: 3562 RVA: 0x000BCCF8 File Offset: 0x000BAEF8
    public static void logNewKing(Kingdom pKingdom)
    {
        new WorldLogMessage(WorldLogLibrary.king_new, pKingdom.name, pKingdom.king.getName(), null)
        {
            kingdom = pKingdom,
            unit = pKingdom.king,
            location = pKingdom.king.current_position,
            color_special1 = pKingdom.kingdomColor.getColorText(),
            color_special2 = pKingdom.kingdomColor.getColorText()
        }.add();
    }

    // Token: 0x06000DEB RID: 3563 RVA: 0x000BCD6C File Offset: 0x000BAF6C
    public static void logRoyalClanNew(Kingdom pKingdom, Clan pClan)
    {
        new WorldLogMessage(WorldLogLibrary.kingdom_royal_clan_new, pKingdom.name, pClan.name, pKingdom.king.name)
        {
            kingdom = pKingdom,
            unit = pKingdom.king,
            location = pKingdom.king.current_position,
            color_special1 = pKingdom.getColor().getColorText(),
            color_special2 = pClan.getColor().getColorText(),
            color_special3 = pKingdom.getColor().getColorText()
        }.add();
    }

    // Token: 0x06000DEC RID: 3564 RVA: 0x000BCDF8 File Offset: 0x000BAFF8
    public static void logRoyalClanChanged(Kingdom pKingdom, Clan pOldClan, Clan pNewClan)
    {
        new WorldLogMessage(WorldLogLibrary.kingdom_royal_clan_changed, pKingdom.name, pOldClan.name, pNewClan.name)
        {
            kingdom = pKingdom,
            unit = pKingdom.king,
            location = pKingdom.king.current_position,
            color_special1 = pKingdom.kingdomColor.getColorText(),
            color_special2 = pOldClan.getColor().getColorText(),
            color_special3 = pNewClan.getColor().getColorText()
        }.add();
    }

    // Token: 0x06000DED RID: 3565 RVA: 0x000BCE80 File Offset: 0x000BB080
    public static void logRoyalClanNoMore(Kingdom pKingdom, Clan pClan)
    {
        WorldLogMessage tLog = new WorldLogMessage(WorldLogLibrary.kingdom_royal_clan_dead, pKingdom.name, pClan.name, null);
        tLog.kingdom = pKingdom;
        if (pKingdom.hasCapital())
        {
            tLog.location = pKingdom.capital.last_city_center;
        }
        tLog.color_special1 = pKingdom.kingdomColor.getColorText();
        tLog.color_special2 = pClan.getColor().getColorText();
        tLog.add();
    }

    // Token: 0x06000DEE RID: 3566 RVA: 0x000BCEF0 File Offset: 0x000BB0F0
    public static void logKingLeft(Kingdom pKingdom, Actor pActor)
    {
        new WorldLogMessage(WorldLogLibrary.king_left, pKingdom.name, pActor.getName(), null)
        {
            kingdom = pKingdom,
            unit = pActor,
            location = pActor.current_position,
            color_special1 = pKingdom.kingdomColor.getColorText(),
            color_special2 = pKingdom.kingdomColor.getColorText()
        }.add();
    }

    // Token: 0x06000DEF RID: 3567 RVA: 0x000BCF58 File Offset: 0x000BB158
    public static void logKingDead(Kingdom pKingdom, Actor pActor)
    {
        new WorldLogMessage(WorldLogLibrary.king_dead, pKingdom.name, pActor.getName(), null)
        {
            kingdom = pKingdom,
            location = pActor.current_position,
            color_special1 = pKingdom.kingdomColor.getColorText(),
            color_special2 = pKingdom.kingdomColor.getColorText()
        }.add();
    }

    // Token: 0x06000DF0 RID: 3568 RVA: 0x000BCFB8 File Offset: 0x000BB1B8
    public static void logKingMurder(Kingdom pKingdom, Actor pActor, Actor pAttacker)
    {
        WorldLogMessage tLog = new WorldLogMessage(WorldLogLibrary.king_killed, pKingdom.name, pActor.getName(), (pAttacker != null) ? pAttacker.getName() : null);
        tLog.kingdom = pKingdom;
        tLog.color_special1 = pKingdom.kingdomColor.getColorText();
        tLog.color_special2 = pKingdom.kingdomColor.getColorText();
        bool flag;
        if (pAttacker == null)
        {
            flag = null != null;
        }
        else
        {
            Kingdom kingdom = pAttacker.kingdom;
            flag = ((kingdom != null) ? kingdom.kingdomColor : null) != null;
        }
        if (flag)
        {
            tLog.color_special3 = pAttacker.kingdom.kingdomColor.getColorText();
        }
        if (pAttacker != null && pAttacker.asset.can_be_inspected)
        {
            tLog.unit = pAttacker;
        }
        tLog.location = pActor.current_position;
        tLog.add();
    }

    // Token: 0x06000DF1 RID: 3569 RVA: 0x000BD06C File Offset: 0x000BB26C
    public static void logFavDead(Actor pActor)
    {
        WorldLogMessage tLog = new WorldLogMessage(WorldLogLibrary.favorite_dead, pActor.getName(), null, null);
        tLog.location = pActor.current_position;
        bool flag;
        if (pActor == null)
        {
            flag = null != null;
        }
        else
        {
            Kingdom kingdom = pActor.kingdom;
            flag = ((kingdom != null) ? kingdom.kingdomColor : null) != null;
        }
        if (flag)
        {
            tLog.kingdom = pActor.kingdom;
            tLog.color_special1 = pActor.kingdom.kingdomColor.getColorText();
        }
        tLog.add();
    }

    // Token: 0x06000DF2 RID: 3570 RVA: 0x000BD0DC File Offset: 0x000BB2DC
    public static void logFavMurder(Actor pActor, Actor pAttacker)
    {
        WorldLogMessage tLog = new WorldLogMessage(WorldLogLibrary.favorite_killed, pActor.getName(), (pAttacker != null) ? pAttacker.getName() : null, null);
        bool flag;
        if (pActor == null)
        {
            flag = null != null;
        }
        else
        {
            Kingdom kingdom = pActor.kingdom;
            flag = ((kingdom != null) ? kingdom.kingdomColor : null) != null;
        }
        if (flag)
        {
            tLog.kingdom = pActor.kingdom;
            tLog.color_special1 = pActor.kingdom.kingdomColor.getColorText();
        }
        bool flag2;
        if (pAttacker == null)
        {
            flag2 = null != null;
        }
        else
        {
            Kingdom kingdom2 = pAttacker.kingdom;
            flag2 = ((kingdom2 != null) ? kingdom2.kingdomColor : null) != null;
        }
        if (flag2)
        {
            tLog.color_special2 = pAttacker.kingdom.kingdomColor.getColorText();
        }
        if (pAttacker != null && pAttacker.asset.can_be_inspected)
        {
            tLog.unit = pAttacker;
        }
        tLog.location = pActor.current_position;
        tLog.add();
    }

    // Token: 0x06000DF3 RID: 3571 RVA: 0x000BD19C File Offset: 0x000BB39C
    public static void logNewCity(City pCity)
    {
        new WorldLogMessage(WorldLogLibrary.city_new, pCity.name, null, null)
        {
            kingdom = pCity.kingdom,
            location = pCity.last_city_center,
            color_special1 = pCity.kingdom.kingdomColor.getColorText()
        }.add();
    }

    // Token: 0x06000DF4 RID: 3572 RVA: 0x000BD1EE File Offset: 0x000BB3EE
    public static void logCityRevolt(City pCity)
    {
        new WorldLogMessage(WorldLogLibrary.log_city_revolted, pCity.name, pCity.kingdom.name, null)
        {
            kingdom = pCity.kingdom,
            location = pCity.last_city_center
        }.add();
    }

    // Token: 0x06000DF5 RID: 3573 RVA: 0x000BD229 File Offset: 0x000BB429
    public static void logWarEnded(War pWar)
    {
        new WorldLogMessage(WorldLogLibrary.diplomacy_war_ended, pWar.data.name, null, null)
        {
            color_special1 = pWar.getColor().getColorText()
        }.add();
    }

    // Token: 0x06000DF6 RID: 3574 RVA: 0x000BD258 File Offset: 0x000BB458
    public static void logNewWar(Kingdom pKingdom1, Kingdom pKingdom2)
    {
        new WorldLogMessage(WorldLogLibrary.diplomacy_war_started, pKingdom1.name, pKingdom2.name, null)
        {
            location = pKingdom1.location,
            color_special1 = pKingdom1.kingdomColor.getColorText(),
            color_special2 = pKingdom2.kingdomColor.getColorText()
        }.add();
    }

    // Token: 0x06000DF7 RID: 3575 RVA: 0x000BD2B4 File Offset: 0x000BB4B4
    public static void logAllianceCreated(Alliance pAlliance)
    {
        new WorldLogMessage(WorldLogLibrary.alliance_new, pAlliance.name, null, null)
        {
            color_special1 = pAlliance.getColor().getColorText()
        }.add();
    }

    // Token: 0x06000DF8 RID: 3576 RVA: 0x000BD2DE File Offset: 0x000BB4DE
    public static void logAllianceDisolved(Alliance pAlliance)
    {
        new WorldLogMessage(WorldLogLibrary.alliance_dissolved, pAlliance.name, null, null)
        {
            color_special1 = pAlliance.getColor().getColorText()
        }.add();
    }

    // Token: 0x06000DF9 RID: 3577 RVA: 0x000BD308 File Offset: 0x000BB508
    public static void logNewKingdom(Kingdom pKingdom)
    {
        new WorldLogMessage(WorldLogLibrary.kingdom_new, pKingdom.name, null, null)
        {
            kingdom = pKingdom,
            location = pKingdom.location,
            color_special1 = pKingdom.getColor().getColorText()
        }.add();
    }

    // Token: 0x06000DFA RID: 3578 RVA: 0x000BD358 File Offset: 0x000BB558
    public static void logKingdomDestroyed(Kingdom pKingdom)
    {
        new WorldLogMessage(WorldLogLibrary.kingdom_destroyed, pKingdom.name, null, null)
        {
            kingdom = pKingdom,
            location = pKingdom.location,
            color_special1 = pKingdom.getColor().getColorText()
        }.add();
    }

    // Token: 0x06000DFB RID: 3579 RVA: 0x000BD3A8 File Offset: 0x000BB5A8
    public static void logCityDestroyed(City pCity)
    {
        new WorldLogMessage(WorldLogLibrary.city_destroyed, pCity.name, null, null)
        {
            kingdom = pCity.kingdom,
            color_special1 = pCity.kingdom.getColor().getColorText(),
            location = pCity.last_city_center
        }.add();
    }

    // Token: 0x06000DFC RID: 3580 RVA: 0x000BD3FC File Offset: 0x000BB5FC
    public static void logDisaster(DisasterAsset pAsset, WorldTile pTile, string pName = null, City pCity = null, Actor pUnit = null)
    {
        if (string.IsNullOrEmpty(pAsset.world_log))
        {
            return;
        }
        WorldLogMessage tLog = new WorldLogMessage(AssetManager.world_log_library.get(pAsset.world_log), null, null, null);
        tLog.location = pTile.posV3;
        tLog.special1 = pName;
        if (pCity != null)
        {
            tLog.special2 = pCity.name;
        }
        if (pUnit != null && pUnit.asset.can_be_inspected)
        {
            tLog.unit = pUnit;
        }
        tLog.add();
    }

    // Token: 0x06000DFD RID: 3581 RVA: 0x000BD477 File Offset: 0x000BB677
    public static void locationJump(Vector3 pVector)
    {
        HistoryHud.disableRaycasts();
        World.world.locatePosition(pVector, new Action(HistoryHud.enableRaycasts), new Action(HistoryHud.enableRaycasts));
    }

    // Token: 0x06000DFE RID: 3582 RVA: 0x000BD4A1 File Offset: 0x000BB6A1
    public static void locationFollow(Actor pActor)
    {
        if (pActor == null)
        {
            return;
        }
        if (!pActor.isAlive())
        {
            return;
        }
        HistoryHud.disableRaycasts();
        World.world.locateAndFollow(pActor, new Action(HistoryHud.enableRaycasts), new Action(HistoryHud.enableRaycasts));
    }

    // Token: 0x06000DFF RID: 3583 RVA: 0x000BD4D8 File Offset: 0x000BB6D8
    public static void logShatteredCrown(Kingdom pKingdom)
    {
        new WorldLogMessage(WorldLogLibrary.kingdom_shattered, pKingdom.name, null, null)
        {
            kingdom = pKingdom,
            location = pKingdom.location,
            color_special1 = pKingdom.getColor().getColorText()
        }.add();
    }

    // Token: 0x06000E00 RID: 3584 RVA: 0x000BD528 File Offset: 0x000BB728
    public static void logFracturedKingdom(Kingdom pKingdom)
    {
        new WorldLogMessage(WorldLogLibrary.kingdom_fractured, pKingdom.name, null, null)
        {
            kingdom = pKingdom,
            location = pKingdom.location,
            color_special1 = pKingdom.getColor().getColorText()
        }.add();
    }

    // Token: 0x04000E78 RID: 3704
    public static WorldLog instance;

    // Token: 0x04000E79 RID: 3705
    public const int WORLDLOG_LIMIT = 2000;
}
using System;

// Token: 0x020001B0 RID: 432
public class WorldLogLibrary : AssetLibrary<WorldLogAsset>
{
    // Token: 0x06000C6F RID: 3183 RVA: 0x000B4858 File Offset: 0x000B2A58
    private void updateText(ref string pText, WorldLogMessage pMessage, string pKey, int pSpecialId)
    {
        string tSpecialText = pMessage.getSpecial(pSpecialId);
        pText = pText.Replace(pKey, tSpecialText);
    }

    // Token: 0x06000C70 RID: 3184 RVA: 0x000B487C File Offset: 0x000B2A7C
    public override void init()
    {
        base.init();
        WorldLogLibrary.king_new = this.add(new WorldLogAsset
        {
            id = "king_new",
            group = "kings",
            path_icon = "ui/Icons/iconKings",
            color = Toolbox.color_log_neutral,
            text_replacer = new WorldLogTextFormatter(this.kingReplacer)
        });
        WorldLogLibrary.king_left = this.add(new WorldLogAsset
        {
            id = "king_left",
            group = "kings",
            path_icon = "ui/Icons/actor_traits/iconStupid",
            color = Toolbox.color_log_warning,
            text_replacer = new WorldLogTextFormatter(this.kingReplacer)
        });
        WorldLogLibrary.king_dead = this.add(new WorldLogAsset
        {
            id = "king_dead",
            group = "kings",
            path_icon = "ui/Icons/iconDead",
            color = Toolbox.color_log_warning,
            text_replacer = new WorldLogTextFormatter(this.kingReplacer)
        });
        WorldLogLibrary.king_killed = this.add(new WorldLogAsset
        {
            id = "king_killed",
            group = "kings",
            random_ids = 3,
            path_icon = "ui/Icons/actor_traits/iconKingslayer",
            color = Toolbox.color_log_warning,
            text_replacer = delegate (WorldLogMessage pMessage, ref string pText)
            {
                this.updateText(ref pText, pMessage, "$kingdom$", 1);
                this.updateText(ref pText, pMessage, "$king$", 2);
                this.updateText(ref pText, pMessage, "$name$", 3);
            }
        });
        WorldLogLibrary.favorite_dead = this.add(new WorldLogAsset
        {
            id = "favorite_dead",
            group = "favorite_units",
            random_ids = 3,
            path_icon = "ui/Icons/iconFavoriteKilled",
            color = Toolbox.color_log_warning,
            text_replacer = new WorldLogTextFormatter(this.nameReplacer)
        });
        WorldLogLibrary.favorite_killed = this.add(new WorldLogAsset
        {
            id = "favorite_killed",
            group = "favorite_units",
            random_ids = 3,
            path_icon = "ui/Icons/iconFavoriteKilled",
            color = Toolbox.color_log_warning,
            text_replacer = delegate (WorldLogMessage pMessage, ref string pText)
            {
                this.updateText(ref pText, pMessage, "$name$", 1);
                this.updateText(ref pText, pMessage, "$killer$", 2);
            }
        });
        WorldLogLibrary.city_new = this.add(new WorldLogAsset
        {
            id = "city_new",
            group = "cities",
            path_icon = "ui/Icons/iconCitySelect",
            color = Toolbox.color_log_neutral,
            text_replacer = new WorldLogTextFormatter(this.nameReplacer)
        });
        WorldLogLibrary.log_city_revolted = this.add(new WorldLogAsset
        {
            id = "log_city_revolted",
            group = "cities",
            path_icon = "ui/Icons/iconInspiration",
            color = Toolbox.color_log_good,
            text_replacer = delegate (WorldLogMessage pMessage, ref string pText)
            {
                this.updateText(ref pText, pMessage, "$name$", 1);
                this.updateText(ref pText, pMessage, "$kingdom$", 2);
            }
        });
        WorldLogLibrary.diplomacy_war_ended = this.add(new WorldLogAsset
        {
            id = "diplomacy_war_ended",
            group = "wars",
            path_icon = "ui/Icons/actor_traits/iconPacifist",
            color = Toolbox.color_log_good,
            text_replacer = new WorldLogTextFormatter(this.nameReplacer)
        });
        WorldLogLibrary.diplomacy_war_started = this.add(new WorldLogAsset
        {
            id = "diplomacy_war_started",
            group = "wars",
            path_icon = "ui/Icons/iconWar",
            color = Toolbox.color_log_warning,
            text_replacer = delegate (WorldLogMessage pMessage, ref string pText)
            {
                this.updateText(ref pText, pMessage, "$kingdom1$", 1);
                this.updateText(ref pText, pMessage, "$kingdom2$", 2);
            }
        });
        WorldLogLibrary.alliance_new = this.add(new WorldLogAsset
        {
            id = "alliance_new",
            path_icon = "ui/Icons/iconAlliance",
            color = Toolbox.color_log_neutral,
            text_replacer = new WorldLogTextFormatter(this.nameReplacer)
        });
        WorldLogLibrary.alliance_dissolved = this.add(new WorldLogAsset
        {
            id = "alliance_dissolved",
            path_icon = "ui/Icons/iconAlliance",
            color = Toolbox.color_log_warning,
            text_replacer = new WorldLogTextFormatter(this.nameReplacer)
        });
        WorldLogLibrary.kingdom_new = this.add(new WorldLogAsset
        {
            id = "kingdom_new",
            group = "kingdoms",
            path_icon = "ui/Icons/iconKingdom",
            color = Toolbox.color_log_neutral,
            text_replacer = new WorldLogTextFormatter(this.nameReplacer)
        });
        WorldLogLibrary.kingdom_destroyed = this.add(new WorldLogAsset
        {
            id = "kingdom_destroyed",
            group = "kingdoms",
            path_icon = "ui/Icons/actor_traits/iconPyromaniac",
            color = Toolbox.color_log_warning,
            text_replacer = new WorldLogTextFormatter(this.nameReplacer)
        });
        WorldLogLibrary.kingdom_shattered = this.add(new WorldLogAsset
        {
            id = "kingdom_shattered",
            group = "kingdoms",
            path_icon = "ui/Icons/actor_traits/iconPyromaniac",
            random_ids = 3,
            color = Toolbox.color_log_warning,
            text_replacer = new WorldLogTextFormatter(this.kingdomReplacer)
        });
        WorldLogLibrary.kingdom_fractured = this.add(new WorldLogAsset
        {
            id = "kingdom_fractured",
            group = "kingdoms",
            path_icon = "ui/Icons/actor_traits/iconPyromaniac",
            random_ids = 3,
            color = Toolbox.color_log_warning,
            text_replacer = new WorldLogTextFormatter(this.kingdomReplacer)
        });
        WorldLogLibrary.kingdom_royal_clan_new = this.add(new WorldLogAsset
        {
            id = "kingdom_royal_clan_new",
            group = "clans",
            path_icon = "ui/Icons/iconClan",
            color = Toolbox.color_log_neutral,
            random_ids = 3,
            text_replacer = delegate (WorldLogMessage pMessage, ref string pText)
            {
                this.updateText(ref pText, pMessage, "$kingdom$", 1);
                this.updateText(ref pText, pMessage, "$clan$", 2);
                this.updateText(ref pText, pMessage, "$king$", 3);
            }
        });
        WorldLogLibrary.kingdom_royal_clan_changed = this.add(new WorldLogAsset
        {
            id = "kingdom_royal_clan_changed",
            group = "clans",
            path_icon = "ui/Icons/iconClan",
            color = Toolbox.color_log_neutral,
            random_ids = 3,
            text_replacer = delegate (WorldLogMessage pMessage, ref string pText)
            {
                this.updateText(ref pText, pMessage, "$kingdom$", 1);
                this.updateText(ref pText, pMessage, "$old_clan$", 2);
                this.updateText(ref pText, pMessage, "$new_clan$", 3);
            }
        });
        WorldLogLibrary.kingdom_royal_clan_dead = this.add(new WorldLogAsset
        {
            id = "kingdom_royal_clan_dead",
            group = "clans",
            path_icon = "ui/Icons/iconClan",
            color = Toolbox.color_log_warning,
            random_ids = 3,
            text_replacer = delegate (WorldLogMessage pMessage, ref string pText)
            {
                this.updateText(ref pText, pMessage, "$kingdom$", 1);
                this.updateText(ref pText, pMessage, "$clan$", 2);
            }
        });
        WorldLogLibrary.city_destroyed = this.add(new WorldLogAsset
        {
            id = "city_destroyed",
            group = "cities",
            path_icon = "ui/Icons/actor_traits/iconPyromaniac",
            color = Toolbox.color_log_warning,
            text_replacer = new WorldLogTextFormatter(this.nameReplacer)
        });
        WorldLogAsset worldLogAsset = new WorldLogAsset();
        worldLogAsset.id = "auto_tester";
        worldLogAsset.path_icon = "ui/Icons/iconPlay";
        worldLogAsset.color = Toolbox.color_log_warning;
        worldLogAsset.text_replacer = delegate (WorldLogMessage pMessage, ref string pText)
        {
            pText = pMessage.special1;
        };
        WorldLogLibrary.auto_tester = this.add(worldLogAsset);
        this.addDisasters();
    }

    // Token: 0x06000C71 RID: 3185 RVA: 0x000B4F28 File Offset: 0x000B3128
    private void addDisasters()
    {
        this.add(new WorldLogAsset
        {
            id = "$basic_disaster$",
            color = Toolbox.color_log_warning,
            group = "disasters"
        });
        this.clone("disaster_tornado", "$basic_disaster$");
        this.t.locale_id = "worldlog_disaster_tornado";
        this.t.path_icon = "ui/Icons/iconTornado";
        this.clone("disaster_meteorite", "$basic_disaster$");
        this.t.locale_id = "worldlog_disaster_meteorite";
        this.t.path_icon = "ui/Icons/iconMeteorite";
        this.clone("disaster_hellspawn", "$basic_disaster$");
        this.t.locale_id = "worldlog_disaster_hellspawn";
        this.t.path_icon = "ui/Icons/iconDemon";
        this.clone("disaster_earthquake", "$basic_disaster$");
        this.t.locale_id = "worldlog_disaster_earthquake";
        this.t.path_icon = "ui/Icons/iconEarthquake";
        this.clone("disaster_greg_abominations", "$basic_disaster$");
        this.t.locale_id = "worldlog_disaster_greg_abominations";
        this.t.path_icon = "ui/Icons/iconGreg";
        this.clone("disaster_ice_ones", "$basic_disaster$");
        this.t.locale_id = "worldlog_disaster_ice_ones";
        this.t.path_icon = "ui/Icons/iconWalker";
        this.clone("disaster_sudden_snowman", "$basic_disaster$");
        this.t.locale_id = "worldlog_disaster_sudden_snowman";
        this.t.path_icon = "ui/Icons/iconSnowMan";
        this.clone("disaster_garden_surprise", "$basic_disaster$");
        this.t.locale_id = "worldlog_disaster_garden_surprise";
        this.t.path_icon = "ui/Icons/iconSuperPumpkin";
        this.clone("disaster_dragon_from_farlands", "$basic_disaster$");
        this.t.locale_id = "worldlog_disaster_dragon_from_farlands";
        this.t.path_icon = "ui/Icons/iconDragon";
        this.clone("disaster_bandits", "$basic_disaster$");
        this.t.locale_id = "worldlog_disaster_bandits";
        this.t.path_icon = "ui/Icons/iconBandit";
        this.clone("disaster_alien_invasion", "$basic_disaster$");
        this.t.locale_id = "worldlog_disaster_alien_invasion";
        this.t.path_icon = "ui/Icons/iconUfo";
        this.clone("disaster_biomass", "$basic_disaster$");
        this.t.locale_id = "worldlog_disaster_biomass";
        this.t.path_icon = "ui/Icons/iconBiomass";
        this.clone("disaster_tumor", "$basic_disaster$");
        this.t.locale_id = "worldlog_disaster_tumor";
        this.t.path_icon = "ui/Icons/iconTumor";
        this.clone("disaster_heatwave", "$basic_disaster$");
        this.t.locale_id = "worldlog_disaster_heatwave";
        this.t.path_icon = "ui/Icons/iconFire";
        this.clone("disaster_evil_mage", "$basic_disaster$");
        this.t.locale_id = "worldlog_disaster_evil_mage";
        this.t.path_icon = "ui/Icons/iconEvilMage";
        this.t.text_replacer = new WorldLogTextFormatter(this.nameReplacer);
        this.clone("$city_name_disaster$", "$basic_disaster$");
        this.t.text_replacer = delegate (WorldLogMessage pMessage, ref string pText)
        {
            this.updateText(ref pText, pMessage, "$name$", 1);
            this.updateText(ref pText, pMessage, "$city$", 2);
        };
        this.clone("disaster_underground_necromancer", "$city_name_disaster$");
        this.t.locale_id = "worldlog_disaster_underground_necromancer";
        this.t.path_icon = "ui/Icons/iconNecromancer";
        this.clone("disaster_mad_thoughts", "$city_name_disaster$");
        this.t.locale_id = "worldlog_disaster_mad_thoughts";
        this.t.path_icon = "ui/Icons/actor_traits/iconMadness";
    }

    // Token: 0x06000C72 RID: 3186 RVA: 0x000B52E2 File Offset: 0x000B34E2
    private void nameReplacer(WorldLogMessage pMessage, ref string pText)
    {
        this.updateText(ref pText, pMessage, "$name$", 1);
    }

    // Token: 0x06000C73 RID: 3187 RVA: 0x000B52F2 File Offset: 0x000B34F2
    private void kingReplacer(WorldLogMessage pMessage, ref string pText)
    {
        this.updateText(ref pText, pMessage, "$kingdom$", 1);
        this.updateText(ref pText, pMessage, "$king$", 2);
    }

    // Token: 0x06000C74 RID: 3188 RVA: 0x000B5310 File Offset: 0x000B3510
    private void kingdomReplacer(WorldLogMessage pMessage, ref string pText)
    {
        this.updateText(ref pText, pMessage, "$kingdom$", 1);
    }

    // Token: 0x06000C75 RID: 3189 RVA: 0x000B5320 File Offset: 0x000B3520
    public override void editorDiagnosticLocales()
    {
        base.editorDiagnosticLocales();
        foreach (WorldLogAsset tAsset in this.list)
        {
            foreach (string tLocaleID in tAsset.getLocaleIDs())
            {
                this.checkLocale(tAsset, tLocaleID);
            }
        }
    }

    // Token: 0x04000C15 RID: 3093
    public static WorldLogAsset king_new;

    // Token: 0x04000C16 RID: 3094
    public static WorldLogAsset king_left;

    // Token: 0x04000C17 RID: 3095
    public static WorldLogAsset king_dead;

    // Token: 0x04000C18 RID: 3096
    public static WorldLogAsset king_killed;

    // Token: 0x04000C19 RID: 3097
    public static WorldLogAsset favorite_dead;

    // Token: 0x04000C1A RID: 3098
    public static WorldLogAsset favorite_killed;

    // Token: 0x04000C1B RID: 3099
    public static WorldLogAsset city_new;

    // Token: 0x04000C1C RID: 3100
    public static WorldLogAsset log_city_revolted;

    // Token: 0x04000C1D RID: 3101
    public static WorldLogAsset diplomacy_war_ended;

    // Token: 0x04000C1E RID: 3102
    public static WorldLogAsset diplomacy_war_started;

    // Token: 0x04000C1F RID: 3103
    public static WorldLogAsset alliance_new;

    // Token: 0x04000C20 RID: 3104
    public static WorldLogAsset alliance_dissolved;

    // Token: 0x04000C21 RID: 3105
    public static WorldLogAsset kingdom_new;

    // Token: 0x04000C22 RID: 3106
    public static WorldLogAsset kingdom_destroyed;

    // Token: 0x04000C23 RID: 3107
    public static WorldLogAsset kingdom_shattered;

    // Token: 0x04000C24 RID: 3108
    public static WorldLogAsset kingdom_fractured;

    // Token: 0x04000C25 RID: 3109
    public static WorldLogAsset city_destroyed;

    // Token: 0x04000C26 RID: 3110
    public static WorldLogAsset kingdom_royal_clan_new;

    // Token: 0x04000C27 RID: 3111
    public static WorldLogAsset kingdom_royal_clan_changed;

    // Token: 0x04000C28 RID: 3112
    public static WorldLogAsset kingdom_royal_clan_dead;

    // Token: 0x04000C29 RID: 3113
    public static WorldLogAsset auto_tester;
}
using System;
using Beebyte.Obfuscator;
using SQLite;
using UnityEngine;

// Token: 0x020001E6 RID: 486
[Preserve]
[Skip]
[Serializable]
public class WorldLogMessage
{
    // Token: 0x1700006B RID: 107
    // (get) Token: 0x06000E01 RID: 3585 RVA: 0x000BD575 File Offset: 0x000BB775
    // (set) Token: 0x06000E02 RID: 3586 RVA: 0x000BD57D File Offset: 0x000BB77D
    [NotNull]
    public string asset_id { get; set; }

    // Token: 0x1700006C RID: 108
    // (get) Token: 0x06000E03 RID: 3587 RVA: 0x000BD586 File Offset: 0x000BB786
    // (set) Token: 0x06000E04 RID: 3588 RVA: 0x000BD58E File Offset: 0x000BB78E
    [NotNull]
    public int timestamp { get; set; }

    // Token: 0x1700006D RID: 109
    // (get) Token: 0x06000E05 RID: 3589 RVA: 0x000BD597 File Offset: 0x000BB797
    // (set) Token: 0x06000E06 RID: 3590 RVA: 0x000BD59F File Offset: 0x000BB79F
    public string special1 { get; set; }

    // Token: 0x1700006E RID: 110
    // (get) Token: 0x06000E07 RID: 3591 RVA: 0x000BD5A8 File Offset: 0x000BB7A8
    // (set) Token: 0x06000E08 RID: 3592 RVA: 0x000BD5B0 File Offset: 0x000BB7B0
    public string special2 { get; set; }

    // Token: 0x1700006F RID: 111
    // (get) Token: 0x06000E09 RID: 3593 RVA: 0x000BD5B9 File Offset: 0x000BB7B9
    // (set) Token: 0x06000E0A RID: 3594 RVA: 0x000BD5C1 File Offset: 0x000BB7C1
    public string special3 { get; set; }

    // Token: 0x17000070 RID: 112
    // (get) Token: 0x06000E0B RID: 3595 RVA: 0x000BD5CA File Offset: 0x000BB7CA
    // (set) Token: 0x06000E0C RID: 3596 RVA: 0x000BD5D2 File Offset: 0x000BB7D2
    public string color_special_1 { get; set; }

    // Token: 0x17000071 RID: 113
    // (get) Token: 0x06000E0D RID: 3597 RVA: 0x000BD5DB File Offset: 0x000BB7DB
    // (set) Token: 0x06000E0E RID: 3598 RVA: 0x000BD5E3 File Offset: 0x000BB7E3
    public string color_special_2 { get; set; }

    // Token: 0x17000072 RID: 114
    // (get) Token: 0x06000E0F RID: 3599 RVA: 0x000BD5EC File Offset: 0x000BB7EC
    // (set) Token: 0x06000E10 RID: 3600 RVA: 0x000BD5F4 File Offset: 0x000BB7F4
    public string color_special_3 { get; set; }

    // Token: 0x17000073 RID: 115
    // (get) Token: 0x06000E11 RID: 3601 RVA: 0x000BD5FD File Offset: 0x000BB7FD
    // (set) Token: 0x06000E12 RID: 3602 RVA: 0x000BD605 File Offset: 0x000BB805
    public long unit_id { get; set; } = -1L;

    // Token: 0x17000074 RID: 116
    // (get) Token: 0x06000E13 RID: 3603 RVA: 0x000BD60E File Offset: 0x000BB80E
    // (set) Token: 0x06000E14 RID: 3604 RVA: 0x000BD616 File Offset: 0x000BB816
    public long kingdom_id { get; set; } = -1L;

    // Token: 0x17000075 RID: 117
    // (get) Token: 0x06000E15 RID: 3605 RVA: 0x000BD61F File Offset: 0x000BB81F
    // (set) Token: 0x06000E16 RID: 3606 RVA: 0x000BD627 File Offset: 0x000BB827
    public int? x { get; set; }

    // Token: 0x17000076 RID: 118
    // (get) Token: 0x06000E17 RID: 3607 RVA: 0x000BD630 File Offset: 0x000BB830
    // (set) Token: 0x06000E18 RID: 3608 RVA: 0x000BD638 File Offset: 0x000BB838
    public int? y { get; set; }

    // Token: 0x17000077 RID: 119
    // (get) Token: 0x06000E1A RID: 3610 RVA: 0x000BD668 File Offset: 0x000BB868
    // (set) Token: 0x06000E19 RID: 3609 RVA: 0x000BD641 File Offset: 0x000BB841
    [Ignore]
    public Vector2 location
    {
        get
        {
            if (this.x == null || this.y == null)
            {
                return new Vector2(-1f, -1f);
            }
            return new Vector2((float)this.x.Value, (float)this.y.Value);
        }
        set
        {
            this.x = new int?((int)value.x);
            this.y = new int?((int)value.y);
        }
    }

    // Token: 0x17000078 RID: 120
    // (get) Token: 0x06000E1C RID: 3612 RVA: 0x000BD6DD File Offset: 0x000BB8DD
    // (set) Token: 0x06000E1B RID: 3611 RVA: 0x000BD6C8 File Offset: 0x000BB8C8
    [Ignore]
    public Actor unit
    {
        get
        {
            return World.world.units.get(this.unit_id);
        }
        set
        {
            this.unit_id = ((value != null) ? value.getID() : (-1L));
        }
    }

    // Token: 0x17000079 RID: 121
    // (get) Token: 0x06000E1E RID: 3614 RVA: 0x000BD709 File Offset: 0x000BB909
    // (set) Token: 0x06000E1D RID: 3613 RVA: 0x000BD6F4 File Offset: 0x000BB8F4
    [Ignore]
    public Kingdom kingdom
    {
        get
        {
            return World.world.kingdoms.get(this.kingdom_id);
        }
        set
        {
            this.kingdom_id = ((value != null) ? value.getID() : (-1L));
        }
    }

    // Token: 0x1700007A RID: 122
    // (set) Token: 0x06000E1F RID: 3615 RVA: 0x000BD720 File Offset: 0x000BB920
    [Ignore]
    public Color color_special1
    {
        set
        {
            this.color_special_1 = Toolbox.colorToHex(value, false);
        }
    }

    // Token: 0x1700007B RID: 123
    // (set) Token: 0x06000E20 RID: 3616 RVA: 0x000BD734 File Offset: 0x000BB934
    [Ignore]
    public Color color_special2
    {
        set
        {
            this.color_special_2 = Toolbox.colorToHex(value, false);
        }
    }

    // Token: 0x1700007C RID: 124
    // (set) Token: 0x06000E21 RID: 3617 RVA: 0x000BD748 File Offset: 0x000BB948
    [Ignore]
    public Color color_special3
    {
        set
        {
            this.color_special_3 = Toolbox.colorToHex(value, false);
        }
    }

    // Token: 0x06000E22 RID: 3618 RVA: 0x000BD75C File Offset: 0x000BB95C
    public WorldLogMessage()
    {
    }

    // Token: 0x06000E23 RID: 3619 RVA: 0x000BD774 File Offset: 0x000BB974
    public WorldLogMessage(WorldLogAsset pAsset, string pSpecial1 = null, string pSpecial2 = null, string pSpecial3 = null)
    {
        this.asset_id = pAsset.id;
        this.special1 = pSpecial1;
        this.special2 = pSpecial2;
        this.special3 = pSpecial3;
        this.x = null;
        this.y = null;
        this.unit_id = -1L;
        this.color_special_1 = null;
        this.color_special_2 = null;
        this.color_special_3 = null;
        this.timestamp = (int)World.world.getCurWorldTime();
        this.unit = null;
    }
}
using System;

// Token: 0x02000244 RID: 580
public class UnitSpawner : BaseBuildingComponent
{
    // Token: 0x0600153B RID: 5435 RVA: 0x000DB8A0 File Offset: 0x000D9AA0
    public override void update(float pElapsed)
    {
        base.update(pElapsed);
        if (this._spawn_timer > 0f)
        {
            this._spawn_timer -= pElapsed;
            return;
        }
        this._spawn_timer = 10f;
        this.trySpawnUnit();
    }

    // Token: 0x0600153C RID: 5436 RVA: 0x000DB8D8 File Offset: 0x000D9AD8
    private void trySpawnUnit()
    {
        int tCurrentResidents = this.building.countResidents();
        if (tCurrentResidents >= this.building.asset.housing_slots)
        {
            return;
        }
        Subspecies tSubspecies = null;
        if (tCurrentResidents > 0)
        {
            foreach (long tActorID in this.building.residents)
            {
                Actor tActor = World.world.units.get(tActorID);
                if (!tActor.isRekt())
                {
                    tSubspecies = tActor.subspecies;
                    break;
                }
            }
        }
        this.spawnUnit(tSubspecies);
    }

    // Token: 0x0600153D RID: 5437 RVA: 0x000DB97C File Offset: 0x000D9B7C
    private void spawnUnit(Subspecies pSubspecies)
    {
        string tStatId = this.building.asset.spawn_units_asset;
        Actor tNewActor = World.world.units.createNewUnit(tStatId, this.building.current_tile, false, 0f, pSubspecies, null, true, true, false);
        tNewActor.applyRandomForce(1.5f, 2f);
        this.setUnitFromHere(tNewActor);
    }

    // Token: 0x0600153E RID: 5438 RVA: 0x000DB9D8 File Offset: 0x000D9BD8
    public void setUnitFromHere(Actor pActor)
    {
        pActor.setHomeBuilding(this.building);
    }

    // Token: 0x04001229 RID: 4649
    private const float SPAWN_INTERVAL = 10f;

    // Token: 0x0400122A RID: 4650
    private float _spawn_timer = 1f;
}
using System;

// Token: 0x0200017D RID: 381
public class UnitHandToolLibrary : AssetLibrary<UnitHandToolAsset>
{
    // Token: 0x06000B43 RID: 2883 RVA: 0x000A1B30 File Offset: 0x0009FD30
    public override void init()
    {
        base.init();
        this.add(new UnitHandToolAsset
        {
            id = "flag",
            animated = true,
            colored = true
        });
        this.add(new UnitHandToolAsset
        {
            id = "axe"
        });
        this.add(new UnitHandToolAsset
        {
            id = "basket"
        });
        this.add(new UnitHandToolAsset
        {
            id = "book"
        });
        this.add(new UnitHandToolAsset
        {
            id = "bucket"
        });
        this.add(new UnitHandToolAsset
        {
            id = "coffee_cup",
            animated = true
        });
        this.add(new UnitHandToolAsset
        {
            id = "hammer"
        });
        this.add(new UnitHandToolAsset
        {
            id = "hoe"
        });
        this.add(new UnitHandToolAsset
        {
            id = "notebook"
        });
        this.add(new UnitHandToolAsset
        {
            id = "pickaxe"
        });
    }

    // Token: 0x06000B44 RID: 2884 RVA: 0x000A1C40 File Offset: 0x0009FE40
    public override void post_init()
    {
        base.post_init();
        foreach (UnitHandToolAsset tAsset in this.list)
        {
            if (string.IsNullOrEmpty(tAsset.path_gameplay_sprite))
            {
                tAsset.path_gameplay_sprite = "items/tools/tool_" + tAsset.id;
            }
        }
    }

    // Token: 0x06000B45 RID: 2885 RVA: 0x000A1CB8 File Offset: 0x0009FEB8
    public void loadSprites()
    {
        foreach (UnitHandToolAsset unitHandToolAsset in this.list)
        {
            unitHandToolAsset.gameplay_sprites = SpriteTextureLoader.getSpriteList(unitHandToolAsset.path_gameplay_sprite, false);
        }
    }
}
using System;
using System.Collections.Generic;
using System.Runtime.CompilerServices;
using UnityEngine;

// Token: 0x020003D5 RID: 981
public class GeneratorTool : ScriptableObject
{
    // Token: 0x06002155 RID: 8533 RVA: 0x0011933C File Offset: 0x0011753C
    internal static void Setup(WorldTile[,] pTilesMap)
    {
        GeneratorTool._tiles_map = pTilesMap;
    }

    // Token: 0x06002156 RID: 8534 RVA: 0x00119344 File Offset: 0x00117544
    public static void Init()
    {
        GeneratorTool.LoadGenShapeTextures();
    }

    // Token: 0x06002157 RID: 8535 RVA: 0x0011934C File Offset: 0x0011754C
    internal static void applyTemplate(string pID, float pMod = 1f)
    {
        Texture2D tTexture = Resources.LoadAll<Texture2D>("map_gen/" + pID).GetRandom<Texture2D>();
        tTexture = TextureRotator.Rotate(tTexture, Randy.randomInt(0, 360), new Color32(byte.MaxValue, byte.MaxValue, byte.MaxValue, byte.MaxValue));
        TextureScale.Bilinear(tTexture, MapBox.width, MapBox.height);
        float tHeightMod = 255f * pMod;
        for (int x = 0; x < tTexture.width; x++)
        {
            for (int y = 0; y < tTexture.height; y++)
            {
                WorldTile tTile = World.world.GetTile(x, y);
                if (tTile != null)
                {
                    tTexture.GetPixel(x, y);
                    int tVal = (int)((1f - tTexture.GetPixel(x, y).g) * tHeightMod);
                    tTile.Height += tVal;
                }
            }
        }
    }

    // Token: 0x06002158 RID: 8536 RVA: 0x00119418 File Offset: 0x00117618
    internal static void ApplyRandomShape(string pWhat = "height", float tDistMax = 2f, float pMod = 0.7f, bool pSubtract = false)
    {
        Texture2D texture = Object.Instantiate<Texture2D>(GeneratorTool._textures.GetRandom<Texture2D>());
        texture.name = "random_shape";
        int newW = (int)((float)texture.width * Randy.randomFloat(0.3f, 2f));
        int newH = (int)((float)texture.height * Randy.randomFloat(0.3f, 2f));
        texture = TextureRotator.Rotate(texture, Randy.randomInt(0, 360), new Color32(0, 0, 0, 0));
        TextureScale.Bilinear(texture, newW, newH);
        newW = texture.width;
        newH = texture.height;
        int tPosX = MapBox.width / 2 - newW / 2 - (int)Randy.randomFloat((float)(-(float)newW) * tDistMax, (float)newW * tDistMax);
        int tPosY = MapBox.height / 2 - newH / 2 - (int)Randy.randomFloat((float)(-(float)newH) * tDistMax, (float)newH * tDistMax);
        if (tPosX < 0)
        {
            tPosX = 0;
        }
        if (tPosY < 0)
        {
            tPosY = 0;
        }
        if (tPosX + newW > MapBox.width)
        {
            tPosX = MapBox.width - newW;
        }
        if (tPosY + newH > MapBox.height)
        {
            tPosY = MapBox.height - newH;
        }
        float tHeightMod = 255f * pMod;
        for (int x = 0; x < texture.width; x++)
        {
            for (int y = 0; y < texture.height; y++)
            {
                WorldTile tTile = World.world.GetTile(tPosX + x, tPosY + y);
                if (tTile != null)
                {
                    int tVal = (int)(texture.GetPixel(x, y).a * tHeightMod);
                    if (pSubtract)
                    {
                        tVal = -tVal;
                    }
                    tTile.Height += tVal;
                }
            }
        }
        Object.Destroy(texture);
    }

    // Token: 0x06002159 RID: 8537 RVA: 0x00119595 File Offset: 0x00117795
    private static void LoadGenShapeTextures()
    {
        if (GeneratorTool._textures != null)
        {
            return;
        }
        GeneratorTool._textures = Resources.LoadAll<Texture2D>("gen_shapes");
    }

    // Token: 0x0600215A RID: 8538 RVA: 0x001195B0 File Offset: 0x001177B0
    public static void ApplyWaterLevel(WorldTile[,] tilesMap, int width, int height, int pVal)
    {
        for (int x = 0; x < width; x++)
        {
            for (int y = 0; y < height; y++)
            {
                tilesMap[x, y].Height -= pVal;
            }
        }
    }

    // Token: 0x0600215B RID: 8539 RVA: 0x001195EC File Offset: 0x001177EC
    public static void ApplyPerlinNoise(WorldTile[,] tilesMap, int width, int height, float pPosX, float pPosY, float pAlphaMod, float pScaleMod, bool pSubtract = false, GeneratorTarget pTarget = GeneratorTarget.Height)
    {
        float tAlphaMod = 255f * pAlphaMod;
        float tScaleX = 1f;
        float tScaleY = 1f;
        if (width > height)
        {
            tScaleX = (float)(width / height);
        }
        else
        {
            tScaleY = (float)(height / width);
        }
        for (int x = 0; x < width; x++)
        {
            for (int y = 0; y < height; y++)
            {
                float num = (pPosX + (float)x) / (float)width;
                float tY = (pPosY + (float)y) / (float)height;
                int tValue = (int)(Mathf.PerlinNoise(num * pScaleMod * tScaleX, tY * pScaleMod * tScaleY) * tAlphaMod);
                if (pSubtract)
                {
                    tValue = -tValue;
                }
                if (pTarget == GeneratorTarget.Height)
                {
                    tilesMap[x, y].Height += tValue;
                }
            }
        }
    }

    // Token: 0x0600215C RID: 8540 RVA: 0x00119688 File Offset: 0x00117888
    public static void ApplyPerlinReplace(PerlinReplaceContainer pContainer)
    {
        float pPosX = (float)Randy.randomInt(0, 15000);
        float pPosY = (float)Randy.randomInt(0, 15000);
        int width = MapBox.width;
        int height = MapBox.height;
        float pScaleMod = (float)pContainer.scale;
        float tMaxHeight = 255f;
        float tScaleX = 1f;
        float tScaleY = 1f;
        if (width > height)
        {
            tScaleX = (float)(width / height);
        }
        else
        {
            tScaleY = (float)(height / width);
        }
        WorldTile[,] tTilesMap = GeneratorTool._tiles_map;
        for (int x = 0; x < width; x++)
        {
            for (int y = 0; y < height; y++)
            {
                WorldTile tTile = tTilesMap[x, y];
                float num = (pPosX + (float)x) / (float)width;
                float tY = (pPosY + (float)y) / (float)height;
                int tValue = (int)(Mathf.PerlinNoise(num * pScaleMod * tScaleX, tY * pScaleMod * tScaleY) * tMaxHeight);
                for (int i = 0; i < pContainer.options.Count; i++)
                {
                    PerlinReplaceOption tOption = pContainer.options[i];
                    if (tValue > tOption.replace_height_value && tTile.main_type.IsType(tOption.from))
                    {
                        tTile.setTileType(tOption.to);
                    }
                }
            }
        }
    }

    // Token: 0x0600215D RID: 8541 RVA: 0x001197B0 File Offset: 0x001179B0
    public static void UpdateTileTypes(bool pGeneratorStage = false, int pStartIndex = 0, int pAmount = 0)
    {
        int tMax = pStartIndex + pAmount;
        for (int i = pStartIndex; i < tMax; i++)
        {
            WorldTile tTile = World.world.tiles_list[i];
            TileType tType = AssetManager.tiles.getTypeByDepth(tTile);
            tTile.setTileType(tType, true);
        }
    }

    // Token: 0x0600215E RID: 8542 RVA: 0x001197F0 File Offset: 0x001179F0
    public static void GenerateTileNeighbours(WorldTile[] pTilesList)
    {
        int tCount = pTilesList.Length;
        for (int i = 0; i < tCount; i++)
        {
            GeneratorTool.generateTileNeighbours(pTilesList[i]);
        }
    }

    // Token: 0x0600215F RID: 8543 RVA: 0x00119818 File Offset: 0x00117A18
    public static void generateTileNeighbours(WorldTile pTile)
    {
        WorldTile tNeighbour = GeneratorTool.getTile(pTile.x - 1, pTile.y);
        pTile.addNeighbour(tNeighbour, TileDirection.Left, GeneratorTool._neighbours, GeneratorTool._neighbours_all, false);
        tNeighbour = GeneratorTool.getTile(pTile.x + 1, pTile.y);
        pTile.addNeighbour(tNeighbour, TileDirection.Right, GeneratorTool._neighbours, GeneratorTool._neighbours_all, false);
        tNeighbour = GeneratorTool.getTile(pTile.x, pTile.y - 1);
        pTile.addNeighbour(tNeighbour, TileDirection.Down, GeneratorTool._neighbours, GeneratorTool._neighbours_all, false);
        tNeighbour = GeneratorTool.getTile(pTile.x, pTile.y + 1);
        pTile.addNeighbour(tNeighbour, TileDirection.Up, GeneratorTool._neighbours, GeneratorTool._neighbours_all, false);
        tNeighbour = GeneratorTool.getTile(pTile.x - 1, pTile.y - 1);
        pTile.addNeighbour(tNeighbour, TileDirection.Null, GeneratorTool._neighbours, GeneratorTool._neighbours_all, true);
        tNeighbour = GeneratorTool.getTile(pTile.x - 1, pTile.y + 1);
        pTile.addNeighbour(tNeighbour, TileDirection.Null, GeneratorTool._neighbours, GeneratorTool._neighbours_all, true);
        tNeighbour = GeneratorTool.getTile(pTile.x + 1, pTile.y - 1);
        pTile.addNeighbour(tNeighbour, TileDirection.Null, GeneratorTool._neighbours, GeneratorTool._neighbours_all, true);
        tNeighbour = GeneratorTool.getTile(pTile.x + 1, pTile.y + 1);
        pTile.addNeighbour(tNeighbour, TileDirection.Null, GeneratorTool._neighbours, GeneratorTool._neighbours_all, true);
        pTile.neighbours = GeneratorTool._neighbours.ToArray();
        pTile.neighboursAll = GeneratorTool._neighbours_all.ToArray();
        GeneratorTool._neighbours.Clear();
        GeneratorTool._neighbours_all.Clear();
    }

    // Token: 0x06002160 RID: 8544 RVA: 0x0011999C File Offset: 0x00117B9C
    public static void ApplyRingEffect()
    {
        WorldTile[,] tTilesMap = GeneratorTool._tiles_map;
        for (int x = 0; x < MapBox.width; x++)
        {
            for (int y = 0; y < MapBox.height; y++)
            {
                for (int i = 0; i < AssetManager.tiles.list.Count; i++)
                {
                    TileType tType = AssetManager.tiles.list[i];
                    if (tType.additional_height != null)
                    {
                        bool found = false;
                        for (int j = 0; j < tType.additional_height.Length; j++)
                        {
                            WorldTile tWorldTile = tTilesMap[x, y];
                            if (tWorldTile.Height == tType.height_min - tType.additional_height[j])
                            {
                                tWorldTile.Height = tType.height_min;
                                found = true;
                                break;
                            }
                        }
                        if (found)
                        {
                            break;
                        }
                    }
                }
            }
        }
    }

    // Token: 0x06002161 RID: 8545 RVA: 0x00119A6A File Offset: 0x00117C6A
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    private static WorldTile getTile(int pX, int pY)
    {
        if (pX < 0 || pX >= MapBox.width)
        {
            return null;
        }
        if (pY < 0 || pY >= MapBox.height)
        {
            return null;
        }
        return GeneratorTool._tiles_map[pX, pY];
    }

    // Token: 0x040018C9 RID: 6345
    private static WorldTile[,] _tiles_map;

    // Token: 0x040018CA RID: 6346
    private static Texture2D[] _textures;

    // Token: 0x040018CB RID: 6347
    private static List<WorldTile> _neighbours = new List<WorldTile>(4);

    // Token: 0x040018CC RID: 6348
    private static List<WorldTile> _neighbours_all = new List<WorldTile>(8);
}
using System;
using System.Collections.Generic;

// Token: 0x020003DD RID: 989
public class NameGenerator
{
    // Token: 0x060021B0 RID: 8624 RVA: 0x0011C6FC File Offset: 0x0011A8FC
    public static void init()
    {
        if (NameGenerator._initiated)
        {
            return;
        }
        NameGenerator._initiated = true;
        Blacklist.init();
    }

    // Token: 0x060021B1 RID: 8625 RVA: 0x0011C714 File Offset: 0x0011A914
    public static string generateName(Actor pActor, MetaType pType, long pSeed, ActorSex pSex = ActorSex.None)
    {
        string tNameTemplate = null;
        int tSeedMeta = pType.GetHashCode();
        pSeed += (long)tSeedMeta;
        if (pActor.hasCulture())
        {
            OnomasticsData tOnomasticData = pActor.culture.getOnomasticData(pType, false);
            if (tOnomasticData != null)
            {
                return tOnomasticData.generateName(pSex, 0, new long?(pSeed));
            }
            tNameTemplate = pActor.culture.getNameTemplate(pType);
        }
        else
        {
            foreach (Actor tParent in pActor.getParents())
            {
                if (tParent.hasCulture())
                {
                    OnomasticsData tOnomasticData2 = tParent.culture.getOnomasticData(pType, false);
                    if (tOnomasticData2 != null)
                    {
                        return tOnomasticData2.generateName(pSex, 0, new long?(pSeed));
                    }
                    tNameTemplate = tParent.culture.getNameTemplate(pType);
                    break;
                }
            }
        }
        if (string.IsNullOrEmpty(tNameTemplate))
        {
            tNameTemplate = pActor.asset.getNameTemplate(pType);
        }
        return NameGenerator.getName(tNameTemplate, pSex, false, null, new long?(pSeed), false);
    }

    // Token: 0x060021B2 RID: 8626 RVA: 0x0011C810 File Offset: 0x0011AA10
    public static string getName(string pAssetID, ActorSex pSex = ActorSex.Male, bool pForceLegacy = false, string pTemplate = null, long? pSeed = null, bool pIgnoreBlackList = false)
    {
        NameGenerator.init();
        NameGeneratorAsset tAsset = AssetManager.name_generator.get(pAssetID);
        NameGenerator._current_consonants = 0;
        NameGenerator._current_vowels = 0;
        string tName = NameGenerator.generateNameFromTemplate(tAsset, null, null, pForceLegacy, 0, pTemplate, null, false, pSeed, pSex, pIgnoreBlackList);
        if (!tAsset.hasOnomastics() && pSex == ActorSex.Female)
        {
            string lastLetter = tName.Substring(tName.Length - 1, 1);
            bool tFound = false;
            string[] vowels = tAsset.vowels;
            for (int i = 0; i < vowels.Length; i++)
            {
                if (vowels[i].CompareTo(lastLetter) == 0)
                {
                    tFound = true;
                    break;
                }
            }
            if (!tFound)
            {
                tName += Randy.getRandom<string>(tAsset.vowels);
            }
        }
        return tName;
    }

    // Token: 0x060021B3 RID: 8627 RVA: 0x0011C8AD File Offset: 0x0011AAAD
    private static string firstToUpper(string pString)
    {
        return pString.FirstToUpper();
    }

    // Token: 0x060021B4 RID: 8628 RVA: 0x0011C8B5 File Offset: 0x0011AAB5
    private static string addVowel(string[] pList, bool pUppercase = false)
    {
        NameGenerator._current_consonants = 0;
        NameGenerator._current_vowels++;
        if (pUppercase)
        {
            return NameGenerator.firstToUpper(Randy.getRandom<string>(pList));
        }
        return Randy.getRandom<string>(pList);
    }

    // Token: 0x060021B5 RID: 8629 RVA: 0x0011C8E0 File Offset: 0x0011AAE0
    private static string addEnding(NameGeneratorAsset pTemplate, string pName)
    {
        string tEnding = Randy.getRandom<string>(pTemplate.parts);
        if (NameGenerator.isConsonant(tEnding[0]) && NameGenerator.isConsonant(pName[pName.Length - 1]))
        {
            tEnding = NameGenerator.addVowel(pTemplate.vowels, false) + tEnding;
        }
        else if (!NameGenerator.isConsonant(tEnding[0]) && !NameGenerator.isConsonant(pName[pName.Length - 1]))
        {
            tEnding = NameGenerator.addConsonant(pTemplate.consonants, false) + tEnding;
        }
        return tEnding;
    }

    // Token: 0x060021B6 RID: 8630 RVA: 0x0011C968 File Offset: 0x0011AB68
    private static string addConsonant(string[] pList, bool pUppercase = false)
    {
        NameGenerator._current_consonants++;
        NameGenerator._current_vowels = 0;
        if (pUppercase)
        {
            return NameGenerator.firstToUpper(Randy.getRandom<string>(pList));
        }
        return Randy.getRandom<string>(pList);
    }

    // Token: 0x060021B7 RID: 8631 RVA: 0x0011C994 File Offset: 0x0011AB94
    private static string addPart(string[] pArray, bool pUppercase = false)
    {
        string tPart = Randy.getRandom<string>(pArray);
        if (NameGenerator.isConsonant(tPart[tPart.Length - 1]))
        {
            NameGenerator._current_consonants++;
            NameGenerator._current_vowels = 0;
        }
        else
        {
            NameGenerator._current_consonants = 0;
            NameGenerator._current_vowels++;
        }
        if (pUppercase)
        {
            tPart = NameGenerator.firstToUpper(tPart);
        }
        return tPart;
    }

    // Token: 0x060021B8 RID: 8632 RVA: 0x0011C9EE File Offset: 0x0011ABEE
    private static bool isConsonant(char pChar)
    {
        return NameGenerator.consonants_all.IndexOf(pChar) > -1;
    }

    // Token: 0x060021B9 RID: 8633 RVA: 0x0011C9FE File Offset: 0x0011ABFE
    private static bool isVowel(char pChar)
    {
        return NameGenerator.vowels_all.IndexOf(pChar) > -1;
    }

    // Token: 0x060021BA RID: 8634 RVA: 0x0011CA10 File Offset: 0x0011AC10
    public static string generateNameFromTemplate(string pAssetID, Actor pActor = null, Kingdom pKingdom = null, bool pForceLegacy = false)
    {
        return NameGenerator.generateNameFromTemplate(AssetManager.name_generator.get(pAssetID), pActor, pKingdom, pForceLegacy, 0, null, null, false, null, ActorSex.None, false);
    }

    // Token: 0x060021BB RID: 8635 RVA: 0x0011CA40 File Offset: 0x0011AC40
    public static string generateNameFromOnomastics(NameGeneratorAsset pAsset, string pTemplate = null, Actor pActor = null, long? pSeed = null, ActorSex pSex = ActorSex.None)
    {
        OnomasticsData tOriginalData;
        if (!string.IsNullOrEmpty(pTemplate))
        {
            tOriginalData = OnomasticsCache.getOriginalData(pTemplate);
        }
        else
        {
            tOriginalData = OnomasticsCache.getOriginalData(pAsset.onomastics_templates.GetRandom<string>());
        }
        ActorSex tSex = pSex;
        if (pActor != null)
        {
            tSex = pActor.data.sex;
        }
        return tOriginalData.generateName(tSex, 0, pSeed);
    }

    // Token: 0x060021BC RID: 8636 RVA: 0x0011CA8C File Offset: 0x0011AC8C
    public static string generateNamesFromTemplate(int pAmount, NameGeneratorAsset pAsset, Actor pActor = null, Kingdom pKingdom = null, bool pForceLegacy = false, bool pTestReplacer = false)
    {
        string tRes = "";
        HashSet<string> tUniques = new HashSet<string>();
        List<string> tNames = new List<string>();
        if (pAsset.hasOnomastics() && !pForceLegacy)
        {
            using (List<string>.Enumerator enumerator = pAsset.onomastics_templates.GetEnumerator())
            {
                while (enumerator.MoveNext())
                {
                    string tTemplate = enumerator.Current;
                    tUniques.Clear();
                    tNames.Clear();
                    for (int i = 0; i < 100; i++)
                    {
                        tUniques.Add(NameGenerator.generateNameFromTemplate(pAsset, pActor, pKingdom, false, 0, tTemplate, null, pTestReplacer, null, ActorSex.None, false));
                    }
                    tRes = tRes + "\n--- " + tTemplate;
                    tRes = string.Concat(new string[]
                    {
                        tRes,
                        "\n -- (",
                        tUniques.Count.ToString(),
                        " / ",
                        100.ToString(),
                        ") \n"
                    });
                    tNames.AddRange(tUniques);
                    tNames.Shuffle<string>();
                    if (tNames.Count - pAmount > 0)
                    {
                        tNames.RemoveRange(pAmount, tNames.Count - pAmount);
                    }
                    tNames.Sort();
                    foreach (string tName in tNames)
                    {
                        tRes = tRes + tName + "\n";
                    }
                }
                return tRes;
            }
        }
        for (int j = 0; j < 100; j++)
        {
            tUniques.Add(NameGenerator.generateNameFromTemplate(pAsset, pActor, pKingdom, pForceLegacy, 0, null, null, pTestReplacer, null, ActorSex.None, false));
        }
        tRes += "\n--- Legacy";
        tRes = string.Concat(new string[]
        {
            tRes,
            "\n -- (",
            tUniques.Count.ToString(),
            " / ",
            100.ToString(),
            ") \n"
        });
        tNames.AddRange(tUniques);
        tNames.Shuffle<string>();
        if (tNames.Count - pAmount > 0)
        {
            tNames.RemoveRange(pAmount, tNames.Count - pAmount);
        }
        tNames.Sort();
        foreach (string tName2 in tNames)
        {
            tRes = tRes + tName2 + "\n";
        }
        return tRes;
    }

    // Token: 0x060021BD RID: 8637 RVA: 0x0011CD2C File Offset: 0x0011AF2C
    public static string generateNameFromTemplate(NameGeneratorAsset pAsset, Actor pActor = null, Kingdom pKingdom = null, bool pForceLegacy = false, int pCalls = 0, string pOnomasticsTemplate = null, string[] pClassicTemplate = null, bool pTestReplacer = false, long? pSeed = null, ActorSex pSex = ActorSex.None, bool pIgnoreBlacklist = false)
    {
        if (pCalls > 50)
        {
            return string.Empty;
        }
        if (pAsset.hasOnomastics() && !pForceLegacy)
        {
            return NameGenerator.generateNameFromOnomastics(pAsset, pOnomasticsTemplate, pActor, pSeed, pSex);
        }
        NameGenerator._current_consonants = 0;
        NameGenerator._current_vowels = 0;
        string tName = "";
        string[] array = pClassicTemplate ?? pAsset.templates.GetRandom<string[]>();
        bool tAdditionAdded = false;
        foreach (string tStep in array)
        {
            string tMain;
            string tLastPart;
            if (tStep.Contains('#'))
            {
                string[] array3 = tStep.Split('#', StringSplitOptions.None);
                tMain = array3[0];
                tLastPart = array3[1];
            }
            else
            {
                tMain = tStep;
                tLastPart = "";
            }
            if (pAsset.use_dictionary)
            {
                if (tMain == "$comma$")
                {
                    tName += ", ";
                }
                else
                {
                    if (tMain.Contains(';'))
                    {
                        tMain = tMain.Split(';', StringSplitOptions.None).GetRandom<string>();
                    }
                    Dictionary<string, ListPool<string>> dict_splitted_items = NameGenerator._dict_splitted_items;
                    if (dict_splitted_items == null || !dict_splitted_items.ContainsKey(tMain))
                    {
                        if (NameGenerator._dict_splitted_items == null)
                        {
                            NameGenerator._dict_splitted_items = UnsafeCollectionPool<Dictionary<string, ListPool<string>>, KeyValuePair<string, ListPool<string>>>.Get();
                        }
                        ListPool<string> tNewList = new ListPool<string>(pAsset.dict_parts[tMain].Split(',', StringSplitOptions.None));
                        NameGenerator._dict_splitted_items.Add(tMain, tNewList);
                    }
                    NameGenerator._dict_splitted_items[tMain].ShuffleLast<string>();
                    string tMottoPartId = NameGenerator._dict_splitted_items[tMain].Last<string>();
                    if (NameGenerator._dict_splitted_items[tMain].Count > 1)
                    {
                        NameGenerator._dict_splitted_items[tMain].Pop<string>();
                    }
                    tName += tMottoPartId;
                }
            }
            else
            {
                uint num = < PrivateImplementationDetails >.ComputeStringHash(tMain);
                if (num <= 2267396087U)
                {
                    if (num <= 717708808U)
                    {
                        if (num <= 455613546U)
                        {
                            if (num != 34558099U)
                            {
                                if (num != 51335718U)
                                {
                                    if (num != 455613546U)
                                    {
                                        goto IL_932;
                                    }
                                    if (!(tMain == "CONSONANT"))
                                    {
                                        goto IL_932;
                                    }
                                    tName += NameGenerator.addConsonant(pAsset.consonants, true);
                                    goto IL_932;
                                }
                                else
                                {
                                    if (!(tMain == "special2"))
                                    {
                                        goto IL_932;
                                    }
                                    tName += pAsset.special2.GetRandom<string>();
                                    goto IL_932;
                                }
                            }
                            else
                            {
                                if (!(tMain == "special1"))
                                {
                                    goto IL_932;
                                }
                                tName += pAsset.special1.GetRandom<string>();
                                goto IL_932;
                            }
                        }
                        else if (num != 467038368U)
                        {
                            if (num != 621580159U)
                            {
                                if (num != 717708808U)
                                {
                                    goto IL_932;
                                }
                                if (!(tMain == "Part_group"))
                                {
                                    goto IL_932;
                                }
                                goto IL_806;
                            }
                            else if (!(tMain == " "))
                            {
                                goto IL_932;
                            }
                        }
                        else
                        {
                            if (!(tMain == "number"))
                            {
                                goto IL_932;
                            }
                            tName += Randy.randomInt(0, 10).ToString();
                            goto IL_932;
                        }
                    }
                    else if (num <= 1417423114U)
                    {
                        if (num != 737585510U)
                        {
                            if (num != 894689925U)
                            {
                                if (num != 1417423114U)
                                {
                                    goto IL_932;
                                }
                                if (!(tMain == "Letters"))
                                {
                                    goto IL_932;
                                }
                                string[] tNumbers2 = tLastPart.Split('-', StringSplitOptions.None);
                                tName += NameGenerator.addWord(pAsset, int.Parse(tNumbers2[0]), int.Parse(tNumbers2[1]), true);
                                goto IL_932;
                            }
                            else if (!(tMain == "space"))
                            {
                                goto IL_932;
                            }
                        }
                        else
                        {
                            if (!(tMain == "vowel"))
                            {
                                goto IL_932;
                            }
                            tName += NameGenerator.addVowel(pAsset.vowels, false);
                            goto IL_932;
                        }
                    }
                    else if (num != 1431138378U)
                    {
                        if (num != 2088252948U)
                        {
                            if (num != 2267396087U)
                            {
                                goto IL_932;
                            }
                            if (!(tMain == "removalchance"))
                            {
                                goto IL_932;
                            }
                            if (Randy.randomBool())
                            {
                                tName.Remove(tName.Length - 1);
                                goto IL_932;
                            }
                            goto IL_932;
                        }
                        else
                        {
                            if (!(tMain == "part"))
                            {
                                goto IL_932;
                            }
                            tName += pAsset.parts.GetRandom<string>();
                            goto IL_932;
                        }
                    }
                    else
                    {
                        if (!(tMain == "consonant"))
                        {
                            goto IL_932;
                        }
                        tName += NameGenerator.addConsonant(pAsset.consonants, false);
                        goto IL_932;
                    }
                    tName += " ";
                    goto IL_932;
                }
                if (num <= 2524959326U)
                {
                    if (num <= 2312965761U)
                    {
                        if (num != 2287153481U)
                        {
                            if (num != 2296188142U)
                            {
                                if (num != 2312965761U)
                                {
                                    goto IL_932;
                                }
                                if (!(tMain == "part_group3"))
                                {
                                    goto IL_932;
                                }
                                goto IL_7BC;
                            }
                            else if (!(tMain == "part_group2"))
                            {
                                goto IL_932;
                            }
                        }
                        else
                        {
                            if (!(tMain == "addition_ending"))
                            {
                                goto IL_932;
                            }
                            if (!tAdditionAdded && Randy.randomChance(pAsset.add_addition_chance))
                            {
                                tName = tName + " " + pAsset.addition_ending.GetRandom<string>();
                                tAdditionAdded = true;
                                goto IL_932;
                            }
                            goto IL_932;
                        }
                    }
                    else if (num != 2446939470U)
                    {
                        if (num != 2463717089U)
                        {
                            if (num != 2524959326U)
                            {
                                goto IL_932;
                            }
                            if (!(tMain == "vowelchance"))
                            {
                                goto IL_932;
                            }
                            if (Randy.randomBool())
                            {
                                tName += NameGenerator.addVowel(pAsset.vowels, false);
                                goto IL_932;
                            }
                            goto IL_932;
                        }
                        else
                        {
                            if (!(tMain == "Part_group3"))
                            {
                                goto IL_932;
                            }
                            goto IL_8CF;
                        }
                    }
                    else
                    {
                        if (!(tMain == "Part_group2"))
                        {
                            goto IL_932;
                        }
                        goto IL_86C;
                    }
                }
                else if (num <= 3814285364U)
                {
                    if (num != 3159231528U)
                    {
                        if (num != 3552634630U)
                        {
                            if (num != 3814285364U)
                            {
                                goto IL_932;
                            }
                            if (!(tMain == "Part"))
                            {
                                goto IL_932;
                            }
                            string tPart = pAsset.parts.GetRandom<string>();
                            tPart = NameGenerator.firstToUpper(tPart);
                            tName += tPart;
                            goto IL_932;
                        }
                        else
                        {
                            if (!(tMain == "VOWEL"))
                            {
                                goto IL_932;
                            }
                            tName += NameGenerator.addVowel(pAsset.vowels, true);
                            goto IL_932;
                        }
                    }
                    else
                    {
                        if (!(tMain == "part_group"))
                        {
                            goto IL_932;
                        }
                        using (List<string>.Enumerator enumerator = pAsset.part_groups.GetEnumerator())
                        {
                            while (enumerator.MoveNext())
                            {
                                string text = enumerator.Current;
                                string[] tGroupParts = text.Split(',', StringSplitOptions.None);
                                tName += tGroupParts.GetRandom<string>();
                            }
                            goto IL_932;
                        }
                    }
                }
                else if (num != 3890148115U)
                {
                    if (num != 4018923290U)
                    {
                        if (num != 4153687146U)
                        {
                            goto IL_932;
                        }
                        if (!(tMain == "letters"))
                        {
                            goto IL_932;
                        }
                        string[] tNumbers3 = tLastPart.Split('-', StringSplitOptions.None);
                        tName += NameGenerator.addWord(pAsset, int.Parse(tNumbers3[0]), int.Parse(tNumbers3[1]), false);
                        goto IL_932;
                    }
                    else
                    {
                        if (!(tMain == "addition_start"))
                        {
                            goto IL_932;
                        }
                        if (!tAdditionAdded && Randy.randomChance(pAsset.add_addition_chance))
                        {
                            tName = tName + pAsset.addition_start.GetRandom<string>() + " ";
                            tAdditionAdded = true;
                            goto IL_932;
                        }
                        goto IL_932;
                    }
                }
                else
                {
                    if (!(tMain == "RANDOM_LETTER"))
                    {
                        goto IL_932;
                    }
                    if (Randy.randomBool())
                    {
                        tName += NameGenerator.addVowel(pAsset.vowels, true);
                        goto IL_932;
                    }
                    tName += NameGenerator.addConsonant(pAsset.consonants, true);
                    goto IL_932;
                }
                using (List<string>.Enumerator enumerator = pAsset.part_groups2.GetEnumerator())
                {
                    while (enumerator.MoveNext())
                    {
                        string text2 = enumerator.Current;
                        string[] tGroupParts2 = text2.Split(',', StringSplitOptions.None);
                        tName += tGroupParts2.GetRandom<string>();
                    }
                    goto IL_932;
                }
            IL_7BC:
                using (List<string>.Enumerator enumerator = pAsset.part_groups3.GetEnumerator())
                {
                    while (enumerator.MoveNext())
                    {
                        string text3 = enumerator.Current;
                        string[] tGroupParts3 = text3.Split(',', StringSplitOptions.None);
                        tName += tGroupParts3.GetRandom<string>();
                    }
                    goto IL_932;
                }
            IL_806:
                bool tMakeUpper = true;
                using (List<string>.Enumerator enumerator = pAsset.part_groups.GetEnumerator())
                {
                    while (enumerator.MoveNext())
                    {
                        string text4 = enumerator.Current;
                        string[] tGroupParts4 = text4.Split(',', StringSplitOptions.None);
                        if (tMakeUpper)
                        {
                            tName += NameGenerator.firstToUpper(tGroupParts4.GetRandom<string>());
                            tMakeUpper = false;
                        }
                        else
                        {
                            tName += tGroupParts4.GetRandom<string>();
                        }
                    }
                    goto IL_932;
                }
            IL_86C:
                tMakeUpper = true;
                using (List<string>.Enumerator enumerator = pAsset.part_groups2.GetEnumerator())
                {
                    while (enumerator.MoveNext())
                    {
                        string text5 = enumerator.Current;
                        string[] tGroupParts5 = text5.Split(',', StringSplitOptions.None);
                        if (tMakeUpper)
                        {
                            tName += NameGenerator.firstToUpper(tGroupParts5.GetRandom<string>());
                            tMakeUpper = false;
                        }
                        else
                        {
                            tName += tGroupParts5.GetRandom<string>();
                        }
                    }
                    goto IL_932;
                }
            IL_8CF:
                tMakeUpper = true;
                foreach (string text6 in pAsset.part_groups3)
                {
                    string[] tGroupParts6 = text6.Split(',', StringSplitOptions.None);
                    if (tMakeUpper)
                    {
                        tName += NameGenerator.firstToUpper(tGroupParts6.GetRandom<string>());
                        tMakeUpper = false;
                    }
                    else
                    {
                        tName += tGroupParts6.GetRandom<string>();
                    }
                }
            }
        IL_932:;
        }
        if (tName.Contains('$'))
        {
            if (pTestReplacer)
            {
                NameGeneratorReplacers.replacer_debug(ref tName);
            }
            else
            {
                if (pAsset.replacer != null)
                {
                    pAsset.replacer(ref tName, pActor);
                }
                if (pAsset.replacer_kingdom != null)
                {
                    pAsset.replacer_kingdom(ref tName, pKingdom);
                }
            }
        }
        bool tRedo = false;
        if (string.IsNullOrEmpty(tName))
        {
            tRedo = true;
        }
        else if (!pAsset.use_dictionary && !pIgnoreBlacklist && Blacklist.checkBlackList(tName))
        {
            tRedo = true;
        }
        if (tRedo)
        {
            return NameGenerator.generateNameFromTemplate(pAsset, pActor, pKingdom, pForceLegacy, ++pCalls, pOnomasticsTemplate, pClassicTemplate, pTestReplacer, null, ActorSex.None, false);
        }
        tName = NameGenerator.firstToUpper(tName);
        if (pAsset.finalizer != null)
        {
            tName = pAsset.finalizer(tName);
        }
        if (NameGenerator._dict_splitted_items != null)
        {
            foreach (ListPool<string> listPool in NameGenerator._dict_splitted_items.Values)
            {
                listPool.Dispose();
            }
            NameGenerator._dict_splitted_items.Clear();
            UnsafeCollectionPool<Dictionary<string, ListPool<string>>, KeyValuePair<string, ListPool<string>>>.Release(NameGenerator._dict_splitted_items);
            NameGenerator._dict_splitted_items = null;
        }
        return tName;
    }

    // Token: 0x060021BE RID: 8638 RVA: 0x0011D7DC File Offset: 0x0011B9DC
    private static string addWord(NameGeneratorAsset pAsset, int pMin, int pMax, bool pToUpperFirst = false)
    {
        string tName = "";
        int tWidth = Randy.randomInt(pMin, pMax);
        for (int i = 0; i < tWidth; i++)
        {
            if (NameGenerator._current_consonants >= pAsset.max_consonants_in_row)
            {
                tName += NameGenerator.addVowel(pAsset.vowels, pToUpperFirst);
                pToUpperFirst = false;
            }
            else if (NameGenerator._current_vowels >= pAsset.max_vowels_in_row)
            {
                tName += NameGenerator.addConsonant(pAsset.consonants, pToUpperFirst);
                pToUpperFirst = false;
            }
            else if (Randy.randomBool())
            {
                tName += NameGenerator.addVowel(pAsset.vowels, pToUpperFirst);
                pToUpperFirst = false;
            }
            else
            {
                tName += NameGenerator.addConsonant(pAsset.consonants, pToUpperFirst);
                pToUpperFirst = false;
            }
        }
        return tName;
    }

    // Token: 0x040018F7 RID: 6391
    private static int _current_consonants = 0;

    // Token: 0x040018F8 RID: 6392
    private static int _current_vowels = 0;

    // Token: 0x040018F9 RID: 6393
    private static readonly char[] vowels_all = new char[] { 'a', 'e', 'i', 'o', 'u', 'y' };

    // Token: 0x040018FA RID: 6394
    private static readonly char[] consonants_all = new char[]
    {
        'b', 'c', 'd', 'f', 'g', 'h', 'j', 'k', 'l', 'm',
        'n', 'p', 'q', 'r', 's', 't', 'v', 'w', 'x', 'z'
    };

    // Token: 0x040018FB RID: 6395
    private static bool _initiated = false;

    // Token: 0x040018FC RID: 6396
    [ThreadStatic]
    private static Dictionary<string, ListPool<string>> _dict_splitted_items;
}
using System;
using System.Collections.Generic;

// Token: 0x0200013C RID: 316
[Serializable]
public class NameSetsLibrary : AssetLibrary<NameSetAsset>
{
    // Token: 0x0600097F RID: 2431 RVA: 0x0008A257 File Offset: 0x00088457
    public override void init()
    {
        base.init();
        this.addHumanLike();
        this.addFantasyRaces();
        this.addAnimalRaces();
        this.addMobRaces();
    }

    // Token: 0x06000980 RID: 2432 RVA: 0x0008A278 File Offset: 0x00088478
    private void addMobRaces()
    {
        this.add(new NameSetAsset
        {
            id = "default_set",
            city = "default_name",
            clan = "default_name",
            culture = "default_name",
            family = "default_name",
            kingdom = "default_name",
            language = "default_name",
            unit = "default_name",
            religion = "default_name"
        });
        this.add(new NameSetAsset
        {
            id = "cold_one_set",
            city = "cold_one_name",
            clan = "cold_one_name",
            culture = "cold_one_name",
            family = "cold_one_name",
            kingdom = "cold_one_name",
            language = "cold_one_name",
            unit = "cold_one_name",
            religion = "cold_one_name"
        });
        this.add(new NameSetAsset
        {
            id = "necromancer_set",
            city = "necromancer_name",
            clan = "necromancer_name",
            culture = "necromancer_name",
            family = "necromancer_name",
            kingdom = "necromancer_name",
            language = "necromancer_name",
            unit = "necromancer_name",
            religion = "necromancer_name"
        });
        this.add(new NameSetAsset
        {
            id = "druid_set",
            city = "flower_name",
            clan = "flower_name",
            culture = "flower_name",
            family = "flower_name",
            kingdom = "flower_name",
            language = "flower_name",
            unit = "flower_name",
            religion = "flower_name"
        });
        this.add(new NameSetAsset
        {
            id = "plague_doctor_set",
            city = "white_mage_name",
            clan = "white_mage_name",
            culture = "white_mage_name",
            family = "white_mage_name",
            kingdom = "white_mage_name",
            language = "white_mage_name",
            unit = "white_mage_name",
            religion = "white_mage_name"
        });
        this.add(new NameSetAsset
        {
            id = "white_mage_set",
            city = "white_mage_name",
            clan = "white_mage_name",
            culture = "white_mage_name",
            family = "white_mage_name",
            kingdom = "white_mage_name",
            language = "white_mage_name",
            unit = "white_mage_name",
            religion = "white_mage_name"
        });
        this.add(new NameSetAsset
        {
            id = "evil_mage_set",
            city = "evil_mage_name",
            clan = "evil_mage_name",
            culture = "evil_mage_name",
            family = "evil_mage_name",
            kingdom = "evil_mage_name",
            language = "evil_mage_name",
            unit = "evil_mage_name",
            religion = "evil_mage_name"
        });
        this.add(new NameSetAsset
        {
            id = "skeleton_set",
            city = "skeleton_name",
            clan = "skeleton_name",
            culture = "skeleton_name",
            family = "skeleton_name",
            kingdom = "skeleton_name",
            language = "skeleton_name",
            unit = "skeleton_name",
            religion = "skeleton_name"
        });
        this.add(new NameSetAsset
        {
            id = "jumpy_skull_set",
            city = "jumpy_skull_name",
            clan = "jumpy_skull_name",
            culture = "jumpy_skull_name",
            family = "jumpy_skull_name",
            kingdom = "jumpy_skull_name",
            language = "jumpy_skull_name",
            unit = "jumpy_skull_name",
            religion = "jumpy_skull_name"
        });
        this.add(new NameSetAsset
        {
            id = "fire_skull_set",
            city = "fire_skull_name",
            clan = "fire_skull_name",
            culture = "fire_skull_name",
            family = "fire_skull_name",
            kingdom = "fire_skull_name",
            language = "fire_skull_name",
            unit = "fire_skull_name",
            religion = "fire_skull_name"
        });
        this.add(new NameSetAsset
        {
            id = "demon_set",
            city = "demon_name",
            clan = "demon_name",
            culture = "demon_name",
            family = "demon_name",
            kingdom = "demon_name",
            language = "demon_name",
            unit = "demon_name",
            religion = "demon_name"
        });
        this.add(new NameSetAsset
        {
            id = "angle_set",
            city = "angle_name",
            clan = "angle_name",
            culture = "angle_name",
            family = "angle_name",
            kingdom = "angle_name",
            language = "angle_name",
            unit = "angle_name",
            religion = "angle_name"
        });
        this.add(new NameSetAsset
        {
            id = "fairy_set",
            city = "fairy_name",
            clan = "fairy_name",
            culture = "fairy_name",
            family = "fairy_name",
            kingdom = "fairy_name",
            language = "fairy_name",
            unit = "fairy_name",
            religion = "fairy_name"
        });
        this.add(new NameSetAsset
        {
            id = "bandit_set",
            city = "bandit_name",
            clan = "bandit_name",
            culture = "bandit_name",
            family = "bandit_name",
            kingdom = "bandit_name",
            language = "bandit_name",
            unit = "bandit_name",
            religion = "bandit_name"
        });
        this.add(new NameSetAsset
        {
            id = "snowman_set",
            city = "snowman_name",
            clan = "snowman_name",
            culture = "snowman_name",
            family = "snowman_name",
            kingdom = "snowman_name",
            language = "snowman_name",
            unit = "snowman_name",
            religion = "snowman_name"
        });
        this.add(new NameSetAsset
        {
            id = "alien_set",
            city = "alien_name",
            clan = "alien_name",
            culture = "alien_name",
            family = "alien_name",
            kingdom = "alien_name",
            language = "alien_name",
            unit = "alien_name",
            religion = "alien_name"
        });
        this.add(new NameSetAsset
        {
            id = "fire_elemental_set",
            city = "fire_elemental_name",
            clan = "fire_elemental_name",
            culture = "fire_elemental_name",
            family = "fire_elemental_name",
            kingdom = "fire_elemental_name",
            language = "fire_elemental_name",
            unit = "fire_elemental_name",
            religion = "fire_elemental_name"
        });
        this.add(new NameSetAsset
        {
            id = "pumpkin_set",
            city = "lil_pumpkin_name",
            clan = "lil_pumpkin_name",
            culture = "lil_pumpkin_name",
            family = "lil_pumpkin_name",
            kingdom = "lil_pumpkin_name",
            language = "lil_pumpkin_name",
            unit = "lil_pumpkin_name",
            religion = "lil_pumpkin_name"
        });
        this.add(new NameSetAsset
        {
            id = "assimilator_set",
            city = "assimilator_name",
            clan = "assimilator_name",
            culture = "assimilator_name",
            family = "assimilator_name",
            kingdom = "assimilator_name",
            language = "assimilator_name",
            unit = "assimilator_name",
            religion = "assimilator_name"
        });
        this.add(new NameSetAsset
        {
            id = "bioblob_set",
            city = "bioblob_name",
            clan = "bioblob_name",
            culture = "bioblob_name",
            family = "bioblob_name",
            kingdom = "bioblob_name",
            language = "bioblob_name",
            unit = "bioblob_name",
            religion = "bioblob_name"
        });
        this.add(new NameSetAsset
        {
            id = "greg_set",
            city = "greg_name",
            clan = "greg_name",
            culture = "greg_name",
            family = "greg_name",
            kingdom = "greg_name",
            language = "greg_name",
            unit = "greg_name",
            religion = "greg_name"
        });
        this.add(new NameSetAsset
        {
            id = "living_plant_set",
            city = "living_plant_name",
            clan = "living_plant_name",
            culture = "living_plant_name",
            family = "living_plant_name",
            kingdom = "living_plant_name",
            language = "living_plant_name",
            unit = "living_plant_name",
            religion = "living_plant_name"
        });
        this.add(new NameSetAsset
        {
            id = "living_house_set",
            city = "living_house_name",
            clan = "living_house_name",
            culture = "living_house_name",
            family = "living_house_name",
            kingdom = "living_house_name",
            language = "living_house_name",
            unit = "living_house_name",
            religion = "living_house_name"
        });
    }

    // Token: 0x06000981 RID: 2433 RVA: 0x0008AC80 File Offset: 0x00088E80
    private void addAnimalRaces()
    {
        this.add(new NameSetAsset
        {
            id = "cat_set",
            city = "cat_name",
            clan = "cat_name",
            culture = "cat_name",
            family = "cat_name",
            kingdom = "cat_name",
            language = "cat_name",
            unit = "cat_name",
            religion = "cat_name"
        });
        this.add(new NameSetAsset
        {
            id = "wolf_set",
            city = "wolf_name",
            clan = "wolf_name",
            culture = "wolf_name",
            family = "wolf_name",
            kingdom = "wolf_name",
            language = "wolf_name",
            unit = "wolf_name",
            religion = "wolf_name"
        });
        this.add(new NameSetAsset
        {
            id = "fox_set",
            city = "fox_name",
            clan = "fox_name",
            culture = "fox_name",
            family = "fox_name",
            kingdom = "fox_name",
            language = "fox_name",
            unit = "fox_name",
            religion = "fox_name"
        });
        this.add(new NameSetAsset
        {
            id = "chicken_set",
            city = "chicken_name",
            clan = "chicken_name",
            culture = "chicken_name",
            family = "chicken_name",
            kingdom = "chicken_name",
            language = "chicken_name",
            unit = "chicken_name",
            religion = "chicken_name"
        });
        this.add(new NameSetAsset
        {
            id = "rabbit_set",
            city = "rabbit_name",
            clan = "rabbit_name",
            culture = "rabbit_name",
            family = "rabbit_name",
            kingdom = "rabbit_name",
            language = "rabbit_name",
            unit = "rabbit_name",
            religion = "rabbit_name"
        });
        this.add(new NameSetAsset
        {
            id = "monkey_set",
            city = "monkey_name",
            clan = "monkey_name",
            culture = "monkey_name",
            family = "monkey_name",
            kingdom = "monkey_name",
            language = "monkey_name",
            unit = "monkey_name",
            religion = "monkey_name"
        });
        this.add(new NameSetAsset
        {
            id = "sheep_set",
            city = "sheep_name",
            clan = "sheep_name",
            culture = "sheep_name",
            family = "sheep_name",
            kingdom = "sheep_name",
            language = "sheep_name",
            unit = "sheep_name",
            religion = "sheep_name"
        });
        this.add(new NameSetAsset
        {
            id = "cow_set",
            city = "cow_name",
            clan = "cow_name",
            culture = "cow_name",
            family = "cow_name",
            kingdom = "cow_name",
            language = "cow_name",
            unit = "cow_name",
            religion = "cow_name"
        });
        this.add(new NameSetAsset
        {
            id = "armadillo_set",
            city = "armadillo_name",
            clan = "armadillo_name",
            culture = "armadillo_name",
            family = "armadillo_name",
            kingdom = "armadillo_name",
            language = "armadillo_name",
            unit = "armadillo_name",
            religion = "armadillo_name"
        });
        this.add(new NameSetAsset
        {
            id = "bear_set",
            city = "bear_name",
            clan = "bear_name",
            culture = "bear_name",
            family = "bear_name",
            kingdom = "bear_name",
            language = "bear_name",
            unit = "bear_name",
            religion = "bear_name"
        });
        this.add(new NameSetAsset
        {
            id = "rhino_set",
            city = "rhino_name",
            clan = "rhino_name",
            culture = "rhino_name",
            family = "rhino_name",
            kingdom = "rhino_name",
            language = "rhino_name",
            unit = "rhino_name",
            religion = "rhino_name"
        });
        this.add(new NameSetAsset
        {
            id = "buffalo_set",
            city = "buffalo_name",
            clan = "buffalo_name",
            culture = "buffalo_name",
            family = "buffalo_name",
            kingdom = "buffalo_name",
            language = "buffalo_name",
            unit = "buffalo_name",
            religion = "buffalo_name"
        });
        this.add(new NameSetAsset
        {
            id = "rat_set",
            city = "rat_name",
            clan = "rat_name",
            culture = "rat_name",
            family = "rat_name",
            kingdom = "rat_name",
            language = "rat_name",
            unit = "rat_name",
            religion = "rat_name"
        });
        this.add(new NameSetAsset
        {
            id = "capybara_set",
            city = "capybara_name",
            clan = "capybara_name",
            culture = "capybara_name",
            family = "capybara_name",
            kingdom = "capybara_name",
            language = "capybara_name",
            unit = "capybara_name",
            religion = "capybara_name"
        });
        this.add(new NameSetAsset
        {
            id = "goat_set",
            city = "goat_name",
            clan = "goat_name",
            culture = "goat_name",
            family = "goat_name",
            kingdom = "goat_name",
            language = "goat_name",
            unit = "goat_name",
            religion = "goat_name"
        });
        this.add(new NameSetAsset
        {
            id = "raccoon_set",
            city = "raccoon_name",
            clan = "raccoon_name",
            culture = "raccoon_name",
            family = "raccoon_name",
            kingdom = "raccoon_name",
            language = "raccoon_name",
            unit = "raccoon_name",
            religion = "raccoon_name"
        });
        this.add(new NameSetAsset
        {
            id = "unicorn_set",
            city = "white_mage_name",
            clan = "white_mage_name",
            culture = "white_mage_name",
            family = "white_mage_name",
            kingdom = "white_mage_name",
            language = "white_mage_name",
            unit = "white_mage_name",
            religion = "white_mage_name"
        });
        this.add(new NameSetAsset
        {
            id = "seal_set",
            city = "default_name",
            clan = "default_name",
            culture = "default_name",
            family = "default_name",
            kingdom = "default_name",
            language = "default_name",
            unit = "default_name",
            religion = "default_name"
        });
        this.add(new NameSetAsset
        {
            id = "ostrich_set",
            city = "default_name",
            clan = "default_name",
            culture = "default_name",
            family = "default_name",
            kingdom = "default_name",
            language = "default_name",
            unit = "default_name",
            religion = "default_name"
        });
        this.add(new NameSetAsset
        {
            id = "scorpion_set",
            city = "scorpion_name",
            clan = "scorpion_name",
            culture = "scorpion_name",
            family = "scorpion_name",
            kingdom = "scorpion_name",
            language = "scorpion_name",
            unit = "scorpion_name",
            religion = "scorpion_name"
        });
        this.add(new NameSetAsset
        {
            id = "crab_set",
            city = "crab_name",
            clan = "crab_name",
            culture = "crab_name",
            family = "crab_name",
            kingdom = "crab_name",
            language = "crab_name",
            unit = "crab_name",
            religion = "crab_name"
        });
        this.add(new NameSetAsset
        {
            id = "penguin_set",
            city = "penguin_name",
            clan = "penguin_name",
            culture = "penguin_name",
            family = "penguin_name",
            kingdom = "penguin_name",
            language = "penguin_name",
            unit = "penguin_name",
            religion = "penguin_name"
        });
        this.add(new NameSetAsset
        {
            id = "turtle_set",
            city = "turtle_name",
            clan = "turtle_name",
            culture = "turtle_name",
            family = "turtle_name",
            kingdom = "turtle_name",
            language = "turtle_name",
            unit = "turtle_name",
            religion = "turtle_name"
        });
        this.add(new NameSetAsset
        {
            id = "crocodile_set",
            city = "crocodile_name",
            clan = "crocodile_name",
            culture = "crocodile_name",
            family = "crocodile_name",
            kingdom = "crocodile_name",
            language = "crocodile_name",
            unit = "crocodile_name",
            religion = "crocodile_name"
        });
        this.add(new NameSetAsset
        {
            id = "frog_set",
            city = "frog_name",
            clan = "frog_name",
            culture = "frog_name",
            family = "frog_name",
            kingdom = "frog_name",
            language = "frog_name",
            unit = "frog_name",
            religion = "frog_name"
        });
        this.add(new NameSetAsset
        {
            id = "piranha_set",
            city = "piranha_name",
            clan = "piranha_name",
            culture = "piranha_name",
            family = "piranha_name",
            kingdom = "piranha_name",
            language = "piranha_name",
            unit = "piranha_name",
            religion = "piranha_name"
        });
        this.add(new NameSetAsset
        {
            id = "flower_set",
            city = "flower_name",
            clan = "flower_name",
            culture = "flower_name",
            family = "flower_name",
            kingdom = "flower_name",
            language = "flower_name",
            unit = "flower_name",
            religion = "flower_name"
        });
        this.add(new NameSetAsset
        {
            id = "garlic_man_set",
            city = "garlic_name",
            clan = "garlic_name",
            culture = "garlic_name",
            family = "garlic_name",
            kingdom = "garlic_name",
            language = "garlic_name",
            unit = "garlic_name",
            religion = "garlic_name"
        });
        this.add(new NameSetAsset
        {
            id = "lemon_man_set",
            city = "lemon_name",
            clan = "lemon_name",
            culture = "lemon_name",
            family = "lemon_name",
            kingdom = "lemon_name",
            language = "lemon_name",
            unit = "lemon_name",
            religion = "lemon_name"
        });
        this.add(new NameSetAsset
        {
            id = "acid_blob_set",
            city = "acid_blob_name",
            clan = "acid_blob_name",
            culture = "acid_blob_name",
            family = "acid_blob_name",
            kingdom = "acid_blob_name",
            language = "acid_blob_name",
            unit = "acid_blob_name",
            religion = "acid_blob_name"
        });
        this.add(new NameSetAsset
        {
            id = "crystal_golem_set",
            city = "crystal_sword_name",
            clan = "crystal_sword_name",
            culture = "crystal_sword_name",
            family = "crystal_sword_name",
            kingdom = "crystal_sword_name",
            language = "crystal_sword_name",
            unit = "crystal_sword_name",
            religion = "crystal_sword_name"
        });
        this.add(new NameSetAsset
        {
            id = "crystal_sword_set",
            city = "crystal_sword_name",
            clan = "crystal_sword_name",
            culture = "crystal_sword_name",
            family = "crystal_sword_name",
            kingdom = "crystal_sword_name",
            language = "crystal_sword_name",
            unit = "crystal_sword_name",
            religion = "crystal_sword_name"
        });
        this.add(new NameSetAsset
        {
            id = "smore_set",
            city = "candy_name",
            clan = "candy_name",
            culture = "candy_name",
            family = "candy_name",
            kingdom = "candy_name",
            language = "candy_name",
            unit = "candy_name",
            religion = "candy_name"
        });
        this.add(new NameSetAsset
        {
            id = "insect_set",
            city = "bug_name",
            clan = "bug_name",
            culture = "bug_name",
            family = "bug_name",
            kingdom = "bug_name",
            language = "bug_name",
            unit = "bug_name",
            religion = "bug_name"
        });
        this.add(new NameSetAsset
        {
            id = "candy_man_set",
            city = "candy_name",
            clan = "candy_name",
            culture = "candy_name",
            family = "candy_name",
            kingdom = "candy_name",
            language = "candy_name",
            unit = "candy_name",
            religion = "candy_name"
        });
        this.add(new NameSetAsset
        {
            id = "alpaca_set",
            city = "alpaca_name",
            clan = "alpaca_name",
            culture = "alpaca_name",
            family = "alpaca_name",
            kingdom = "alpaca_name",
            language = "alpaca_name",
            unit = "alpaca_name",
            religion = "alpaca_name"
        });
        this.add(new NameSetAsset
        {
            id = "hyena_set",
            city = "hyena_city",
            clan = "hyena_name",
            culture = "hyena_name",
            family = "hyena_name",
            kingdom = "hyena_name",
            language = "hyena_name",
            unit = "hyena_name",
            religion = "hyena_name"
        });
        this.add(new NameSetAsset
        {
            id = "snake_set",
            city = "snake_city",
            clan = "snake_name",
            culture = "snake_name",
            family = "snake_name",
            kingdom = "snake_name",
            language = "snake_name",
            unit = "snake_name",
            religion = "snake_name"
        });
    }

    // Token: 0x06000982 RID: 2434 RVA: 0x0008BD08 File Offset: 0x00089F08
    private void addFantasyRaces()
    {
        this.add(new NameSetAsset
        {
            id = "dwarf_default_set",
            city = "dwarf_city",
            clan = "dwarf_clan",
            culture = "dwarf_culture",
            family = "dwarf_clan",
            kingdom = "dwarf_kingdom",
            language = "dwarf_language",
            unit = "dwarf_unit",
            religion = "dwarf_religion"
        });
        this.add(new NameSetAsset
        {
            id = "dwarf_nordic_set",
            city = "nordic_city",
            clan = "nordic_clan",
            culture = "dwarf_culture",
            family = "nordic_clan",
            kingdom = "nordic_kingdom",
            language = "dwarf_language",
            unit = "nordic_unit",
            religion = "dwarf_religion"
        });
        this.add(new NameSetAsset
        {
            id = "elf_default_set",
            city = "elf_city",
            clan = "elf_clan",
            culture = "elf_culture",
            family = "elf_clan",
            kingdom = "elf_kingdom",
            language = "elf_language",
            unit = "elf_unit",
            religion = "elf_religion"
        });
        this.add(new NameSetAsset
        {
            id = "orc_default_set",
            city = "orc_city",
            clan = "orc_clan",
            culture = "orc_culture",
            family = "orc_clan",
            kingdom = "orc_kingdom",
            language = "orc_language",
            unit = "orc_unit",
            religion = "orc_religion"
        });
    }

    // Token: 0x06000983 RID: 2435 RVA: 0x0008BED4 File Offset: 0x0008A0D4
    private void addHumanLike()
    {
        this.add(new NameSetAsset
        {
            id = "human_default_set",
            city = "human_city",
            clan = "human_clan",
            culture = "human_culture",
            family = "human_clan",
            kingdom = "human_kingdom",
            language = "human_language",
            unit = "human_unit",
            religion = "human_religion"
        });
        this.add(new NameSetAsset
        {
            id = "human_slavic_set",
            city = "slavic_city",
            clan = "slavic_clan",
            culture = "human_culture",
            family = "slavic_clan",
            kingdom = "slavic_kingdom",
            language = "human_language",
            unit = "slavic_unit",
            religion = "human_religion"
        });
        this.add(new NameSetAsset
        {
            id = "human_germanic_set",
            city = "germanic_city",
            clan = "germanic_clan",
            culture = "human_culture",
            family = "germanic_clan",
            kingdom = "germanic_kingdom",
            language = "human_language",
            unit = "germanic_unit",
            religion = "human_religion"
        });
        this.add(new NameSetAsset
        {
            id = "human_rus_set",
            city = "rus_city",
            clan = "rus_clan",
            culture = "human_culture",
            family = "rus_clan",
            kingdom = "rus_kingdom",
            language = "human_language",
            unit = "rus_unit",
            religion = "human_religion"
        });
        this.add(new NameSetAsset
        {
            id = "human_posh_set",
            city = "posh_city",
            clan = "posh_clan",
            culture = "human_culture",
            family = "posh_clan",
            kingdom = "posh_kingdom",
            language = "human_language",
            unit = "posh_unit",
            religion = "human_religion"
        });
        this.add(new NameSetAsset
        {
            id = "human_folk_set",
            city = "folk_city",
            clan = "folk_clan",
            culture = "human_culture",
            family = "folk_clan",
            kingdom = "folk_kingdom",
            language = "human_language",
            unit = "folk_unit",
            religion = "human_religion"
        });
        this.add(new NameSetAsset
        {
            id = "human_pomeranian_set",
            city = "pomeranian_city",
            clan = "pomeranian_clan",
            culture = "human_culture",
            family = "pomeranian_clan",
            kingdom = "pomeranian_kingdom",
            language = "human_language",
            unit = "pomeranian_unit",
            religion = "human_religion"
        });
        this.add(new NameSetAsset
        {
            id = "human_frankish_set",
            city = "frankish_city",
            clan = "frankish_clan",
            culture = "human_culture",
            family = "frankish_clan",
            kingdom = "frankish_kingdom",
            language = "human_language",
            unit = "frankish_unit",
            religion = "human_religion"
        });
        this.add(new NameSetAsset
        {
            id = "human_rome_set",
            city = "rome_city",
            clan = "rome_clan",
            culture = "human_culture",
            family = "rome_clan",
            kingdom = "rome_kingdom",
            language = "human_language",
            unit = "rome_unit",
            religion = "human_religion"
        });
        this.add(new NameSetAsset
        {
            id = "human_iberian_set",
            city = "iberian_city",
            clan = "iberian_clan",
            culture = "human_culture",
            family = "iberian_clan",
            kingdom = "iberian_kingdom",
            language = "human_language",
            unit = "iberian_unit",
            religion = "human_religion"
        });
        this.add(new NameSetAsset
        {
            id = "human_monolux_set",
            city = "monolux_city",
            clan = "monolux_clan",
            culture = "human_culture",
            family = "monolux_clan",
            kingdom = "monolux_kingdom",
            language = "human_language",
            unit = "monolux_unit",
            religion = "human_religion"
        });
        this.add(new NameSetAsset
        {
            id = "polynesian_set",
            city = "poly_city",
            clan = "poly_clan",
            culture = "human_culture",
            family = "poly_clan",
            kingdom = "poly_kingdom",
            language = "human_language",
            unit = "poly_unit",
            religion = "human_religion"
        });
        this.add(new NameSetAsset
        {
            id = "nomads_set",
            city = "nomad_city",
            clan = "nomad_clan",
            culture = "human_culture",
            family = "nomad_clan",
            kingdom = "nomad_kingdom",
            language = "human_language",
            unit = "nomad_unit",
            religion = "human_religion"
        });
        this.add(new NameSetAsset
        {
            id = "sino_set",
            city = "sino_city",
            clan = "sino_clan",
            culture = "human_culture",
            family = "sino_clan",
            kingdom = "sino_kingdom",
            language = "human_language",
            unit = "sino_unit",
            religion = "human_religion"
        });
        this.add(new NameSetAsset
        {
            id = "siam_set",
            city = "siam_city",
            clan = "siam_clan",
            culture = "human_culture",
            family = "siam_clan",
            kingdom = "siam_kingdom",
            language = "human_language",
            unit = "siam_unit",
            religion = "human_religion"
        });
        this.add(new NameSetAsset
        {
            id = "vishna_set",
            city = "vishna_city",
            clan = "vishna_clan",
            culture = "human_culture",
            family = "vishna_family",
            kingdom = "vishna_kingdom",
            language = "human_language",
            unit = "vishna_unit",
            religion = "human_religion"
        });
        this.add(new NameSetAsset
        {
            id = "nihon_set",
            city = "nihon_city",
            clan = "nihon_clan",
            culture = "human_culture",
            family = "nihon_clan",
            kingdom = "nihon_kingdom",
            language = "human_language",
            unit = "nihon_unit",
            religion = "human_religion"
        });
    }

    // Token: 0x06000984 RID: 2436 RVA: 0x0008C640 File Offset: 0x0008A840
    public override void editorDiagnostic()
    {
        using (ListPool<string> tMissing = new ListPool<string>(8))
        {
            using (ListPool<string> tValid = new ListPool<string>(32))
            {
                foreach (NameSetAsset tAsset in this.list)
                {
                    tMissing.Clear();
                    (AssetManager.name_generator.has(tAsset.city) ? tValid : tMissing).Add(tAsset.city);
                    (AssetManager.name_generator.has(tAsset.clan) ? tValid : tMissing).Add(tAsset.clan);
                    (AssetManager.name_generator.has(tAsset.culture) ? tValid : tMissing).Add(tAsset.culture);
                    (AssetManager.name_generator.has(tAsset.family) ? tValid : tMissing).Add(tAsset.family);
                    (AssetManager.name_generator.has(tAsset.kingdom) ? tValid : tMissing).Add(tAsset.kingdom);
                    (AssetManager.name_generator.has(tAsset.language) ? tValid : tMissing).Add(tAsset.language);
                    (AssetManager.name_generator.has(tAsset.unit) ? tValid : tMissing).Add(tAsset.unit);
                    (AssetManager.name_generator.has(tAsset.religion) ? tValid : tMissing).Add(tAsset.religion);
                    foreach (string ptr in tMissing)
                    {
                        string tMissingName = ptr;
                        BaseAssetLibrary.logAssetError("<e>" + tAsset.id + "</e>: Missing name generator", tMissingName);
                    }
                }
                foreach (string tValidName in new HashSet<string>(tValid))
                {
                    if (!AssetManager.name_generator.get(tValidName).hasOnomastics())
                    {
                        BaseAssetLibrary.logAssetError("Name generator is missing onomastics", tValidName);
                    }
                }
                base.editorDiagnostic();
            }
        }
    }
}
using System;
using ai.behaviours;

// Token: 0x0200034C RID: 844
public class AiSystemActor : AiSystem<Actor, ActorJob, BehaviourTaskActor, BehaviourActionActor, BehaviourActorCondition>
{
    // Token: 0x06001F45 RID: 8005 RVA: 0x0010E5B8 File Offset: 0x0010C7B8
    public AiSystemActor(Actor pObject)
        : base(pObject)
    {
    }
}
using System;

// Token: 0x0200034D RID: 845
public class AiSystemCity : AiSystem<City, JobCityAsset, BehaviourTaskCity, BehaviourActionCity, BehaviourCityCondition>
{
    // Token: 0x06001F46 RID: 8006 RVA: 0x0010E5C1 File Offset: 0x0010C7C1
    public AiSystemCity(City pObject)
        : base(pObject)
    {
    }
}
using System;

// Token: 0x0200034B RID: 843
public class AiSystemKingdom : AiSystem<Kingdom, KingdomJob, BehaviourTaskKingdom, BehaviourActionKingdom, BehaviourKingdomCondition>
{
    // Token: 0x06001F44 RID: 8004 RVA: 0x0010E5AF File Offset: 0x0010C7AF
    public AiSystemKingdom(Kingdom pObject)
        : base(pObject)
    {
    }
}
using System;
using System.Collections.Generic;
using UnityEngine;

// Token: 0x020004C8 RID: 1224
public class Bench
{
    // Token: 0x060027DD RID: 10205 RVA: 0x0013EBA4 File Offset: 0x0013CDA4
    public static void update()
    {
        if (!Bench.bench_enabled)
        {
            return;
        }
        Bench.finishSplitBenchmarkGroupAI();
        Bench.finishSplitBenchmarkGroup("effects_traits");
        Bench.finishSplitBenchmarkGroup("effects_items");
        if (Bench._timer_flatten > 0f)
        {
            Bench._timer_flatten -= Time.deltaTime;
            return;
        }
        Bench._timer_flatten = 0.05f;
        Bench.flatten("effects_traits");
        Bench.flatten("effects_items");
    }

    // Token: 0x060027DE RID: 10206 RVA: 0x0013EC10 File Offset: 0x0013CE10
    private static void flatten(string pID)
    {
        BenchmarkGroup tGroup;
        if (Bench.dict.TryGetValue(pID, out tGroup))
        {
            tGroup.flatten();
        }
    }

    // Token: 0x060027DF RID: 10207 RVA: 0x0013EC32 File Offset: 0x0013CE32
    private static void finishSplitBenchmarkGroupAI()
    {
    }

    // Token: 0x060027E0 RID: 10208 RVA: 0x0013EC34 File Offset: 0x0013CE34
    private static void finishSplitBenchmarkGroup(string pID)
    {
        BenchmarkGroup tGroup;
        if (!Bench.dict.TryGetValue(pID, out tGroup))
        {
            return;
        }
        double tTotal = 0.0;
        foreach (ToolBenchmarkData tData in tGroup.dict_data.Values)
        {
            tTotal += tData.latest_result;
            tData.saveAverageCounter();
        }
        Bench.benchSaveSplit(pID, tTotal, 1, "game_total");
    }

    // Token: 0x060027E1 RID: 10209 RVA: 0x0013ECBC File Offset: 0x0013CEBC
    public static void saveAverageCounter(string pID, string pGroup)
    {
        Bench.get(pID, pGroup, true).saveAverageCounter();
    }

    // Token: 0x060027E2 RID: 10210 RVA: 0x0013ECCC File Offset: 0x0013CECC
    public static BenchmarkGroup getGroup(string pID)
    {
        if (Bench.dict.ContainsKey(pID))
        {
            return Bench.dict[pID];
        }
        BenchmarkGroup tGroup = new BenchmarkGroup();
        tGroup.id = pID;
        Bench.dict.Add(pID, tGroup);
        return tGroup;
    }

    // Token: 0x060027E3 RID: 10211 RVA: 0x0013ED0C File Offset: 0x0013CF0C
    private static ToolBenchmarkData get(string pID, string pGroupID = "main", bool pNew = true)
    {
        BenchmarkGroup tGroup;
        if (!Bench.dict.TryGetValue(pGroupID, out tGroup))
        {
            tGroup = new BenchmarkGroup();
            tGroup.id = pGroupID;
            Bench.dict.Add(pGroupID, tGroup);
        }
        ToolBenchmarkData tData;
        if (!tGroup.dict_data.TryGetValue(pID, out tData) && pNew)
        {
            tData = new ToolBenchmarkData();
            tData.id = pID;
            tGroup.dict_data.Add(pID, tData);
        }
        return tData;
    }

    // Token: 0x060027E4 RID: 10212 RVA: 0x0013ED74 File Offset: 0x0013CF74
    public static double bench(string pID, string pGroupID = "main", bool pForce = false)
    {
        if (!Bench.bench_enabled && !pForce)
        {
            return 0.0;
        }
        ToolBenchmarkData toolBenchmarkData = Bench.get(pID, pGroupID, true);
        double tTime = Time.realtimeSinceStartupAsDouble;
        toolBenchmarkData.start(tTime);
        return tTime;
    }

    // Token: 0x060027E5 RID: 10213 RVA: 0x0013EDAC File Offset: 0x0013CFAC
    public static double benchEnd(string pID, string pGroupID = "main", bool pSaveCounter = false, long pCounter = 0L, bool pForce = false)
    {
        if (!Bench.bench_enabled && !pForce)
        {
            return 0.0;
        }
        ToolBenchmarkData tData = Bench.get(pID, pGroupID, true);
        double tTime = Time.realtimeSinceStartupAsDouble - tData.latest_time;
        tData.end(tTime);
        if (pSaveCounter)
        {
            tData.newCount(pCounter);
            tData.saveAverageCounter();
        }
        return tTime;
    }

    // Token: 0x060027E6 RID: 10214 RVA: 0x0013EDFB File Offset: 0x0013CFFB
    public static void benchSet(string pID, double pVal, int pCounter, string pGroupID = "main")
    {
        if (!Bench.bench_enabled)
        {
            return;
        }
        Bench.benchSave(pID, pVal, pCounter, pGroupID);
        Bench.saveAverageCounter(pID, pGroupID);
    }

    // Token: 0x060027E7 RID: 10215 RVA: 0x0013EE16 File Offset: 0x0013D016
    public static void benchSetValue(string pID, int pValue, string pGroupID = "main")
    {
        if (!Bench.bench_enabled)
        {
            return;
        }
        Bench.get(pID, pGroupID, true).newValue(pValue);
    }

    // Token: 0x060027E8 RID: 10216 RVA: 0x0013EE2E File Offset: 0x0013D02E
    public static int getBenchValue(string pID, string pGroupID = "main")
    {
        if (!Bench.bench_enabled)
        {
            return 0;
        }
        return (int)Bench.get(pID, pGroupID, true).debug_value;
    }

    // Token: 0x060027E9 RID: 10217 RVA: 0x0013EE47 File Offset: 0x0013D047
    public static double benchSave(string pID, double pValue, int pCounter, string pGroupID = "main")
    {
        if (!Bench.bench_enabled)
        {
            return 0.0;
        }
        ToolBenchmarkData toolBenchmarkData = Bench.get(pID, pGroupID, true);
        toolBenchmarkData.end(pValue);
        toolBenchmarkData.newCount((long)pCounter);
        return pValue;
    }

    // Token: 0x060027EA RID: 10218 RVA: 0x0013EE71 File Offset: 0x0013D071
    public static double benchSaveSplit(string pID, double pValue, int pCounter, string pGroupID = "main")
    {
        if (!Bench.bench_enabled)
        {
            return 0.0;
        }
        ToolBenchmarkData toolBenchmarkData = Bench.get(pID, pGroupID, true);
        toolBenchmarkData.end(pValue);
        toolBenchmarkData.newCount((long)pCounter);
        return pValue;
    }

    // Token: 0x060027EB RID: 10219 RVA: 0x0013EE9C File Offset: 0x0013D09C
    public static string getBenchResult(string pID, string pGroupID = "main", bool pAverage = true)
    {
        return Bench.getBenchResultAsDouble(pID, pGroupID, pAverage).ToString("##,0.#######");
    }

    // Token: 0x060027EC RID: 10220 RVA: 0x0013EEC0 File Offset: 0x0013D0C0
    public static double getBenchResultAsDouble(string pID, string pGroupID = "main", bool pAverage = true)
    {
        ToolBenchmarkData tData = Bench.get(pID, pGroupID, false);
        if (tData == null)
        {
            return -1.0;
        }
        if (pAverage)
        {
            return tData.getAverage();
        }
        return tData.latest_result;
    }

    // Token: 0x060027ED RID: 10221 RVA: 0x0013EEF4 File Offset: 0x0013D0F4
    public static string printableBenchResults(string pGroupID = "main", bool pAverage = false, params string[] pID)
    {
        double[] tResults = new double[pID.Length];
        double tMax = 0.0;
        double tMin = double.MaxValue;
        for (int i = 0; i < pID.Length; i++)
        {
            tResults[i] = Bench.getBenchResultAsDouble(pID[i], pGroupID, pAverage);
            if (tResults[i] > tMax)
            {
                tMax = tResults[i];
            }
            if (tResults[i] < tMin)
            {
                tMin = tResults[i];
            }
        }
        Array.Sort<double, string>(tResults, pID);
        string result;
        using (ListPool<string[]> tRow = new ListPool<string[]>())
        {
            tRow.Add(new string[] { "ID", "TIME", "PERCENT", "WINNER", "BAR" });
            tRow.Add(new string[0]);
            for (int j = 0; j < pID.Length; j++)
            {
                double tPercent = tResults[j] / tMax;
                bool tWinner = tResults[j].Equals(tMin);
                bool tLoser = tResults[j].Equals(tMax);
                string tPrefix = "";
                string tSuffix = "";
                string tBar = "";
                int tBars = (int)(tPercent * 10.0);
                for (int k = 0; k < tBars; k++)
                {
                    tBar += "■";
                }
                tBar = Toolbox.fillRight(tBar, 10, ' ');
                if (tWinner || tLoser)
                {
                    if (tWinner)
                    {
                        tPrefix = "<color=green>";
                    }
                    if (tLoser)
                    {
                        tPrefix = "<color=red>";
                    }
                    tSuffix = "</color>";
                }
                string tID = tPrefix + pID[j] + tSuffix;
                string tResult = tPrefix + tResults[j].ToString("F7") + tSuffix;
                string tPercentStr = tPrefix + tPercent.ToString("P0") + tSuffix;
                string tWinnerStr = tPrefix + (tWinner ? "WINNER" : (tLoser ? "SLOWEST" : "")) + tSuffix;
                string tBarStr = tPrefix + tBar + tSuffix;
                tRow.Add(new string[] { tID, tResult, tPercentStr, tWinnerStr, tBarStr });
            }
            result = Toolbox.printRows(tRow, "right", false);
        }
        return result;
    }

    // Token: 0x060027EE RID: 10222 RVA: 0x0013F12C File Offset: 0x0013D32C
    public static void printBenchResult(string pID, string pGroupID = "main", bool pAverage = false)
    {
        double tResultFloat = Bench.getBenchResultAsDouble(pID, pGroupID, pAverage);
        string tResult = tResultFloat.ToString("##,0.##########");
        if (tResultFloat > 0.3)
        {
            tResult = "<color=red>" + tResult + "</color>";
        }
        else if (tResultFloat > 0.1)
        {
            tResult = "<color=yellow>" + tResult + "</color>";
        }
        Debug.Log("#benchmark: <color=white>" + pID + "</color>: " + tResult);
    }

    // Token: 0x04001E68 RID: 7784
    public static bool bench_enabled = false;

    // Token: 0x04001E69 RID: 7785
    public static bool bench_ai_enabled = false;

    // Token: 0x04001E6A RID: 7786
    private static Dictionary<string, BenchmarkGroup> dict = new Dictionary<string, BenchmarkGroup>();

    // Token: 0x04001E6B RID: 7787
    private static float _timer_flatten = 0f;
}
using System;
using System.Collections.Generic;
using UnityEngine;

// Token: 0x02000041 RID: 65
public static class FPS
{
    // Token: 0x1700000E RID: 14
    // (get) Token: 0x060002DF RID: 735 RVA: 0x0001C288 File Offset: 0x0001A488
    public static int fps
    {
        get
        {
            return FPS._fps;
        }
    }

    // Token: 0x060002E0 RID: 736 RVA: 0x0001C290 File Offset: 0x0001A490
    public static string getFPS()
    {
        if (FPS._fps >= 60)
        {
            return "<color=#75D53A>" + FPS._fps.ToString() + "</color>";
        }
        if (FPS._fps >= 30)
        {
            return "<color=#F4E700>" + FPS._fps.ToString() + "</color>";
        }
        return "<color=#DB2920>" + FPS._fps.ToString() + "</color>";
    }

    // Token: 0x060002E1 RID: 737 RVA: 0x0001C2FC File Offset: 0x0001A4FC
    public static void update()
    {
        FPS._delta_time += Time.unscaledDeltaTime;
        FPS._frame_count += 1f;
        if (FPS._delta_time > 1f / FPS._update_rate)
        {
            FPS._fps = (int)(FPS._frame_count / FPS._delta_time);
            FPS._delta_time = 0f;
            FPS._frame_count = 0f;
            return;
        }
    }

    // Token: 0x060002E2 RID: 738 RVA: 0x0001C364 File Offset: 0x0001A564
    public static void debug_update()
    {
        if (!Config.game_loaded)
        {
            return;
        }
        if (SmoothLoader.isLoading())
        {
            return;
        }
        if (FPS._last_fps.Count >= 5)
        {
            return;
        }
        if (FPS._fps >= 25)
        {
            FPS._last_fps.Clear();
        }
        FPS._last_fps.Add(FPS._fps);
        if (Config.editor_mastef && FPS._last_fps.Count >= 5)
        {
            DebugConfig.createTool(AssetManager.debug_tool_library.get("Benchmark All").id, 30, -10, -1);
            DebugConfig.createTool(AssetManager.debug_tool_library.get("Benchmark Actors").id, 200, -10, -1);
        }
    }

    // Token: 0x04000256 RID: 598
    private static float _delta_time;

    // Token: 0x04000257 RID: 599
    private static float _frame_count;

    // Token: 0x04000258 RID: 600
    private static float _update_rate = 3f;

    // Token: 0x04000259 RID: 601
    private static int _fps;

    // Token: 0x0400025A RID: 602
    private const int DEBUG_FPS_THRESHOLD = 25;

    // Token: 0x0400025B RID: 603
    private static List<int> _last_fps = new List<int>(5);
}
using System;
using System.Runtime.CompilerServices;
using UnityEngine;

// Token: 0x020002AE RID: 686
public class Projectile : CoreSystemObject<ProjectileData>
{
    // Token: 0x060018F8 RID: 6392 RVA: 0x000ED264 File Offset: 0x000EB464
    protected sealed override void setDefaultValues()
    {
        base.setDefaultValues();
        this._current_scale = 0f;
        this._target_scale = 0f;
        this._is_target_reached = false;
        this._angle_horizontal = 0f;
        this._angle_vertical = 0f;
        this._timer_smoke = 0f;
        this._dead_alpha = 1f;
        this._state = ProjectileState.Active;
        this._collision_timeout = 0f;
        this._speed = 0f;
    }

    // Token: 0x060018F9 RID: 6393 RVA: 0x000ED2DD File Offset: 0x000EB4DD
    public Vector2 getStartVector()
    {
        return this._vector_start;
    }

    // Token: 0x060018FA RID: 6394 RVA: 0x000ED2E5 File Offset: 0x000EB4E5
    public Vector2 getTargetVector()
    {
        return this._vector_target;
    }

    // Token: 0x060018FB RID: 6395 RVA: 0x000ED2F0 File Offset: 0x000EB4F0
    public void start(BaseSimObject pInitiator, BaseSimObject pTargetObject, Vector3 pLaunchPosition, Vector3 pTargetPosition, string pAssetID, float pTargetPosZ = 0f, float pStartZ = 0.25f, float pForce = 0f, Action pKillAction = null, Kingdom pForcedKingdom = null)
    {
        this.by_who = pInitiator;
        this._main_target = pTargetObject;
        this._kill_action = pKillAction;
        if (this.by_who != null)
        {
            this.setStats(pInitiator.stats);
            this.kingdom = this.by_who.kingdom;
        }
        if (pForcedKingdom != null)
        {
            this.kingdom = pForcedKingdom;
        }
        this.asset = AssetManager.projectiles.get(pAssetID);
        this._speed = this.asset.speed + Randy.randomFloat(0f, this.asset.speed_random);
        if (pForce != 0f)
        {
            this._speed = pForce;
        }
        Vector3 tPos = new Vector3(pLaunchPosition.x, pLaunchPosition.y, 0f)
        {
            z = pStartZ
        };
        this._current_position_3d = tPos;
        this.calculateAngles(pLaunchPosition, pTargetPosition, tPos.z, pTargetPosZ);
        this.calculateVelocities();
        if (this.asset.frames == null || this.asset.frames.Length == 0)
        {
            this.asset.frames = SpriteTextureLoader.getSpriteList("effects/projectiles/" + this.asset.texture, false);
        }
        if (this.asset.sound_launch != string.Empty)
        {
            MusicBox.playSound(this.asset.sound_launch, pLaunchPosition.x, pLaunchPosition.y, true, false);
        }
        this._current_scale = this.asset.scale_start;
        this._target_scale = this.asset.scale_target;
        this._is_target_reached = false;
        this._dead_alpha = 1f;
        this.setState(ProjectileState.Active);
    }

    // Token: 0x060018FC RID: 6396 RVA: 0x000ED47E File Offset: 0x000EB67E
    private void calculateAngles(Vector3 pStart, Vector3 pTarget, float pStartZ, float pTargetZ)
    {
        this._vector_start = pStart;
        this._vector_target = pTarget;
        this._angle_horizontal = this.getHorizontalLaunchAngle(pStart, pTarget);
        this._angle_vertical = this.getVerticalLaunchAngle(pStart, pTarget, this._speed, pStartZ, pTargetZ);
    }

    // Token: 0x060018FD RID: 6397 RVA: 0x000ED4C0 File Offset: 0x000EB6C0
    private void calculateVelocities()
    {
        float initialSpeed = this._speed / this.asset.mass;
        this._velocity.x = initialSpeed * Mathf.Cos(this._angle_vertical) * Mathf.Cos(this._angle_horizontal);
        this._velocity.y = initialSpeed * Mathf.Cos(this._angle_vertical) * Mathf.Sin(this._angle_horizontal);
        this._velocity.z = initialSpeed * Mathf.Sin(this._angle_vertical);
    }

    // Token: 0x060018FE RID: 6398 RVA: 0x000ED540 File Offset: 0x000EB740
    private float getVerticalLaunchAngle(Vector3 pStart, Vector3 pTarget, float pForce, float pStartHeight, float pTargetHeight)
    {
        float tGravity = SimGlobals.m.gravity;
        float tDistance = Toolbox.DistVec3(pStart, pTarget);
        float tHeightDiff = pTargetHeight - pStartHeight;
        float tInitialSpeed = pForce / this.asset.mass;
        float tSpeedSquared = tInitialSpeed * tInitialSpeed;
        float tOperandA = Mathf.Pow(tInitialSpeed, 4f);
        float tOperandB = tGravity * (tGravity * tDistance * tDistance + 2f * tHeightDiff * tSpeedSquared);
        if (tOperandB > tOperandA)
        {
            return 0.7853982f;
        }
        float tRoot = Mathf.Sqrt(tOperandA - tOperandB);
        float tAngle = Mathf.Atan((tSpeedSquared + tRoot) / (SimGlobals.m.gravity * tDistance));
        float tAngle2 = Mathf.Atan((tSpeedSquared - tRoot) / (SimGlobals.m.gravity * tDistance));
        float tTimeOfFlight = 2f * tInitialSpeed * Mathf.Sin(tAngle) / tGravity;
        float tTimeOfFlight2 = 2f * tInitialSpeed * Mathf.Sin(tAngle2) / tGravity;
        float tResultAngle;
        if (this.asset.use_min_angle_height)
        {
            tResultAngle = ((tTimeOfFlight < tTimeOfFlight2) ? tAngle : tAngle2);
        }
        else if (tAngle > tAngle2)
        {
            tResultAngle = tAngle;
        }
        else
        {
            tResultAngle = tAngle2;
        }
        return tResultAngle;
    }

    // Token: 0x060018FF RID: 6399 RVA: 0x000ED639 File Offset: 0x000EB839
    private float getHorizontalLaunchAngle(Vector3 pStart, Vector3 pTarget)
    {
        return Mathf.Atan2(pTarget.y - pStart.y, pTarget.x - pStart.x);
    }

    // Token: 0x06001900 RID: 6400 RVA: 0x000ED65C File Offset: 0x000EB85C
    private void updateVelocity(float pElapsed)
    {
        this._velocity.z = this._velocity.z - SimGlobals.m.gravity * pElapsed;
        Vector3 tNewPos = this._current_position_3d + this._velocity * pElapsed;
        this._current_position_3d = tNewPos;
        float tDirectionAngle = Mathf.Atan2(this._velocity.y + this._velocity.z, this._velocity.x) * 57.29578f;
        this.rotation = Quaternion.AngleAxis(tDirectionAngle, Vector3.forward);
        if (this._current_position_3d.z <= 0f)
        {
            this._velocity.Set(0f, 0f, 0f);
            this._current_position_3d.z = 0f;
        }
        if (this._collision_timeout == 0f || this._current_position_3d.z == 0f)
        {
            AttackDataResult tAttackResult = this.checkHitOnNearbyUnits();
            switch (tAttackResult.state)
            {
                case ApplyAttackState.Hit:
                    {
                        this.setState(ProjectileState.ToRemove);
                        Action kill_action = this._kill_action;
                        if (kill_action != null)
                        {
                            kill_action();
                        }
                        this.targetReached();
                        return;
                    }
                case ApplyAttackState.Block:
                    this.getCollided(this._vector_target);
                    return;
                case ApplyAttackState.Deflect:
                    this.getDeflected(this._vector_start, tAttackResult);
                    return;
                case ApplyAttackState.Continue:
                    return;
            }
            EffectsLibrary.spawnAt("fx_miss", this._current_position_3d, 0.1f);
            if (this.asset.can_be_left_on_ground)
            {
                this.setState(ProjectileState.AlphaAnimation);
            }
            else
            {
                this.setState(ProjectileState.ToRemove);
            }
            this.targetReached();
        }
    }

    // Token: 0x06001901 RID: 6401 RVA: 0x000ED7E7 File Offset: 0x000EB9E7
    private bool isOnGround()
    {
        return this._current_position_3d.z <= 0f;
    }

    // Token: 0x06001902 RID: 6402 RVA: 0x000ED800 File Offset: 0x000EBA00
    private AttackDataResult checkHitOnNearbyUnits()
    {
        if (this._is_target_reached)
        {
            return AttackDataResult.Continue;
        }
        WorldTile tTile = World.world.GetTile((int)this._current_position_3d.x, (int)this._current_position_3d.y);
        if (tTile == null)
        {
            if (this.isOnGround())
            {
                return AttackDataResult.Miss;
            }
            return AttackDataResult.Continue;
        }
        else
        {
            if (this.by_who.isRekt())
            {
                return AttackDataResult.Miss;
            }
            EnemyFinderData tEnemyData = EnemiesFinder.findEnemiesFrom(tTile, this.kingdom, -1);
            if (!this._main_target.isRekt() && !tEnemyData.list.Contains(this._main_target))
            {
                tEnemyData.list.Add(this._main_target);
            }
            if (tEnemyData.isEmpty())
            {
                if (this.isOnGround())
                {
                    return AttackDataResult.Miss;
                }
                return AttackDataResult.Continue;
            }
            else
            {
                Vector3 tPos = this.by_who.current_position;
                BaseSimObject pInitiator = this.by_who;
                Kingdom pKingdom = this.kingdom;
                Vector3 pInitiatorPosition = tPos;
                AttackData tAttackData = new AttackData(pInitiator, tTile, this._current_position_3d, pInitiatorPosition, null, pKingdom, AttackType.Weapon, false, false, true, this.asset.id, null, 0f);
                if (this.isOnGround())
                {
                    AttackDataResult tResult = MapBox.newAttack(tAttackData);
                    if (tResult.state == ApplyAttackState.Continue)
                    {
                        tResult.state = ApplyAttackState.Miss;
                    }
                    return tResult;
                }
                foreach (BaseSimObject tSimObject in tEnemyData.list.LoopRandom<BaseSimObject>())
                {
                    AttackDataResult tResult2 = this.checkHitForUnit(tSimObject, tAttackData);
                    ApplyAttackState state = tResult2.state;
                    if (state == ApplyAttackState.Hit || state - ApplyAttackState.Block <= 1)
                    {
                        return tResult2;
                    }
                }
                return AttackDataResult.Continue;
            }
        }
    }

    // Token: 0x06001903 RID: 6403 RVA: 0x000ED9A4 File Offset: 0x000EBBA4
    private AttackDataResult checkHitForUnit(BaseSimObject pObject, AttackData pData)
    {
        if (pObject == null)
        {
            return AttackDataResult.Continue;
        }
        if (!pObject.isAlive())
        {
            return AttackDataResult.Continue;
        }
        float z = this._current_position_3d.z;
        float tObjectHeight = pObject.getHeight();
        if (Mathf.Abs(z - tObjectHeight) > 3f)
        {
            return AttackDataResult.Continue;
        }
        Vector3 tObjectCurrentPos = pObject.current_position;
        Vector3 tCurrentArrayPos3d = this._current_position_3d;
        float num = Toolbox.Dist(tCurrentArrayPos3d.x, tCurrentArrayPos3d.y + tCurrentArrayPos3d.z, tObjectCurrentPos.x, tObjectCurrentPos.y + pObject.getHeight());
        float tRad = this.asset.size + pObject.stats["size"];
        if (num > tRad)
        {
            return AttackDataResult.Continue;
        }
        return MapBox.checkAttackFor(pData, pObject);
    }

    // Token: 0x06001904 RID: 6404 RVA: 0x000EDA59 File Offset: 0x000EBC59
    public void setStats(BaseStats pStats)
    {
        this.stats.clear();
        this.stats.mergeStats(pStats, 1f);
    }

    // Token: 0x06001905 RID: 6405 RVA: 0x000EDA77 File Offset: 0x000EBC77
    public float getLaunchAngle()
    {
        return Mathf.Atan2(this._velocity.y + this._velocity.z, this._velocity.x) * 57.29578f;
    }

    // Token: 0x06001906 RID: 6406 RVA: 0x000EDAA6 File Offset: 0x000EBCA6
    private void updateScaleEffect(float pElapsed)
    {
        if (this._current_scale < this._target_scale)
        {
            this._current_scale += pElapsed * 0.2f;
            if (this._current_scale > this._target_scale)
            {
                this._current_scale = this._target_scale;
            }
        }
    }

    // Token: 0x06001907 RID: 6407 RVA: 0x000EDAE4 File Offset: 0x000EBCE4
    private void updateTrailEffect(float pElapsed)
    {
        if (!this.asset.trail_effect_enabled)
        {
            return;
        }
        if (this._timer_smoke > 0f)
        {
            this._timer_smoke -= pElapsed;
            return;
        }
        Vector3 tPos = new Vector3(this._current_position_3d.x, this._current_position_3d.y + this._current_position_3d.z, 0f);
        BaseEffect tEffect = EffectsLibrary.spawnAt(this.asset.trail_effect_id, tPos, this.asset.trail_effect_scale);
        if (this.asset.look_at_target && tEffect != null)
        {
            tEffect.transform.rotation = this.rotation;
        }
        this._timer_smoke = this.asset.trail_effect_timer;
    }

    // Token: 0x06001908 RID: 6408 RVA: 0x000EDBA0 File Offset: 0x000EBDA0
    public void update(float pElapsed)
    {
        if (this._collision_timeout > 0f)
        {
            this._collision_timeout -= pElapsed;
            if (this._collision_timeout < 0f)
            {
                this._collision_timeout = 0f;
            }
        }
        switch (this._state)
        {
            case ProjectileState.Active:
                this.updateVelocity(pElapsed);
                break;
            case ProjectileState.AlphaAnimation:
                this.updateDeadAnimation(pElapsed);
                break;
        }
        this.updateScaleEffect(pElapsed);
        this.updateTrailEffect(pElapsed);
        this.updateLightEffect(pElapsed);
    }

    // Token: 0x06001909 RID: 6409 RVA: 0x000EDC20 File Offset: 0x000EBE20
    private void updateLightEffect(float pElapsed)
    {
        if (this.asset.draw_light_area)
        {
            Vector2 tPos = new Vector2(this._current_position_3d.x, this._current_position_3d.y + this._current_position_3d.z);
            tPos.x += this.asset.draw_light_area_offset_x;
            tPos.y += this.asset.draw_light_area_offset_y;
            World.world.stack_effects.light_blobs.Add(new LightBlobData
            {
                position = tPos,
                radius = this.asset.draw_light_size
            });
        }
    }

    // Token: 0x0600190A RID: 6410 RVA: 0x000EDCC9 File Offset: 0x000EBEC9
    private void updateDeadAnimation(float pElapsed)
    {
        this._dead_alpha -= pElapsed * 0.5f;
        if (this._dead_alpha < 0f)
        {
            this.setState(ProjectileState.ToRemove);
        }
    }

    // Token: 0x0600190B RID: 6411 RVA: 0x000EDCF4 File Offset: 0x000EBEF4
    private void targetReached()
    {
        this._is_target_reached = true;
        WorldTile tTile = this.getCurrentTilePosition();
        if (tTile == null)
        {
            tTile = World.world.GetTile((int)this._vector_target.x, (int)this._vector_target.y);
        }
        if (this.asset.impact_actions != null && tTile != null && !this.asset.impact_actions(this.by_who, null, tTile))
        {
            this.reset();
            return;
        }
        Vector2 tEndPos = this.getTransformedPositionWithHeight();
        if (!string.IsNullOrEmpty(this.asset.end_effect))
        {
            EffectsLibrary.spawnAt(this.asset.end_effect, tEndPos, this.asset.end_effect_scale);
        }
        if (this.asset.sound_impact != string.Empty)
        {
            MusicBox.playSound(this.asset.sound_impact, tEndPos.x, tEndPos.y, true, false);
        }
        if (tTile != null)
        {
            if (this.asset.world_actions != null)
            {
                this.asset.world_actions(this.by_who, null, tTile);
            }
            if (this.asset.hit_freeze)
            {
                tTile.freeze(1);
                for (int i = 0; i < tTile.neighbours.Length; i++)
                {
                    WorldTile tNTile = tTile.neighbours[i];
                    if (Randy.randomBool())
                    {
                        tNTile.freeze(1);
                    }
                }
            }
            if (this.asset.hit_shake && tTile.zone.visible && MapBox.isRenderGameplay())
            {
                World.world.startShake(this.asset.shake_duration, this.asset.shake_interval, this.asset.shake_intensity, this.asset.shake_x, this.asset.shake_y);
            }
            if (this.asset.terraform_option != string.Empty)
            {
                MapAction.damageWorld(tTile, this.asset.terraform_range, AssetManager.terraform.get(this.asset.terraform_option), this.by_who);
            }
        }
        this.reset();
    }

    // Token: 0x0600190C RID: 6412 RVA: 0x000EDEE8 File Offset: 0x000EC0E8
    public void getDeflected(Vector3 pPos, AttackDataResult pDataResult)
    {
        BaseSimObject tOldTarget = World.world.units.get(pDataResult.deflected_by_who_id);
        Vector3 tCurPos = this.getCurrentPosition();
        Vector3 tTargetPos = this._vector_start;
        this.start(tOldTarget, null, tCurPos, tTargetPos, this.asset.id, this.getCurrentHeight(), this.getCurrentHeight(), this._speed, null, null);
    }

    // Token: 0x0600190D RID: 6413 RVA: 0x000EDF4C File Offset: 0x000EC14C
    public void getCollided(Vector3 pPos)
    {
        if (this.asset.trigger_on_collision)
        {
            this.targetReached();
            this.setState(ProjectileState.ToRemove);
            return;
        }
        this._collision_timeout = 1f;
        Vector3 tCurPos = this.getCurrentPosition();
        Vector3 tNewDirection = Toolbox.getNewPoint(tCurPos.x, tCurPos.y, pPos.x, pPos.y, 6f, true);
        this.start(this.by_who, null, tCurPos, tNewDirection, this.asset.id, this.getCurrentHeight() + 5f, this.getCurrentHeight(), this._speed * 0.2f, null, null);
    }

    // Token: 0x0600190E RID: 6414 RVA: 0x000EDFE9 File Offset: 0x000EC1E9
    private void setState(ProjectileState pState)
    {
        this._state = pState;
    }

    // Token: 0x0600190F RID: 6415 RVA: 0x000EDFF2 File Offset: 0x000EC1F2
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public bool isTargetReached()
    {
        return this._is_target_reached;
    }

    // Token: 0x06001910 RID: 6416 RVA: 0x000EDFFA File Offset: 0x000EC1FA
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public float getCurrentHeight()
    {
        return this._current_position_3d.z;
    }

    // Token: 0x06001911 RID: 6417 RVA: 0x000EE007 File Offset: 0x000EC207
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public Vector2 getCurrentPosition()
    {
        return this._current_position_3d;
    }

    // Token: 0x06001912 RID: 6418 RVA: 0x000EE014 File Offset: 0x000EC214
    private WorldTile getCurrentTilePosition()
    {
        return World.world.GetTile((int)this._current_position_3d.x, (int)this._current_position_3d.y);
    }

    // Token: 0x06001913 RID: 6419 RVA: 0x000EE038 File Offset: 0x000EC238
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public Vector2 getTransformedPositionWithHeight()
    {
        Vector2 tResult = this._current_position_3d;
        tResult.y += this.getCurrentHeight();
        return tResult;
    }

    // Token: 0x06001914 RID: 6420 RVA: 0x000EE063 File Offset: 0x000EC263
    public float getCurrentScale()
    {
        return this._current_scale;
    }

    // Token: 0x06001915 RID: 6421 RVA: 0x000EE06B File Offset: 0x000EC26B
    public float getAngleForShadow()
    {
        return Toolbox.getAngleDegrees(this._current_position_3d.x, this._current_position_3d.y, this._vector_target.x, this._vector_target.y);
    }

    // Token: 0x06001916 RID: 6422 RVA: 0x000EE09E File Offset: 0x000EC29E
    public override void setAlive(bool pValue)
    {
        this._alive = pValue;
    }

    // Token: 0x06001917 RID: 6423 RVA: 0x000EE0A7 File Offset: 0x000EC2A7
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public bool isFinished()
    {
        return this._state == ProjectileState.ToRemove;
    }

    // Token: 0x06001918 RID: 6424 RVA: 0x000EE0B2 File Offset: 0x000EC2B2
    public bool isDeadAnimation()
    {
        return this._state == ProjectileState.AlphaAnimation;
    }

    // Token: 0x06001919 RID: 6425 RVA: 0x000EE0BD File Offset: 0x000EC2BD
    [MethodImpl(MethodImplOptions.AggressiveInlining)]
    public bool canBeCollided()
    {
        return this.asset.can_be_collided && !this.isFinished() && !this.isTargetReached() && this._collision_timeout <= 0f;
    }

    // Token: 0x0600191A RID: 6426 RVA: 0x000EE0F2 File Offset: 0x000EC2F2
    public float getAlpha()
    {
        return this._dead_alpha;
    }

    // Token: 0x0600191B RID: 6427 RVA: 0x000EE0FA File Offset: 0x000EC2FA
    private void reset()
    {
        this._kill_action = null;
        this._collision_timeout = 0f;
        this.by_who = null;
        this._main_target = null;
        this.kingdom = null;
        this.stats.clear();
    }

    // Token: 0x0600191C RID: 6428 RVA: 0x000EE12E File Offset: 0x000EC32E
    public override void Dispose()
    {
        this.reset();
        this.asset = null;
        this.stats.reset();
        base.Dispose();
    }

    // Token: 0x04001411 RID: 5137
    internal readonly BaseStats stats = new BaseStats();

    // Token: 0x04001412 RID: 5138
    private BaseSimObject by_who;

    // Token: 0x04001413 RID: 5139
    private BaseSimObject _main_target;

    // Token: 0x04001414 RID: 5140
    internal Kingdom kingdom;

    // Token: 0x04001415 RID: 5141
    private Action _kill_action;

    // Token: 0x04001416 RID: 5142
    public ProjectileAsset asset;

    // Token: 0x04001417 RID: 5143
    private Vector2 _vector_start;

    // Token: 0x04001418 RID: 5144
    private Vector2 _vector_target;

    // Token: 0x04001419 RID: 5145
    private float _current_scale;

    // Token: 0x0400141A RID: 5146
    private float _target_scale;

    // Token: 0x0400141B RID: 5147
    private bool _is_target_reached;

    // Token: 0x0400141C RID: 5148
    private Vector3 _current_position_3d;

    // Token: 0x0400141D RID: 5149
    private float _angle_horizontal;

    // Token: 0x0400141E RID: 5150
    private float _angle_vertical;

    // Token: 0x0400141F RID: 5151
    private float _timer_smoke;

    // Token: 0x04001420 RID: 5152
    private float _dead_alpha;

    // Token: 0x04001421 RID: 5153
    private ProjectileState _state;

    // Token: 0x04001422 RID: 5154
    private float _collision_timeout;

    // Token: 0x04001423 RID: 5155
    private Vector3 _velocity;

    // Token: 0x04001424 RID: 5156
    public Quaternion rotation;

    // Token: 0x04001425 RID: 5157
    private float _speed;
}
using System;
using System.Collections.Generic;
using UnityEngine;

// Token: 0x020002B0 RID: 688
public class ProjectileManager : CoreSystemManager<Projectile, ProjectileData>
{
    // Token: 0x0600191F RID: 6431 RVA: 0x000EE169 File Offset: 0x000EC369
    public ProjectileManager()
    {
        this.type_id = "projectile";
    }

    // Token: 0x06001920 RID: 6432 RVA: 0x000EE187 File Offset: 0x000EC387
    public override void update(float pElapsed)
    {
        base.update(pElapsed);
        this.updateProjectiles(pElapsed);
        this.checkCollision();
        this.checkDead();
    }

    // Token: 0x06001921 RID: 6433 RVA: 0x000EE1A4 File Offset: 0x000EC3A4
    private void checkCollision()
    {
        if (this.list.Count < 2)
        {
            return;
        }
        for (int i = 0; i < this.list.Count - 1; i++)
        {
            Projectile tProjectile = this.list[i];
            if (tProjectile.canBeCollided())
            {
                for (int i2 = i + 1; i2 < this.list.Count; i2++)
                {
                    Projectile tProjectile2 = this.list[i2];
                    if (tProjectile2.canBeCollided() && (tProjectile.kingdom != tProjectile2.kingdom || tProjectile.kingdom.asset.always_attack_each_other))
                    {
                        Vector3 tPos = tProjectile.getTransformedPositionWithHeight();
                        Vector3 tPos2 = tProjectile2.getTransformedPositionWithHeight();
                        if (Vector3.Distance(tPos, tPos2) < 0.25f)
                        {
                            Vector3 tNewPos = (tPos + tPos2) / 2f;
                            tNewPos.y += tNewPos.z;
                            tNewPos.z = 0f;
                            EffectsLibrary.spawnAt("fx_hit", tNewPos, 0.1f);
                            tProjectile2.getCollided(tPos);
                            tProjectile.getCollided(tPos2);
                        }
                    }
                }
            }
        }
    }

    // Token: 0x06001922 RID: 6434 RVA: 0x000EE2CC File Offset: 0x000EC4CC
    private void updateProjectiles(float pElapsed)
    {
        this._kingdoms.Clear();
        List<Projectile> tList = this.list;
        for (int i = 0; i < tList.Count; i++)
        {
            Projectile tObj = tList[i];
            if (!tObj.isTargetReached())
            {
                this._kingdoms[tObj.kingdom] = true;
            }
            tObj.update(pElapsed);
        }
    }

    // Token: 0x06001923 RID: 6435 RVA: 0x000EE325 File Offset: 0x000EC525
    internal bool hasActiveProjectiles(Kingdom pKingdom)
    {
        return this._kingdoms.ContainsKey(pKingdom);
    }

    // Token: 0x06001924 RID: 6436 RVA: 0x000EE334 File Offset: 0x000EC534
    private void checkDead()
    {
        for (int i = this.list.Count - 1; i >= 0; i--)
        {
            Projectile tProjectile = this.list[i];
            if (tProjectile.isFinished())
            {
                this.removeObject(tProjectile);
            }
        }
    }

    // Token: 0x06001925 RID: 6437 RVA: 0x000EE378 File Offset: 0x000EC578
    public Projectile spawn(BaseSimObject pInitiator, BaseSimObject pTargetObject, string pAssetID, Vector3 pLaunchPosition, Vector3 pTargetPosition, float pTargetZ = 0f, float pStartPosZ = 0.25f, Action pKillAction = null, Kingdom pForcedKingdom = null)
    {
        Projectile tProjectile = base.newObject();
        if (tProjectile == null)
        {
            return null;
        }
        tProjectile.start(pInitiator, pTargetObject, pLaunchPosition, pTargetPosition, pAssetID, pTargetZ, pStartPosZ, 0f, pKillAction, pForcedKingdom);
        return tProjectile;
    }

    // Token: 0x04001426 RID: 5158
    private const float COLLISION_DISTANCE = 0.25f;

    // Token: 0x04001427 RID: 5159
    private readonly Dictionary<Kingdom, bool> _kingdoms = new Dictionary<Kingdom, bool>();
}
using System;

// Token: 0x02000074 RID: 116
public class ProjectileLibrary : AssetLibrary<ProjectileAsset>
{
    // Token: 0x06000439 RID: 1081 RVA: 0x0002C3EC File Offset: 0x0002A5EC
    public override void init()
    {
        base.init();
        this.add(new ProjectileAsset
        {
            id = "arrow",
            speed = 20f,
            texture = "arrow",
            texture_shadow = "shadows/projectiles/shadow_arrow",
            sound_launch = "event:/SFX/WEAPONS/WeaponStartArrow",
            sound_impact = "event:/SFX/HIT/HitGeneric",
            can_be_left_on_ground = true,
            can_be_blocked = true
        });
        this.add(new ProjectileAsset
        {
            id = "snowball",
            texture = "snowball",
            texture_shadow = "shadows/projectiles/shadow_snowball",
            sound_launch = "event:/SFX/WEAPONS/WeaponStartThrow",
            sound_impact = "event:/SFX/WEAPONS/WeaponSnowballLand",
            hit_freeze = true,
            can_be_blocked = true
        });
        this.add(new ProjectileAsset
        {
            id = "firebomb",
            texture = "firebomb",
            texture_shadow = "shadows/projectiles/shadow_ball",
            speed = 12f,
            trigger_on_collision = true,
            terraform_option = "demon_fireball",
            end_effect = "fx_firebomb_explosion",
            hit_shake = true,
            shake_duration = 0.01f,
            shake_interval = 0.01f,
            shake_intensity = 0.25f,
            scale_start = 0.075f,
            scale_target = 0.075f,
            draw_light_area = true,
            sound_launch = "event:/SFX/WEAPONS/WeaponStartThrow",
            terraform_range = 2
        });
        this.add(new ProjectileAsset
        {
            id = "torch",
            texture = "pr_torch",
            texture_shadow = "shadows/projectiles/shadow_ball",
            terraform_option = "torch",
            scale_start = 0.075f,
            scale_target = 0.075f,
            speed = 15f,
            terraform_range = 1,
            trigger_on_collision = true,
            draw_light_area = true,
            sound_launch = "event:/SFX/WEAPONS/WeaponStartThrow",
            sound_impact = "event:/SFX/WEAPONS/WeaponTorchLand"
        });
        this.add(new ProjectileAsset
        {
            id = "red_orb",
            speed_random = 5f,
            texture = "pr_red_orb",
            trigger_on_collision = true,
            scale_start = 0.035f,
            scale_target = 0.2f,
            sound_launch = "event:/SFX/WEAPONS/WeaponRedOrbStart",
            sound_impact = "event:/SFX/WEAPONS/WeaponRedOrbLand",
            draw_light_area = true
        });
        ProjectileAsset t = this.t;
        t.world_actions = (AttackAction)Delegate.Combine(t.world_actions, new AttackAction(ActionLibrary.burnTile));
        this.add(new ProjectileAsset
        {
            id = "freeze_orb",
            texture = "pr_freeze_orb",
            trigger_on_collision = true,
            scale_start = 0.035f,
            scale_target = 0.2f,
            sound_launch = "event:/SFX/WEAPONS/WeaponFreezeOrbStart",
            sound_impact = "event:/SFX/WEAPONS/WeaponFreezeOrbLand",
            draw_light_area = true
        });
        this.add(new ProjectileAsset
        {
            id = "green_orb",
            texture = "pr_green_orb",
            trigger_on_collision = true,
            scale_start = 0.035f,
            scale_target = 0.2f,
            sound_launch = "event:/SFX/WEAPONS/WeaponGreenOrbStart",
            sound_impact = "event:/SFX/WEAPONS/WeaponGreenOrbLand",
            draw_light_area = true
        });
        this.add(new ProjectileAsset
        {
            id = "bone",
            speed = 15f,
            texture = "pr_bone",
            texture_shadow = "shadows/projectiles/shadow_ball",
            scale_start = 0.035f,
            scale_target = 0.05f,
            sound_launch = "event:/SFX/WEAPONS/WeaponBoneProjectileStart",
            sound_impact = "event:/SFX/WEAPONS/WeaponBoneProjectileLand",
            can_be_blocked = true
        });
        this.add(new ProjectileAsset
        {
            id = "plasma_ball",
            speed = 40f,
            texture = "pr_plasma_ball",
            trigger_on_collision = true,
            trail_effect_enabled = true,
            trail_effect_id = "fx_plasma_trail",
            trail_effect_scale = 0.1f,
            trail_effect_timer = 0.1f,
            look_at_target = true,
            terraform_option = "plasma_ball",
            end_effect = "fx_plasma_ball_explosion",
            terraform_range = 2,
            draw_light_area = true,
            draw_light_size = 0.1f,
            sound_launch = "event:/SFX/WEAPONS/WeaponPlasmaBallStart",
            sound_impact = "event:/SFX/WEAPONS/WeaponPlasmaBallLand",
            scale_start = 0.035f,
            scale_target = 0.2f,
            mass = 1f
        });
        this.add(new ProjectileAsset
        {
            id = "skull",
            speed = 17f,
            texture = "pr_skull",
            animation_speed = 10f,
            trigger_on_collision = true,
            look_at_target = true,
            end_effect = "fx_cast_ground_purple",
            end_effect_scale = 0.12f,
            texture_shadow = "shadows/projectiles/shadow_ball",
            scale_start = 0.035f,
            scale_target = 0.08f,
            sound_launch = "event:/SFX/WEAPONS/WeaponBoneProjectileStart",
            sound_impact = "event:/SFX/WEAPONS/WeaponBoneProjectileLand"
        });
        this.add(new ProjectileAsset
        {
            id = "fireball",
            speed = 25f,
            texture = "fireball",
            trail_effect_enabled = true,
            trigger_on_collision = true,
            texture_shadow = "shadows/projectiles/shadow_ball",
            terraform_option = "demon_fireball",
            end_effect = "fx_fireball_explosion",
            terraform_range = 3,
            draw_light_area = true,
            draw_light_size = 0.1f,
            sound_launch = "event:/SFX/WEAPONS/WeaponFireballStart",
            sound_impact = "event:/SFX/WEAPONS/WeaponFireballLand",
            scale_start = 0.035f,
            scale_target = 0.2f
        });
        this.add(new ProjectileAsset
        {
            id = "madness_ball",
            speed = 30f,
            trigger_on_collision = true,
            texture = "madness_ball",
            terraform_option = "madness_ball",
            texture_shadow = "shadows/projectiles/shadow_ball",
            terraform_range = 3,
            scale_start = 0.035f,
            scale_target = 0.2f,
            draw_light_area = true,
            sound_launch = "event:/SFX/WEAPONS/WeaponMadnessBallStart",
            sound_impact = "event:/SFX/WEAPONS/WeaponMadnessBallLand"
        });
        this.add(new ProjectileAsset
        {
            id = "rock",
            texture = "rock",
            texture_shadow = "shadows/projectiles/shadow_snowball",
            sound_launch = "event:/SFX/WEAPONS/WeaponStartThrow",
            sound_impact = "event:/SFX/WEAPONS/WeaponRockLand",
            can_be_left_on_ground = true,
            scale_start = 0.05f,
            scale_target = 0.09f,
            can_be_blocked = true
        });
        this.add(new ProjectileAsset
        {
            id = "shotgun_bullet",
            speed = 30f,
            speed_random = 7f,
            texture = "shotgun_bullet",
            look_at_target = true,
            draw_light_area = true,
            terraform_option = "assimilator_bullet",
            sound_launch = "event:/SFX/WEAPONS/WeaponShotgunStart",
            sound_impact = "event:/SFX/WEAPONS/WeaponShotgunLand",
            scale_start = 0.035f,
            scale_target = 0.08f,
            can_be_blocked = true
        });
        this.add(new ProjectileAsset
        {
            id = "cannonball",
            speed = 25f,
            texture = "cannonball",
            texture_shadow = "shadows/projectiles/shadow_ball",
            terraform_option = "cannonball",
            terraform_range = 2,
            sound_launch = "event:/SFX/WEAPONS/WeaponShotgunStart",
            sound_impact = "event:/SFX/WEAPONS/WeaponShotgunLand",
            end_effect = "fx_firebomb_explosion",
            scale_start = 0.1f,
            scale_target = 0.1f
        });
        this.add(new ProjectileAsset
        {
            id = "acid_ball",
            speed = 25f,
            texture = "acid_ball",
            texture_shadow = "shadows/projectiles/shadow_ball",
            terraform_option = "acid_ball",
            terraform_range = 2,
            sound_impact = "event:/SFX/DROPS/DropAcid",
            end_effect = "fx_cast_top_green",
            scale_start = 0.1f,
            scale_target = 0.1f
        });
    }
}
using System;
using UnityEngine;

// Token: 0x020001BF RID: 447
public class Drop : BaseMapObject
{
    // Token: 0x06000D21 RID: 3361 RVA: 0x000B7A98 File Offset: 0x000B5C98
    private void Awake()
    {
        this._sprite_renderer = base.gameObject.GetComponent<SpriteRenderer>();
        this._sprite_animation = base.gameObject.GetComponent<SpriteAnimation>();
    }

    // Token: 0x06000D22 RID: 3362 RVA: 0x000B7ABC File Offset: 0x000B5CBC
    public void setForceSurprise()
    {
        this._force_surprise = true;
    }

    // Token: 0x06000D23 RID: 3363 RVA: 0x000B7AC8 File Offset: 0x000B5CC8
    internal void prepare()
    {
        if (!this.created)
        {
            this.create();
        }
        base.gameObject.SetActive(true);
        this.m_transform.localScale = Vector3.one;
        this.active = true;
        this._force_surprise = false;
        this._timeInAir = 0f;
        this._timeToTarget = 0f;
        this._landed = false;
        this._parabolic = false;
        this.soundOn = false;
        this._currentHeightZ = 0f;
        base.transform.rotation = Quaternion.Euler(new Vector3(0f, 0f, 0f));
        if (this.DEBUG_COLOR)
        {
            this._sprite_renderer.color = Randy.getRandomColor();
        }
    }

    // Token: 0x06000D24 RID: 3364 RVA: 0x000B7B80 File Offset: 0x000B5D80
    internal void launchStraight(WorldTile pTile, DropAsset pAsset, float zDropHeight = -1f)
    {
        this._asset = pAsset;
        if (this._asset.animation_rotation)
        {
            this._rotation_speed = Randy.randomFloat(this._asset.animation_rotation_speed_min, this._asset.animation_rotation_speed_max);
            if (Randy.randomBool())
            {
                this._rotation_speed *= -1f;
            }
        }
        if (!string.IsNullOrEmpty(this._asset.sound_launch))
        {
            MusicBox.playSound(this._asset.sound_launch, pTile, false, false);
        }
        if (this._asset.action_launch != null)
        {
            this._asset.action_launch(null, null);
        }
        this._falling_speed = this._asset.falling_speed + Randy.randomFloat(0f, this._asset.falling_speed_random);
        if (this._asset.cached_sprites == null || this._asset.cached_sprites.Length == 0)
        {
            this._asset.cached_sprites = SpriteTextureLoader.getSpriteList(this._asset.path_texture, false);
        }
        this._sprite_renderer.sharedMaterial = LibraryMaterials.instance.dict[this._asset.material];
        this._sprite_animation.setFrames(this._asset.cached_sprites);
        if (this._asset.random_flip)
        {
            this._sprite_renderer.flipX = Randy.randomBool();
        }
        if (this._asset.animated)
        {
            this._sprite_animation.isOn = true;
            this._sprite_animation.timeBetweenFrames = this._asset.animation_speed + Randy.randomFloat(0f, this._asset.animation_speed_random);
        }
        else
        {
            this._sprite_animation.isOn = false;
        }
        if (this._asset.random_frame)
        {
            this._sprite_animation.setRandomFrame();
        }
        this._sprite_animation.forceUpdateFrame();
        this.current_tile = pTile;
        if (zDropHeight != -1f)
        {
            this._currentHeightZ = zDropHeight;
        }
        else
        {
            this._currentHeightZ = (float)((int)Randy.randomFloat(pAsset.falling_height.x, pAsset.falling_height.y));
        }
        this.current_position = new Vector2(pTile.posV3.x, pTile.posV3.y);
        this._startPosition = this.current_position;
        this.updatePosition();
    }

    // Token: 0x06000D25 RID: 3365 RVA: 0x000B7DC0 File Offset: 0x000B5FC0
    public void launchParabolic(float pStartHeight, float pMinHeight, float pMaxHeight, float pMinRadius, float pMaxRadius)
    {
        Vector2 tRandomVec = Randy.randomPointOnCircle(pMinRadius, pMaxRadius);
        this._targetPosition = this._startPosition + tRandomVec;
        this._targetHeight = Randy.randomFloat(pMinHeight, pMaxHeight);
        this._startPosition.y = this._startPosition.y + pStartHeight;
        this._currentHeightZ = this._startPosition.y;
        this._timeInAir = 0f;
        if (this._scale < 1f)
        {
            this._falling_speed /= this._scale * 2f;
        }
        float tDist = Toolbox.DistVec2Float(this._startPosition, this._targetPosition);
        this._timeToTarget = (tDist + this._targetHeight * 3f) * 0.25f / this._falling_speed;
        if (this._timeToTarget < 1f)
        {
            this._timeToTarget += 0.5f;
        }
        this._parabolic = true;
        this.updatePosition();
    }

    // Token: 0x06000D26 RID: 3366 RVA: 0x000B7EA8 File Offset: 0x000B60A8
    private void updateStraightFall(float pElapsed)
    {
        float tChange = 15f * pElapsed;
        if (this._scale < 1f)
        {
            tChange *= this._falling_speed / (this._scale * 2f);
        }
        else
        {
            tChange *= this._falling_speed;
        }
        if (this._currentHeightZ < 0f)
        {
            tChange = 0f;
        }
        this._currentHeightZ -= tChange * this._scale;
        this.applyRandomXMove(tChange);
        if (this._currentHeightZ <= 0f)
        {
            this._currentHeightZ = 0f;
            this.updatePosition();
            this.current_tile = World.world.GetTile((int)this.current_position.x, (int)this.current_position.y);
            this.land();
            return;
        }
        this.updatePosition();
    }

    // Token: 0x06000D27 RID: 3367 RVA: 0x000B7F70 File Offset: 0x000B6170
    private void applyRandomXMove(float pChangeX)
    {
        if (!this._asset.falling_random_x_move)
        {
            return;
        }
        if (pChangeX <= 0f)
        {
            return;
        }
        if (Randy.randomBool())
        {
            if (Randy.randomBool())
            {
                this.current_position.x = this.current_position.x - 1f * this._scale;
                return;
            }
            this.current_position.x = this.current_position.x + 1f * this._scale;
        }
    }

    // Token: 0x06000D28 RID: 3368 RVA: 0x000B7FDC File Offset: 0x000B61DC
    private void land()
    {
        if (this._asset.action_landed != null && this.current_tile != null)
        {
            this._asset.action_landed(this.current_tile, this._asset.id);
        }
        if (this.current_tile != null)
        {
            if (this.current_tile.zone.visible && this._asset.sound_drop != string.Empty)
            {
                MusicBox.playSound(this._asset.sound_drop, this.current_tile, false, false);
            }
            if (this._force_surprise || this._asset.surprises_units)
            {
                ActionLibrary.suprisedByArchitector(null, this.current_tile);
            }
        }
        World.world.drop_manager.landDrop(this);
        this._landed = true;
    }

    // Token: 0x06000D29 RID: 3369 RVA: 0x000B80A4 File Offset: 0x000B62A4
    public override void update(float pElapsed)
    {
        if (this._landed)
        {
            return;
        }
        this._sprite_animation.update(pElapsed);
        if (this._parabolic)
        {
            this.updateParabolicFall(pElapsed);
        }
        else
        {
            this.updateStraightFall(pElapsed);
        }
        if (this._landed)
        {
            return;
        }
        if (this._asset.animation_rotation)
        {
            this.updateRotation(pElapsed);
        }
    }

    // Token: 0x06000D2A RID: 3370 RVA: 0x000B80FC File Offset: 0x000B62FC
    private void updateRotation(float pElapsed)
    {
        float tAngleZ = base.transform.rotation.eulerAngles.z + this._rotation_speed * pElapsed;
        base.transform.rotation = Quaternion.Euler(new Vector3(0f, 0f, tAngleZ));
    }

    // Token: 0x06000D2B RID: 3371 RVA: 0x000B814C File Offset: 0x000B634C
    private void updateParabolicFall(float pElapsed)
    {
        if (this._timeInAir > this._timeToTarget)
        {
            return;
        }
        this._timeInAir += pElapsed;
        if (this._timeInAir > this._timeToTarget)
        {
            this._timeInAir = this._timeToTarget;
        }
        float tTime = this._timeInAir / this._timeToTarget;
        Vector2 tParabolicPos = Toolbox.ParabolaDrag(this._startPosition, this._targetPosition, this._targetHeight, tTime);
        Vector2 tStraightLine = Vector2.Lerp(this._startPosition, this._targetPosition, tTime);
        this._currentHeightZ = tParabolicPos.y - tStraightLine.y;
        float tX = tParabolicPos.x;
        float tY = tParabolicPos.y - this._currentHeightZ;
        this.current_position.Set(tX, tY);
        if (this.current_position == this._targetPosition)
        {
            this.current_tile = World.world.GetTile((int)this._targetPosition.x, (int)this._targetPosition.y);
            this.land();
            return;
        }
        if (this._timeInAir >= this._timeToTarget)
        {
            this.current_tile = World.world.GetTile((int)this._targetPosition.x, (int)this._targetPosition.y);
            this.land();
            return;
        }
        this.updatePosition();
    }

    // Token: 0x06000D2C RID: 3372 RVA: 0x000B8288 File Offset: 0x000B6488
    private void updatePosition()
    {
        Vector3 tVec = new Vector3(this.current_position.x, this.current_position.y + this._currentHeightZ, this._currentHeightZ);
        this.m_transform.position = tVec;
    }

    // Token: 0x06000D2D RID: 3373 RVA: 0x000B82CB File Offset: 0x000B64CB
    public void setScale(Vector3 pVec)
    {
        this.m_transform.localScale = pVec;
        this._scale = pVec.x;
    }

    // Token: 0x06000D2E RID: 3374 RVA: 0x000B82E5 File Offset: 0x000B64E5
    public void makeInactive()
    {
        this.reset();
        this.active = false;
        base.gameObject.SetActive(false);
    }

    // Token: 0x06000D2F RID: 3375 RVA: 0x000B8300 File Offset: 0x000B6500
    public void reset()
    {
        this._asset = null;
        this.current_tile = null;
    }

    // Token: 0x06000D30 RID: 3376 RVA: 0x000B8310 File Offset: 0x000B6510
    private void OnDrawGizmos()
    {
        if (!this._parabolic)
        {
            return;
        }
        if (this._landed)
        {
            return;
        }
        if (this._timeToTarget == 0f)
        {
            return;
        }
        if (this._timeInAir > this._timeToTarget)
        {
            return;
        }
        if (this._gizmoColor.Equals(Vector4.zero))
        {
            this._gizmoColor = Randy.ColorHSV();
        }
        if (this._gizmoColor2.Equals(Vector4.zero))
        {
            this._gizmoColor2 = Randy.ColorHSV();
            this._gizmoColor2.a = 0.5f;
        }
        Gizmos.color = this._gizmoColor;
        Vector2 previousDrawPoint = this._startPosition;
        Vector2 previousDrawPoint2 = this._startPosition;
        int resolution = 60;
        for (int i = 1; i <= resolution; i++)
        {
            float simulationTime = (float)i / (float)resolution * this._timeToTarget;
            Vector2 currentPosition = Toolbox.ParabolaDrag(this._startPosition, this._targetPosition, this._targetHeight, simulationTime);
            Vector2 currentPosition2 = Toolbox.Parabola(this._startPosition, this._targetPosition, this._targetHeight, simulationTime);
            Gizmos.color = this._gizmoColor;
            Gizmos.DrawLine(previousDrawPoint, currentPosition);
            Gizmos.color = this._gizmoColor2;
            Gizmos.DrawLine(previousDrawPoint, currentPosition2);
            Gizmos.DrawLine(currentPosition, currentPosition2);
            Gizmos.DrawLine(previousDrawPoint2, currentPosition2);
            previousDrawPoint = currentPosition;
            previousDrawPoint2 = currentPosition2;
        }
    }

    // Token: 0x04000CF1 RID: 3313
    private readonly bool DEBUG_COLOR;

    // Token: 0x04000CF2 RID: 3314
    public int drop_index;

    // Token: 0x04000CF3 RID: 3315
    internal bool active;

    // Token: 0x04000CF4 RID: 3316
    private SpriteRenderer _sprite_renderer;

    // Token: 0x04000CF5 RID: 3317
    private SpriteAnimation _sprite_animation;

    // Token: 0x04000CF6 RID: 3318
    private float _currentHeightZ;

    // Token: 0x04000CF7 RID: 3319
    private bool _landed;

    // Token: 0x04000CF8 RID: 3320
    private DropAsset _asset;

    // Token: 0x04000CF9 RID: 3321
    internal bool soundOn;

    // Token: 0x04000CFA RID: 3322
    private bool _parabolic;

    // Token: 0x04000CFB RID: 3323
    private float _falling_speed;

    // Token: 0x04000CFC RID: 3324
    private float _scale = 1f;

    // Token: 0x04000CFD RID: 3325
    private bool _force_surprise;

    // Token: 0x04000CFE RID: 3326
    private Vector2 _targetPosition;

    // Token: 0x04000CFF RID: 3327
    private Vector2 _startPosition;

    // Token: 0x04000D00 RID: 3328
    private float _targetHeight;

    // Token: 0x04000D01 RID: 3329
    private float _timeToTarget;

    // Token: 0x04000D02 RID: 3330
    private float _timeInAir;

    // Token: 0x04000D03 RID: 3331
    private Color _gizmoColor = Vector4.zero;

    // Token: 0x04000D04 RID: 3332
    private Color _gizmoColor2 = Vector4.zero;

    // Token: 0x04000D05 RID: 3333
    private float _rotation_speed;
}
using System;
using System.Collections.Generic;
using UnityEngine;

// Token: 0x020001C0 RID: 448
public class DropManager
{
    // Token: 0x06000D32 RID: 3378 RVA: 0x000B84AC File Offset: 0x000B66AC
    public DropManager(Transform pDropContainer)
    {
        this._dropContainer = pDropContainer;
        string tPath = "effects/p_drop";
        this._original_drop = (GameObject)Resources.Load(tPath, typeof(GameObject));
    }

    // Token: 0x06000D33 RID: 3379 RVA: 0x000B84F4 File Offset: 0x000B66F4
    public Drop spawn(WorldTile pTile, string pDropID, float zHeight = -1f, float pScale = -1f)
    {
        DropAsset tAsset = AssetManager.drops.get(pDropID);
        return this.spawn(pTile, tAsset, zHeight, pScale, false);
    }

    // Token: 0x06000D34 RID: 3380 RVA: 0x000B851C File Offset: 0x000B671C
    public Drop spawn(WorldTile pTile, DropAsset pAsset, float zHeight = -1f, float pScale = -1f, bool pForceSurprise = false)
    {
        Drop tDrop = this.getObject();
        if (pForceSurprise)
        {
            tDrop.setForceSurprise();
        }
        tDrop.launchStraight(pTile, pAsset, zHeight);
        if (pScale == -1f)
        {
            pScale = pAsset.default_scale;
        }
        tDrop.setScale(new Vector3(pScale, pScale, tDrop.transform.localScale.z));
        return tDrop;
    }

    // Token: 0x06000D35 RID: 3381 RVA: 0x000B8574 File Offset: 0x000B6774
    public void spawnParabolicDrop(WorldTile pTile, string pDropID, float pStartHeight = 0f, float pMinHeight = 0f, float pMaxHeight = 0f, float pMinRadius = 0f, float pMaxRadius = 0f, float pScale = -1f)
    {
        this.spawn(pTile, pDropID, pMinHeight, pScale).launchParabolic(pStartHeight, pMinHeight, pMaxHeight, pMinRadius, pMaxRadius);
    }

    // Token: 0x06000D36 RID: 3382 RVA: 0x000B8590 File Offset: 0x000B6790
    public void clear()
    {
        List<Drop> tDrops = this._drops;
        for (int i = 0; i < tDrops.Count; i++)
        {
            tDrops[i].makeInactive();
        }
        this._activeIndex = 0;
    }

    // Token: 0x06000D37 RID: 3383 RVA: 0x000B85C8 File Offset: 0x000B67C8
    private void killObject(Drop pObject)
    {
        pObject.makeInactive();
        int tDeadIndex = pObject.drop_index - 1;
        int tAliveIndex = this._activeIndex - 1;
        List<Drop> tDrops = this._drops;
        if (tDeadIndex != tAliveIndex)
        {
            Drop tSwitchDrop = tDrops[tAliveIndex];
            tDrops[tAliveIndex] = pObject;
            tDrops[tDeadIndex] = tSwitchDrop;
            pObject.drop_index = tAliveIndex + 1;
            tSwitchDrop.drop_index = tDeadIndex + 1;
        }
        if (this._activeIndex > 0)
        {
            this._activeIndex--;
        }
    }

    // Token: 0x06000D38 RID: 3384 RVA: 0x000B863C File Offset: 0x000B683C
    public void landDrop(Drop pObject)
    {
        WorldTile tTile = pObject.current_tile;
        this.killObject(pObject);
        if (tTile == null)
        {
            return;
        }
        World.world.flash_effects.flashPixel(tTile, 14, ColorType.White);
    }

    // Token: 0x06000D39 RID: 3385 RVA: 0x000B8670 File Offset: 0x000B6870
    public Drop getObject()
    {
        List<Drop> tDrops = this._drops;
        Drop tDrop;
        if (tDrops.Count > this._activeIndex)
        {
            tDrop = tDrops[this._activeIndex];
        }
        else
        {
            tDrop = Object.Instantiate<GameObject>(this._original_drop, this._dropContainer).GetComponent<Drop>();
            tDrop.gameObject.layer = this._dropContainer.gameObject.layer;
            tDrop.transform.parent = this._dropContainer;
            tDrops.Add(tDrop);
            tDrop.drop_index = tDrops.Count;
        }
        this._activeIndex++;
        tDrop.prepare();
        return tDrop;
    }

    // Token: 0x06000D3A RID: 3386 RVA: 0x000B870C File Offset: 0x000B690C
    public void update(float pElapsed)
    {
        Bench.bench("drops", "game_total", false);
        if (this._timeout_timer > 0f)
        {
            this._timeout_timer -= World.world.delta_time;
        }
        List<Drop> tDrops = this._drops;
        for (int i = this._activeIndex - 1; i >= 0; i--)
        {
            Drop tObj = tDrops[i];
            if (tObj.created && tObj.active)
            {
                tObj.update(pElapsed);
            }
            else if (this._activeIndex == tObj.drop_index)
            {
                this._activeIndex--;
                Debug.LogError("do we ever hit this??? " + this._activeIndex.ToString());
            }
        }
        Bench.benchEnd("drops", "game_total", false, 0L, false);
    }

    // Token: 0x06000D3B RID: 3387 RVA: 0x000B87D8 File Offset: 0x000B69D8
    public void debug(DebugTool pTool)
    {
        pTool.setText("drops total", this._drops.Count.ToString() ?? "", 0f, false, 0L, false, false, "");
        pTool.setText("drops active", this._activeIndex.ToString() ?? "", 0f, false, 0L, false, false, "");
    }

    // Token: 0x06000D3C RID: 3388 RVA: 0x000B8849 File Offset: 0x000B6A49
    public int getActiveIndex()
    {
        return this._activeIndex;
    }

    // Token: 0x06000D3D RID: 3389 RVA: 0x000B8854 File Offset: 0x000B6A54
    private void debugString()
    {
        string test = "";
        for (int i = 0; i < this._drops.Count; i++)
        {
            if (this._drops[i].active)
            {
                test += "O";
            }
            else
            {
                test += "x";
            }
        }
        Debug.Log(test + " ::: " + this._activeIndex.ToString());
    }

    // Token: 0x04000D06 RID: 3334
    private List<Drop> _drops = new List<Drop>();

    // Token: 0x04000D07 RID: 3335
    private float _timeout_timer;

    // Token: 0x04000D08 RID: 3336
    private int _activeIndex;

    // Token: 0x04000D09 RID: 3337
    private GameObject _original_drop;

    // Token: 0x04000D0A RID: 3338
    private Transform _dropContainer;
}
using System;
using System.Collections.Generic;
using UnityEngine;

// Token: 0x02000040 RID: 64
public class DropsLibrary : AssetLibrary<DropAsset>
{
    // Token: 0x0600028F RID: 655 RVA: 0x00016EC8 File Offset: 0x000150C8
    public override void init()
    {
        base.init();
        this.add(new DropAsset
        {
            id = "paint",
            path_texture = "drops/drop_paint",
            animated = true,
            animation_speed = 0.03f,
            default_scale = 0.1f,
            action_landed = new DropsAction(DropsLibrary.action_paint),
            sound_drop = "event:/SFX/DROPS/DropBlessing",
            type = DropType.DropMagic
        });
        this.add(new DropAsset
        {
            id = "dust_black",
            path_texture = "drops/drop_dust_black",
            animated = true,
            animation_speed = 0.03f,
            default_scale = 0.1f,
            material = "mat_world_object_lit",
            sound_drop = "event:/SFX/DROPS/DropBlessing",
            type = DropType.DropMagic
        });
        DropAsset t = this.t;
        t.action_landed = (DropsAction)Delegate.Combine(t.action_landed, new DropsAction(DropsLibrary.action_dust_white));
        DropAsset t2 = this.t;
        t2.action_landed = (DropsAction)Delegate.Combine(t2.action_landed, new DropsAction(DropsLibrary.action_dust_red));
        DropAsset t3 = this.t;
        t3.action_landed = (DropsAction)Delegate.Combine(t3.action_landed, new DropsAction(DropsLibrary.action_dust_blue));
        DropAsset t4 = this.t;
        t4.action_landed = (DropsAction)Delegate.Combine(t4.action_landed, new DropsAction(DropsLibrary.action_dust_gold));
        DropAsset t5 = this.t;
        t5.action_landed = (DropsAction)Delegate.Combine(t5.action_landed, new DropsAction(DropsLibrary.action_dust_purple));
        DropAsset t6 = this.t;
        t6.action_landed = (DropsAction)Delegate.Combine(t6.action_landed, new DropsAction(DropsLibrary.action_dust_black));
        this.add(new DropAsset
        {
            id = "dust_white",
            path_texture = "drops/drop_dust_white",
            animated = true,
            animation_speed = 0.03f,
            default_scale = 0.1f,
            action_landed = new DropsAction(DropsLibrary.action_dust_white),
            material = "mat_world_object_lit",
            sound_drop = "event:/SFX/DROPS/DropBlessing",
            type = DropType.DropMagic
        });
        this.add(new DropAsset
        {
            id = "dust_red",
            path_texture = "drops/drop_dust_red",
            animated = true,
            animation_speed = 0.03f,
            default_scale = 0.1f,
            action_landed = new DropsAction(DropsLibrary.action_dust_red),
            material = "mat_world_object_lit",
            sound_drop = "event:/SFX/DROPS/DropBlessing",
            type = DropType.DropMagic
        });
        this.add(new DropAsset
        {
            id = "dust_blue",
            path_texture = "drops/drop_dust_blue",
            animated = true,
            animation_speed = 0.03f,
            default_scale = 0.1f,
            action_landed = new DropsAction(DropsLibrary.action_dust_blue),
            material = "mat_world_object_lit",
            sound_drop = "event:/SFX/DROPS/DropBlessing",
            type = DropType.DropMagic
        });
        this.add(new DropAsset
        {
            id = "dust_gold",
            path_texture = "drops/drop_dust_gold",
            animated = true,
            animation_speed = 0.03f,
            default_scale = 0.1f,
            action_landed = new DropsAction(DropsLibrary.action_dust_gold),
            material = "mat_world_object_lit",
            sound_drop = "event:/SFX/DROPS/DropBlessing",
            type = DropType.DropMagic
        });
        this.add(new DropAsset
        {
            id = "dust_purple",
            path_texture = "drops/drop_dust_purple",
            animated = true,
            animation_speed = 0.03f,
            default_scale = 0.1f,
            action_landed = new DropsAction(DropsLibrary.action_dust_purple),
            material = "mat_world_object_lit",
            sound_drop = "event:/SFX/DROPS/DropBlessing",
            type = DropType.DropMagic
        });
        this.add(new DropAsset
        {
            id = "gamma_rain",
            path_texture = "drops/drop_gamma_rain",
            random_frame = true,
            default_scale = 0.1f,
            action_landed = new DropsAction(DropsLibrary.action_gamma_rain),
            material = "mat_world_object_lit",
            sound_drop = "event:/SFX/DROPS/DropRainGamma",
            type = DropType.DropTraitRain
        });
        this.add(new DropAsset
        {
            id = "delta_rain",
            path_texture = "drops/drop_delta_rain",
            random_frame = true,
            default_scale = 0.1f,
            action_landed = new DropsAction(DropsLibrary.action_delta_rain),
            material = "mat_world_object_lit",
            sound_drop = "event:/SFX/DROPS/DropRainDelta",
            type = DropType.DropTraitRain
        });
        this.add(new DropAsset
        {
            id = "omega_rain",
            path_texture = "drops/drop_omega_rain",
            random_frame = true,
            default_scale = 0.1f,
            action_landed = new DropsAction(DropsLibrary.action_omega_rain),
            material = "mat_world_object_lit",
            sound_drop = "event:/SFX/DROPS/DropRainOmeaga",
            type = DropType.DropTraitRain
        });
        this.add(new DropAsset
        {
            id = "loot_rain",
            path_texture = "drops/drop_loot_rain",
            random_frame = true,
            default_scale = 0.1f,
            action_landed = new DropsAction(DropsLibrary.action_equipment_rain),
            material = "mat_world_object_lit",
            sound_drop = "event:/SFX/DROPS/DropRainGamma",
            type = DropType.DropEquipmentRain
        });
        this.add(new DropAsset
        {
            id = "tnt",
            animated = true,
            path_texture = "drops/drop_tnt",
            animation_speed = 0.03f,
            default_scale = 0.2f,
            action_landed = new DropsAction(DropsLibrary.action_tnt),
            sound_drop = "event:/SFX/DROPS/DropTnt",
            type = DropType.DropTile
        });
        this.add(new DropAsset
        {
            id = "tnt_timed",
            path_texture = "drops/drop_tnttimed",
            default_scale = 0.2f,
            action_landed = new DropsAction(DropsLibrary.action_tnt_timed),
            sound_drop = "event:/SFX/DROPS/DropTnt",
            type = DropType.DropTile
        });
        this.add(new DropAsset
        {
            id = "water_bomb",
            path_texture = "drops/drop_waterbomb",
            default_scale = 0.2f,
            action_landed = new DropsAction(DropsLibrary.action_water_bomb),
            sound_drop = "event:/SFX/DROPS/DropWaterBomb",
            type = DropType.DropTile
        });
        this.add(new DropAsset
        {
            id = "landmine",
            path_texture = "drops/drop_landmine",
            default_scale = 0.2f,
            action_landed = new DropsAction(DropsLibrary.action_landmine),
            sound_drop = "event:/SFX/DROPS/DropLandmine",
            type = DropType.DropTile
        });
        this.add(new DropAsset
        {
            id = "fireworks",
            path_texture = "drops/drop_fireworks",
            random_frame = true,
            default_scale = 0.1f,
            action_landed = new DropsAction(DropsLibrary.action_fireworks),
            sound_drop = "event:/SFX/DROPS/DropFireworks",
            type = DropType.DropTile
        });
        this.add(new DropAsset
        {
            id = "inspiration",
            path_texture = "drops/drop_inspiration",
            default_scale = 0.2f,
            action_landed = new DropsAction(DropsLibrary.action_inspiration),
            material = "mat_world_object_lit",
            sound_drop = "event:/SFX/DROPS/DropInspiration",
            type = DropType.DropMagic
        });
        this.add(new DropAsset
        {
            id = "discord",
            path_texture = "drops/drop_discord",
            default_scale = 0.2f,
            action_landed = new DropsAction(DropsLibrary.action_discord),
            material = "mat_world_object_lit",
            sound_drop = "event:/SFX/DROPS/DropInspiration",
            type = DropType.DropMagic
        });
        this.add(new DropAsset
        {
            id = "friendship",
            path_texture = "drops/drop_friendship",
            random_frame = true,
            default_scale = 0.1f,
            action_landed = new DropsAction(DropsLibrary.action_friendship),
            material = "mat_world_object_lit",
            sound_drop = "event:/SFX/DROPS/DropFriendship",
            type = DropType.DropMagic
        });
        this.add(new DropAsset
        {
            id = "spite",
            path_texture = "drops/drop_spite",
            random_frame = true,
            default_scale = 0.1f,
            action_landed = new DropsAction(DropsLibrary.action_spite),
            material = "mat_world_object_lit",
            sound_drop = "event:/SFX/DROPS/DropSpite",
            type = DropType.DropMagic
        });
        this.add(new DropAsset
        {
            id = "madness",
            path_texture = "drops/drop_madness",
            random_frame = true,
            default_scale = 0.1f,
            action_landed = new DropsAction(DropsLibrary.action_madness),
            material = "mat_world_object_lit",
            sound_drop = "event:/SFX/DROPS/DropMadness",
            type = DropType.DropTrait
        });
        this.add(new DropAsset
        {
            id = "blessing",
            path_texture = "drops/drop_blessing",
            animated = true,
            animation_speed = 0.03f,
            default_scale = 0.1f,
            action_landed = new DropsAction(DropsLibrary.action_blessing),
            material = "mat_world_object_lit",
            sound_drop = "event:/SFX/DROPS/DropBlessing",
            type = DropType.DropMagic
        });
        DropAsset t7 = this.t;
        t7.action_landed = (DropsAction)Delegate.Combine(t7.action_landed, new DropsAction(ActionLibrary.action_shrinkTornadoes));
        this.add(new DropAsset
        {
            id = "shield",
            path_texture = "drops/drop_shield",
            random_frame = true,
            default_scale = 0.1f,
            action_landed = new DropsAction(DropsLibrary.action_shield),
            material = "mat_world_object_lit",
            sound_drop = "event:/SFX/DROPS/DropShield",
            type = DropType.DropStatus
        });
        this.add(new DropAsset
        {
            id = "coffee",
            path_texture = "drops/drop_coffee",
            random_frame = true,
            default_scale = 0.1f,
            action_landed = new DropsAction(DropsLibrary.action_coffee),
            sound_drop = "event:/SFX/DROPS/DropCoffee",
            type = DropType.DropStatus
        });
        this.add(new DropAsset
        {
            id = "powerup",
            path_texture = "drops/drop_mushroom_powerup",
            random_frame = true,
            default_scale = 0.1f,
            action_landed = new DropsAction(DropsLibrary.action_powerup),
            sound_drop = "event:/SFX/DROPS/DropPowerup",
            type = DropType.DropMagic
        });
        this.add(new DropAsset
        {
            id = "curse",
            path_texture = "drops/drop_curse",
            random_frame = true,
            default_scale = 0.1f,
            action_landed = new DropsAction(DropsLibrary.action_curse),
            material = "mat_world_object_lit",
            sound_drop = "event:/SFX/DROPS/DropCurse",
            type = DropType.DropTrait
        });
        DropAsset t8 = this.t;
        t8.action_landed = (DropsAction)Delegate.Combine(t8.action_landed, new DropsAction(ActionLibrary.action_growTornadoes));
        this.add(new DropAsset
        {
            id = "spell_silence",
            path_texture = "drops/drop_spell_silence",
            random_frame = true,
            default_scale = 0.1f,
            action_landed = new DropsAction(DropsLibrary.action_spell_silence),
            material = "mat_world_object_lit",
            sound_drop = "event:/SFX/DROPS/DropCurse",
            type = DropType.DropTrait
        });
        this.add(new DropAsset
        {
            id = "zombie_infection",
            path_texture = "drops/drop_zombieinfection",
            random_frame = true,
            default_scale = 0.1f,
            action_landed = new DropsAction(DropsLibrary.action_zombie_infection),
            sound_drop = "event:/SFX/DROPS/DropZombieInfection",
            type = DropType.DropTrait
        });
        this.add(new DropAsset
        {
            id = "mush_spores",
            path_texture = "drops/drop_mushSpores",
            random_frame = true,
            default_scale = 0.1f,
            action_landed = new DropsAction(DropsLibrary.action_mush_spore),
            sound_drop = "event:/SFX/DROPS/DropMushSpores",
            type = DropType.DropTrait
        });
        this.add(new DropAsset
        {
            id = "plague",
            path_texture = "drops/drop_plague",
            random_frame = true,
            default_scale = 0.1f,
            action_landed = new DropsAction(DropsLibrary.action_plague),
            material = "mat_world_object_lit",
            sound_drop = "event:/SFX/DROPS/DropPlague",
            type = DropType.DropTrait
        });
        this.add(new DropAsset
        {
            id = "living_plants",
            path_texture = "drops/drop_blessing",
            animated = true,
            default_scale = 0.1f,
            action_landed = new DropsAction(DropsLibrary.action_living_plants),
            sound_drop = "event:/SFX/DROPS/DropLivingPlants",
            type = DropType.DropMagic
        });
        this.add(new DropAsset
        {
            id = "living_house",
            path_texture = "drops/drop_blessing",
            animated = true,
            default_scale = 0.1f,
            action_landed = new DropsAction(DropsLibrary.action_living_house),
            sound_drop = "event:/SFX/DROPS/DropLivingHouse",
            type = DropType.DropMagic
        });
        this.add(new DropAsset
        {
            id = "bomb",
            path_texture = "drops/drop_bomb",
            default_scale = 0.2f,
            falling_height = new Vector2(60f, 70f),
            sound_launch = "event:/SFX/DROPS/DropLaunchBombSmall",
            action_landed = new DropsAction(DropsLibrary.action_bomb),
            type = DropType.DropBomb
        });
        DropAsset t9 = this.t;
        t9.action_launch = (DropsAction)Delegate.Combine(t9.action_launch, new DropsAction(ActionLibrary.increaseDroppedBombsCounter));
        this.add(new DropAsset
        {
            id = "grenade",
            path_texture = "drops/drop_grenade",
            animated = true,
            default_scale = 0.2f,
            animation_speed = 0.03f,
            falling_height = new Vector2(60f, 70f),
            action_landed = new DropsAction(DropsLibrary.action_grenade),
            random_flip = true,
            sound_launch = "event:/SFX/DROPS/DropLaunchGrenade",
            type = DropType.DropBomb
        });
        this.add(new DropAsset
        {
            id = "crab_bomb",
            path_texture = "drops/drop_crab_bomb_parachute",
            animated = true,
            default_scale = 0.1f,
            animation_speed = 0.05f,
            falling_height = new Vector2(60f, 70f),
            action_landed = new DropsAction(DropsLibrary.action_crab_bomb_impact),
            random_flip = true,
            sound_launch = "event:/SFX/DROPS/DropLaunchCrabBomb",
            type = DropType.DropBomb
        });
        this.add(new DropAsset
        {
            id = "crab_bomb_shrapnel",
            path_texture = "drops/drop_crab_bomb_shrapnel",
            animated = true,
            animation_rotation = true,
            animation_rotation_speed_min = 50f,
            animation_rotation_speed_max = 200f,
            default_scale = 0.175f,
            animation_speed = 0.05f,
            falling_height = new Vector2(60f, 70f),
            action_landed = new DropsAction(DropsLibrary.action_crab_bomb_shrapnel),
            random_flip = true,
            sound_launch = "event:/SFX/DROPS/DropLaunchCrabBomb",
            type = DropType.DropBomb,
            surprises_units = true
        });
        this.add(new DropAsset
        {
            id = "napalm_bomb",
            path_texture = "drops/drop_napalmbomb",
            default_scale = 0.2f,
            falling_height = new Vector2(60f, 70f),
            action_landed = new DropsAction(DropsLibrary.action_napalm_bomb),
            random_flip = true,
            type = DropType.DropBomb
        });
        DropAsset t10 = this.t;
        t10.action_launch = (DropsAction)Delegate.Combine(t10.action_launch, new DropsAction(ActionLibrary.increaseDroppedBombsCounter));
        this.add(new DropAsset
        {
            id = "atomic_bomb",
            path_texture = "drops/drop_atomicbomb",
            default_scale = 0.2f,
            falling_height = new Vector2(60f, 70f),
            action_landed = new DropsAction(DropsLibrary.action_atomic_bomb),
            random_flip = true,
            sound_launch = "event:/SFX/DROPS/DropLaunchGrenadeHuge",
            type = DropType.DropBomb
        });
        DropAsset t11 = this.t;
        t11.action_launch = (DropsAction)Delegate.Combine(t11.action_launch, new DropsAction(ActionLibrary.increaseDroppedBombsCounter));
        this.add(new DropAsset
        {
            id = "antimatter_bomb",
            path_texture = "drops/drop_antimatterbomb",
            default_scale = 0.2f,
            falling_height = new Vector2(60f, 70f),
            action_landed = new DropsAction(DropsLibrary.action_antimatter_bomb),
            sound_launch = "event:/SFX/DROPS/DropLaunchGrenadeHuge",
            type = DropType.DropBomb
        });
        DropAsset t12 = this.t;
        t12.action_launch = (DropsAction)Delegate.Combine(t12.action_launch, new DropsAction(ActionLibrary.increaseDroppedBombsCounter));
        this.add(new DropAsset
        {
            id = "czar_bomba",
            path_texture = "drops/drop_czarbomba",
            default_scale = 0.2f,
            falling_height = new Vector2(60f, 70f),
            action_landed = new DropsAction(DropsLibrary.action_czar_bomba),
            sound_launch = "event:/SFX/DROPS/DropLaunchGrenadeHuge",
            type = DropType.DropBomb
        });
        DropAsset t13 = this.t;
        t13.action_launch = (DropsAction)Delegate.Combine(t13.action_launch, new DropsAction(ActionLibrary.increaseDroppedBombsCounter));
        this.add(new DropAsset
        {
            id = "rain",
            path_texture = "drops/drop_rain",
            random_frame = true,
            default_scale = 0.2f,
            falling_height = new Vector2(30f, 45f),
            action_landed = new DropsAction(DropsLibrary.action_rain),
            sound_drop = "event:/SFX/DROPS/DropRain",
            type = DropType.DropGeneric,
            surprises_units = false
        });
        this.add(new DropAsset
        {
            id = "blood_rain",
            path_texture = "drops/drop_blood",
            random_frame = true,
            default_scale = 0.1f,
            falling_height = new Vector2(30f, 45f),
            action_landed = new DropsAction(DropsLibrary.action_blood_rain),
            material = "mat_world_object_lit",
            sound_drop = "event:/SFX/DROPS/DropBloodRain",
            type = DropType.DropMagic
        });
        this.add(new DropAsset
        {
            id = "clone_rain",
            path_texture = "drops/drop_clone",
            random_frame = true,
            default_scale = 0.1f,
            falling_height = new Vector2(30f, 45f),
            action_landed = new DropsAction(DropsLibrary.action_clone_rain),
            material = "mat_world_object_lit",
            sound_drop = "event:/SFX/DROPS/DropBloodRain",
            type = DropType.DropMagic
        });
        this.add(new DropAsset
        {
            id = "jazz",
            path_texture = "drops/drop_jazz",
            random_frame = true,
            default_scale = 0.1f,
            falling_height = new Vector2(30f, 45f),
            action_landed = new DropsAction(this.action_jazz_rain),
            material = "mat_world_object_lit",
            sound_drop = "event:/SFX/DROPS/DropBloodRain",
            type = DropType.DropMagic
        });
        this.add(new DropAsset
        {
            id = "dispel",
            path_texture = "drops/drop_dispel",
            random_frame = true,
            default_scale = 0.1f,
            falling_height = new Vector2(30f, 45f),
            action_landed = new DropsAction(this.action_dispel_rain),
            material = "mat_world_object_lit",
            sound_drop = "event:/SFX/DROPS/DropBloodRain",
            type = DropType.DropMagic
        });
        this.add(new DropAsset
        {
            id = "sleep",
            path_texture = "drops/drop_sleep",
            random_frame = true,
            default_scale = 0.1f,
            falling_height = new Vector2(30f, 45f),
            action_landed = new DropsAction(this.action_sleep_rain),
            material = "mat_world_object_lit",
            sound_drop = "event:/SFX/DROPS/DropBloodRain",
            type = DropType.DropMagic
        });
        this.add(new DropAsset
        {
            id = "cure",
            path_texture = "drops/drop_cure",
            random_frame = true,
            default_scale = 0.1f,
            falling_height = new Vector2(30f, 45f),
            action_landed = new DropsAction(DropsLibrary.action_cure),
            material = "mat_world_object_lit",
            sound_drop = "event:/SFX/DROPS/DropCure",
            type = DropType.DropMagic
        });
        this.add(new DropAsset
        {
            id = "fire",
            path_texture = "drops/drop_fire",
            animated = true,
            animation_speed = 0.03f,
            default_scale = 0.2f,
            falling_height = new Vector2(30f, 45f),
            falling_random_x_move = true,
            particle_interval = 0.3f,
            action_landed = new DropsAction(DropsLibrary.action_fire),
            animation_speed_random = 0.08f,
            random_frame = true,
            random_flip = true,
            sound_drop = "event:/SFX/DROPS/DropFire",
            material = "mat_world_object_lit",
            type = DropType.DropGeneric
        });
        this.add(new DropAsset
        {
            id = "snow",
            path_texture = "drops/drop_snow",
            random_frame = true,
            default_scale = 0.2f,
            falling_speed = 0.3f,
            falling_height = new Vector2(30f, 45f),
            falling_random_x_move = true,
            particle_interval = 0.15f,
            sound_drop = "event:/SFX/DROPS/DropSnow",
            action_landed = new DropsAction(DropsLibrary.action_snow),
            type = DropType.DropGeneric
        });
        this.add(new DropAsset
        {
            id = "life_seed",
            path_texture = "drops/drop_life_seed",
            random_frame = true,
            default_scale = 0.2f,
            falling_speed = 0.3f,
            falling_height = new Vector2(30f, 45f),
            falling_random_x_move = true,
            particle_interval = 0.15f,
            sound_drop = "event:/SFX/DROPS/DropSeedGrass",
            action_landed = new DropsAction(DropsLibrary.action_life_seed),
            type = DropType.DropGeneric
        });
        this.add(new DropAsset
        {
            id = "ash",
            path_texture = "drops/drop_ash",
            random_frame = true,
            default_scale = 0.2f,
            falling_speed = 0.3f,
            falling_height = new Vector2(30f, 45f),
            falling_random_x_move = true,
            particle_interval = 0.15f,
            sound_drop = "event:/SFX/DROPS/DropAsh",
            action_landed = new DropsAction(DropsLibrary.action_ash),
            type = DropType.DropMagic
        });
        this.add(new DropAsset
        {
            id = "magic_rain",
            path_texture = "drops/drop_magic_rain",
            random_frame = true,
            default_scale = 0.2f,
            falling_speed = 0.3f,
            falling_height = new Vector2(30f, 45f),
            falling_random_x_move = true,
            particle_interval = 0.15f,
            sound_drop = "event:/SFX/DROPS/DropMagicRain",
            action_landed = new DropsAction(DropsLibrary.action_magic_rain),
            type = DropType.DropMagic
        });
        this.add(new DropAsset
        {
            id = "rage",
            path_texture = "drops/drop_rage",
            random_frame = true,
            default_scale = 0.2f,
            falling_speed = 0.3f,
            falling_height = new Vector2(30f, 45f),
            falling_random_x_move = true,
            particle_interval = 0.15f,
            sound_drop = "event:/SFX/DROPS/DropRage",
            action_landed = new DropsAction(DropsLibrary.action_rage),
            type = DropType.DropStatus
        });
        this.add(new DropAsset
        {
            id = "acid",
            path_texture = "drops/drop_acid",
            random_frame = true,
            default_scale = 0.2f,
            falling_height = new Vector2(30f, 45f),
            action_landed = new DropsAction(DropsLibrary.action_acid),
            material = "mat_world_object_lit",
            sound_drop = "event:/SFX/DROPS/DropAcid",
            type = DropType.DropMagic
        });
        this.add(new DropAsset
        {
            id = "lava",
            path_texture = "drops/drop_lava",
            animated = true,
            animation_speed = 0.03f,
            default_scale = 0.2f,
            falling_height = new Vector2(30f, 45f),
            action_landed = new DropsAction(DropsLibrary.action_lava),
            material = "mat_world_object_lit",
            sound_drop = "event:/SFX/DROPS/DropLava",
            type = DropType.DropGeneric
        });
        this.add(new DropAsset
        {
            id = "santa_bomb",
            path_texture = "drops/drop_santabomb",
            random_frame = true,
            default_scale = 0.2f,
            sound_launch = "event:/SFX/DROPS/DropLaunchSantaBomb",
            action_landed = new DropsAction(DropsLibrary.action_santa_bomb),
            type = DropType.DropBomb,
            surprises_units = true
        });
        this.add(new DropAsset
        {
            id = "$spawn_building$",
            path_texture = "drops/drop_stone",
            random_frame = true,
            default_scale = 0.2f,
            falling_height = new Vector2(10f, 15f),
            falling_speed = 5f,
            type = DropType.DropBuilding
        });
        this.t.action_landed = new DropsAction(DropsLibrary.action_spawn_building);
        this.clone("$biome_seeds$", "$spawn_building$");
        this.t.type = DropType.DropSeed;
        this.t.action_landed = null;
        this.clone("seeds_grass", "$biome_seeds$");
        this.t.path_texture = "drops/drop_seed_grass";
        this.t.falling_speed = 3f;
        this.t.action_landed = new DropsAction(DropsLibrary.action_drop_seeds);
        this.t.drop_type_low = "grass_low";
        this.t.drop_type_high = "grass_high";
        this.t.sound_drop = "event:/SFX/DROPS/DropSeedGrass";
        this.clone("seeds_enchanted", "$biome_seeds$");
        this.t.path_texture = "drops/drop_seed_enchanted";
        this.t.falling_speed = 3f;
        this.t.action_landed = new DropsAction(DropsLibrary.action_drop_seeds);
        this.t.drop_type_low = "enchanted_low";
        this.t.drop_type_high = "enchanted_high";
        this.t.sound_drop = "event:/SFX/DROPS/DropSeedEnchanted";
        this.clone("seeds_savanna", "$biome_seeds$");
        this.t.path_texture = "drops/drop_seed_savanna";
        this.t.falling_speed = 3f;
        this.t.action_landed = new DropsAction(DropsLibrary.action_drop_seeds);
        this.t.drop_type_low = "savanna_low";
        this.t.drop_type_high = "savanna_high";
        this.t.sound_drop = "event:/SFX/DROPS/DropSeedSavanna";
        this.clone("seeds_corrupted", "$biome_seeds$");
        this.t.path_texture = "drops/drop_seed_corrupted";
        this.t.falling_speed = 3f;
        this.t.action_landed = new DropsAction(DropsLibrary.action_drop_seeds);
        this.t.drop_type_low = "corrupted_low";
        this.t.drop_type_high = "corrupted_high";
        this.t.sound_drop = "event:/SFX/DROPS/DropSeedCorrupted";
        this.clone("seeds_mushroom", "$biome_seeds$");
        this.t.path_texture = "drops/drop_seed_mushroom";
        this.t.falling_speed = 3f;
        this.t.action_landed = new DropsAction(DropsLibrary.action_drop_seeds);
        this.t.drop_type_low = "mushroom_low";
        this.t.drop_type_high = "mushroom_high";
        this.t.sound_drop = "event:/SFX/DROPS/DropSeedMushroom";
        this.clone("seeds_jungle", "$biome_seeds$");
        this.t.path_texture = "drops/drop_seed_jungle";
        this.t.falling_speed = 3f;
        this.t.action_landed = new DropsAction(DropsLibrary.action_drop_seeds);
        this.t.drop_type_low = "jungle_low";
        this.t.drop_type_high = "jungle_high";
        this.t.sound_drop = "event:/SFX/DROPS/DropSeedJungle";
        this.clone("seeds_desert", "$biome_seeds$");
        this.t.path_texture = "drops/drop_seed_desert";
        this.t.falling_speed = 3f;
        this.t.action_landed = new DropsAction(DropsLibrary.action_drop_seeds);
        this.t.drop_type_low = "desert_low";
        this.t.drop_type_high = "desert_high";
        this.t.sound_drop = "event:/SFX/DROPS/DropSeedDesert";
        this.clone("seeds_lemon", "$biome_seeds$");
        this.t.path_texture = "drops/drop_seed_lemon";
        this.t.falling_speed = 3f;
        this.t.action_landed = new DropsAction(DropsLibrary.action_drop_seeds);
        this.t.drop_type_low = "lemon_low";
        this.t.drop_type_high = "lemon_high";
        this.t.sound_drop = "event:/SFX/DROPS/DropSeedLemon";
        this.clone("seeds_permafrost", "$biome_seeds$");
        this.t.path_texture = "drops/drop_seed_permafrost";
        this.t.falling_speed = 3f;
        this.t.action_landed = new DropsAction(DropsLibrary.action_drop_seeds);
        this.t.drop_type_low = "permafrost_low";
        this.t.drop_type_high = "permafrost_high";
        this.t.sound_drop = "event:/SFX/DROPS/DropSeedPermafrost";
        this.clone("seeds_candy", "$biome_seeds$");
        this.t.path_texture = "drops/drop_seed_candy";
        this.t.falling_speed = 3f;
        this.t.action_landed = new DropsAction(DropsLibrary.action_drop_seeds);
        this.t.drop_type_low = "candy_low";
        this.t.drop_type_high = "candy_high";
        this.t.sound_drop = "event:/SFX/DROPS/DropSeedCandy";
        this.clone("seeds_crystal", "$biome_seeds$");
        this.t.path_texture = "drops/drop_seed_crystal";
        this.t.falling_speed = 3f;
        this.t.action_landed = new DropsAction(DropsLibrary.action_drop_seeds);
        this.t.drop_type_low = "crystal_low";
        this.t.drop_type_high = "crystal_high";
        this.t.sound_drop = "event:/SFX/DROPS/DropSeedCrystal";
        this.clone("seeds_swamp", "$biome_seeds$");
        this.t.path_texture = "drops/drop_seed_swamp";
        this.t.falling_speed = 3f;
        this.t.action_landed = new DropsAction(DropsLibrary.action_drop_seeds);
        this.t.drop_type_low = "swamp_low";
        this.t.drop_type_high = "swamp_high";
        this.t.sound_drop = "event:/SFX/DROPS/DropSeedSwamp";
        this.clone("seeds_infernal", "$biome_seeds$");
        this.t.path_texture = "drops/drop_seed_infernal";
        this.t.falling_speed = 3f;
        this.t.action_landed = new DropsAction(DropsLibrary.action_drop_seeds);
        this.t.drop_type_low = "infernal_low";
        this.t.drop_type_high = "infernal_high";
        this.t.sound_drop = "event:/SFX/DROPS/DropSeedInfernal";
        this.clone("seeds_birch", "$biome_seeds$");
        this.t.path_texture = "drops/drop_seed_birch";
        this.t.falling_speed = 3f;
        this.t.action_landed = new DropsAction(DropsLibrary.action_drop_seeds);
        this.t.drop_type_low = "birch_low";
        this.t.drop_type_high = "birch_high";
        this.t.sound_drop = "event:/SFX/DROPS/DropSeedGrass";
        this.clone("seeds_maple", "$biome_seeds$");
        this.t.path_texture = "drops/drop_seed_maple";
        this.t.falling_speed = 3f;
        this.t.action_landed = new DropsAction(DropsLibrary.action_drop_seeds);
        this.t.drop_type_low = "maple_low";
        this.t.drop_type_high = "maple_high";
        this.t.sound_drop = "event:/SFX/DROPS/DropSeedGrass";
        this.clone("seeds_rocklands", "$biome_seeds$");
        this.t.path_texture = "drops/drop_seed_rocklands";
        this.t.falling_speed = 3f;
        this.t.action_landed = new DropsAction(DropsLibrary.action_drop_seeds);
        this.t.drop_type_low = "rocklands_low";
        this.t.drop_type_high = "rocklands_high";
        this.t.sound_drop = "event:/SFX/DROPS/DropSeedGrass";
        this.clone("seeds_garlic", "$biome_seeds$");
        this.t.path_texture = "drops/drop_seed_garlic";
        this.t.falling_speed = 3f;
        this.t.action_landed = new DropsAction(DropsLibrary.action_drop_seeds);
        this.t.drop_type_low = "garlic_low";
        this.t.drop_type_high = "garlic_high";
        this.t.sound_drop = "event:/SFX/DROPS/DropSeedGrass";
        this.clone("seeds_flower", "$biome_seeds$");
        this.t.path_texture = "drops/drop_seed_flower";
        this.t.falling_speed = 3f;
        this.t.action_landed = new DropsAction(DropsLibrary.action_drop_seeds);
        this.t.drop_type_low = "flower_low";
        this.t.drop_type_high = "flower_high";
        this.t.sound_drop = "event:/SFX/DROPS/DropSeedGrass";
        this.clone("seeds_celestial", "$biome_seeds$");
        this.t.path_texture = "drops/drop_seed_celestial";
        this.t.falling_speed = 3f;
        this.t.action_landed = new DropsAction(DropsLibrary.action_drop_seeds);
        this.t.drop_type_low = "celestial_low";
        this.t.drop_type_high = "celestial_high";
        this.t.sound_drop = "event:/SFX/DROPS/DropSeedGrass";
        this.clone("seeds_singularity", "$biome_seeds$");
        this.t.path_texture = "drops/drop_seed_singularity";
        this.t.falling_speed = 3f;
        this.t.action_landed = new DropsAction(DropsLibrary.action_drop_seeds);
        this.t.drop_type_low = "singularity_low";
        this.t.drop_type_high = "singularity_high";
        this.t.sound_drop = "event:/SFX/DROPS/DropSeedGrass";
        this.clone("seeds_clover", "$biome_seeds$");
        this.t.path_texture = "drops/drop_seed_clover";
        this.t.falling_speed = 3f;
        this.t.action_landed = new DropsAction(DropsLibrary.action_drop_seeds);
        this.t.drop_type_low = "clover_low";
        this.t.drop_type_high = "clover_high";
        this.t.sound_drop = "event:/SFX/DROPS/DropSeedGrass";
        this.clone("seeds_paradox", "$biome_seeds$");
        this.t.path_texture = "drops/drop_seed_paradox";
        this.t.falling_speed = 3f;
        this.t.action_landed = new DropsAction(DropsLibrary.action_drop_seeds);
        this.t.drop_type_low = "paradox_low";
        this.t.drop_type_high = "paradox_high";
        this.t.sound_drop = "event:/SFX/DROPS/DropSeedGrass";
        this.clone("fruit_bush", "$spawn_building$");
        this.t.path_texture = "drops/drop_seed";
        this.t.falling_speed = 3f;
        this.t.action_landed = new DropsAction(DropsLibrary.action_fruit_bush);
        this.t.sound_drop = "event:/SFX/DROPS/DropBush";
        this.clone("fertilizer_plants", "$biome_seeds$");
        this.t.surprises_units = false;
        this.t.path_texture = "drops/drop_fertilizer";
        this.t.falling_speed = 5f;
        DropAsset t14 = this.t;
        t14.action_landed = (DropsAction)Delegate.Combine(t14.action_landed, new DropsAction(DropsLibrary.action_fertilizer_plants));
        DropAsset t15 = this.t;
        t15.action_landed = (DropsAction)Delegate.Combine(t15.action_landed, new DropsAction(DropsLibrary.tryToGrowWheat));
        DropAsset t16 = this.t;
        t16.action_landed = (DropsAction)Delegate.Combine(t16.action_landed, new DropsAction(DropsLibrary.flash));
        this.t.sound_drop = "event:/SFX/DROPS/DropFertilizerPlants";
        this.clone("fertilizer_trees", "$biome_seeds$");
        this.t.path_texture = "drops/drop_fertilizer";
        this.t.falling_speed = 5f;
        this.t.action_landed = new DropsAction(DropsLibrary.action_fertilizer_trees);
        DropAsset t17 = this.t;
        t17.action_landed = (DropsAction)Delegate.Combine(t17.action_landed, new DropsAction(DropsLibrary.flash));
        this.t.sound_drop = "event:/SFX/DROPS/DropFertilizerPlants";
        this.clone("$spawn_mineral$", "$spawn_building$");
        this.t.falling_speed = 6f;
        this.t.type = DropType.DropMineral;
        this.clone("stone", "$spawn_mineral$");
        this.t.path_texture = "drops/drop_stone";
        this.t.default_scale = 0.2f;
        this.t.building_asset = "mineral_stone";
        this.t.action_landed = new DropsAction(DropsLibrary.action_spawn_building);
        this.t.sound_drop = "event:/SFX/DROPS/DropStone";
        this.clone("metals", "$spawn_mineral$");
        this.t.path_texture = "drops/drop_metal";
        this.t.default_scale = 0.2f;
        this.t.building_asset = "mineral_metals";
        this.t.action_landed = new DropsAction(DropsLibrary.action_spawn_building);
        this.t.sound_drop = "event:/SFX/DROPS/DropMineral";
        this.clone("gold", "$spawn_mineral$");
        this.t.path_texture = "drops/drop_gold";
        this.t.default_scale = 0.2f;
        this.t.building_asset = "mineral_gold";
        this.t.action_landed = new DropsAction(DropsLibrary.action_spawn_building);
        this.t.sound_drop = "event:/SFX/DROPS/DropGold";
        this.clone("silver", "$spawn_mineral$");
        this.t.path_texture = "drops/drop_stone";
        this.t.default_scale = 0.2f;
        this.t.building_asset = "mineral_silver";
        this.t.action_landed = new DropsAction(DropsLibrary.action_spawn_building);
        this.t.sound_drop = "event:/SFX/DROPS/DropMineral";
        this.clone("mythril", "$spawn_mineral$");
        this.t.path_texture = "drops/drop_stone";
        this.t.default_scale = 0.2f;
        this.t.building_asset = "mineral_mythril";
        this.t.action_landed = new DropsAction(DropsLibrary.action_spawn_building);
        this.t.sound_drop = "event:/SFX/DROPS/DropMineral";
        this.clone("adamantine", "$spawn_mineral$");
        this.t.path_texture = "drops/drop_stone";
        this.t.default_scale = 0.2f;
        this.t.building_asset = "mineral_adamantine";
        this.t.action_landed = new DropsAction(DropsLibrary.action_spawn_building);
        this.t.sound_drop = "event:/SFX/DROPS/DropMineral";
        this.clone("$spawn_creep$", "$spawn_building$");
        this.t.type = DropType.DropCreep;
        this.clone("tumor", "$spawn_creep$");
        this.t.building_asset = this.t.id;
        this.t.action_landed = new DropsAction(DropsLibrary.action_spawn_building);
        this.t.sound_drop = "event:/SFX/DROPS/DropTumor";
        this.clone("biomass", "$spawn_creep$");
        this.t.building_asset = this.t.id;
        this.t.action_landed = new DropsAction(DropsLibrary.action_spawn_building);
        this.t.sound_drop = "event:/SFX/DROPS/DropBiomass";
        this.clone("cybercore", "$spawn_creep$");
        this.t.building_asset = this.t.id;
        this.t.action_landed = new DropsAction(DropsLibrary.action_spawn_building);
        this.t.sound_drop = "event:/SFX/DROPS/DropCybercore";
        this.clone("super_pumpkin", "$spawn_creep$");
        this.t.building_asset = this.t.id;
        this.t.action_landed = new DropsAction(DropsLibrary.action_spawn_building);
        this.t.sound_drop = "event:/SFX/DROPS/DropSuperPumpkin";
        this.clone("geyser", "$spawn_building$");
        this.t.building_asset = this.t.id;
        this.t.action_landed = new DropsAction(DropsLibrary.action_spawn_building);
        this.t.sound_drop = "event:/SFX/DROPS/DropGeyser";
        this.clone("geyser_acid", "$spawn_building$");
        this.t.building_asset = this.t.id;
        this.t.action_landed = new DropsAction(DropsLibrary.action_spawn_building);
        this.t.sound_drop = "event:/SFX/DROPS/DropGeyser";
        this.clone("volcano", "$spawn_building$");
        this.t.building_asset = this.t.id;
        this.t.action_landed = new DropsAction(DropsLibrary.action_spawn_building);
        this.t.sound_drop = "event:/SFX/DROPS/DropVolcano";
        this.clone("golden_brain", "$spawn_building$");
        this.t.building_asset = this.t.id;
        this.t.action_landed = new DropsAction(DropsLibrary.action_spawn_building);
        this.t.sound_drop = "event:/SFX/DROPS/DropGoldenBrain";
        this.clone("monolith", "$spawn_building$");
        this.t.building_asset = this.t.id;
        this.t.action_landed = new DropsAction(DropsLibrary.action_spawn_building);
        DropAsset t18 = this.t;
        t18.action_landed = (DropsAction)Delegate.Combine(t18.action_landed, new DropsAction(delegate (WorldTile _, string _)
        {
            SignalManager.add(SignalLibrary.check_achievement_cant_be_too_much, null);
        }));
        this.t.sound_drop = "event:/SFX/DROPS/DropMonolith";
        this.clone("corrupted_brain", "$spawn_building$");
        this.t.building_asset = this.t.id;
        this.t.action_landed = new DropsAction(DropsLibrary.action_spawn_building);
        this.t.sound_drop = "event:/SFX/DROPS/DropCorruptedBrain";
        this.clone("ice_tower", "$spawn_building$");
        this.t.building_asset = this.t.id;
        this.t.action_landed = new DropsAction(DropsLibrary.action_spawn_building);
        this.t.sound_drop = "event:/SFX/DROPS/DropIceTower";
        this.clone("angle_tower", "$spawn_building$");
        this.t.building_asset = this.t.id;
        this.t.action_landed = new DropsAction(DropsLibrary.action_spawn_building);
        this.t.sound_drop = "event:/SFX/DROPS/DropIceTower";
        this.clone("beehive", "$spawn_building$");
        this.t.building_asset = this.t.id;
        this.t.action_landed = new DropsAction(DropsLibrary.action_spawn_building);
        this.t.sound_drop = "event:/SFX/DROPS/DropBeehive";
        this.clone("flame_tower", "$spawn_building$");
        this.t.building_asset = this.t.id;
        this.t.action_landed = new DropsAction(DropsLibrary.action_spawn_building);
        this.t.sound_drop = "event:/SFX/DROPS/DropFlameTower";
        this.addWaypointDrops();
    }

    // Token: 0x06000290 RID: 656 RVA: 0x00019CC8 File Offset: 0x00017EC8
    public override void linkAssets()
    {
        foreach (DropAsset tAsset in this.list)
        {
            if (!string.IsNullOrEmpty(tAsset.drop_type_high))
            {
                tAsset.cached_drop_type_high = AssetManager.top_tiles.get(tAsset.drop_type_high);
            }
            if (!string.IsNullOrEmpty(tAsset.drop_type_low))
            {
                tAsset.cached_drop_type_low = AssetManager.top_tiles.get(tAsset.drop_type_low);
            }
        }
        base.linkAssets();
    }

    // Token: 0x06000291 RID: 657 RVA: 0x00019D60 File Offset: 0x00017F60
    private void addWaypointDrops()
    {
        this.add(new DropAsset
        {
            id = "desire_alien_mold",
            path_texture = "drops/drop_alien_mold",
            animated = false,
            default_scale = 0.1f,
            material = "mat_world_object_lit",
            sound_drop = "event:/SFX/DROPS/DropBlessing",
            type = DropType.DropMagic
        });
        this.t.action_landed = new DropsAction(DropsLibrary.action_alien_mold);
        this.t.surprises_units = true;
        this.clone("desire_computer", "desire_alien_mold");
        this.t.path_texture = "drops/drop_computer";
        this.t.action_landed = new DropsAction(DropsLibrary.action_drop_computer);
        this.clone("desire_golden_egg", "desire_alien_mold");
        this.t.path_texture = "drops/drop_golden_egg";
        this.t.action_landed = new DropsAction(DropsLibrary.action_drop_golden_egg);
        this.clone("desire_harp", "desire_alien_mold");
        this.t.path_texture = "drops/drop_harp";
        this.t.action_landed = new DropsAction(DropsLibrary.action_drop_harp);
        this.clone("waypoint_alien_mold", "$spawn_building$");
        this.t.building_asset = this.t.id;
        this.t.action_landed = new DropsAction(DropsLibrary.action_spawn_building);
        this.t.sound_drop = "event:/SFX/DROPS/DropCorruptedBrain";
        this.clone("waypoint_computer", "$spawn_building$");
        this.t.building_asset = this.t.id;
        this.t.action_landed = new DropsAction(DropsLibrary.action_spawn_building);
        this.t.sound_drop = "event:/SFX/DROPS/DropCorruptedBrain";
        this.clone("waypoint_golden_egg", "$spawn_building$");
        this.t.building_asset = this.t.id;
        this.t.action_landed = new DropsAction(DropsLibrary.action_spawn_building);
        this.t.sound_drop = "event:/SFX/DROPS/DropCorruptedBrain";
        this.clone("waypoint_harp", "$spawn_building$");
        this.t.building_asset = this.t.id;
        this.t.action_landed = new DropsAction(DropsLibrary.action_spawn_building);
        this.t.sound_drop = "event:/SFX/DROPS/DropCorruptedBrain";
    }

    // Token: 0x06000292 RID: 658 RVA: 0x00019FC4 File Offset: 0x000181C4
    public static void action_drop_seeds(WorldTile pTile = null, string pDropID = null)
    {
        DropAsset tDropAsset = AssetManager.drops.get(pDropID);
        DropsLibrary.useDropSeedOn(pTile, tDropAsset.cached_drop_type_low, tDropAsset.cached_drop_type_high);
    }

    // Token: 0x06000293 RID: 659 RVA: 0x00019FF0 File Offset: 0x000181F0
    public static void useDropSeedOn(WorldTile pTile, TopTileType pTypeLow, TopTileType pHigh)
    {
        DropsLibrary.useSeedOn(pTile, pTypeLow, pHigh);
        for (int i = 0; i < pTile.neighbours.Length; i++)
        {
            DropsLibrary.useSeedOn(pTile.neighbours[i], pTypeLow, pHigh);
        }
    }

    // Token: 0x06000294 RID: 660 RVA: 0x0001A027 File Offset: 0x00018227
    public static void tryToGrowWheat(WorldTile pTile = null, string pDropID = null)
    {
        if (pTile.Type.farm_field && !pTile.hasBuilding())
        {
            World.world.buildings.addBuilding("wheat", pTile, false, false, BuildPlacingType.New);
        }
    }

    // Token: 0x06000295 RID: 661 RVA: 0x0001A058 File Offset: 0x00018258
    public static void useSeedOn(WorldTile pTile, TopTileType pTypeLow, TopTileType pHigh)
    {
        pTile.unfreeze(1);
        if (!pTile.Type.can_be_biome)
        {
            return;
        }
        if (pTile.isTileRank(TileRank.Low))
        {
            MapAction.growGreens(pTile, pTypeLow);
        }
        else if (pTile.isTileRank(TileRank.High))
        {
            MapAction.growGreens(pTile, pHigh);
        }
        BiomeAsset tBiome = pTile.getBiome();
        if (tBiome == null)
        {
            return;
        }
        pTile.doUnits(delegate (Actor tActor)
        {
            if (!tActor.hasSubspecies())
            {
                return;
            }
            if (tBiome.spawn_trait_subspecies_always == null)
            {
                return;
            }
            foreach (string tID in tBiome.spawn_trait_subspecies_always)
            {
                tActor.subspecies.addTrait(tID, false);
            }
        });
    }

    // Token: 0x06000296 RID: 662 RVA: 0x0001A0CC File Offset: 0x000182CC
    public static void action_rain(WorldTile pTile = null, string pDropID = null)
    {
        DropsLibrary.useRainOn(pTile);
        for (int i = 0; i < pTile.neighbours.Length; i++)
        {
            DropsLibrary.useRainOn(pTile.neighbours[i]);
        }
        for (int j = 0; j < pTile.neighbours.Length; j++)
        {
            WorldTile tNeighbour = pTile.neighbours[j];
            if (tNeighbour.isOnFire())
            {
                tNeighbour.stopFire();
            }
        }
    }

    // Token: 0x06000297 RID: 663 RVA: 0x0001A12C File Offset: 0x0001832C
    private static void useRainOn(WorldTile pTile)
    {
        pTile.stopFire();
        pTile.doUnits(delegate (Actor tActor)
        {
            tActor.finishStatusEffect("burning");
            tActor.finishAngryStatus();
            if (tActor.isDamagedByRain())
            {
                tActor.getHit((float)tActor.getWaterDamage(), true, AttackType.Water, null, true, false, true);
                return;
            }
            tActor.addStamina((int)((float)tActor.getMaxStamina() * 0.1f));
        });
        if (pTile.hasBuilding())
        {
            pTile.building.stopFire();
            if (pTile.building.asset.wheat)
            {
                pTile.building.component_wheat.grow();
            }
        }
        if (pTile.hasBuilding() && pTile.building.asset.damaged_by_rain)
        {
            pTile.building.getHit(20f, true, AttackType.Other, null, true, false, true);
        }
        pTile.removeBurn();
        if (pTile.Type.can_be_filled_with_ocean)
        {
            MapAction.setOcean(pTile);
        }
        if (pTile.Type.lava)
        {
            LavaHelper.putOut(pTile);
        }
        if (pTile.Type.explodable_by_ocean)
        {
            World.world.explosion_layer.explodeBomb(pTile, false);
        }
        BiomeAsset biome = pTile.getBiome();
        if (biome != null && biome.spread_by_drops_water)
        {
            WorldBehaviourActionBiomes.trySpreadBiomeAround(pTile, pTile, false, false, false);
        }
    }

    // Token: 0x06000298 RID: 664 RVA: 0x0001A234 File Offset: 0x00018434
    public static void action_gamma_rain(WorldTile pTile = null, string pDropID = null)
    {
        List<string> tList = PlayerConfig.instance.data.trait_editor_gamma;
        DropsLibrary.useTraitRain(pTile, tList, PlayerConfig.instance.data.trait_editor_gamma_state);
    }

    // Token: 0x06000299 RID: 665 RVA: 0x0001A268 File Offset: 0x00018468
    public static void action_delta_rain(WorldTile pTile = null, string pDropID = null)
    {
        List<string> tList = PlayerConfig.instance.data.trait_editor_delta;
        DropsLibrary.useTraitRain(pTile, tList, PlayerConfig.instance.data.trait_editor_delta_state);
    }

    // Token: 0x0600029A RID: 666 RVA: 0x0001A29C File Offset: 0x0001849C
    public static void action_omega_rain(WorldTile pTile = null, string pDropID = null)
    {
        List<string> tList = PlayerConfig.instance.data.trait_editor_omega;
        DropsLibrary.useTraitRain(pTile, tList, PlayerConfig.instance.data.trait_editor_omega_state);
    }

    // Token: 0x0600029B RID: 667 RVA: 0x0001A2D0 File Offset: 0x000184D0
    private static void useTraitRain(WorldTile pTile, List<string> pList, RainState pRainState)
    {
        if (pList.Count == 0)
        {
            return;
        }
        using (ListPool<ActorTrait> tList = new ListPool<ActorTrait>(pList.Count))
        {
            foreach (string tTraitID in pList)
            {
                ActorTrait tTrait = AssetManager.traits.get(tTraitID);
                if (tTrait != null && tTrait.isAvailable() && (pRainState != RainState.Add || tTrait.can_be_given) && (pRainState != RainState.Remove || tTrait.can_be_removed))
                {
                    tList.Add(tTrait);
                }
            }
            foreach (Actor tActor in Finder.getUnitsFromChunk(pTile, 1, 3f, false))
            {
                if (tActor.asset.can_edit_traits)
                {
                    if (pRainState == RainState.Remove)
                    {
                        tActor.removeTraits(tList);
                    }
                    else
                    {
                        foreach (ActorTrait ptr in tList)
                        {
                            ActorTrait tTrait2 = ptr;
                            tActor.addTrait(tTrait2, true);
                        }
                    }
                    tActor.addTrait("scar_of_divinity", false);
                    tActor.startShake(0.3f, 0.1f, true, true);
                    tActor.makeConfused(-1f, true);
                }
            }
        }
    }

    // Token: 0x0600029C RID: 668 RVA: 0x0001A480 File Offset: 0x00018680
    public static void action_equipment_rain(WorldTile pTile = null, string pDropID = null)
    {
        List<string> tItems = PlayerConfig.instance.data.equipment_editor;
        DropsLibrary.useEquipmentRain(pTile, tItems, PlayerConfig.instance.data.equipment_editor_state);
    }

    // Token: 0x0600029D RID: 669 RVA: 0x0001A4B4 File Offset: 0x000186B4
    private static void useEquipmentRain(WorldTile pTile, List<string> pItems, RainState pRainState)
    {
        if (pItems.Count == 0)
        {
            return;
        }
        using (ListPool<EquipmentAsset> tListItems = new ListPool<EquipmentAsset>(pItems.Count))
        {
            for (int i = 0; i < pItems.Count; i++)
            {
                string tItemId = pItems[i];
                EquipmentAsset tItemAsset = AssetManager.items.get(tItemId);
                if (tItemAsset != null && tItemAsset.isAvailable() && (pRainState != RainState.Add || tItemAsset.can_be_given) && (pRainState != RainState.Remove || tItemAsset.can_be_removed))
                {
                    tListItems.Add(tItemAsset);
                }
            }
            foreach (Actor tActor in Finder.getUnitsFromChunk(pTile, 1, 3f, false))
            {
                if (tActor.canEditEquipment())
                {
                    for (int j = 0; j < tListItems.Count; j++)
                    {
                        EquipmentAsset tItemAsset2 = tListItems[j];
                        if (tActor.asset.canEditItem(tItemAsset2))
                        {
                            ActorEquipmentSlot tSlot = tActor.equipment.getSlot(tItemAsset2.equipment_type);
                            Item tSlotItem = tSlot.getItem();
                            if ((tSlot.isEmpty() || (!tSlotItem.isFavorite() && !tSlotItem.isCursed())) && tSlot.canChangeSlot())
                            {
                                if (pRainState == RainState.Remove)
                                {
                                    if (!tSlot.isEmpty() && tSlotItem.getAsset().id != tItemAsset2.id)
                                    {
                                        return;
                                    }
                                    tSlot.takeAwayItem();
                                }
                                else
                                {
                                    Item tItem = World.world.items.generateItem(tItemAsset2, tActor.kingdom, World.world.map_stats.player_name, 1, tActor, 0, true);
                                    tItem.addMod("divine_rune");
                                    tActor.equipment.setItem(tItem, tActor);
                                }
                            }
                        }
                    }
                    tActor.startShake(0.3f, 0.1f, true, true);
                    tActor.makeConfused(-1f, true);
                }
            }
        }
    }

    // Token: 0x0600029E RID: 670 RVA: 0x0001A6D0 File Offset: 0x000188D0
    public static void action_acid(WorldTile pTile = null, string pDropID = null)
    {
        MapAction.checkAcidTerraform(pTile);
        if (Randy.randomChance(0.2f))
        {
            World.world.particles_smoke.spawn(pTile.posV3);
        }
        if (pTile.hasBuilding() && pTile.building.asset.affected_by_acid && pTile.building.isAlive())
        {
            pTile.building.getHit(20f, true, AttackType.Other, null, true, false, true);
        }
        foreach (Actor tActor in Finder.getUnitsFromChunk(pTile, 1, 3f, false))
        {
            if (!Randy.randomChance(0.6f) && !tActor.hasTrait("acid_proof") && !tActor.hasTrait("acid_blood"))
            {
                tActor.getHit(20f, true, AttackType.Acid, null, true, false, true);
            }
        }
        World.world.conway_layer.checkKillRange(pTile.pos, 2);
        BiomeAsset biome = pTile.getBiome();
        if (biome != null && biome.spread_by_drops_acid)
        {
            WorldBehaviourActionBiomes.trySpreadBiomeAround(pTile, pTile, false, false, true);
        }
    }

    // Token: 0x0600029F RID: 671 RVA: 0x0001A7EC File Offset: 0x000189EC
    public static void action_fire(WorldTile pTile = null, string pDropID = null)
    {
        ActionLibrary.burnTile(null, null, pTile);
        ActionLibrary.startBurningObjects(null, null, pTile);
        BiomeAsset biome = pTile.getBiome();
        if (biome != null && biome.spread_by_drops_fire)
        {
            WorldBehaviourActionBiomes.trySpreadBiomeAround(pTile, pTile, false, false, true);
        }
    }

    // Token: 0x060002A0 RID: 672 RVA: 0x0001A81D File Offset: 0x00018A1D
    public static void action_fireworks(WorldTile pTile = null, string pDropID = null)
    {
        MapAction.terraformTop(pTile, TopTileLibrary.fireworks, TerraformLibrary.remove);
    }

    // Token: 0x060002A1 RID: 673 RVA: 0x0001A830 File Offset: 0x00018A30
    public static void action_tnt(WorldTile pTile = null, string pDropID = null)
    {
        if (pTile.Type.lava || pTile.isOnFire())
        {
            MapAction.terraformTop(pTile, TopTileLibrary.tnt, TerraformLibrary.remove);
            World.world.explosion_layer.explodeBomb(pTile, false);
            return;
        }
        MapAction.terraformTop(pTile, TopTileLibrary.tnt, TerraformLibrary.remove);
    }

    // Token: 0x060002A2 RID: 674 RVA: 0x0001A884 File Offset: 0x00018A84
    public static void action_tnt_timed(WorldTile pTile = null, string pDropID = null)
    {
        if (pTile.Type.lava || pTile.isOnFire())
        {
            MapAction.terraformTop(pTile, TopTileLibrary.tnt_timed, TerraformLibrary.remove);
            World.world.explosion_layer.explodeBomb(pTile, false);
            return;
        }
        MapAction.terraformTop(pTile, TopTileLibrary.tnt_timed, TerraformLibrary.remove);
    }

    // Token: 0x060002A3 RID: 675 RVA: 0x0001A8D8 File Offset: 0x00018AD8
    public static void action_czar_bomba(WorldTile pTile = null, string pDropID = null)
    {
        EffectsLibrary.spawn("fx_nuke_flash", pTile, "czar_bomba", null, 0f, -1f, -1f, null);
        World.world.startShake(0.3f, 0.01f, 2.5f, true, true);
    }

    // Token: 0x060002A4 RID: 676 RVA: 0x0001A917 File Offset: 0x00018B17
    public static void action_atomic_bomb(WorldTile pTile = null, string pDropID = null)
    {
        World.world.startShake(0.3f, 0.01f, 2f, true, true);
        EffectsLibrary.spawn("fx_nuke_flash", pTile, "atomic_bomb", null, 0f, -1f, -1f, null);
    }

    // Token: 0x060002A5 RID: 677 RVA: 0x0001A956 File Offset: 0x00018B56
    public static void action_antimatter_bomb(WorldTile pTile = null, string pDropID = null)
    {
        World.world.startShake(0.3f, 0.01f, 0.03f, false, true);
        EffectsLibrary.spawn("fx_antimatter_effect", pTile, null, null, 0f, -1f, -1f, null);
    }

    // Token: 0x060002A6 RID: 678 RVA: 0x0001A994 File Offset: 0x00018B94
    public static void action_napalm_bomb(WorldTile pTile = null, string pDropID = null)
    {
        World.world.startShake(0.3f, 0.01f, 0.5f, true, true);
        EffectsLibrary.spawn("fx_napalm_flash", pTile, null, null, 0f, -1f, -1f, null);
        EffectsLibrary.spawnAtTileRandomScale("fx_explosion_tiny", pTile, 0.15f, 0.3f);
    }

    // Token: 0x060002A7 RID: 679 RVA: 0x0001A9F0 File Offset: 0x00018BF0
    public static void action_crab_bomb_impact(WorldTile pTile = null, string pDropID = null)
    {
        MusicBox.playSound("event:/SFX/DESTRUCTION/CrabBombImpact", pTile, false, false);
        int tAmount = Randy.randomInt(1, 4);
        for (int i = 0; i < tAmount; i++)
        {
            World.world.drop_manager.spawnParabolicDrop(pTile, "crab_bomb_shrapnel", 1f, 15f, 40f, 4f, 16f, -1f);
        }
    }

    // Token: 0x060002A8 RID: 680 RVA: 0x0001AA54 File Offset: 0x00018C54
    public static void action_crab_bomb_shrapnel(WorldTile pTile = null, string pDropID = null)
    {
        EffectsLibrary.spawnAt("fx_explosion_crab_bomb", pTile.posV, 0.25f);
        World.world.startShake(0.3f, 0.01f, 0.5f, true, true);
        MapAction.damageWorld(pTile, 2, AssetManager.terraform.get("crab_bomb"), null);
        if (Randy.randomChance(0.05f))
        {
            DropsLibrary.action_crab_bomb_impact(pTile, "crab_bomb_shrapnel");
        }
    }

    // Token: 0x060002A9 RID: 681 RVA: 0x0001AAC0 File Offset: 0x00018CC0
    public static void action_grenade(WorldTile pTile = null, string pDropID = null)
    {
        MapAction.damageWorld(pTile, 5, AssetManager.terraform.get("grenade"), null);
        EffectsLibrary.spawnAtTileRandomScale("fx_explosion_small", pTile, 0.1f, 0.15f);
    }

    // Token: 0x060002AA RID: 682 RVA: 0x0001AAF0 File Offset: 0x00018CF0
    public static void action_bomb(WorldTile pTile = null, string pDropID = null)
    {
        EffectsLibrary.spawnAtTileRandomScale("fx_explosion_middle", pTile, 0.45f, 0.6f);
        if (World.world.explosion_checker.checkNearby(pTile, 10))
        {
            return;
        }
        MapAction.damageWorld(pTile, 10, AssetManager.terraform.get("bomb"), null);
    }

    // Token: 0x060002AB RID: 683 RVA: 0x0001AB40 File Offset: 0x00018D40
    public static void action_santa_bomb(WorldTile pTile = null, string pDropID = null)
    {
        MapAction.damageWorld(pTile, 10, AssetManager.terraform.get("santa_bomb"), null);
        EffectsLibrary.spawnAtTileRandomScale("fx_explosion_small", pTile, 0.45f, 0.6f);
    }

    // Token: 0x060002AC RID: 684 RVA: 0x0001AB70 File Offset: 0x00018D70
    public static void action_water_bomb(WorldTile pTile = null, string pDropID = null)
    {
        if (pTile.Type.liquid || pTile.Type.lava || pTile.isOnFire())
        {
            MapAction.terraformTop(pTile, TopTileLibrary.water_bomb, TerraformLibrary.remove);
            World.world.explosion_layer.explodeBomb(pTile, false);
            return;
        }
        MapAction.terraformTop(pTile, TopTileLibrary.water_bomb, TerraformLibrary.remove);
    }

    // Token: 0x060002AD RID: 685 RVA: 0x0001ABD1 File Offset: 0x00018DD1
    public static void action_lava(WorldTile pTile = null, string pDropID = null)
    {
        LavaHelper.addLava(pTile, "lava3");
    }

    // Token: 0x060002AE RID: 686 RVA: 0x0001ABE0 File Offset: 0x00018DE0
    public static void action_rage(WorldTile pTile = null, string pDropID = null)
    {
        foreach (Actor tActor in Finder.getUnitsFromChunk(pTile, 1, 3f, false))
        {
            if (Randy.randomChance(0.2f))
            {
                tActor.addStatusEffect("rage", 0f, true);
            }
        }
    }

    // Token: 0x060002AF RID: 687 RVA: 0x0001AC4C File Offset: 0x00018E4C
    public static void action_magic_rain(WorldTile pTile = null, string pDropID = null)
    {
        foreach (Actor tActor in Finder.getUnitsFromChunk(pTile, 1, 3f, false))
        {
            if (Randy.randomChance(0.2f))
            {
                tActor.addStatusEffect("powerup", 0f, true);
            }
            if (Randy.randomChance(0.2f))
            {
                tActor.addStatusEffect("spell_boost", 0f, true);
            }
            if (Randy.randomChance(0.2f))
            {
                tActor.addStatusEffect("shield", 0f, true);
            }
            if (Randy.randomChance(0.2f))
            {
                tActor.addStatusEffect("caffeinated", 0f, true);
            }
            tActor.addMana((int)((float)tActor.getMaxMana() * 0.1f));
        }
    }

    // Token: 0x060002B0 RID: 688 RVA: 0x0001AD2C File Offset: 0x00018F2C
    public static void action_ash(WorldTile pTile = null, string pDropID = null)
    {
        foreach (Actor tActor in Finder.getUnitsFromChunk(pTile, 1, 3f, false))
        {
            if (Randy.randomChance(0.3f))
            {
                tActor.addStatusEffect("cough", 0f, true);
            }
            if (Randy.randomChance(0.1f))
            {
                tActor.addStatusEffect("ash_fever", 0f, true);
            }
        }
    }

    // Token: 0x060002B1 RID: 689 RVA: 0x0001ADB8 File Offset: 0x00018FB8
    public static void action_life_seed(WorldTile pTile = null, string pDropID = null)
    {
        if (WorldLawLibrary.world_law_animals_spawn.isEnabled())
        {
            DropsLibrary.trySpawnUnit(pTile);
        }
        if (WorldLawLibrary.world_law_vegetation_random_seeds.isEnabled())
        {
            DropsLibrary.trySpawnVegetation(pTile);
        }
    }

    // Token: 0x060002B2 RID: 690 RVA: 0x0001ADE0 File Offset: 0x00018FE0
    private void action_jazz_rain(WorldTile pTile, string pDropID)
    {
        Actor tRandomParent = null;
        foreach (Actor tActor in Finder.getUnitsFromChunk(pTile, 1, 3f, true))
        {
            if (tActor.hasSubspecies() && tActor.isBreedingAge())
            {
                tRandomParent = tActor;
                break;
            }
        }
        if (tRandomParent == null)
        {
            return;
        }
        BabyMaker.makeBabyFromMiracle(tRandomParent, ActorSex.None, true);
    }

    // Token: 0x060002B3 RID: 691 RVA: 0x0001AE50 File Offset: 0x00019050
    private static void trySpawnUnit(WorldTile pTile)
    {
        BiomeAsset tBiomeAsset = pTile.Type.biome_asset;
        if (tBiomeAsset == null)
        {
            return;
        }
        if (!tBiomeAsset.pot_spawn_units_auto)
        {
            return;
        }
        string tUnitID = tBiomeAsset.pot_units_spawn.GetRandom<string>();
        bool tSapient = false;
        if (WorldLawLibrary.world_law_drop_of_thoughts.isEnabled() && Randy.randomBool() && tBiomeAsset.pot_sapient_units_spawn != null)
        {
            foreach (string tID in tBiomeAsset.pot_sapient_units_spawn.LoopRandom<string>())
            {
                ActorAsset tAsset = AssetManager.actor_library.get(tID);
                if (tAsset.isAvailable())
                {
                    GodPower tPower = tAsset.getGodPower();
                    if (tPower == null || tPower.isAvailable())
                    {
                        tUnitID = tID;
                        tSapient = true;
                        break;
                    }
                }
            }
        }
        ActorAsset tActorAsset = AssetManager.actor_library.get(tUnitID);
        if (tActorAsset == null)
        {
            return;
        }
        if (tActorAsset.units.Count > tActorAsset.max_random_amount)
        {
            return;
        }
        int tCountActors = 0;
        foreach (Actor actor in Finder.getUnitsFromChunk(pTile, 1, 0f, false))
        {
            if (tCountActors++ > 3)
            {
                return;
            }
        }
        Actor tActor = World.world.units.spawnNewUnit(tActorAsset.id, pTile, false, false, 6f, null, false);
        if (tSapient && tActor != null && tActor.subspecies.isJustCreated())
        {
            tActor.subspecies.makeSapient();
        }
    }

    // Token: 0x060002B4 RID: 692 RVA: 0x0001AFD0 File Offset: 0x000191D0
    private static void trySpawnVegetation(WorldTile pTile)
    {
        BiomeAsset tBiomeAsset = pTile.Type.biome_asset;
        if (tBiomeAsset == null)
        {
            return;
        }
        if (!tBiomeAsset.grow_vegetation_auto)
        {
            return;
        }
        ActionLibrary.growRandomVegetation(pTile, tBiomeAsset);
    }

    // Token: 0x060002B5 RID: 693 RVA: 0x0001B000 File Offset: 0x00019200
    public static void action_snow(WorldTile pTile = null, string pDropID = null)
    {
        if (pTile.canBeFrozen())
        {
            pTile.freeze(1);
        }
        for (int i = 0; i < 10; i++)
        {
            WorldTile tRandTile = pTile.chunk.tiles.GetRandom<WorldTile>();
            if (tRandTile.canBeFrozen())
            {
                if (Toolbox.DistTile(pTile, tRandTile) < 11f)
                {
                    break;
                }
                tRandTile.freeze(1);
            }
        }
        if (pTile.Type.lava)
        {
            return;
        }
        if (Randy.randomBool())
        {
            foreach (Actor tActor in Finder.getUnitsFromChunk(pTile, 1, 3f, false))
            {
                ActionLibrary.addFrozenEffectOnTarget(tActor, tActor, null);
            }
        }
        DropsLibrary.checkIceBabies(pTile);
    }

    // Token: 0x060002B6 RID: 694 RVA: 0x0001B0C0 File Offset: 0x000192C0
    public static void checkIceBabies(WorldTile pTile)
    {
        if (!WorldLawLibrary.world_law_disasters_other.isEnabled())
        {
            return;
        }
        if (World.world_era.era_disaster_snow_turns_babies_into_ice_ones)
        {
            foreach (Actor tActor in Finder.getUnitsFromChunk(pTile, 1, 3f, false))
            {
                if (tActor.canTurnIntoIceOne())
                {
                    ActionLibrary.turnIntoIceOne(tActor, null);
                }
            }
        }
    }

    // Token: 0x060002B7 RID: 695 RVA: 0x0001B138 File Offset: 0x00019338
    public static void action_cure(WorldTile pTile = null, string pDropID = null)
    {
        foreach (Actor actor in Finder.getUnitsFromChunk(pTile, 1, 4f, false))
        {
            actor.removeTrait("plague");
            actor.removeTrait("tumor_infection");
            actor.removeTrait("mush_spores");
            actor.removeTrait("infected");
            actor.finishStatusEffect("ash_fever");
            actor.finishStatusEffect("cursed");
            actor.startShake(0.3f, 0.1f, true, true);
            actor.startColorEffect(ActorColorEffect.White);
        }
    }

    // Token: 0x060002B8 RID: 696 RVA: 0x0001B1E0 File Offset: 0x000193E0
    public static void action_clone_rain(WorldTile pTile, string pDropID = null)
    {
        foreach (Actor tActor in Finder.getUnitsFromChunk(pTile, 1, 1f, true))
        {
            WorldTile tTileTarget = null;
            foreach (WorldTile tTile in tActor.current_tile.neighboursAll.LoopRandom<WorldTile>())
            {
                if (!tTile.hasUnits())
                {
                    tTileTarget = tTile;
                    break;
                }
            }
            if (tTileTarget != null && World.world.units.cloneUnit(tActor, tTileTarget))
            {
                break;
            }
        }
    }

    // Token: 0x060002B9 RID: 697 RVA: 0x0001B298 File Offset: 0x00019498
    private void action_sleep_rain(WorldTile pTile, string pDropID)
    {
        foreach (Actor tActor in Finder.getUnitsFromChunk(pTile, 1, 3f, false))
        {
            if (tActor.makeSleep(60f) && !tActor.isLying())
            {
                tActor.applyRandomForce(1.5f, 2f);
            }
        }
    }

    // Token: 0x060002BA RID: 698 RVA: 0x0001B30C File Offset: 0x0001950C
    private void action_dispel_rain(WorldTile pTile, string pDropID)
    {
        foreach (Actor tActor in Finder.getUnitsFromChunk(pTile, 1, 3f, false))
        {
            tActor.finishStatusEffect("powerup");
            tActor.finishStatusEffect("enchanted");
            tActor.finishStatusEffect("slowness");
            tActor.finishStatusEffect("shield");
            tActor.finishStatusEffect("invincible");
            tActor.finishStatusEffect("spell_boost");
            if (tActor.asset.die_from_dispel)
            {
                tActor.getHit((float)tActor.getMaxHealthPercent(0.5f), true, AttackType.Other, null, true, false, true);
            }
        }
    }

    // Token: 0x060002BB RID: 699 RVA: 0x0001B3C0 File Offset: 0x000195C0
    public static void action_blood_rain(WorldTile pTile = null, string pDropID = null)
    {
        foreach (Actor actor in Finder.getUnitsFromChunk(pTile, 1, 3f, false))
        {
            actor.finishStatusEffect("burning");
            actor.restoreHealth(actor.getMaxHealthPercent(0.2f));
            actor.startShake(0.3f, 0.1f, true, true);
            actor.startColorEffect(ActorColorEffect.White);
        }
    }

    // Token: 0x060002BC RID: 700 RVA: 0x0001B440 File Offset: 0x00019640
    public static void action_plague(WorldTile pTile = null, string pDropID = null)
    {
        foreach (Actor tActor in Finder.getUnitsFromChunk(pTile, 1, 4f, false))
        {
            if (tActor.hasTrait("plague"))
            {
                tActor.startShake(0.3f, 0.1f, true, true);
                tActor.startColorEffect(ActorColorEffect.White);
            }
            else
            {
                tActor.addTrait("plague", false);
            }
        }
    }

    // Token: 0x060002BD RID: 701 RVA: 0x0001B4C4 File Offset: 0x000196C4
    public static void action_zombie_infection(WorldTile pTile = null, string pDropID = null)
    {
        foreach (Actor tActor in Finder.getUnitsFromChunk(pTile, 1, 3f, false))
        {
            if (tActor.asset.can_turn_into_zombie && !tActor.hasTrait("zombie"))
            {
                tActor.addTrait("infected", false);
                tActor.startShake(0.3f, 0.1f, true, true);
                tActor.startColorEffect(ActorColorEffect.White);
            }
        }
    }

    // Token: 0x060002BE RID: 702 RVA: 0x0001B554 File Offset: 0x00019754
    public static void action_mush_spore(WorldTile pTile = null, string pDropID = null)
    {
        foreach (Actor tActor in Finder.getUnitsFromChunk(pTile, 1, 3f, false))
        {
            if (tActor.asset.can_turn_into_mush && !tActor.hasTrait("mush_spores"))
            {
                tActor.addTrait("mush_spores", false);
                tActor.startShake(0.3f, 0.1f, true, true);
                tActor.startColorEffect(ActorColorEffect.White);
            }
        }
    }

    // Token: 0x060002BF RID: 703 RVA: 0x0001B5E4 File Offset: 0x000197E4
    public static void action_curse(WorldTile pTile = null, string pDropID = null)
    {
        foreach (Actor tActor in Finder.getUnitsFromChunk(pTile, 1, 3f, false))
        {
            if (tActor.addStatusEffect("cursed", 0f, true))
            {
                tActor.setStatsDirty();
                tActor.removeTrait("blessed");
                tActor.startShake(0.3f, 0.1f, true, true);
                tActor.startColorEffect(ActorColorEffect.White);
            }
        }
        BiomeAsset biome = pTile.getBiome();
        if (biome != null && biome.spread_by_drops_curse)
        {
            WorldBehaviourActionBiomes.trySpreadBiomeAround(pTile, pTile, false, false, true);
        }
    }

    // Token: 0x060002C0 RID: 704 RVA: 0x0001B68C File Offset: 0x0001988C
    public static void action_spell_silence(WorldTile pTile = null, string pDropID = null)
    {
        foreach (Actor actor in Finder.getUnitsFromChunk(pTile, 1, 3f, false))
        {
            actor.addStatusEffect("spell_silence", 0f, true);
        }
    }

    // Token: 0x060002C1 RID: 705 RVA: 0x0001B6EC File Offset: 0x000198EC
    public static void action_shield(WorldTile pTile = null, string pDropID = null)
    {
        foreach (Actor actor in Finder.getUnitsFromChunk(pTile, 1, 3f, false))
        {
            actor.addStatusEffect("shield", 0f, true);
        }
    }

    // Token: 0x060002C2 RID: 706 RVA: 0x0001B74C File Offset: 0x0001994C
    public static void action_powerup(WorldTile pTile = null, string pDropID = null)
    {
        foreach (Actor tActor in Finder.getUnitsFromChunk(pTile, 1, 3f, false))
        {
            tActor.addStatusEffect("powerup", 0f, true);
            if (tActor.isSameSpecies("mush_unit") || tActor.isSameSpecies("mush_animal"))
            {
                AchievementLibrary.achievementSuperMushroom.check(null, null, null);
            }
        }
        BiomeAsset biome = pTile.getBiome();
        if (biome != null && biome.spread_by_drops_powerup)
        {
            WorldBehaviourActionBiomes.trySpreadBiomeAround(pTile, pTile, false, false, true);
        }
    }

    // Token: 0x060002C3 RID: 707 RVA: 0x0001B7F0 File Offset: 0x000199F0
    public static void action_paint(WorldTile pTile = null, string pDropID = null)
    {
        TileZone tMainZone = pTile.zone;
        if (!tMainZone.hasCity())
        {
            return;
        }
        City tMainCity = tMainZone.city;
        World.world.city_zone_helper.city_growth.getZoneToClaim(null, tMainCity, true, DropsLibrary._paint_zones_hashset, 1);
        using (ListPool<TileZone> tZones = new ListPool<TileZone>())
        {
            foreach (TileZone tZone in DropsLibrary._paint_zones_hashset)
            {
                if (tZone.city != tMainCity)
                {
                    TileZone[] tNeighbours = tZone.neighbours;
                    for (int i = 0; i < tNeighbours.Length; i++)
                    {
                        if (tNeighbours[i].city == tMainCity)
                        {
                            tZones.Add(tZone);
                        }
                    }
                }
            }
            if (tZones.Count > 0)
            {
                TileZone tRandomZone = tZones.GetRandom<TileZone>();
                tMainCity.addZone(tRandomZone);
                tMainCity.setAbandonedZonesDirty();
            }
            DropsLibrary._paint_zones_hashset.Clear();
        }
    }

    // Token: 0x060002C4 RID: 708 RVA: 0x0001B8F4 File Offset: 0x00019AF4
    public static void action_dust_black(WorldTile pTile = null, string pDropID = null)
    {
        foreach (Actor tActor in Finder.getUnitsFromChunk(pTile, 1, 3f, false))
        {
            if (tActor.asset.affected_by_dust)
            {
                tActor.makeConfused(-1f, true);
            }
        }
    }

    // Token: 0x060002C5 RID: 709 RVA: 0x0001B95C File Offset: 0x00019B5C
    public static void action_dust_white(WorldTile pTile = null, string pDropID = null)
    {
        foreach (Actor tActor in Finder.getUnitsFromChunk(pTile, 1, 3f, false))
        {
            if (tActor.asset.affected_by_dust)
            {
                tActor.forgetLanguage();
            }
        }
    }

    // Token: 0x060002C6 RID: 710 RVA: 0x0001B9BC File Offset: 0x00019BBC
    public static void action_dust_red(WorldTile pTile = null, string pDropID = null)
    {
        foreach (Actor tActor in Finder.getUnitsFromChunk(pTile, 1, 3f, false))
        {
            if (tActor.asset.affected_by_dust)
            {
                tActor.makeConfused(-1f, true);
                if (tActor.hasFamily())
                {
                    tActor.setFamily(null);
                }
                if (tActor.hasClan())
                {
                    tActor.forgetClan();
                }
                if (tActor.hasLover())
                {
                    Actor lover = tActor.lover;
                    tActor.setLover(null);
                    lover.setLover(null);
                }
            }
        }
    }

    // Token: 0x060002C7 RID: 711 RVA: 0x0001BA5C File Offset: 0x00019C5C
    public static void action_dust_blue(WorldTile pTile = null, string pDropID = null)
    {
        foreach (Actor tActor in Finder.getUnitsFromChunk(pTile, 1, 3f, false))
        {
            if (tActor.asset.affected_by_dust)
            {
                tActor.forgetCulture();
            }
        }
    }

    // Token: 0x060002C8 RID: 712 RVA: 0x0001BABC File Offset: 0x00019CBC
    public static void action_dust_gold(WorldTile pTile = null, string pDropID = null)
    {
        foreach (Actor tActor in Finder.getUnitsFromChunk(pTile, 1, 3f, false))
        {
            if (tActor.asset.affected_by_dust)
            {
                tActor.forgetKingdomAndCity();
            }
        }
    }

    // Token: 0x060002C9 RID: 713 RVA: 0x0001BB1C File Offset: 0x00019D1C
    public static void action_dust_purple(WorldTile pTile = null, string pDropID = null)
    {
        foreach (Actor tActor in Finder.getUnitsFromChunk(pTile, 1, 3f, false))
        {
            if (tActor.asset.affected_by_dust)
            {
                tActor.forgetReligion();
            }
        }
    }

    // Token: 0x060002CA RID: 714 RVA: 0x0001BB7C File Offset: 0x00019D7C
    public static void action_coffee(WorldTile pTile = null, string pDropID = null)
    {
        foreach (Actor actor in Finder.getUnitsFromChunk(pTile, 1, 3f, false))
        {
            actor.addStatusEffect("caffeinated", 0f, true);
        }
        BiomeAsset biome = pTile.getBiome();
        if (biome != null && biome.spread_by_drops_coffee)
        {
            WorldBehaviourActionBiomes.trySpreadBiomeAround(pTile, pTile, false, false, true);
        }
    }

    // Token: 0x060002CB RID: 715 RVA: 0x0001BBF8 File Offset: 0x00019DF8
    public static void action_blessing(WorldTile pTile = null, string pDropID = null)
    {
        foreach (Actor tActor in Finder.getUnitsFromChunk(pTile, 1, 3f, false))
        {
            if (tActor.addTrait("blessed", false))
            {
                tActor.setStatsDirty();
                tActor.event_full_stats = true;
            }
            tActor.finishStatusEffect("cursed");
            tActor.startShake(0.3f, 0.1f, true, true);
            if (tActor.isSameSpecies("frog"))
            {
                AchievementLibrary.achievementThePrincess.check(null, null, null);
            }
            tActor.startColorEffect(ActorColorEffect.White);
        }
        BiomeAsset biome = pTile.getBiome();
        if (biome != null && biome.spread_by_drops_blessing)
        {
            WorldBehaviourActionBiomes.trySpreadBiomeAround(pTile, pTile, false, false, true);
        }
    }

    // Token: 0x060002CC RID: 716 RVA: 0x0001BCBC File Offset: 0x00019EBC
    public static void action_alien_mold(WorldTile pTile = null, string pDropID = null)
    {
        foreach (Actor actor in Finder.getUnitsFromChunk(pTile, 1, 3f, false))
        {
            actor.addTrait("desire_alien_mold", false);
        }
    }

    // Token: 0x060002CD RID: 717 RVA: 0x0001BD14 File Offset: 0x00019F14
    public static void action_drop_computer(WorldTile pTile = null, string pDropID = null)
    {
        foreach (Actor actor in Finder.getUnitsFromChunk(pTile, 1, 3f, false))
        {
            actor.addTrait("desire_computer", false);
        }
    }

    // Token: 0x060002CE RID: 718 RVA: 0x0001BD6C File Offset: 0x00019F6C
    public static void action_drop_golden_egg(WorldTile pTile = null, string pDropID = null)
    {
        foreach (Actor actor in Finder.getUnitsFromChunk(pTile, 1, 3f, false))
        {
            actor.addTrait("desire_golden_egg", false);
        }
    }

    // Token: 0x060002CF RID: 719 RVA: 0x0001BDC4 File Offset: 0x00019FC4
    public static void action_drop_harp(WorldTile pTile = null, string pDropID = null)
    {
        foreach (Actor actor in Finder.getUnitsFromChunk(pTile, 1, 3f, false))
        {
            actor.addTrait("desire_harp", false);
        }
    }

    // Token: 0x060002D0 RID: 720 RVA: 0x0001BE1C File Offset: 0x0001A01C
    public static void action_madness(WorldTile pTile = null, string pDropID = null)
    {
        foreach (Actor actor in Finder.getUnitsFromChunk(pTile, 1, 3f, false))
        {
            actor.addTrait("madness", false);
        }
    }

    // Token: 0x060002D1 RID: 721 RVA: 0x0001BE74 File Offset: 0x0001A074
    public static void action_inspiration(WorldTile pTile, string pDropID = null)
    {
        if (!pTile.zone.hasCity())
        {
            return;
        }
        City tCity = pTile.zone_city;
        if (tCity.isNeutral())
        {
            return;
        }
        if (tCity.kingdom.cities.Count == 1)
        {
            return;
        }
        if (tCity.isCapitalCity())
        {
            return;
        }
        if (!tCity.hasLeader())
        {
            return;
        }
        tCity.leader.addStatusEffect("voices_in_my_head", 0f, true);
        tCity.useInspire(tCity.leader);
    }

    // Token: 0x060002D2 RID: 722 RVA: 0x0001BEE8 File Offset: 0x0001A0E8
    public static void action_discord(WorldTile pTile, string pDropID = null)
    {
        if (!pTile.zone.hasCity())
        {
            return;
        }
        City tCity = pTile.zone_city;
        if (tCity == null)
        {
            return;
        }
        if (tCity.isNeutral())
        {
            return;
        }
        Alliance tAlliance = tCity.kingdom.getAlliance();
        if (tAlliance == null)
        {
            return;
        }
        World.world.alliances.useDiscordPower(tAlliance, tCity);
    }

    // Token: 0x060002D3 RID: 723 RVA: 0x0001BF38 File Offset: 0x0001A138
    public static void action_spite(WorldTile pTile, string pDropID = null)
    {
        if (!pTile.zone.hasCity())
        {
            return;
        }
        Kingdom tKingdom = pTile.zone.city.kingdom;
        if (tKingdom.isNeutral())
        {
            return;
        }
        World.world.diplomacy.eventSpite(tKingdom);
    }

    // Token: 0x060002D4 RID: 724 RVA: 0x0001BF80 File Offset: 0x0001A180
    public static void action_friendship(WorldTile pTile, string pDropID = null)
    {
        if (!pTile.zone.hasCity())
        {
            return;
        }
        Kingdom tKingdom = pTile.zone.city.kingdom;
        if (tKingdom.isNeutral())
        {
            return;
        }
        World.world.diplomacy.eventFriendship(tKingdom);
    }

    // Token: 0x060002D5 RID: 725 RVA: 0x0001BFC8 File Offset: 0x0001A1C8
    public static void action_spawn_building(WorldTile pTile = null, string pDropID = null)
    {
        string tBuildingAssetID = AssetManager.drops.get(pDropID).getRandomBuildingAsset();
        BuildingAsset tBuildingAsset = AssetManager.buildings.get(tBuildingAssetID);
        Building tNewBuilding = World.world.buildings.addBuilding(tBuildingAssetID, pTile, true, false, BuildPlacingType.New);
        if (tNewBuilding == null)
        {
            EffectsLibrary.spawnAtTile("fx_bad_place", pTile, 0.25f);
            return;
        }
        tBuildingAsset.checkLimits(tNewBuilding);
    }

    // Token: 0x060002D6 RID: 726 RVA: 0x0001C023 File Offset: 0x0001A223
    public static void flash(WorldTile pTile, string pDropID)
    {
        World.world.flash_effects.flashPixel(pTile, 20, ColorType.White);
    }

    // Token: 0x060002D7 RID: 727 RVA: 0x0001C038 File Offset: 0x0001A238
    public static void action_fertilizer_plants(WorldTile pTile = null, string pDropID = null)
    {
        BuildingActions.tryGrowVegetationRandom(pTile, VegetationType.Plants, false, false, false);
        if (pTile.Type.biome_asset == null)
        {
            return;
        }
        if (pTile.Type.biome_asset.grow_type_selector_plants == null)
        {
            EffectsLibrary.spawnAtTile("fx_bad_place", pTile, 0.25f);
        }
    }

    // Token: 0x060002D8 RID: 728 RVA: 0x0001C078 File Offset: 0x0001A278
    public static void action_fertilizer_trees(WorldTile pTile = null, string pDropID = null)
    {
        BiomeAsset tBiomeAsset = pTile.Type.biome_asset;
        BuildingActions.tryGrowVegetationRandom(pTile, VegetationType.Trees, false, false, false);
        if (tBiomeAsset == null)
        {
            return;
        }
        if (tBiomeAsset.grow_type_selector_trees == null)
        {
            EffectsLibrary.spawnAtTile("fx_bad_place", pTile, 0.25f);
        }
    }

    // Token: 0x060002D9 RID: 729 RVA: 0x0001C0B8 File Offset: 0x0001A2B8
    public static void action_fruit_bush(WorldTile pTile = null, string pDropID = null)
    {
        BuildingAsset tBuildingAsset = AssetManager.buildings.get("fruit_bush");
        BuildingActions.tryGrowVegetation(pTile, tBuildingAsset.id, true, false);
        if (!tBuildingAsset.isOverlaysBiomeTags(pTile.Type))
        {
            EffectsLibrary.spawnAtTile("fx_bad_place", pTile, 0.25f);
        }
    }

    // Token: 0x060002DA RID: 730 RVA: 0x0001C103 File Offset: 0x0001A303
    public static void action_landmine(WorldTile pTile = null, string pDropID = null)
    {
        if (pTile.Type.lava)
        {
            World.world.explosion_layer.explodeBomb(pTile, false);
            return;
        }
        MapAction.terraformTop(pTile, TopTileLibrary.landmine, TerraformLibrary.remove);
    }

    // Token: 0x060002DB RID: 731 RVA: 0x0001C134 File Offset: 0x0001A334
    public static void action_living_house(WorldTile pTile = null, string pDropID = null)
    {
        TileZone tZone = pTile.zone;
        if (!tZone.hasAnyBuildings())
        {
            return;
        }
        using (ListPool<Building> tTempPool = new ListPool<Building>())
        {
            if (tZone.hasAnyBuildingsInSet(BuildingList.Civs))
            {
                tTempPool.AddRange(tZone.getHashset(BuildingList.Civs));
            }
            if (tZone.hasAnyBuildingsInSet(BuildingList.Ruins))
            {
                tTempPool.AddRange(tZone.getHashset(BuildingList.Ruins));
            }
            if (tZone.hasAnyBuildingsInSet(BuildingList.Abandoned))
            {
                tTempPool.AddRange(tZone.getHashset(BuildingList.Abandoned));
            }
            for (int i = 0; i < tTempPool.Count; i++)
            {
                ActionLibrary.tryToMakeBuildingAlive(tTempPool[i]);
            }
        }
    }

    // Token: 0x060002DC RID: 732 RVA: 0x0001C1D4 File Offset: 0x0001A3D4
    public static void action_living_plants(WorldTile pTile = null, string pDropID = null)
    {
        TileZone tZone = pTile.zone;
        if (!tZone.hasAnyBuildings())
        {
            return;
        }
        using (ListPool<Building> tTempPool = new ListPool<Building>())
        {
            if (tZone.hasAnyBuildingsInSet(BuildingList.Food))
            {
                tTempPool.AddRange(tZone.getHashset(BuildingList.Food));
            }
            if (tZone.hasAnyBuildingsInSet(BuildingList.Trees))
            {
                tTempPool.AddRange(tZone.getHashset(BuildingList.Trees));
            }
            if (tZone.hasAnyBuildingsInSet(BuildingList.Wheat))
            {
                tTempPool.AddRange(tZone.getHashset(BuildingList.Wheat));
            }
            for (int i = 0; i < tTempPool.Count; i++)
            {
                ActionLibrary.tryToMakeFloraAlive(tTempPool[i], true);
            }
        }
    }

    // Token: 0x04000251 RID: 593
    private const string TEMPLATE_BIOME_SEEDS = "$biome_seeds$";

    // Token: 0x04000252 RID: 594
    private const string TEMPLATE_SPAWN_BUILDING = "$spawn_building$";

    // Token: 0x04000253 RID: 595
    private const string TEMPLATE_SPAWN_MINERAL = "$spawn_mineral$";

    // Token: 0x04000254 RID: 596
    private const string TEMPLATE_SPAWN_CREEP = "$spawn_creep$";

    // Token: 0x04000255 RID: 597
    private static HashSet<TileZone> _paint_zones_hashset = new HashSet<TileZone>();
}
using System;
using System.ComponentModel;
using Newtonsoft.Json;

// Token: 0x020000F5 RID: 245
[Serializable]
public class EffectAsset : Asset
{
    // Token: 0x17000023 RID: 35
    // (get) Token: 0x06000718 RID: 1816 RVA: 0x00067D84 File Offset: 0x00065F84
    [JsonIgnore]
    public bool has_sound_launch
    {
        get
        {
            return this.sound_launch != null;
        }
    }

    // Token: 0x17000024 RID: 36
    // (get) Token: 0x06000719 RID: 1817 RVA: 0x00067D92 File Offset: 0x00065F92
    [JsonIgnore]
    public bool has_sound_loop_idle
    {
        get
        {
            return this.sound_loop_idle != null;
        }
    }

    // Token: 0x0600071A RID: 1818 RVA: 0x00067DA0 File Offset: 0x00065FA0
    public bool checkIsUnderCooldown()
    {
        double tCurTime = World.world.getCurSessionTime();
        if (tCurTime - this._cooldown < this.cooldown_interval)
        {
            return true;
        }
        this._cooldown = tCurTime;
        return false;
    }

    // Token: 0x040007AF RID: 1967
    public string prefab_id;

    // Token: 0x040007B0 RID: 1968
    public bool use_basic_prefab;

    // Token: 0x040007B1 RID: 1969
    public bool load_texture;

    // Token: 0x040007B2 RID: 1970
    public string sprite_path;

    // Token: 0x040007B3 RID: 1971
    public string sorting_layer_id;

    // Token: 0x040007B4 RID: 1972
    [DefaultValue(0.1f)]
    public float time_between_frames = 0.1f;

    // Token: 0x040007B5 RID: 1973
    public int limit;

    // Token: 0x040007B6 RID: 1974
    public string sound_launch;

    // Token: 0x040007B7 RID: 1975
    public string sound_loop_idle;

    // Token: 0x040007B8 RID: 1976
    public bool show_on_mini_map;

    // Token: 0x040007B9 RID: 1977
    public EffectAction spawn_action;

    // Token: 0x040007BA RID: 1978
    public double cooldown_interval;

    // Token: 0x040007BB RID: 1979
    private double _cooldown;

    // Token: 0x040007BC RID: 1980
    public bool draw_light_area;

    // Token: 0x040007BD RID: 1981
    public float draw_light_area_offset_x;

    // Token: 0x040007BE RID: 1982
    public float draw_light_area_offset_y;

    // Token: 0x040007BF RID: 1983
    [DefaultValue(0.5f)]
    public float draw_light_size = 0.5f;
}
using System;
using UnityEngine;

// Token: 0x020000F6 RID: 246
public class EffectsLibrary : AssetLibrary<EffectAsset>
{
    // Token: 0x0600071C RID: 1820 RVA: 0x00067DF0 File Offset: 0x00065FF0
    public override void init()
    {
        base.init();
        this.add(new EffectAsset
        {
            id = "fx_spores",
            prefab_id = "effects/prefabs/PrefabSpores",
            show_on_mini_map = true,
            limit = 200
        });
        this.add(new EffectAsset
        {
            id = "fx_fireball_explosion",
            sprite_path = "effects/fx_fireball_explosion",
            sorting_layer_id = "EffectsTop",
            use_basic_prefab = true,
            draw_light_area = true,
            sound_launch = "event:/SFX/EXPLOSIONS/ExplosionSmall"
        });
        this.add(new EffectAsset
        {
            id = "fx_firebomb_explosion",
            sprite_path = "effects/fx_firebomb_explosion",
            sorting_layer_id = "EffectsTop",
            use_basic_prefab = true,
            draw_light_area = true,
            sound_launch = "event:/SFX/EXPLOSIONS/ExplosionSmall"
        });
        this.add(new EffectAsset
        {
            id = "fx_plasma_ball_explosion",
            sprite_path = "effects/fx_plasma_ball_explosion",
            sorting_layer_id = "EffectsTop",
            use_basic_prefab = true,
            draw_light_area = true
        });
        this.add(new EffectAsset
        {
            id = "fx_cast_ground_blue",
            use_basic_prefab = true,
            sorting_layer_id = "EffectsBack",
            sprite_path = "effects/fx_cast_ground_blue_t",
            draw_light_area = true,
            draw_light_size = 0.2f,
            limit = 60
        });
        this.add(new EffectAsset
        {
            id = "fx_cast_top_blue",
            use_basic_prefab = true,
            sorting_layer_id = "EffectsTop",
            sprite_path = "effects/fx_cast_top_blue_t",
            draw_light_area = true,
            draw_light_size = 0.2f,
            limit = 60
        });
        this.add(new EffectAsset
        {
            id = "fx_cast_ground_red",
            use_basic_prefab = true,
            sorting_layer_id = "EffectsBack",
            sprite_path = "effects/fx_cast_ground_red_t",
            draw_light_area = true,
            draw_light_size = 0.2f,
            limit = 60
        });
        this.add(new EffectAsset
        {
            id = "fx_cast_top_red",
            use_basic_prefab = true,
            sorting_layer_id = "EffectsTop",
            sprite_path = "effects/fx_cast_top_red_t",
            draw_light_area = true,
            draw_light_size = 0.2f,
            limit = 60
        });
        this.add(new EffectAsset
        {
            id = "fx_cast_ground_green",
            use_basic_prefab = true,
            sorting_layer_id = "EffectsBack",
            sprite_path = "effects/fx_cast_ground_green_t",
            draw_light_area = true,
            draw_light_size = 0.2f,
            limit = 60
        });
        this.add(new EffectAsset
        {
            id = "fx_cast_ground_purple",
            use_basic_prefab = true,
            sorting_layer_id = "EffectsBack",
            sprite_path = "effects/fx_cast_ground_purple_t",
            draw_light_area = true,
            draw_light_size = 0.2f,
            limit = 60
        });
        this.add(new EffectAsset
        {
            id = "fx_cast_top_green",
            use_basic_prefab = true,
            sorting_layer_id = "EffectsTop",
            sprite_path = "effects/fx_cast_top_green_t",
            draw_light_area = true,
            draw_light_size = 0.2f,
            limit = 60
        });
        this.add(new EffectAsset
        {
            id = "fx_create_skeleton",
            use_basic_prefab = true,
            sorting_layer_id = "EffectsTop",
            sprite_path = "effects/fx_create_skeleton_t",
            draw_light_area = true,
            show_on_mini_map = true,
            limit = 0
        });
        this.add(new EffectAsset
        {
            id = "fx_teleport_blue",
            use_basic_prefab = true,
            sorting_layer_id = "EffectsTop",
            sprite_path = "effects/fx_teleport_blue_t",
            draw_light_area = true,
            limit = 100
        });
        this.add(new EffectAsset
        {
            id = "fx_teleport_red",
            use_basic_prefab = true,
            sorting_layer_id = "EffectsTop",
            sprite_path = "effects/fx_teleport_red_t",
            draw_light_area = true,
            limit = 100
        });
        this.add(new EffectAsset
        {
            id = "fx_shield_hit",
            use_basic_prefab = true,
            sorting_layer_id = "EffectsTop",
            sprite_path = "effects/fx_shield_hit_t",
            draw_light_area = true,
            limit = 200
        });
        this.add(new EffectAsset
        {
            id = "fx_dodge",
            use_basic_prefab = true,
            sorting_layer_id = "EffectsBack",
            sprite_path = "effects/combat_actions/fx_action_dodge_t",
            limit = 100
        });
        this.add(new EffectAsset
        {
            id = "fx_block",
            use_basic_prefab = true,
            sorting_layer_id = "EffectsTop",
            sprite_path = "effects/combat_actions/fx_action_block_t",
            limit = 10
        });
        this.add(new EffectAsset
        {
            id = "fx_monolith_launch",
            use_basic_prefab = true,
            sorting_layer_id = "EffectsTop",
            sprite_path = "effects/fx_monolith_launch",
            limit = 10
        });
        this.add(new EffectAsset
        {
            id = "fx_monolith_launch_bottom",
            use_basic_prefab = true,
            sorting_layer_id = "EffectsBack",
            sprite_path = "effects/fx_monolith_launch_bottom",
            limit = 10
        });
        this.add(new EffectAsset
        {
            id = "fx_monolith_glow_1",
            use_basic_prefab = true,
            sorting_layer_id = "Objects",
            sprite_path = "effects/fx_monolith_glow_1",
            limit = 10
        });
        this.add(new EffectAsset
        {
            id = "fx_monolith_glow_2",
            use_basic_prefab = true,
            sorting_layer_id = "Objects",
            sprite_path = "effects/fx_monolith_glow_2",
            limit = 10
        });
        this.add(new EffectAsset
        {
            id = "fx_waypoint_alien_mold_launch_bottom",
            use_basic_prefab = true,
            sorting_layer_id = "EffectsBack",
            sprite_path = "effects/fx_waypoint_alien_mold_launch_bottom",
            limit = 10
        });
        this.add(new EffectAsset
        {
            id = "fx_waypoint_computer_launch_bottom",
            use_basic_prefab = true,
            sorting_layer_id = "EffectsTop",
            sprite_path = "effects/fx_waypoint_computer_launch_bottom",
            limit = 10
        });
        this.add(new EffectAsset
        {
            id = "fx_waypoint_golden_egg_launch_bottom",
            use_basic_prefab = true,
            sorting_layer_id = "EffectsTop",
            sprite_path = "effects/fx_waypoint_golden_egg_launch_bottom",
            limit = 10
        });
        this.add(new EffectAsset
        {
            id = "fx_waypoint_harp_launch_bottom",
            use_basic_prefab = true,
            sorting_layer_id = "EffectsBack",
            sprite_path = "effects/fx_waypoint_harp_launch_bottom",
            limit = 10
        });
        this.add(new EffectAsset
        {
            id = "fx_bad_place",
            use_basic_prefab = true,
            sorting_layer_id = "EffectsBack",
            sprite_path = "effects/fx_bad_place_t",
            draw_light_area = true,
            limit = 10,
            show_on_mini_map = true
        });
        this.add(new EffectAsset
        {
            id = "fx_debug_tile",
            use_basic_prefab = true,
            sorting_layer_id = "EffectsTop",
            sprite_path = "effects/fx_debug_tile",
            draw_light_area = true,
            time_between_frames = 3f,
            show_on_mini_map = true
        });
        this.add(new EffectAsset
        {
            id = "fx_move",
            use_basic_prefab = true,
            sorting_layer_id = "EffectsBack",
            sprite_path = "effects/fx_move_t",
            draw_light_area = true,
            limit = 30,
            show_on_mini_map = true
        });
        this.add(new EffectAsset
        {
            id = "fx_plasma_trail",
            use_basic_prefab = true,
            sorting_layer_id = "EffectsTop",
            sprite_path = "effects/fx_plasma_trail_t",
            draw_light_area = true,
            show_on_mini_map = true,
            limit = 15
        });
        this.add(new EffectAsset
        {
            id = "fx_building_sparkle",
            use_basic_prefab = true,
            sorting_layer_id = "EffectsTop",
            sprite_path = "effects/fx_building_sparkle_t",
            limit = 15
        });
        this.add(new EffectAsset
        {
            id = "fx_fire_smoke",
            prefab_id = "Prefabs/PrefabFireSmoke",
            show_on_mini_map = true
        });
        this.add(new EffectAsset
        {
            id = "fx_boulder_charge",
            prefab_id = "Prefabs/PrefabBoulderCharge",
            show_on_mini_map = true
        });
        this.add(new EffectAsset
        {
            id = "fx_spark",
            prefab_id = "Prefabs/PrefabSpark",
            show_on_mini_map = true
        });
        this.add(new EffectAsset
        {
            id = "fx_lightning_big",
            prefab_id = "effects/prefabs/PrefabLightning",
            show_on_mini_map = true,
            limit = 100,
            draw_light_area = true,
            draw_light_size = 2f,
            draw_light_area_offset_y = 5f,
            sound_launch = "event:/SFX/EXPLOSIONS/ExplosionLightningStrike"
        });
        this.add(new EffectAsset
        {
            id = "fx_lightning_medium",
            prefab_id = "effects/prefabs/PrefabLightningMedium",
            show_on_mini_map = true,
            limit = 100,
            draw_light_area = true,
            draw_light_size = 2f,
            draw_light_area_offset_y = 5f,
            sound_launch = "event:/SFX/EXPLOSIONS/ExplosionLightningStrike"
        });
        this.add(new EffectAsset
        {
            id = "fx_lightning_small",
            prefab_id = "effects/prefabs/PrefabLightningSmall",
            show_on_mini_map = true,
            limit = 100,
            draw_light_area = true,
            draw_light_size = 2f,
            draw_light_area_offset_y = 5f,
            sound_launch = "event:/SFX/EXPLOSIONS/ExplosionLightningStrike"
        });
        this.add(new EffectAsset
        {
            id = "fx_spawn",
            prefab_id = "effects/prefabs/PrefabSpawnSmall",
            show_on_mini_map = false,
            draw_light_area = true,
            spawn_action = new EffectAction(this.showSpawnEffect),
            limit = 100
        });
        this.add(new EffectAsset
        {
            id = "fx_teleport_singularity",
            use_basic_prefab = true,
            sorting_layer_id = "EffectsTop",
            sprite_path = "effects/fx_teleport_singularity",
            draw_light_area = true,
            limit = 0
        });
        this.add(new EffectAsset
        {
            id = "fx_spawn_big",
            prefab_id = "effects/prefabs/PrefabSpawnBig",
            show_on_mini_map = true,
            spawn_action = new EffectAction(this.spawnSimpleTile),
            draw_light_area = true,
            draw_light_size = 2f,
            sound_launch = "event:/SFX/UNIQUE/Crabzilla/CrabzillaSpawn"
        });
        this.add(new EffectAsset
        {
            id = "fx_land_explosion_old",
            prefab_id = "effects/prefabs/PrefabFireballExplosion",
            show_on_mini_map = true,
            draw_light_area = true,
            sound_launch = "event:/SFX/EXPLOSIONS/ExplosionSmall"
        });
        this.add(new EffectAsset
        {
            id = "fx_explosion_crab_bomb",
            prefab_id = "effects/prefabs/PrefabFireballExplosion",
            show_on_mini_map = true,
            draw_light_area = true,
            sound_launch = "event:/SFX/EXPLOSIONS/ExplosionCrabBomb"
        });
        this.add(new EffectAsset
        {
            id = "fx_explosion_tiny",
            prefab_id = "effects/prefabs/PrefabExplosionSmall",
            show_on_mini_map = true,
            draw_light_area = true,
            sound_launch = "event:/SFX/EXPLOSIONS/ExplosionTiny"
        });
        this.add(new EffectAsset
        {
            id = "fx_explosion_small",
            prefab_id = "effects/prefabs/PrefabExplosionSmall",
            show_on_mini_map = true,
            draw_light_area = true,
            draw_light_size = 1f,
            sound_launch = "event:/SFX/EXPLOSIONS/ExplosionSmall"
        });
        this.add(new EffectAsset
        {
            id = "fx_explosion_ufo",
            prefab_id = "effects/prefabs/PrefabExplosionSmall",
            show_on_mini_map = true,
            draw_light_area = true,
            draw_light_size = 1f,
            sound_launch = "event:/SFX/EXPLOSIONS/ExplosionUFO"
        });
        this.add(new EffectAsset
        {
            id = "fx_explosion_meteorite",
            prefab_id = "effects/prefabs/PrefabExplosionSmall",
            show_on_mini_map = true,
            draw_light_area = true,
            draw_light_size = 2f,
            sound_launch = "event:/SFX/EXPLOSIONS/ExplosionMeteorite"
        });
        this.add(new EffectAsset
        {
            id = "fx_explosion_middle",
            prefab_id = "effects/prefabs/PrefabExplosionSmall",
            show_on_mini_map = true,
            draw_light_area = true,
            draw_light_size = 2f,
            sound_launch = "event:/SFX/EXPLOSIONS/ExplosionSmall"
        });
        this.add(new EffectAsset
        {
            id = "fx_explosion_nuke_atomic",
            show_on_mini_map = true,
            prefab_id = "effects/prefabs/PrefabExplosionBig",
            draw_light_area = true,
            draw_light_size = 5f,
            sound_launch = "event:/SFX/EXPLOSIONS/ExplosionBig"
        });
        this.add(new EffectAsset
        {
            id = "fx_explosion_huge",
            show_on_mini_map = true,
            prefab_id = "effects/prefabs/PrefabExplosionBig",
            draw_light_area = true,
            draw_light_size = 5f,
            sound_launch = "event:/SFX/EXPLOSIONS/ExplosionHuge"
        });
        this.add(new EffectAsset
        {
            id = "fx_explosion_wave",
            prefab_id = "effects/prefabs/PrefabExplosionWave",
            show_on_mini_map = true
        });
        this.add(new EffectAsset
        {
            id = "fx_fireworks",
            prefab_id = "effects/prefabs/PrefabFireworks",
            show_on_mini_map = true,
            spawn_action = new EffectAction(this.spawnFireworks),
            cooldown_interval = 0.20000000298023224,
            draw_light_area = true,
            draw_light_size = 4f,
            draw_light_area_offset_y = 40f,
            sound_launch = "event:/SFX/EXPLOSIONS/ExplosionFireworks"
        });
        this.add(new EffectAsset
        {
            id = "fx_hearts",
            prefab_id = "effects/prefabs/PrefabHearts",
            sorting_layer_id = "EffectsTop",
            limit = 10
        });
        this.add(new EffectAsset
        {
            id = "fx_new_border",
            prefab_id = "effects/prefabs/PrefabNewBorder",
            sorting_layer_id = "EffectsTop",
            limit = 10
        });
        this.add(new EffectAsset
        {
            id = "fx_money_got_loot",
            prefab_id = "effects/prefabs/PrefabMoneyGotLoot",
            sorting_layer_id = "EffectsTop",
            limit = 10
        });
        this.add(new EffectAsset
        {
            id = "fx_money_got_money",
            prefab_id = "effects/prefabs/PrefabMoneyGotMoney",
            sorting_layer_id = "EffectsTop",
            limit = 10
        });
        this.add(new EffectAsset
        {
            id = "fx_money_paid_tax",
            prefab_id = "effects/prefabs/PrefabMoneyPaidTax",
            sorting_layer_id = "EffectsTop",
            limit = 10
        });
        this.add(new EffectAsset
        {
            id = "fx_money_paid_tribute",
            prefab_id = "effects/prefabs/PrefabMoneyPaidTribute",
            sorting_layer_id = "EffectsTop",
            limit = 10
        });
        this.add(new EffectAsset
        {
            id = "fx_money_spend_money",
            prefab_id = "effects/prefabs/PrefabMoneySpendMoney",
            sorting_layer_id = "EffectsTop",
            limit = 10
        });
        this.add(new EffectAsset
        {
            id = "fx_conversion_religion",
            load_texture = true,
            prefab_id = "effects/prefabs/PrefabMetaEvent",
            sprite_path = "effects/fx_conversion_religion",
            sorting_layer_id = "EffectsTop",
            limit = 10
        });
        this.add(new EffectAsset
        {
            id = "fx_conversion_culture",
            load_texture = true,
            prefab_id = "effects/prefabs/PrefabMetaEvent",
            sprite_path = "effects/fx_conversion_culture",
            sorting_layer_id = "EffectsTop",
            limit = 10
        });
        this.add(new EffectAsset
        {
            id = "fx_conversion_language",
            load_texture = true,
            prefab_id = "effects/prefabs/PrefabMetaEvent",
            sprite_path = "effects/fx_conversion_language",
            sorting_layer_id = "EffectsTop",
            limit = 10
        });
        this.add(new EffectAsset
        {
            id = "fx_experience_gain",
            load_texture = true,
            prefab_id = "effects/prefabs/PrefabMetaEvent",
            sprite_path = "effects/fx_experience_gain",
            sorting_layer_id = "EffectsTop",
            limit = 10
        });
        this.add(new EffectAsset
        {
            id = "fx_change_happiness_positive",
            load_texture = true,
            prefab_id = "effects/prefabs/PrefabMetaEvent",
            sprite_path = "effects/fx_change_happiness_positive",
            sorting_layer_id = "EffectsTop",
            limit = 10
        });
        this.add(new EffectAsset
        {
            id = "fx_change_happiness_negative",
            load_texture = true,
            prefab_id = "effects/prefabs/PrefabMetaEvent",
            sprite_path = "effects/fx_change_happiness_negative",
            sorting_layer_id = "EffectsTop",
            limit = 10
        });
        this.add(new EffectAsset
        {
            id = "fx_hmm",
            prefab_id = "effects/prefabs/PrefabHmm",
            sorting_layer_id = "EffectsTop",
            limit = 10
        });
        this.add(new EffectAsset
        {
            id = "fx_plot_progress",
            prefab_id = "effects/prefabs/PrefabPlotProgress",
            sorting_layer_id = "EffectsTop",
            limit = 10
        });
        this.add(new EffectAsset
        {
            id = "fx_nuke_flash",
            prefab_id = "effects/prefabs/PrefabNukeFlash",
            show_on_mini_map = true,
            draw_light_area = true,
            draw_light_size = 3f,
            spawn_action = new EffectAction(this.spawnNukeFlash)
        });
        this.add(new EffectAsset
        {
            id = "fx_napalm_flash",
            show_on_mini_map = true,
            sound_launch = "event:/SFX/EXPLOSIONS/ExplosionMiddle",
            prefab_id = "effects/prefabs/PrefabNapalmFlash",
            draw_light_area = true,
            draw_light_size = 2f,
            spawn_action = new EffectAction(this.spawnNapalmFlash)
        });
        this.add(new EffectAsset
        {
            id = "fx_thunder_flash",
            prefab_id = "effects/prefabs/PrefabThunderFlash",
            limit = 3,
            show_on_mini_map = true,
            sound_launch = "event:/SFX/EXPLOSIONS/ExplosionLightningStrike",
            spawn_action = new EffectAction(this.spawnThunderFlash)
        });
        this.add(new EffectAsset
        {
            id = "fx_boulder_impact",
            prefab_id = "effects/prefabs/PrefabBoulderImpact",
            show_on_mini_map = true,
            sound_launch = "event:/SFX/DESTRUCTION/DropSimpleImpact"
        });
        this.add(new EffectAsset
        {
            id = "fx_boulder_impact_water",
            prefab_id = "effects/prefabs/PrefabBoulderImpactWater",
            show_on_mini_map = true,
            sound_launch = "event:/SFX/DESTRUCTION/DropSimpleImpact"
        });
        this.add(new EffectAsset
        {
            id = "fx_antimatter_effect",
            prefab_id = "effects/prefabs/PrefabAntimatterEffect",
            show_on_mini_map = true,
            sound_launch = "event:/SFX/EXPLOSIONS/ExplosionAntimatterBomb",
            spawn_action = new EffectAction(this.spawnSimpleTile)
        });
        this.add(new EffectAsset
        {
            id = "fx_infinity_coin",
            show_on_mini_map = true,
            prefab_id = "effects/prefabs/PrefabInfinityCoin",
            spawn_action = new EffectAction(this.spawnSimpleTile),
            draw_light_area = true,
            draw_light_size = 1f,
            sound_launch = "event:/SFX/DESTRUCTION/InfinityCoin"
        });
        this.add(new EffectAsset
        {
            id = "fx_status_particle",
            prefab_id = "effects/prefabs/PrefabStatusParticle",
            limit = 10
        });
        this.add(new EffectAsset
        {
            id = "fx_weapon_particle",
            prefab_id = "effects/prefabs/PrefabStatusParticle",
            limit = 50
        });
        this.add(new EffectAsset
        {
            id = "fx_slash",
            prefab_id = "effects/prefabs/PrefabSlash",
            limit = 40
        });
        this.add(new EffectAsset
        {
            id = "fx_hit",
            prefab_id = "effects/prefabs/PrefabHit",
            limit = 20
        });
        this.add(new EffectAsset
        {
            id = "fx_miss",
            prefab_id = "effects/prefabs/PrefabMiss",
            limit = 10
        });
        this.add(new EffectAsset
        {
            id = "fx_jump",
            sorting_layer_id = "EffectsBack",
            load_texture = true,
            sprite_path = "effects/jump",
            use_basic_prefab = true,
            limit = 10
        });
        this.add(new EffectAsset
        {
            id = "fx_walk",
            sorting_layer_id = "EffectsBack",
            load_texture = true,
            sprite_path = "effects/walk",
            limit = 15,
            use_basic_prefab = true,
            cooldown_interval = 0.15000000596046448
        });
        this.add(new EffectAsset
        {
            id = "fx_hit_critical",
            prefab_id = "effects/prefabs/PrefabHitCritical",
            limit = 10
        });
        this.add(new EffectAsset
        {
            id = "fx_boat_explosion",
            prefab_id = "effects/prefabs/PrefabBoatExplosion",
            draw_light_area = true,
            limit = 20
        });
        this.add(new EffectAsset
        {
            id = "fx_fishnet",
            prefab_id = "effects/prefabs/PrefabFishnet",
            limit = 20,
            sound_launch = "event:/SFX/CIVILIZATIONS/SpawnFishnet"
        });
        this.add(new EffectAsset
        {
            id = "fx_tile_effect",
            prefab_id = "effects/prefabs/PrefabTileEffect",
            limit = 20,
            show_on_mini_map = false,
            spawn_action = new EffectAction(this.spawnSimpleTile)
        });
        this.add(new EffectAsset
        {
            id = "fx_cloud",
            prefab_id = "effects/prefabs/PrefabCloud",
            show_on_mini_map = true,
            limit = 200,
            spawn_action = new EffectAction(this.spawnCloud)
        });
        this.add(new EffectAsset
        {
            id = "fx_meteorite",
            prefab_id = "effects/prefabs/PrefabMeteorite",
            show_on_mini_map = true,
            spawn_action = new EffectAction(this.spawnMeteorite),
            sound_launch = "event:/SFX/DESTRUCTION/FallMeteorite"
        });
        this.add(new EffectAsset
        {
            id = "fx_boulder",
            prefab_id = "effects/prefabs/PrefabBoulder",
            show_on_mini_map = true,
            spawn_action = new EffectAction(this.spawnBoulder)
        });
        this.add(new EffectAsset
        {
            id = "fx_santa",
            prefab_id = "effects/prefabs/PrefabSanta",
            show_on_mini_map = true,
            spawn_action = new EffectAction(this.spawnSanta),
            sound_loop_idle = "event:/SFX/OTHER/RoboSanta/RoboSantaIdleLoop",
            limit = 100
        });
        this.add(new EffectAsset
        {
            id = "fx_zone_highlight",
            prefab_id = "effects/prefabs/PrefabZoneFlash",
            show_on_mini_map = true,
            spawn_action = new EffectAction(this.spawnZoneFlash)
        });
        this.add(new EffectAsset
        {
            id = "fx_tornado",
            prefab_id = "effects/prefabs/PrefabTornado",
            show_on_mini_map = true,
            sound_loop_idle = "event:/SFX/NATURE/TornadoIdleLoop"
        });
    }

    // Token: 0x0600071D RID: 1821 RVA: 0x0006948C File Offset: 0x0006768C
    public override void editorDiagnostic()
    {
        base.editorDiagnostic();
        foreach (EffectAsset tAsset in this.list)
        {
            if (tAsset.use_basic_prefab || tAsset.load_texture)
            {
                if (tAsset.sorting_layer_id == null)
                {
                    BaseAssetLibrary.logAssetError("EffectsLibrary: sorting_layer_id is missing", tAsset.id);
                }
                if (tAsset.sprite_path == null)
                {
                    BaseAssetLibrary.logAssetError("EffectsLibrary: sprite_path is missing", tAsset.id);
                }
            }
            if (!tAsset.use_basic_prefab && tAsset.prefab_id == null)
            {
                BaseAssetLibrary.logAssetError("EffectsLibrary: prefab_id is missing", tAsset.id);
            }
        }
    }

    // Token: 0x0600071E RID: 1822 RVA: 0x00069540 File Offset: 0x00067740
    private static BaseEffect check(string pID)
    {
        EffectAsset tAsset = AssetManager.effects_library.get(pID);
        if (tAsset == null)
        {
            return null;
        }
        if (tAsset.cooldown_interval > 0.0 && tAsset.checkIsUnderCooldown())
        {
            return null;
        }
        if (!tAsset.show_on_mini_map && MapBox.isRenderMiniMap())
        {
            return null;
        }
        return World.world.stack_effects.get(pID).spawnNew();
    }

    // Token: 0x0600071F RID: 1823 RVA: 0x000695A0 File Offset: 0x000677A0
    public static BaseEffect spawnAtTileRandomScale(string pID, WorldTile pTile, float pScaleMin, float pScaleMax)
    {
        float tScale = Randy.randomFloat(pScaleMin, pScaleMax);
        return EffectsLibrary.spawnAtTile(pID, pTile, tScale);
    }

    // Token: 0x06000720 RID: 1824 RVA: 0x000695C0 File Offset: 0x000677C0
    public static void spawnDebugTile(WorldTile pTile, Color pColor)
    {
        if (pTile == null)
        {
            return;
        }
        BaseEffect tEffect = EffectsLibrary.spawnAtTile("fx_debug_tile", pTile, 0.75f);
        if (tEffect == null)
        {
            return;
        }
        pColor.a = 0.7f;
        tEffect.sprite_renderer.color = pColor;
    }

    // Token: 0x06000721 RID: 1825 RVA: 0x00069604 File Offset: 0x00067804
    public static BaseEffect spawnAtTile(string pID, WorldTile pTile, float pScale)
    {
        BaseEffect tEffect = EffectsLibrary.spawn(pID, pTile, null, null, 0f, -1f, -1f, null);
        if (tEffect == null)
        {
            return null;
        }
        tEffect.prepare(pTile, pScale);
        return tEffect;
    }

    // Token: 0x06000722 RID: 1826 RVA: 0x00069640 File Offset: 0x00067840
    public static BaseEffect spawnAt(string pID, Vector2 pPos, float pScale)
    {
        BaseEffect tEffect = EffectsLibrary.spawn(pID, null, null, null, 0f, pPos.x, pPos.y, null);
        if (tEffect == null)
        {
            return null;
        }
        tEffect.prepare(pPos, pScale);
        return tEffect;
    }

    // Token: 0x06000723 RID: 1827 RVA: 0x00069680 File Offset: 0x00067880
    public static BaseEffect spawnAt(string pID, Vector3 pPos, float pScale)
    {
        BaseEffect tEffect = EffectsLibrary.spawn(pID, null, null, null, 0f, pPos.x, pPos.y, null);
        if (tEffect == null)
        {
            return null;
        }
        tEffect.prepare(pPos, pScale);
        return tEffect;
    }

    // Token: 0x06000724 RID: 1828 RVA: 0x000696C4 File Offset: 0x000678C4
    public static BaseEffect spawn(string pID, WorldTile pTile = null, string pParam1 = null, string pParam2 = null, float pFloatParam1 = 0f, float pX = -1f, float pY = -1f, Actor pActor = null)
    {
        BaseEffect tEffect = EffectsLibrary.check(pID);
        if (tEffect == null)
        {
            return null;
        }
        EffectAsset tAsset = AssetManager.effects_library.get(pID);
        if (tAsset.spawn_action != null)
        {
            tAsset.spawn_action(tEffect, pTile, pParam1, pParam2, pFloatParam1, pActor);
        }
        if (tAsset.has_sound_launch)
        {
            float tX = pX;
            float tY = pY;
            if (pTile != null && tX == -1f && tY == -1f)
            {
                tX = (float)pTile.x;
                tY = (float)pTile.y;
            }
            MusicBox.playSound(tAsset.sound_launch, tX, tY, false, false);
        }
        if (pX != -1f && pY != -1f)
        {
            tEffect.transform.position = new Vector3(pX, pY, 0f);
        }
        if (tAsset.has_sound_loop_idle)
        {
            tEffect.fmod_instance = MusicBox.attachToObject(tAsset.sound_loop_idle, tEffect.gameObject, tEffect);
        }
        return tEffect;
    }

    // Token: 0x06000725 RID: 1829 RVA: 0x0006979C File Offset: 0x0006799C
    public static void spawnExplosionWave(Vector3 pVec, float pRadius, float pSpeed = 1f)
    {
        BaseEffect tEffects = EffectsLibrary.spawn("fx_explosion_wave", null, null, null, 0f, -1f, -1f, null);
        if (tEffects == null)
        {
            return;
        }
        ((ExplosionFlash)tEffects).start(pVec, pRadius, pSpeed);
    }

    // Token: 0x06000726 RID: 1830 RVA: 0x000697DF File Offset: 0x000679DF
    public static bool canShowSlashEffect()
    {
        return !World.world.stack_effects.controller_slash_effects.isLimitReached();
    }

    // Token: 0x06000727 RID: 1831 RVA: 0x000697F8 File Offset: 0x000679F8
    public static void spawnSlash(Vector2 pVec, string pPathSprites, float pAngle, float pScaleMod = 0.1f)
    {
        BaseEffect tObject = EffectsLibrary.spawn("fx_slash", null, null, null, 0f, -1f, -1f, null);
        if (tObject == null)
        {
            return;
        }
        tObject.prepare(pVec, pScaleMod);
        SpriteAnimation component = tObject.GetComponent<SpriteAnimation>();
        Sprite[] sprites = SpriteTextureLoader.getSpriteList(pPathSprites, false);
        component.setFrames(sprites);
        tObject.transform.rotation = Quaternion.Euler(new Vector3(0f, 0f, pAngle));
    }

    // Token: 0x06000728 RID: 1832 RVA: 0x00069869 File Offset: 0x00067A69
    public BaseEffect spawnMeteorite(BaseEffect pEffect, WorldTile pTile, string pParam1, string pParam2 = null, float pFloatParam1 = 0f, Actor pActor = null)
    {
        ((Meteorite)pEffect).spawnOn(pTile, pParam1, pActor);
        return pEffect;
    }

    // Token: 0x06000729 RID: 1833 RVA: 0x0006987B File Offset: 0x00067A7B
    public BaseEffect spawnSanta(BaseEffect pEffect, WorldTile pTile, string pParam1, string pParam2 = null, float pFloatParam1 = 0f, Actor pActor = null)
    {
        ((Santa)pEffect).spawnOn(pTile);
        return pEffect;
    }

    // Token: 0x0600072A RID: 1834 RVA: 0x0006988C File Offset: 0x00067A8C
    public BaseEffect spawnBoulder(BaseEffect pEffect, WorldTile pTile, string pParam1, string pParam2 = null, float pFloatParam1 = 0f, Actor pActor = null)
    {
        Boulder boulder = (Boulder)pEffect;
        Vector2 tPosition = World.world.getMousePos();
        boulder.spawnOn(tPosition);
        return pEffect;
    }

    // Token: 0x0600072B RID: 1835 RVA: 0x000698B1 File Offset: 0x00067AB1
    public BaseEffect spawnNapalmFlash(BaseEffect pEffect, WorldTile pTile, string pParam1, string pParam2 = null, float pFloatParam1 = 0f, Actor pActor = null)
    {
        ((NapalmFlash)pEffect).spawnFlash(pTile);
        return pEffect;
    }

    // Token: 0x0600072C RID: 1836 RVA: 0x000698C0 File Offset: 0x00067AC0
    public BaseEffect spawnNukeFlash(BaseEffect pEffect, WorldTile pTile, string pParam1, string pParam2 = null, float pFloatParam1 = 0f, Actor pActor = null)
    {
        ((NukeFlash)pEffect).spawnFlash(pTile, pParam1);
        return pEffect;
    }

    // Token: 0x0600072D RID: 1837 RVA: 0x000698D0 File Offset: 0x00067AD0
    public BaseEffect spawnThunderFlash(BaseEffect pEffect, WorldTile pTile, string pParam1, string pParam2 = null, float pFloatParam1 = 0f, Actor pActor = null)
    {
        ((ThunderFlash)pEffect).spawnFlash();
        return pEffect;
    }

    // Token: 0x0600072E RID: 1838 RVA: 0x000698DE File Offset: 0x00067ADE
    public BaseEffect spawnSimpleTile(BaseEffect pEffect, WorldTile pTile, string pParam1 = null, string pParam2 = null, float pFloatParam1 = 0f, Actor pActor = null)
    {
        pEffect.spawnOnTile(pTile);
        return pEffect;
    }

    // Token: 0x0600072F RID: 1839 RVA: 0x000698E8 File Offset: 0x00067AE8
    public BaseEffect spawnZoneFlash(BaseEffect pEffect, WorldTile pTile, string pParam1 = null, string pParam2 = null, float pFloatParam1 = 0f, Actor pActor = null)
    {
        ((ZoneFlash)pEffect).spawnOnTile(pTile);
        return pEffect;
    }

    // Token: 0x06000730 RID: 1840 RVA: 0x000698F7 File Offset: 0x00067AF7
    public BaseEffect spawnCloud(BaseEffect pEffect, WorldTile pTile, string pParam1, string pParam2 = null, float pFloatParam1 = 0f, Actor pActor = null)
    {
        ((Cloud)pEffect).spawn(pTile, pParam1);
        return pEffect;
    }

    // Token: 0x06000731 RID: 1841 RVA: 0x00069907 File Offset: 0x00067B07
    public BaseEffect spawnFireworks(BaseEffect pEffect, WorldTile pTile, string pParam1, string pParam2 = null, float pFloatParam1 = 0f, Actor pActor = null)
    {
        ((Fireworks)pEffect).spawnOnTile(pTile);
        return pEffect;
    }

    // Token: 0x06000732 RID: 1842 RVA: 0x00069916 File Offset: 0x00067B16
    public BaseEffect showSpawnEffect(BaseEffect pEffect, WorldTile pTile, string pParam1, string pParam2 = null, float pFloatParam1 = 0f, Actor pActor = null)
    {
        pEffect.prepare(pTile, 0.2f);
        return pEffect;
    }

    // Token: 0x06000733 RID: 1843 RVA: 0x00069925 File Offset: 0x00067B25
    public BaseEffect spawnStatusParticle(BaseEffect pEffect, Vector3 pPos)
    {
        return pEffect;
    }

    // Token: 0x06000734 RID: 1844 RVA: 0x00069928 File Offset: 0x00067B28
    public static void highlightKingdomZones(Kingdom pKingdom, Color pColor, float pAlpha = 0.3f)
    {
        foreach (City city in pKingdom.cities)
        {
            foreach (TileZone tZone in city.zones)
            {
                ((ZoneFlash)EffectsLibrary.spawn("fx_zone_highlight", tZone.centerTile, null, null, pAlpha, -1f, -1f, null)).start(pColor, pAlpha);
            }
        }
    }

    // Token: 0x06000735 RID: 1845 RVA: 0x000699D8 File Offset: 0x00067BD8
    public static void showMoneyEffect(string pID, Vector2 pPosition, TileZone pZone, float pScale)
    {
        if (!pZone.visible_main_centered)
        {
            return;
        }
        if (!PlayerConfig.optionBoolEnabled("money_flow"))
        {
            return;
        }
        float tRandomXPos = pPosition.x + Randy.randomFloat(-0.3f, 0.3f);
        pPosition.x = tRandomXPos;
        EffectsLibrary.spawnAt(pID, pPosition, pScale);
    }

    // Token: 0x06000736 RID: 1846 RVA: 0x00069A23 File Offset: 0x00067C23
    public static void showMetaEventEffectConversion(string pID, Actor pActor)
    {
        if (!PlayerConfig.optionBoolEnabled("meta_conversions"))
        {
            return;
        }
        EffectsLibrary.showMetaEventEffect(pID, pActor.current_position, pActor.current_zone, pActor.actor_scale);
    }

    // Token: 0x06000737 RID: 1847 RVA: 0x00069A4A File Offset: 0x00067C4A
    public static void showMetaEventEffect(string pID, Actor pActor)
    {
        EffectsLibrary.showMetaEventEffect(pID, pActor.current_position, pActor.current_zone, pActor.actor_scale);
    }

    // Token: 0x06000738 RID: 1848 RVA: 0x00069A64 File Offset: 0x00067C64
    public static void showMetaEventEffect(string pID, Vector2 pPosition, TileZone pZone, float pScale)
    {
        if (!pZone.visible_main_centered)
        {
            return;
        }
        float tRandomXPos = pPosition.x + Randy.randomFloat(-0.3f, 0.3f);
        pPosition.x = tRandomXPos;
        EffectsLibrary.spawnAt(pID, pPosition, pScale);
    }
}
using System;
using System.Collections.Generic;
using UnityEngine;

// Token: 0x02000326 RID: 806
public class StackEffects : BaseMapObject
{
    // Token: 0x06001E79 RID: 7801 RVA: 0x00108C20 File Offset: 0x00106E20
    internal override void create()
    {
        base.create();
        this.dictionary = new Dictionary<string, BaseEffectController>();
        this.list = new List<BaseEffectController>();
        this.checkInit();
        this.controller_slash_effects = this.get("fx_slash");
        this.controller_tile_effects = this.get("fx_tile_effect");
    }

    // Token: 0x06001E7A RID: 7802 RVA: 0x00108C74 File Offset: 0x00106E74
    private void checkInit()
    {
        foreach (EffectAsset tAsset in AssetManager.effects_library.list)
        {
            if (!this.dictionary.ContainsKey(tAsset.id))
            {
                this.add(tAsset);
            }
        }
    }

    // Token: 0x06001E7B RID: 7803 RVA: 0x00108CE0 File Offset: 0x00106EE0
    internal int countActive()
    {
        int tResult = 0;
        for (int i = 0; i < this.list.Count; i++)
        {
            BaseEffectController tController = this.list[i];
            tResult += tController.activeIndex;
        }
        return tResult;
    }

    // Token: 0x06001E7C RID: 7804 RVA: 0x00108D1C File Offset: 0x00106F1C
    internal bool isLocked()
    {
        return this.get("fx_spawn_big").activeIndex > 0;
    }

    // Token: 0x06001E7D RID: 7805 RVA: 0x00108D34 File Offset: 0x00106F34
    internal BaseEffectController get(string pID)
    {
        return this.dictionary[pID];
    }

    // Token: 0x06001E7E RID: 7806 RVA: 0x00108D44 File Offset: 0x00106F44
    private BaseEffectController add(EffectAsset pAsset)
    {
        string tPrefabPath;
        if (pAsset.use_basic_prefab)
        {
            tPrefabPath = "effects/prefabs/PrefabEffectBasic";
        }
        else
        {
            tPrefabPath = pAsset.prefab_id;
        }
        GameObject tPrefab = Object.Instantiate<GameObject>((GameObject)Resources.Load(tPrefabPath, typeof(GameObject)), base.transform);
        tPrefab.transform.name = "[base] " + pAsset.id;
        tPrefab.gameObject.SetActive(false);
        if (pAsset.use_basic_prefab || pAsset.load_texture)
        {
            SpriteAnimation tAnimation = tPrefab.GetComponent<SpriteAnimation>();
            tAnimation.timeBetweenFrames = pAsset.time_between_frames;
            tAnimation.frames = SpriteTextureLoader.getSpriteList(pAsset.sprite_path, false);
            if (tAnimation.frames == null || tAnimation.frames.Length == 0)
            {
                Debug.LogError("NO SPRITES FOR EFFECT " + pAsset.id + " " + pAsset.sprite_path);
            }
            tAnimation.spriteRenderer.sortingLayerName = pAsset.sorting_layer_id;
        }
        BaseEffectController tController = Object.Instantiate<BaseEffectController>(this.prefabController, base.transform, true);
        tController.create();
        tController.asset = pAsset;
        tController.transform.name = "[controller] " + pAsset.id;
        tController.prefab = tPrefab.transform;
        tController.objectLimit = pAsset.limit;
        this.dictionary.Add(pAsset.id, tController);
        this.list.Add(tController);
        tController.addNewObject(tPrefab.GetComponent<BaseEffect>());
        return tController;
    }

    // Token: 0x06001E7F RID: 7807 RVA: 0x00108EA8 File Offset: 0x001070A8
    internal void clear()
    {
        for (int i = 0; i < this.list.Count; i++)
        {
            this.list[i].clear();
        }
        StackEffects.last_thunder_timestamp = 0.0;
        this.light_blobs.Clear();
        this.plot_removals.Clear();
        this.actor_effect_hit.Clear();
        this.actor_effect_highlight.Clear();
    }

    // Token: 0x06001E80 RID: 7808 RVA: 0x00108F18 File Offset: 0x00107118
    public override void update(float pElapsed)
    {
        if (AssetManager.effects_library.list.Count > this.list.Count)
        {
            this.checkInit();
        }
        Bench.bench("stack_effects", "game_total", false);
        for (int i = 0; i < this.list.Count; i++)
        {
            this.list[i].update(pElapsed);
        }
        Bench.benchEnd("stack_effects", "game_total", false, 0L, false);
    }

    // Token: 0x040016DD RID: 5853
    public static double last_thunder_timestamp;

    // Token: 0x040016DE RID: 5854
    public BaseEffectController prefabController;

    // Token: 0x040016DF RID: 5855
    private Dictionary<string, BaseEffectController> dictionary;

    // Token: 0x040016E0 RID: 5856
    internal List<BaseEffectController> list;

    // Token: 0x040016E1 RID: 5857
    public List<LightBlobData> light_blobs = new List<LightBlobData>();

    // Token: 0x040016E2 RID: 5858
    public List<PlotIconData> plot_removals = new List<PlotIconData>();

    // Token: 0x040016E3 RID: 5859
    public List<ActorDamageEffectData> actor_effect_hit = new List<ActorDamageEffectData>();

    // Token: 0x040016E4 RID: 5860
    public List<ActorHighlightEffectData> actor_effect_highlight = new List<ActorHighlightEffectData>();

    // Token: 0x040016E5 RID: 5861
    public BaseEffectController controller_slash_effects;

    // Token: 0x040016E6 RID: 5862
    public BaseEffectController controller_tile_effects;
}
using System;
using System.Collections.Generic;
using System.ComponentModel;
using UnityEngine;

// Token: 0x0200017E RID: 382
[Serializable]
public class ActorTrait : BaseTrait<ActorTrait>
{
    // Token: 0x17000047 RID: 71
    // (get) Token: 0x06000B47 RID: 2887 RVA: 0x000A1D1C File Offset: 0x0009FF1C
    protected override HashSet<string> progress_elements
    {
        get
        {
            GameProgressData progress_data = base._progress_data;
            if (progress_data == null)
            {
                return null;
            }
            return progress_data.unlocked_traits_actor;
        }
    }

    // Token: 0x17000048 RID: 72
    // (get) Token: 0x06000B48 RID: 2888 RVA: 0x000A1D2F File Offset: 0x0009FF2F
    public override string typed_id
    {
        get
        {
            return "trait";
        }
    }

    // Token: 0x06000B49 RID: 2889 RVA: 0x000A1D36 File Offset: 0x0009FF36
    public override BaseCategoryAsset getGroup()
    {
        return AssetManager.trait_groups.get(this.group_id);
    }

    // Token: 0x06000B4A RID: 2890 RVA: 0x000A1D48 File Offset: 0x0009FF48
    public int getRate(string pGroup)
    {
        if (pGroup == "body")
        {
            return this.rate_birth;
        }
        return this.rate_acquire_grow_up;
    }

    // Token: 0x06000B4B RID: 2891 RVA: 0x000A1D64 File Offset: 0x0009FF64
    public Kingdom getForcedKingdom()
    {
        if (this.forced_kingdom == string.Empty)
        {
            Debug.LogError("Shouldn't call this from a trait that doesn't have a forced kingdom! " + this.id);
            return null;
        }
        return World.world.kingdoms_wild.get(this.forced_kingdom);
    }

    // Token: 0x06000B4C RID: 2892 RVA: 0x000A1DA4 File Offset: 0x0009FFA4
    protected override IEnumerable<ITraitsOwner<ActorTrait>> getRelatedMetaList()
    {
        return World.world.units;
    }

    // Token: 0x06000B4D RID: 2893 RVA: 0x000A1DB0 File Offset: 0x0009FFB0
    public override string getCountRows()
    {
        return base.getCountRowsByCategories();
    }

    // Token: 0x06000B4E RID: 2894 RVA: 0x000A1DB8 File Offset: 0x0009FFB8
    protected override bool isSapient(ITraitsOwner<ActorTrait> pObject)
    {
        return ((Actor)pObject).isSapient();
    }

    // Token: 0x04000AE1 RID: 2785
    public int rate_birth;

    // Token: 0x04000AE2 RID: 2786
    public int rate_acquire_grow_up;

    // Token: 0x04000AE3 RID: 2787
    public bool acquire_grow_up_sapient_only;

    // Token: 0x04000AE4 RID: 2788
    public int rate_inherit;

    // Token: 0x04000AE5 RID: 2789
    public bool is_mutation_box_allowed = true;

    // Token: 0x04000AE6 RID: 2790
    public int same_trait_mod;

    // Token: 0x04000AE7 RID: 2791
    public int opposite_trait_mod;

    // Token: 0x04000AE8 RID: 2792
    public bool only_active_on_era_flag;

    // Token: 0x04000AE9 RID: 2793
    public bool era_active_moon;

    // Token: 0x04000AEA RID: 2794
    public bool era_active_night;

    // Token: 0x04000AEB RID: 2795
    [DefaultValue(TraitType.Other)]
    public TraitType type = TraitType.Other;

    // Token: 0x04000AEC RID: 2796
    public bool remove_for_zombie_actor_asset;

    // Token: 0x04000AED RID: 2797
    public bool can_be_cured;

    // Token: 0x04000AEE RID: 2798
    public bool affects_mind;

    // Token: 0x04000AEF RID: 2799
    public bool is_kingdom_affected;

    // Token: 0x04000AF0 RID: 2800
    [DefaultValue("")]
    public string forced_kingdom = string.Empty;

    // Token: 0x04000AF1 RID: 2801
    public bool can_be_removed_by_divine_light;

    // Token: 0x04000AF2 RID: 2802
    public bool can_be_removed_by_accelerated_healing;

    // Token: 0x04000AF3 RID: 2803
    public float likeability;

    // Token: 0x04000AF4 RID: 2804
    public bool combat;
}
using System;
using System.Collections.Generic;
using Beebyte.Obfuscator;

// Token: 0x02000181 RID: 385
[ObfuscateLiterals]
[Serializable]
public class ActorTraitLibrary : BaseTraitLibrary<ActorTrait>
{
    // Token: 0x06000B53 RID: 2899 RVA: 0x000A2081 File Offset: 0x000A0281
    protected override List<string> getDefaultTraitsForMeta(ActorAsset pAsset)
    {
        return pAsset.traits;
    }

    // Token: 0x06000B54 RID: 2900 RVA: 0x000A2089 File Offset: 0x000A0289
    public override void init()
    {
        base.init();
        this.addTraitsSpecial();
        this.addTraitsBody();
        this.addTraitsMind();
        this.addTraitsSpirit();
        this.addTraitsAcquired();
        this.addTraitsFun();
        this.addTraitsMisc();
    }

    // Token: 0x06000B55 RID: 2901 RVA: 0x000A20BC File Offset: 0x000A02BC
    private void addTraitsBody()
    {
        this.add(new ActorTrait
        {
            id = "dash",
            path_icon = "ui/Icons/skills/iconSkillDash",
            group_id = "skills",
            combat = true
        });
        this.t.addCombatAction("combat_dash");
        this.add(new ActorTrait
        {
            id = "block",
            path_icon = "ui/Icons/skills/iconSkillBlock",
            group_id = "skills",
            combat = true
        });
        this.t.addCombatAction("combat_block");
        this.add(new ActorTrait
        {
            id = "dodge",
            path_icon = "ui/Icons/skills/iconSkillDodge",
            group_id = "skills",
            combat = true
        });
        this.t.addCombatAction("combat_dodge");
        this.add(new ActorTrait
        {
            id = "backstep",
            path_icon = "ui/Icons/skills/iconSkillBackstep",
            group_id = "skills",
            combat = true
        });
        this.t.addCombatAction("combat_backstep");
        this.add(new ActorTrait
        {
            id = "deflect_projectile",
            path_icon = "ui/Icons/skills/iconSkillDeflectProjectile",
            group_id = "skills",
            combat = true
        });
        this.t.addCombatAction("combat_deflect_projectile");
        this.add(new ActorTrait
        {
            id = "mute",
            path_icon = "ui/Icons/actor_traits/iconMute",
            group_id = "body",
            rate_birth = 1,
            rate_inherit = 5,
            likeability = -0.1f
        });
        this.add(new ActorTrait
        {
            id = "sunblessed",
            path_icon = "ui/Icons/actor_traits/iconSunblessed",
            group_id = "body",
            rate_birth = 2,
            rate_inherit = 5
        });
        this.t.special_effect_interval = 5f;
        ActorTrait t = this.t;
        t.action_special_effect = (WorldAction)Delegate.Combine(t.action_special_effect, new WorldAction(ActionLibrary.sunblessedEffect));
        this.add(new ActorTrait
        {
            id = "clumsy",
            rarity = Rarity.R0_Normal,
            path_icon = "ui/Icons/actor_traits/iconClumsy",
            group_id = "physique",
            rate_birth = 5,
            rate_inherit = 5
        });
        this.t.addOpposite("long_liver");
        this.t.base_stats["multiplier_lifespan"] = -0.5f;
        this.add(new ActorTrait
        {
            id = "fragile_health",
            rarity = Rarity.R0_Normal,
            path_icon = "ui/Icons/actor_traits/iconFrail",
            group_id = "health",
            rate_birth = 5,
            rate_inherit = 5
        });
        this.t.addOpposite("boosted_vitality");
        this.t.base_stats["multiplier_health"] = -0.5f;
        this.add(new ActorTrait
        {
            id = "boosted_vitality",
            path_icon = "ui/Icons/actor_traits/iconBoostedVitality",
            group_id = "health",
            rate_birth = 5,
            rate_inherit = 5
        });
        this.t.addOpposite("fragile_health");
        this.t.base_stats["multiplier_health"] = 0.5f;
        this.add(new ActorTrait
        {
            id = "hard_skin",
            rarity = Rarity.R0_Normal,
            path_icon = "ui/Icons/actor_traits/iconHardSkin",
            group_id = "physique",
            rate_birth = 5,
            rate_inherit = 5
        });
        this.t.addOpposite("soft_skin");
        this.t.base_stats["armor"] = 5f;
        this.add(new ActorTrait
        {
            id = "soft_skin",
            rarity = Rarity.R0_Normal,
            path_icon = "ui/Icons/actor_traits/iconSoftSkin",
            group_id = "physique",
            rate_birth = 5,
            rate_inherit = 5
        });
        this.t.addOpposite("hard_skin");
        this.t.base_stats["armor"] = -5f;
        this.add(new ActorTrait
        {
            id = "long_liver",
            rarity = Rarity.R0_Normal,
            path_icon = "ui/Icons/actor_traits/iconLongLiver",
            group_id = "health",
            rate_birth = 2,
            rate_inherit = 5
        });
        this.t.addOpposite("clumsy");
        this.t.base_stats["multiplier_lifespan"] = 0.5f;
        this.add(new ActorTrait
        {
            id = "acid_touch",
            path_icon = "ui/Icons/actor_traits/iconAcidTouch",
            unlocked_with_achievement = true,
            achievement_id = "achievementLetsNot",
            group_id = "body",
            likeability = -0.1f
        });
        ActorTrait t2 = this.t;
        t2.action_special_effect = (WorldAction)Delegate.Combine(t2.action_special_effect, new WorldAction(ActionLibrary.acidTouchEffect));
        this.add(new ActorTrait
        {
            id = "acid_blood",
            path_icon = "ui/Icons/actor_traits/iconAcidBlood",
            unlocked_with_achievement = true,
            achievement_id = "achievementLetsNot",
            group_id = "body",
            rate_inherit = 5,
            likeability = -0.1f
        });
        ActorTrait t3 = this.t;
        t3.action_death = (WorldAction)Delegate.Combine(t3.action_death, new WorldAction(ActionLibrary.acidBloodEffect));
        this.add(new ActorTrait
        {
            id = "acid_proof",
            path_icon = "ui/Icons/actor_traits/iconAcidProof",
            unlocked_with_achievement = true,
            achievement_id = "achievementLetsNot",
            group_id = "protection",
            rate_inherit = 5
        });
        this.add(new ActorTrait
        {
            id = "fire_blood",
            path_icon = "ui/Icons/actor_traits/iconFireBlood",
            group_id = "body",
            rate_inherit = 5
        });
        ActorTrait t4 = this.t;
        t4.action_death = (WorldAction)Delegate.Combine(t4.action_death, new WorldAction(ActionLibrary.fireDropsSpawn));
        this.add(new ActorTrait
        {
            id = "fire_proof",
            path_icon = "ui/Icons/actor_traits/iconFireProof",
            group_id = "protection",
            rate_inherit = 5
        });
        this.t.base_stats.addTag("immunity_fire");
        this.add(new ActorTrait
        {
            id = "freeze_proof",
            path_icon = "ui/Icons/actor_traits/iconFreezeProof",
            group_id = "protection",
            rate_inherit = 5
        });
        this.t.base_stats.addTag("immunity_cold");
        this.add(new ActorTrait
        {
            id = "regeneration",
            path_icon = "ui/Icons/actor_traits/iconRegeneration",
            rate_birth = 1,
            rate_inherit = 5,
            group_id = "health",
            type = TraitType.Positive,
            special_effect_interval = 3f
        });
        ActorTrait t5 = this.t;
        t5.action_special_effect = (WorldAction)Delegate.Combine(t5.action_special_effect, new WorldAction(ActionLibrary.regenerationEffect));
        this.add(new ActorTrait
        {
            id = "heliophobia",
            path_icon = "ui/Icons/actor_traits/iconHeliophobia",
            rate_inherit = 10,
            group_id = "body",
            type = TraitType.Negative,
            special_effect_interval = 10f
        });
        ActorTrait t6 = this.t;
        t6.action_special_effect = (WorldAction)Delegate.Combine(t6.action_special_effect, new WorldAction(ActionLibrary.heliophobiaEffect));
        this.add(new ActorTrait
        {
            id = "ugly",
            rarity = Rarity.R0_Normal,
            path_icon = "ui/Icons/actor_traits/iconUgly",
            rate_birth = 7,
            same_trait_mod = 5,
            opposite_trait_mod = -15,
            likeability = -0.1f,
            group_id = "appearance",
            type = TraitType.Negative
        });
        this.t.base_stats["multiplier_offspring"] = -0.3f;
        this.t.addOpposite("attractive");
        this.add(new ActorTrait
        {
            id = "fat",
            rarity = Rarity.R0_Normal,
            path_icon = "ui/Icons/actor_traits/iconFat",
            rate_birth = 7,
            rate_inherit = 5,
            opposite_trait_mod = -10,
            same_trait_mod = 10,
            likeability = -0.1f,
            group_id = "physique",
            type = TraitType.Negative
        });
        this.t.addOpposite("agile");
        this.t.addOpposite("weightless");
        this.t.base_stats["multiplier_mass"] = 0.3f;
        this.t.base_stats["scale"] = 0.02f;
        this.t.base_stats["multiplier_stamina"] = -0.5f;
        this.t.base_stats["multiplier_damage"] = 0.1f;
        this.add(new ActorTrait
        {
            id = "attractive",
            path_icon = "ui/Icons/actor_traits/iconAttractive",
            rate_birth = 3,
            rate_inherit = 5,
            same_trait_mod = 10,
            likeability = 0.1f,
            group_id = "appearance",
            type = TraitType.Positive
        });
        this.t.addOpposite("ugly");
        this.t.base_stats["diplomacy"] = 2f;
        this.t.base_stats["stewardship"] = 1f;
        this.t.base_stats["critical_chance"] = 0.1f;
        this.t.base_stats["multiplier_offspring"] = 0.6f;
        this.add(new ActorTrait
        {
            id = "fast",
            rarity = Rarity.R0_Normal,
            path_icon = "ui/Icons/actor_traits/iconFast",
            rate_birth = 4,
            rate_inherit = 5,
            remove_for_zombie_actor_asset = true,
            group_id = "physique",
            type = TraitType.Positive
        });
        this.t.addOpposite("slow");
        this.t.base_stats["multiplier_speed"] = 0.3f;
        this.t.base_stats["attack_speed"] = 5f;
        this.add(new ActorTrait
        {
            id = "slow",
            rarity = Rarity.R0_Normal,
            path_icon = "ui/Icons/actor_traits/iconSlow",
            rate_birth = 6,
            rate_inherit = 5,
            group_id = "physique",
            type = TraitType.Negative
        });
        this.t.addOpposite("fast");
        this.t.addOpposite("agile");
        this.t.base_stats["multiplier_speed"] = -0.5f;
        this.t.base_stats["attack_speed"] = -5f;
        this.add(new ActorTrait
        {
            id = "gluttonous",
            rarity = Rarity.R0_Normal,
            path_icon = "ui/Icons/actor_traits/iconGluttonous",
            rate_birth = 4,
            rate_inherit = 5,
            same_trait_mod = 5,
            group_id = "mind",
            type = TraitType.Negative
        });
        this.add(new ActorTrait
        {
            id = "giant",
            path_icon = "ui/Icons/actor_traits/iconGiant",
            group_id = "physique",
            type = TraitType.Positive,
            rate_birth = 2,
            rate_inherit = 7,
            unlocked_with_achievement = true,
            achievement_id = "achievementTORNADO"
        });
        this.t.addOpposite("tiny");
        this.t.base_stats["scale"] = 0.05f;
        this.t.base_stats["multiplier_health"] = 0.5f;
        this.t.base_stats["multiplier_speed"] = -0.25f;
        this.add(new ActorTrait
        {
            id = "tiny",
            path_icon = "ui/Icons/actor_traits/iconTiny",
            group_id = "physique",
            type = TraitType.Negative,
            rate_birth = 4,
            rate_inherit = 7,
            unlocked_with_achievement = true,
            achievement_id = "achievementBabyTornado"
        });
        this.t.addOpposite("giant");
        this.t.base_stats["diplomacy"] = -1f;
        this.t.base_stats["scale"] = -0.02f;
        this.t.base_stats["multiplier_health"] = -0.25f;
        this.t.base_stats["multiplier_speed"] = 0.25f;
        this.add(new ActorTrait
        {
            id = "eagle_eyed",
            rarity = Rarity.R0_Normal,
            path_icon = "ui/Icons/actor_traits/iconEagleEye",
            rate_birth = 3,
            rate_inherit = 5,
            group_id = "cognitive",
            type = TraitType.Positive
        });
        this.t.addOpposite("short_sighted");
        this.t.base_stats["accuracy"] = 5f;
        this.t.base_stats["critical_chance"] = 0.15f;
        this.add(new ActorTrait
        {
            id = "short_sighted",
            rarity = Rarity.R0_Normal,
            path_icon = "ui/Icons/actor_traits/iconShortsighted",
            rate_birth = 5,
            rate_inherit = 5,
            group_id = "cognitive",
            type = TraitType.Negative
        });
        this.t.addOpposite("eagle_eyed");
        this.t.base_stats["accuracy"] = -5f;
        this.t.base_stats["critical_chance"] = -0.05f;
        this.add(new ActorTrait
        {
            id = "infertile",
            path_icon = "ui/Icons/actor_traits/iconInfertile",
            rate_birth = 1,
            rate_inherit = 5,
            group_id = "health",
            type = TraitType.Negative
        });
        this.t.addOpposite("fertile");
        this.t.base_stats["offspring"] = -99999f;
        this.add(new ActorTrait
        {
            id = "fertile",
            rarity = Rarity.R0_Normal,
            path_icon = "ui/Icons/actor_traits/iconFertile",
            rate_birth = 3,
            rate_inherit = 7,
            group_id = "health",
            type = TraitType.Positive,
            likeability = 0.1f
        });
        this.t.addOpposite("infertile");
        this.t.base_stats["multiplier_offspring"] = 0.8f;
        this.t.base_stats["birth_rate"] = 4f;
        this.add(new ActorTrait
        {
            id = "thorns",
            path_icon = "ui/Icons/actor_traits/iconThorns",
            group_id = "protection",
            rate_inherit = 5
        });
        ActorTrait t7 = this.t;
        t7.action_get_hit = (GetHitAction)Delegate.Combine(t7.action_get_hit, new GetHitAction(ActionLibrary.thornsDefense));
        this.add(new ActorTrait
        {
            id = "bubble_defense",
            path_icon = "ui/Icons/actor_traits/iconBubbleDefense",
            group_id = "protection",
            rate_inherit = 3
        });
        ActorTrait t8 = this.t;
        t8.action_get_hit = (GetHitAction)Delegate.Combine(t8.action_get_hit, new GetHitAction(ActionLibrary.bubbleDefense));
        this.add(new ActorTrait
        {
            id = "immune",
            path_icon = "ui/Icons/actor_traits/iconImmune",
            rate_birth = 1,
            rate_inherit = 10,
            group_id = "health",
            type = TraitType.Positive
        });
        this.t.addOpposite("plague");
        this.t.addOpposite("tumor_infection");
        this.t.addOpposite("mush_spores");
        this.t.addOpposite("infected");
        this.add(new ActorTrait
        {
            id = "agile",
            path_icon = "ui/Icons/actor_traits/iconAgile",
            rate_birth = 3,
            rate_inherit = 5,
            same_trait_mod = 5,
            remove_for_zombie_actor_asset = true,
            group_id = "physique",
            type = TraitType.Positive
        });
        this.t.addOpposite("fat");
        this.t.addOpposite("slow");
        this.t.base_stats["lifespan"] = 3f;
        this.t.base_stats["scale"] = -0.01f;
        this.t.base_stats["stamina"] = 20f;
        this.t.base_stats["skill_combat"] = 0.2f;
        this.add(new ActorTrait
        {
            id = "weightless",
            path_icon = "ui/Icons/actor_traits/iconWeightless",
            rate_birth = 1,
            rate_inherit = 5,
            group_id = "physique"
        });
        this.t.addOpposite("fat");
        this.add(new ActorTrait
        {
            id = "poisonous",
            path_icon = "ui/Icons/actor_traits/iconPoisonous",
            group_id = "body",
            rate_inherit = 5
        });
        this.add(new ActorTrait
        {
            id = "venomous",
            path_icon = "ui/Icons/actor_traits/iconVenomous",
            group_id = "body",
            rate_inherit = 5
        });
        this.t.action_attack_target = new AttackAction(ActionLibrary.addPoisonedEffectOnTarget);
        this.add(new ActorTrait
        {
            id = "poison_immune",
            path_icon = "ui/Icons/actor_traits/iconPoisonImmune",
            group_id = "protection",
            rate_inherit = 5
        });
        this.add(new ActorTrait
        {
            id = "tough",
            path_icon = "ui/Icons/actor_traits/iconTough",
            rate_birth = 2,
            group_id = "physique",
            type = TraitType.Positive,
            same_trait_mod = -5,
            unlocked_with_achievement = true,
            achievement_id = "achievementDestroyWorldBox"
        });
        this.t.base_stats["armor"] = 10f;
        this.t.base_stats["warfare"] = 1f;
        this.t.base_stats["lifespan"] = 4f;
        this.add(new ActorTrait
        {
            id = "strong",
            rarity = Rarity.R0_Normal,
            path_icon = "ui/Icons/actor_traits/iconStrong",
            rate_birth = 4,
            opposite_trait_mod = -10,
            same_trait_mod = 5,
            group_id = "physique",
            type = TraitType.Positive
        });
        this.t.addOpposite("weak");
        this.t.base_stats["multiplier_damage"] = 0.5f;
        this.t.base_stats["warfare"] = 2f;
        this.t.base_stats["lifespan"] = 3f;
        this.add(new ActorTrait
        {
            id = "weak",
            rarity = Rarity.R0_Normal,
            path_icon = "ui/Icons/actor_traits/iconWeak",
            rate_birth = 5,
            opposite_trait_mod = -10,
            group_id = "physique",
            type = TraitType.Negative
        });
        this.t.addOpposite("strong");
        this.t.base_stats["multiplier_damage"] = -0.5f;
        this.t.base_stats["warfare"] = -2f;
        this.t.base_stats["diplomacy"] = -2f;
        this.t.base_stats["lifespan"] = -6f;
    }

    // Token: 0x06000B56 RID: 2902 RVA: 0x000A34D4 File Offset: 0x000A16D4
    private void addTraitsMind()
    {
        this.add(new ActorTrait
        {
            id = "lustful",
            path_icon = "ui/Icons/actor_traits/iconLustful",
            group_id = "mind",
            rate_acquire_grow_up = 5,
            rate_birth = 1,
            likeability = 0.1f
        });
        this.t.base_stats["diplomacy"] = -2f;
        this.t.base_stats["multiplier_offspring"] = 0.2f;
        this.add(new ActorTrait
        {
            id = "miner",
            path_icon = "ui/Icons/actor_traits/iconMiner",
            group_id = "miscellaneous",
            type = TraitType.Positive,
            rate_acquire_grow_up = 5
        });
        this.add(new ActorTrait
        {
            id = "psychopath",
            path_icon = "ui/Icons/actor_traits/iconPsychopath",
            group_id = "mind",
            rate_birth = 1,
            type = TraitType.Negative
        });
        this.add(new ActorTrait
        {
            id = "strong_minded",
            path_icon = "ui/Icons/actor_traits/iconStrongMinded",
            group_id = "mind",
            type = TraitType.Positive
        });
        this.t.base_stats.addTag("strong_mind");
        this.t.addOpposite("madness");
        this.t.addOpposite("desire_golden_egg");
        this.t.addOpposite("desire_harp");
        this.add(new ActorTrait
        {
            id = "peaceful",
            rarity = Rarity.R0_Normal,
            path_icon = "ui/Icons/actor_traits/iconPeaceful",
            remove_for_zombie_actor_asset = true,
            group_id = "mind",
            type = TraitType.Positive
        });
        this.t.base_stats.addTag("love_peace");
        this.add(new ActorTrait
        {
            id = "evil",
            path_icon = "ui/Icons/actor_traits/iconEvil",
            group_id = "mind",
            likeability = -0.2f
        });
        this.t.addOpposite("blessed");
        this.t.base_stats["cities"] = -2f;
        this.t.base_stats["warfare"] = 10f;
        this.add(new ActorTrait
        {
            id = "hotheaded",
            path_icon = "ui/Icons/actor_traits/iconHotheaded",
            rate_birth = 1,
            same_trait_mod = -10,
            group_id = "mind",
            type = TraitType.Negative
        });
        this.add(new ActorTrait
        {
            id = "thief",
            path_icon = "ui/Icons/actor_traits/iconThief",
            rate_birth = 1,
            same_trait_mod = 10,
            group_id = "cognitive",
            type = TraitType.Negative
        });
        this.t.setUnlockedWithAchievement("achievementNotOnMyWatch");
        this.t.addOpposite("honest");
        this.t.addOpposite("content");
        this.t.base_stats.addTag("steal_items");
        this.t.addDecision("try_to_steal_money");
        this.add(new ActorTrait
        {
            id = "stupid",
            rarity = Rarity.R0_Normal,
            path_icon = "ui/Icons/actor_traits/iconStupid",
            rate_birth = 3,
            same_trait_mod = 30,
            group_id = "cognitive",
            type = TraitType.Negative
        });
        this.t.addOpposite("genius");
        this.t.addOpposite("wise");
        this.t.base_stats["damage"] = 5f;
        this.t.base_stats["cities"] = -3f;
        this.t.base_stats["intelligence"] = -5f;
        this.t.base_stats["diplomacy"] = -2f;
        this.t.base_stats["warfare"] = -2f;
        this.t.base_stats["stewardship"] = -5f;
        this.t.base_stats["loyalty_traits"] = -15f;
        this.t.base_stats["personality_rationality"] = -0.5f;
        this.add(new ActorTrait
        {
            id = "genius",
            path_icon = "ui/Icons/actor_traits/iconGenius",
            rate_birth = 1,
            remove_for_zombie_actor_asset = true,
            same_trait_mod = 20,
            opposite_trait_mod = -20,
            unlocked_with_achievement = true,
            achievement_id = "achievementTraitsExplorer60",
            group_id = "cognitive",
            type = TraitType.Positive
        });
        this.t.base_stats.addTag("can_read_any_book");
        this.t.addOpposite("stupid");
        this.t.base_stats["intelligence"] = 10f;
        this.t.base_stats["diplomacy"] = 5f;
        this.t.base_stats["warfare"] = 5f;
        this.t.base_stats["stewardship"] = 7f;
        this.t.base_stats["loyalty_traits"] = -10f;
        this.t.base_stats["cities"] = 3f;
        this.add(new ActorTrait
        {
            id = "deceitful",
            rarity = Rarity.R0_Normal,
            path_icon = "ui/Icons/actor_traits/iconDeceitful",
            rate_acquire_grow_up = 5,
            same_trait_mod = -15,
            opposite_trait_mod = -5,
            likeability = 0.1f,
            group_id = "mind",
            type = TraitType.Negative
        });
        this.t.addOpposite("honest");
        this.t.base_stats["diplomacy"] = 1f;
        this.t.base_stats["stewardship"] = 4f;
        this.t.base_stats["loyalty_traits"] = -20f;
        this.add(new ActorTrait
        {
            id = "ambitious",
            path_icon = "ui/Icons/actor_traits/iconAmbitious",
            rate_acquire_grow_up = 5,
            rate_birth = 1,
            same_trait_mod = -10,
            group_id = "mind",
            achievement_id = "achievement4RaceCities",
            unlocked_with_achievement = true
        });
        this.t.addOpposite("content");
        this.t.base_stats["diplomacy"] = 2f;
        this.t.base_stats["warfare"] = 4f;
        this.t.base_stats["stewardship"] = 1f;
        this.t.base_stats["loyalty_traits"] = -15f;
        this.t.base_stats["cities"] = 5f;
        this.add(new ActorTrait
        {
            id = "content",
            rarity = Rarity.R0_Normal,
            path_icon = "ui/Icons/actor_traits/iconContent",
            rate_acquire_grow_up = 5,
            rate_birth = 2,
            same_trait_mod = 15,
            likeability = 0.1f,
            group_id = "mind",
            type = TraitType.Positive
        });
        this.t.addOpposite("ambitious");
        this.t.addOpposite("greedy");
        this.t.addOpposite("thief");
        this.t.base_stats["multiplier_supply_timer"] = -0.3f;
        this.t.base_stats["loyalty_traits"] = 10f;
        this.t.base_stats["diplomacy"] = 2f;
        this.t.base_stats["stewardship"] = 2f;
        this.t.base_stats["warfare"] = -2f;
        this.add(new ActorTrait
        {
            id = "honest",
            rarity = Rarity.R0_Normal,
            path_icon = "ui/Icons/actor_traits/iconHonest",
            rate_acquire_grow_up = 5,
            rate_birth = 2,
            same_trait_mod = 10,
            opposite_trait_mod = -10,
            likeability = -0.1f,
            group_id = "mind",
            type = TraitType.Positive
        });
        this.t.addOpposite("deceitful");
        this.t.addOpposite("thief");
        this.t.base_stats["stewardship"] = 3f;
        this.t.base_stats["diplomacy"] = 2f;
        this.t.base_stats["warfare"] = -2f;
        this.t.base_stats["loyalty_traits"] = 5f;
        this.add(new ActorTrait
        {
            id = "paranoid",
            path_icon = "ui/Icons/actor_traits/iconParanoid",
            rate_acquire_grow_up = 5,
            rate_birth = 1,
            group_id = "mind",
            type = TraitType.Negative
        });
        this.t.base_stats["diplomacy"] = -2f;
        this.t.base_stats["warfare"] = 4f;
        this.t.base_stats["multiplier_supply_timer"] = 0.5f;
        this.t.base_stats["loyalty_traits"] = -15f;
        this.t.base_stats["cities"] = -1f;
        this.add(new ActorTrait
        {
            id = "greedy",
            path_icon = "ui/Icons/actor_traits/iconGreedy",
            rate_acquire_grow_up = 5,
            rate_birth = 1,
            likeability = -0.1f,
            group_id = "mind",
            type = TraitType.Negative
        });
        this.t.addOpposite("content");
        this.t.base_stats["diplomacy"] = -2f;
        this.t.base_stats["stewardship"] = -3f;
        this.t.base_stats["warfare"] = 4f;
        this.t.base_stats["multiplier_supply_timer"] = 4f;
        this.t.base_stats["loyalty_traits"] = -5f;
        this.t.base_stats["cities"] = 2f;
    }

    // Token: 0x06000B57 RID: 2903 RVA: 0x000A3FB0 File Offset: 0x000A21B0
    private void addTraitsSpirit()
    {
        this.add(new ActorTrait
        {
            id = "chosen_one",
            path_icon = "ui/Icons/actor_traits/iconChosenOne",
            likeability = 0.25f,
            group_id = "spirit",
            achievement_id = "achievementLavaStrike",
            unlocked_with_achievement = true
        });
        this.t.base_stats["stamina"] = 1000f;
        this.t.base_stats["mana"] = 1000f;
        this.t.addCombatAction("combat_backstep");
        this.t.addCombatAction("combat_block");
        this.t.addCombatAction("combat_dash");
        this.t.addCombatAction("combat_deflect_projectile");
        this.t.addCombatAction("combat_dodge");
        this.t.addSpell("cast_fire");
        this.t.addSpell("summon_lightning");
        this.t.addSpell("teleport");
        this.t.addSpell("summon_tornado");
        this.t.addSpell("cast_blood_rain");
        this.t.addSpell("cast_blood_rain");
        this.t.addSpell("cast_cure");
        this.t.addSpell("cast_shield");
        this.t.addSpell("cast_grass_seeds");
        this.t.addSpell("spawn_vegetation");
        this.t.addSpell("cast_curse");
        this.add(new ActorTrait
        {
            id = "moonchild",
            path_icon = "ui/Icons/actor_traits/iconMoonchild",
            only_active_on_era_flag = true,
            era_active_moon = true,
            group_id = "spirit",
            rate_inherit = 5,
            rate_birth = 1
        });
        this.t.base_stats["multiplier_damage"] = 0.5f;
        this.t.base_stats["multiplier_speed"] = 0.1f;
        this.t.base_stats["armor"] = 1f;
        this.t.base_stats["intelligence"] = 3f;
        this.add(new ActorTrait
        {
            id = "nightchild",
            path_icon = "ui/Icons/actor_traits/iconNightchild",
            only_active_on_era_flag = true,
            era_active_night = true,
            group_id = "spirit",
            rate_inherit = 5,
            rate_birth = 1
        });
        this.t.base_stats["multiplier_damage"] = 0.5f;
        this.t.base_stats["multiplier_speed"] = 0.1f;
        this.t.base_stats["critical_chance"] = 0.03f;
        this.t.base_stats["warfare"] = 3f;
        this.add(new ActorTrait
        {
            id = "flesh_eater",
            path_icon = "ui/Icons/actor_traits/iconFleshEater",
            group_id = "spirit",
            rate_inherit = 5,
            rate_birth = 1
        });
        this.t.action_attack_target = new AttackAction(ActionLibrary.restoreHealthOnHit);
        this.add(new ActorTrait
        {
            id = "titan_lungs",
            path_icon = "ui/Icons/actor_traits/iconTitanLungs",
            group_id = "body",
            rate_inherit = 5
        });
        this.t.setUnlockedWithAchievement("achievementNinjaTurtle");
        this.t.base_stats["multiplier_stamina"] = 10f;
        this.add(new ActorTrait
        {
            id = "heart_of_wizard",
            path_icon = "ui/Icons/actor_traits/iconHeartWizard",
            group_id = "spirit",
            rate_inherit = 5
        });
        this.t.base_stats["multiplier_mana"] = 10f;
        this.add(new ActorTrait
        {
            id = "battle_reflexes",
            path_icon = "ui/Icons/actor_traits/iconBattleReflexes",
            group_id = "mind",
            rate_inherit = 5
        });
        this.t.base_stats["skill_combat"] = 0.5f;
        this.add(new ActorTrait
        {
            id = "arcane_reflexes",
            path_icon = "ui/Icons/actor_traits/iconArcaneReflexes",
            group_id = "mind",
            rate_inherit = 5
        });
        this.t.base_stats["skill_spell"] = 0.5f;
        this.add(new ActorTrait
        {
            id = "healing_aura",
            path_icon = "ui/Icons/actor_traits/iconHealingAura",
            group_id = "spirit",
            rate_inherit = 5,
            special_effect_interval = 2f,
            likeability = 0.1f
        });
        ActorTrait t = this.t;
        t.action_special_effect = (WorldAction)Delegate.Combine(t.action_special_effect, new WorldAction(ActionLibrary.healingAuraEffect));
        this.add(new ActorTrait
        {
            id = "savage",
            path_icon = "ui/Icons/actor_traits/iconSavage",
            group_id = "spirit",
            type = TraitType.Positive,
            same_trait_mod = 5,
            rate_acquire_grow_up = 2,
            rate_inherit = 5
        });
        this.add(new ActorTrait
        {
            id = "immortal",
            path_icon = "ui/Icons/actor_traits/iconImmortal",
            same_trait_mod = -20,
            type = TraitType.Positive,
            unlocked_with_achievement = true,
            achievement_id = "achievementTheKing",
            group_id = "health"
        });
        this.t.addOpposite("plague");
        this.t.addOpposite("boat");
        this.t.base_stats["loyalty_traits"] = -20f;
        this.add(new ActorTrait
        {
            id = "burning_feet",
            path_icon = "ui/Icons/actor_traits/iconBurningFeet",
            unlocked_with_achievement = true,
            achievement_id = "achievementTheHell",
            group_id = "spirit",
            rate_inherit = 3
        });
        ActorTrait t2 = this.t;
        t2.action_special_effect = (WorldAction)Delegate.Combine(t2.action_special_effect, new WorldAction(ActionLibrary.burningFeetEffect));
        this.add(new ActorTrait
        {
            id = "cold_aura",
            path_icon = "ui/Icons/actor_traits/iconColdAura",
            group_id = "spirit",
            rate_inherit = 3
        });
        ActorTrait t3 = this.t;
        t3.action_special_effect = (WorldAction)Delegate.Combine(t3.action_special_effect, new WorldAction(ActionLibrary.coldAuraEffect));
        this.add(new ActorTrait
        {
            id = "lucky",
            path_icon = "ui/Icons/actor_traits/iconLucky",
            rate_birth = 2,
            rate_inherit = 5,
            likeability = 0.1f,
            group_id = "spirit",
            type = TraitType.Positive
        });
        this.t.addOpposite("unlucky");
        this.t.base_stats["lifespan"] = 7f;
        this.t.base_stats["accuracy"] = 4f;
        this.t.base_stats["critical_chance"] = 0.3f;
        this.t.base_stats["birth_rate"] = 5f;
        this.add(new ActorTrait
        {
            id = "unlucky",
            path_icon = "ui/Icons/actor_traits/iconUnlucky",
            rate_birth = 3,
            rate_inherit = 5,
            likeability = -0.1f,
            group_id = "spirit",
            type = TraitType.Negative
        });
        this.t.addOpposite("lucky");
        this.t.base_stats["lifespan"] = -13f;
        ActorTrait t4 = this.t;
        t4.action_special_effect = (WorldAction)Delegate.Combine(t4.action_special_effect, new WorldAction(ActionLibrary.unluckyMeteorite));
        this.t.base_stats["accuracy"] = -4f;
        this.t.base_stats["critical_chance"] = -0.3f;
        this.add(new ActorTrait
        {
            id = "bloodlust",
            path_icon = "ui/Icons/actor_traits/iconBloodlust",
            rate_acquire_grow_up = 4,
            rate_birth = 1,
            rate_inherit = 5,
            group_id = "spirit",
            type = TraitType.Negative,
            unlocked_with_achievement = true,
            achievement_id = "achievementTheDemon"
        });
        this.t.addOpposite("pacifist");
        this.t.base_stats["multiplier_supply_timer"] = 1.5f;
        this.t.base_stats["loyalty_traits"] = -20f;
        this.t.base_stats["warfare"] = 5f;
        this.t.base_stats["diplomacy"] = -2f;
        this.t.base_stats["cities"] = 3f;
        this.add(new ActorTrait
        {
            id = "pacifist",
            path_icon = "ui/Icons/actor_traits/iconPacifist",
            rate_acquire_grow_up = 3,
            rate_inherit = 5,
            likeability = 0.1f,
            group_id = "spirit",
            type = TraitType.Positive
        });
        this.t.addOpposite("bloodlust");
        this.t.base_stats["multiplier_supply_timer"] = -0.1f;
        this.t.base_stats["loyalty_traits"] = 50f;
        this.t.base_stats["diplomacy"] = 10f;
        this.t.base_stats["warfare"] = -4f;
    }

    // Token: 0x06000B58 RID: 2904 RVA: 0x000A498C File Offset: 0x000A2B8C
    private void addTraitsAcquired()
    {
        this.add(new ActorTrait
        {
            id = "veteran",
            path_icon = "ui/Icons/actor_traits/iconVeteran",
            group_id = "merits",
            type = TraitType.Positive,
            same_trait_mod = 5,
            is_mutation_box_allowed = false
        });
        this.t.base_stats["skill_combat"] = 0.1f;
        this.t.base_stats["multiplier_damage"] = 0.1f;
        this.t.base_stats["multiplier_health"] = 0.1f;
        this.add(new ActorTrait
        {
            id = "wise",
            path_icon = "ui/Icons/actor_traits/iconWise",
            group_id = "cognitive",
            type = TraitType.Positive,
            is_mutation_box_allowed = false
        });
        this.t.addOpposite("stupid");
        this.t.addOpposite("boat");
        this.t.base_stats["diplomacy"] = 1f;
        this.t.base_stats["stewardship"] = 1f;
        this.t.base_stats["warfare"] = 1f;
        this.t.base_stats["intelligence"] = 1f;
        this.add(new ActorTrait
        {
            id = "infected",
            path_icon = "ui/Icons/actor_traits/iconInfected",
            rate_inherit = 20,
            group_id = "acquired",
            can_be_removed_by_divine_light = true,
            can_be_removed_by_accelerated_healing = true,
            is_mutation_box_allowed = false
        });
        this.t.addOpposite("immune");
        this.t.addOpposite("boat");
        this.t.can_be_cured = true;
        ActorTrait t = this.t;
        t.action_special_effect = (WorldAction)Delegate.Combine(t.action_special_effect, new WorldAction(ActionLibrary.infectedEffect));
        this.t.special_effect_interval = 1.5f;
        ActorTrait t2 = this.t;
        t2.action_death = (WorldAction)Delegate.Combine(t2.action_death, new WorldAction(ActionLibrary.turnIntoZombie));
        this.t.base_stats["multiplier_speed"] = 0.1f;
        this.t.base_stats["loyalty_traits"] = -15f;
        this.add(new ActorTrait
        {
            id = "mush_spores",
            path_icon = "ui/Icons/actor_traits/iconMushSpores",
            rate_inherit = 30,
            can_be_removed_by_divine_light = true,
            can_be_removed_by_accelerated_healing = true,
            group_id = "acquired",
            is_mutation_box_allowed = false
        });
        this.t.addOpposite("immune");
        this.t.addOpposite("boat");
        this.t.can_be_cured = true;
        ActorTrait t3 = this.t;
        t3.action_death = (WorldAction)Delegate.Combine(t3.action_death, new WorldAction(ActionLibrary.mushSporesEffect));
        ActorTrait t4 = this.t;
        t4.action_death = (WorldAction)Delegate.Combine(t4.action_death, new WorldAction(ActionLibrary.turnIntoMush));
        this.t.base_stats["multiplier_speed"] = 0.3f;
        this.t.base_stats["loyalty_traits"] = -15f;
        this.add(new ActorTrait
        {
            id = "tumor_infection",
            path_icon = "ui/Icons/actor_traits/iconTumorInfection",
            rate_inherit = 30,
            can_be_removed_by_divine_light = true,
            can_be_removed_by_accelerated_healing = true,
            group_id = "acquired",
            is_mutation_box_allowed = false
        });
        this.t.addOpposite("immune");
        this.t.addOpposite("boat");
        this.t.can_be_cured = true;
        ActorTrait t5 = this.t;
        t5.action_special_effect = (WorldAction)Delegate.Combine(t5.action_special_effect, new WorldAction(ActionLibrary.tumorEffect));
        ActorTrait t6 = this.t;
        t6.action_death = (WorldAction)Delegate.Combine(t6.action_death, new WorldAction(ActionLibrary.turnIntoTumorMonster));
        this.t.base_stats["multiplier_speed"] = 0.3f;
        this.t.base_stats["loyalty_traits"] = -15f;
        this.add(new ActorTrait
        {
            id = "plague",
            path_icon = "ui/Icons/actor_traits/iconPlague",
            rate_inherit = 30,
            unlocked_with_achievement = true,
            achievement_id = "achievementGreatPlague",
            can_be_removed_by_divine_light = true,
            can_be_removed_by_accelerated_healing = true,
            group_id = "acquired",
            is_mutation_box_allowed = false
        });
        this.t.addOpposite("immune");
        this.t.addOpposite("immortal");
        this.t.addOpposite("contagious");
        this.t.addOpposite("boat");
        this.t.can_be_cured = true;
        ActorTrait t7 = this.t;
        t7.action_special_effect = (WorldAction)Delegate.Combine(t7.action_special_effect, new WorldAction(ActionLibrary.plagueEffect));
        this.t.base_stats["multiplier_speed"] = -0.3f;
        this.t.base_stats["multiplier_damage"] = -0.5f;
        this.t.base_stats["stamina"] = -10f;
        this.t.base_stats["armor"] = -2f;
        this.t.base_stats["loyalty_traits"] = -15f;
        this.t.base_stats["lifespan"] = -30f;
        this.add(new ActorTrait
        {
            id = "blessed",
            likeability = 0.1f,
            path_icon = "ui/Icons/actor_traits/iconBlessing",
            group_id = "acquired",
            is_mutation_box_allowed = false
        });
        this.t.addOpposite("evil");
        this.t.base_stats["multiplier_damage"] = 0.5f;
        this.t.base_stats["multiplier_health"] = 0.5f;
        this.t.base_stats["multiplier_speed"] = 0.5f;
        this.t.base_stats["multiplier_diplomacy"] = 0.2f;
        this.t.base_stats["multiplier_crit"] = 0.1f;
        this.t.base_stats["lifespan"] = 5f;
        this.add(new ActorTrait
        {
            id = "kingslayer",
            path_icon = "ui/Icons/actor_traits/iconKingslayer",
            group_id = "merits",
            is_mutation_box_allowed = false
        });
        this.t.base_stats["multiplier_supply_timer"] = 2f;
        this.t.base_stats["loyalty_traits"] = -25f;
        this.t.base_stats["diplomacy"] = -5f;
        this.t.base_stats["warfare"] = 5f;
        this.add(new ActorTrait
        {
            id = "mageslayer",
            group_id = "merits",
            path_icon = "ui/Icons/actor_traits/iconMageslayer",
            is_mutation_box_allowed = false
        });
        this.t.base_stats["loyalty_traits"] = -10f;
        this.t.base_stats["warfare"] = 5f;
        this.t.base_stats["critical_chance"] = 0.03f;
        this.add(new ActorTrait
        {
            id = "dragonslayer",
            group_id = "merits",
            path_icon = "ui/Icons/actor_traits/iconDragonslayer",
            is_mutation_box_allowed = false
        });
        this.t.base_stats["warfare"] = 5f;
        this.t.base_stats["critical_chance"] = 0.04f;
        this.t.base_stats["multiplier_diplomacy"] = 0.1f;
        this.add(new ActorTrait
        {
            id = "crippled",
            path_icon = "ui/Icons/actor_traits/iconCrippled",
            same_trait_mod = 10,
            can_be_removed_by_divine_light = true,
            can_be_removed_by_accelerated_healing = true,
            type = TraitType.Negative,
            group_id = "acquired",
            is_mutation_box_allowed = false
        });
        this.t.base_stats["multiplier_speed"] = -0.5f;
        this.t.base_stats["diplomacy"] = -3f;
        this.t.base_stats["multiplier_offspring"] = -0.5f;
        this.add(new ActorTrait
        {
            id = "golden_tooth",
            path_icon = "ui/Icons/actor_traits/iconGoldenTooth",
            same_trait_mod = 5,
            type = TraitType.Positive,
            group_id = "appearance",
            is_mutation_box_allowed = false
        });
        this.t.base_stats["diplomacy"] = 2f;
        this.add(new ActorTrait
        {
            id = "eyepatch",
            path_icon = "ui/Icons/actor_traits/iconEyePatch",
            same_trait_mod = 20,
            can_be_removed_by_divine_light = true,
            can_be_removed_by_accelerated_healing = true,
            type = TraitType.Negative,
            group_id = "appearance",
            is_mutation_box_allowed = false
        });
        this.t.base_stats["accuracy"] = -5f;
        this.t.base_stats["diplomacy"] = 1f;
        this.t.base_stats["warfare"] = -1f;
        this.t.base_stats["critical_chance"] = -0.15f;
        this.add(new ActorTrait
        {
            id = "skin_burns",
            path_icon = "ui/Icons/actor_traits/iconSkinBurns",
            same_trait_mod = 40,
            can_be_removed_by_divine_light = true,
            can_be_removed_by_accelerated_healing = true,
            type = TraitType.Negative,
            group_id = "appearance",
            is_mutation_box_allowed = false
        });
        this.t.base_stats["diplomacy"] = -2f;
        this.t.base_stats["warfare"] = 2f;
        this.t.base_stats["multiplier_speed"] = -0.25f;
        this.t.base_stats["lifespan"] = -5f;
    }

    // Token: 0x06000B59 RID: 2905 RVA: 0x000A5448 File Offset: 0x000A3648
    private void addTraitsFun()
    {
        this.add(new ActorTrait
        {
            id = "super_health",
            path_icon = "ui/Icons/actor_traits/iconSuperHealth",
            unlocked_with_achievement = true,
            achievement_id = "achievementTraitsExplorer90",
            group_id = "health",
            rate_inherit = 3
        });
        this.t.base_stats["lifespan"] = 100f;
        this.t.base_stats["multiplier_health"] = 100f;
        this.add(new ActorTrait
        {
            id = "death_nuke",
            path_icon = "ui/Icons/actor_traits/iconDeathNuke",
            unlocked_with_achievement = true,
            achievement_id = "achievementFinalResolution",
            group_id = "fun",
            rate_inherit = 1,
            is_mutation_box_allowed = false
        });
        this.t.addOpposite("death_bomb");
        ActorTrait t = this.t;
        t.action_death = (WorldAction)Delegate.Combine(t.action_death, new WorldAction(ActionLibrary.deathNuke));
        this.add(new ActorTrait
        {
            id = "death_bomb",
            path_icon = "ui/Icons/actor_traits/iconDeathBomb",
            unlocked_with_achievement = true,
            achievement_id = "achievementManyBombs",
            group_id = "fun",
            rate_inherit = 1
        });
        this.t.addOpposite("death_nuke");
        ActorTrait t2 = this.t;
        t2.action_death = (WorldAction)Delegate.Combine(t2.action_death, new WorldAction(ActionLibrary.deathBomb));
        this.add(new ActorTrait
        {
            id = "death_mark",
            path_icon = "ui/Icons/actor_traits/iconDeathMark",
            unlocked_with_achievement = true,
            achievement_id = "achievementTraitsExplorer40",
            group_id = "fun",
            is_mutation_box_allowed = false
        });
        ActorTrait t3 = this.t;
        t3.action_special_effect = (WorldAction)Delegate.Combine(t3.action_special_effect, new WorldAction(ActionLibrary.deathMark));
        this.add(new ActorTrait
        {
            id = "energized",
            path_icon = "ui/Icons/actor_traits/iconLightning",
            group_id = "fun",
            spawn_random_trait_allowed = false
        });
        this.t.addOpposite("boat");
        this.t.base_stats["multiplier_speed"] = 2f;
        this.t.base_stats["lifespan"] = 7f;
        ActorTrait t4 = this.t;
        t4.action_death = (WorldAction)Delegate.Combine(t4.action_death, new WorldAction(ActionLibrary.energizedLightning));
        this.add(new ActorTrait
        {
            id = "mega_heartbeat",
            path_icon = "ui/Icons/actor_traits/iconMegaHeartbeat",
            group_id = "fun",
            rate_inherit = 4,
            unlocked_with_achievement = true,
            achievement_id = "achievementPrintHeart",
            special_effect_interval = 5f,
            likeability = 0.1f,
            spawn_random_trait_allowed = false,
            is_mutation_box_allowed = false
        });
        this.t.addOpposite("whirlwind");
        ActorTrait t5 = this.t;
        t5.action_special_effect = (WorldAction)Delegate.Combine(t5.action_special_effect, new WorldAction(ActionLibrary.megaHeartbeat));
        this.add(new ActorTrait
        {
            id = "bomberman",
            path_icon = "ui/Icons/actor_traits/iconGrenade",
            group_id = "skills",
            combat = true
        });
        this.t.addCombatAction("combat_throw_bomb");
        this.add(new ActorTrait
        {
            id = "pyromaniac",
            path_icon = "ui/Icons/actor_traits/iconPyromaniac",
            rate_acquire_grow_up = 2,
            achievement_id = "achievementWorldWar",
            unlocked_with_achievement = true,
            group_id = "skills",
            acquire_grow_up_sapient_only = true,
            rate_inherit = 4
        });
        this.t.addCombatAction("combat_throw_torch");
        this.add(new ActorTrait
        {
            id = "whirlwind",
            path_icon = "ui/Icons/iconTornado",
            group_id = "fun",
            action_special_effect = new WorldAction(ActionLibrary.whirlwind),
            special_effect_interval = 0.1f,
            unlocked_with_achievement = true,
            spawn_random_trait_allowed = false,
            is_mutation_box_allowed = false,
            achievement_id = "achievementRainTornado"
        });
        this.t.addOpposite("mega_heartbeat");
    }

    // Token: 0x06000B5A RID: 2906 RVA: 0x000A58A0 File Offset: 0x000A3AA0
    private void addTraitsMisc()
    {
        this.add(new ActorTrait
        {
            id = "light_lamp",
            path_icon = "ui/Icons/actor_traits/iconLightLamp",
            group_id = "miscellaneous"
        });
        this.t.base_stats.addTag("generate_light");
        this.add(new ActorTrait
        {
            id = "shiny",
            path_icon = "ui/Icons/actor_traits/iconShiny",
            group_id = "miscellaneous",
            rate_inherit = 10
        });
        this.t.base_stats["diplomacy"] = 5f;
        this.t.action_special_effect = new WorldAction(ActionLibrary.shiny);
        this.add(new ActorTrait
        {
            id = "flower_prints",
            path_icon = "ui/Icons/actor_traits/iconFlowerPrints",
            unlocked_with_achievement = true,
            achievement_id = "achievementTouchTheGrass",
            group_id = "miscellaneous",
            rate_inherit = 10
        });
        ActorTrait t = this.t;
        t.action_special_effect = (WorldAction)Delegate.Combine(t.action_special_effect, new WorldAction(ActionLibrary.flowerPrintsEffect));
    }

    // Token: 0x06000B5B RID: 2907 RVA: 0x000A59C4 File Offset: 0x000A3BC4
    private void addTraitsSpecial()
    {
        this.add(new ActorTrait
        {
            id = "clone",
            rarity = Rarity.R0_Normal,
            path_icon = "ui/Icons/actor_traits/iconClone",
            can_be_given = false,
            group_id = "special",
            is_mutation_box_allowed = false
        });
        this.add(new ActorTrait
        {
            id = "boat",
            path_icon = "ui/Icons/iconBoat",
            can_be_given = false,
            group_id = "special",
            is_mutation_box_allowed = false
        });
        this.t.addOpposite("infected");
        this.t.addOpposite("tumor_infection");
        this.t.addOpposite("mush_spores");
        this.t.addOpposite("plague");
        this.t.addOpposite("immortal");
        this.t.addOpposite("energized");
        this.t.addOpposite("wise");
        this.add(new ActorTrait
        {
            id = "scar_of_divinity",
            path_icon = "ui/Icons/actor_traits/iconDivineScar",
            can_be_removed = false,
            can_be_given = false,
            rate_inherit = 0,
            group_id = "special",
            is_mutation_box_allowed = false
        });
        this.add(new ActorTrait
        {
            id = "miracle_born",
            path_icon = "ui/Icons/actor_traits/iconMiracleBorn",
            group_id = "special",
            can_be_given = false,
            can_be_removed = false,
            is_mutation_box_allowed = false
        });
        this.t.base_stats["lifespan"] = 20f;
        this.t.base_stats["multiplier_offspring"] = 2f;
        this.t.base_stats["birth_rate"] = 2f;
        this.add(new ActorTrait
        {
            id = "miracle_bearer",
            path_icon = "ui/Icons/actor_traits/iconMiracleBearer",
            group_id = "special",
            can_be_given = false,
            can_be_removed = false,
            is_mutation_box_allowed = false
        });
        this.add(new ActorTrait
        {
            id = "contagious",
            path_icon = "ui/Icons/iconRat",
            group_id = "miscellaneous",
            is_mutation_box_allowed = false
        });
        this.t.addOpposite("plague");
        ActorTrait t = this.t;
        t.action_special_effect = (WorldAction)Delegate.Combine(t.action_special_effect, new WorldAction(ActionLibrary.contagiousEffect));
        this.add(new ActorTrait
        {
            id = "zombie",
            path_icon = "ui/Icons/iconZombie",
            can_be_given = false,
            group_id = "special",
            is_mutation_box_allowed = false
        });
        this.t.action_special_effect = new WorldAction(ActionLibrary.zombieEffect);
        this.t.action_attack_target = new AttackAction(ActionLibrary.zombieInfectAttack);
        this.add(new ActorTrait
        {
            id = "madness",
            path_icon = "ui/Icons/actor_traits/iconMadness",
            group_id = "special",
            can_be_removed_by_divine_light = true,
            can_be_given = false,
            can_be_removed = false,
            is_kingdom_affected = true,
            affects_mind = true,
            forced_kingdom = "mad",
            likeability = -1f,
            is_mutation_box_allowed = false
        });
        ActorTrait t2 = this.t;
        t2.action_on_add = (WorldActionTrait)Delegate.Combine(t2.action_on_add, new WorldActionTrait(ActionLibrary.forcedKingdomAdd));
        ActorTrait t3 = this.t;
        t3.action_on_remove = (WorldActionTrait)Delegate.Combine(t3.action_on_remove, new WorldActionTrait(ActionLibrary.forcedKingdomEffectRemove));
        ActorTrait t4 = this.t;
        t4.action_on_load = (WorldActionTrait)Delegate.Combine(t4.action_on_load, new WorldActionTrait(ActionLibrary.madnessEffectLoad));
        this.t.traits_to_remove_ids = new string[] { "desire_alien_mold", "desire_computer", "desire_golden_egg", "desire_harp" };
        this.t.addOpposite("strong_minded");
        this.t.addOpposite("desire_alien_mold");
        this.t.addOpposite("desire_computer");
        this.t.addOpposite("desire_golden_egg");
        this.t.addOpposite("desire_harp");
        this.t.addDecision("madness_random_emotion");
        this.t.base_stats["multiplier_speed"] = 0.1f;
        this.t.base_stats["diplomacy"] = -100f;
        this.t.base_stats["loyalty_traits"] = -100f;
        this.add(new ActorTrait
        {
            id = "desire_alien_mold",
            path_icon = "ui/Icons/actor_traits/iconWaypointAlienMoldDrop",
            group_id = "special",
            can_be_removed_by_divine_light = true,
            can_be_given = false,
            can_be_removed = false,
            is_kingdom_affected = true,
            affects_mind = true,
            forced_kingdom = "alien_mold",
            is_mutation_box_allowed = false
        });
        ActorTrait t5 = this.t;
        t5.action_on_add = (WorldActionTrait)Delegate.Combine(t5.action_on_add, new WorldActionTrait(ActionLibrary.forcedKingdomAdd));
        ActorTrait t6 = this.t;
        t6.action_on_remove = (WorldActionTrait)Delegate.Combine(t6.action_on_remove, new WorldActionTrait(ActionLibrary.forcedKingdomEffectRemove));
        ActorTrait t7 = this.t;
        t7.action_on_load = (WorldActionTrait)Delegate.Combine(t7.action_on_load, new WorldActionTrait(ActionLibrary.madnessEffectLoad));
        this.t.addDecision("follow_desire_target");
        this.t.traits_to_remove_ids = new string[] { "desire_computer", "desire_golden_egg", "desire_harp", "madness" };
        this.t.addOpposite("madness");
        this.t.addOpposite("desire_computer");
        this.t.addOpposite("desire_golden_egg");
        this.t.addOpposite("desire_harp");
        this.t.base_stats["targets"] = 1f;
        this.t.base_stats["multiplier_crit"] = 0.3f;
        this.t.base_stats["damage_range"] = 0.3f;
        this.t.base_stats["armor"] = 10f;
        this.add(new ActorTrait
        {
            id = "desire_computer",
            path_icon = "ui/Icons/actor_traits/iconWaypointComputerDrop",
            group_id = "special",
            can_be_removed_by_divine_light = true,
            can_be_given = false,
            can_be_removed = false,
            is_kingdom_affected = true,
            affects_mind = true,
            forced_kingdom = "computer",
            is_mutation_box_allowed = false
        });
        ActorTrait t8 = this.t;
        t8.action_on_add = (WorldActionTrait)Delegate.Combine(t8.action_on_add, new WorldActionTrait(ActionLibrary.forcedKingdomAdd));
        ActorTrait t9 = this.t;
        t9.action_on_remove = (WorldActionTrait)Delegate.Combine(t9.action_on_remove, new WorldActionTrait(ActionLibrary.forcedKingdomEffectRemove));
        ActorTrait t10 = this.t;
        t10.action_on_load = (WorldActionTrait)Delegate.Combine(t10.action_on_load, new WorldActionTrait(ActionLibrary.madnessEffectLoad));
        this.t.addDecision("follow_desire_target");
        this.t.traits_to_remove_ids = new string[] { "desire_alien_mold", "desire_golden_egg", "desire_harp", "madness" };
        this.t.addOpposite("madness");
        this.t.addOpposite("desire_alien_mold");
        this.t.addOpposite("desire_golden_egg");
        this.t.addOpposite("desire_harp");
        this.t.base_stats["multiplier_health"] = 0.3f;
        this.t.base_stats["multiplier_lifespan"] = 0.5f;
        this.add(new ActorTrait
        {
            id = "desire_golden_egg",
            path_icon = "ui/Icons/actor_traits/iconWaypointGoldenEggDrop",
            group_id = "special",
            can_be_removed_by_divine_light = true,
            can_be_given = false,
            can_be_removed = false,
            is_kingdom_affected = true,
            affects_mind = true,
            forced_kingdom = "golden_egg",
            is_mutation_box_allowed = false
        });
        ActorTrait t11 = this.t;
        t11.action_on_add = (WorldActionTrait)Delegate.Combine(t11.action_on_add, new WorldActionTrait(ActionLibrary.forcedKingdomAdd));
        ActorTrait t12 = this.t;
        t12.action_on_remove = (WorldActionTrait)Delegate.Combine(t12.action_on_remove, new WorldActionTrait(ActionLibrary.forcedKingdomEffectRemove));
        ActorTrait t13 = this.t;
        t13.action_on_load = (WorldActionTrait)Delegate.Combine(t13.action_on_load, new WorldActionTrait(ActionLibrary.madnessEffectLoad));
        this.t.addDecision("follow_desire_target");
        this.t.traits_to_remove_ids = new string[] { "desire_alien_mold", "desire_computer", "desire_harp", "madness" };
        this.t.addOpposite("strong_minded");
        this.t.addOpposite("madness");
        this.t.addOpposite("desire_alien_mold");
        this.t.addOpposite("desire_computer");
        this.t.addOpposite("desire_harp");
        this.t.base_stats["multiplier_damage"] = 0.5f;
        this.add(new ActorTrait
        {
            id = "desire_harp",
            path_icon = "ui/Icons/actor_traits/iconWaypointHarpDrop",
            group_id = "special",
            can_be_removed_by_divine_light = true,
            can_be_given = false,
            can_be_removed = false,
            is_kingdom_affected = true,
            affects_mind = true,
            forced_kingdom = "harp",
            is_mutation_box_allowed = false
        });
        ActorTrait t14 = this.t;
        t14.action_on_add = (WorldActionTrait)Delegate.Combine(t14.action_on_add, new WorldActionTrait(ActionLibrary.forcedKingdomAdd));
        ActorTrait t15 = this.t;
        t15.action_on_remove = (WorldActionTrait)Delegate.Combine(t15.action_on_remove, new WorldActionTrait(ActionLibrary.forcedKingdomEffectRemove));
        ActorTrait t16 = this.t;
        t16.action_on_load = (WorldActionTrait)Delegate.Combine(t16.action_on_load, new WorldActionTrait(ActionLibrary.madnessEffectLoad));
        this.t.addDecision("follow_desire_target");
        this.t.traits_to_remove_ids = new string[] { "desire_alien_mold", "desire_computer", "desire_golden_egg", "madness" };
        this.t.addOpposite("strong_minded");
        this.t.addOpposite("madness");
        this.t.addOpposite("desire_alien_mold");
        this.t.addOpposite("desire_computer");
        this.t.addOpposite("desire_golden_egg");
        this.t.base_stats["multiplier_speed"] = 0.3f;
        this.t.base_stats["multiplier_attack_speed"] = 0.3f;
    }

    // Token: 0x06000B5C RID: 2908 RVA: 0x000A64D8 File Offset: 0x000A46D8
    public override ActorTrait add(ActorTrait pAsset)
    {
        base.add(pAsset);
        this.checkDefault(pAsset);
        return pAsset;
    }

    // Token: 0x06000B5D RID: 2909 RVA: 0x000A64EC File Offset: 0x000A46EC
    public override void linkAssets()
    {
        base.linkAssets();
        foreach (ActorTrait tTrait in this.list)
        {
            if (tTrait.is_mutation_box_allowed)
            {
                this.pot_traits_mutation_box.Add(tTrait);
            }
        }
        foreach (ActorTrait tTrait2 in this.list)
        {
            if (tTrait2.rate_birth != 0)
            {
                for (int i = 0; i < tTrait2.rate_birth; i++)
                {
                    this.pot_traits_birth.Add(tTrait2);
                }
            }
        }
        foreach (ActorTrait tTrait3 in this.list)
        {
            if (tTrait3.rate_acquire_grow_up != 0)
            {
                for (int j = 0; j < tTrait3.rate_acquire_grow_up; j++)
                {
                    this.pot_traits_growup.Add(tTrait3);
                }
            }
        }
        foreach (ActorTrait tTrait4 in this.list)
        {
            if (tTrait4.combat)
            {
                this.pot_traits_combat.Add(tTrait4);
            }
        }
    }

    // Token: 0x06000B5E RID: 2910 RVA: 0x000A666C File Offset: 0x000A486C
    private void checkDefault(ActorTrait pAsset)
    {
        if (pAsset.rate_inherit == 0)
        {
            pAsset.rate_inherit = pAsset.rate_birth * 10;
        }
    }

    // Token: 0x06000B5F RID: 2911 RVA: 0x000A6688 File Offset: 0x000A4888
    public int checkTraitsMod(Actor pMain, Actor pTarget)
    {
        int tResult = 0;
        foreach (ActorTrait tTrait in pMain.getTraits())
        {
            if (tTrait.same_trait_mod != 0 && pTarget.hasTrait(tTrait))
            {
                tResult += tTrait.same_trait_mod;
            }
            if (tTrait.opposite_trait_mod != 0)
            {
                foreach (ActorTrait tOppositeTrait in tTrait.opposite_traits)
                {
                    if (pTarget.hasTrait(tOppositeTrait))
                    {
                        tResult += tTrait.opposite_trait_mod;
                    }
                }
            }
        }
        return tResult;
    }

    // Token: 0x04000AF5 RID: 2805
    public const int COMBAT_SKILLS_AMOUNT = 5;

    // Token: 0x04000AF6 RID: 2806
    [NonSerialized]
    public List<ActorTrait> pot_traits_mutation_box = new List<ActorTrait>();

    // Token: 0x04000AF7 RID: 2807
    [NonSerialized]
    public List<ActorTrait> pot_traits_birth = new List<ActorTrait>();

    // Token: 0x04000AF8 RID: 2808
    [NonSerialized]
    public List<ActorTrait> pot_traits_growup = new List<ActorTrait>();

    // Token: 0x04000AF9 RID: 2809
    [NonSerialized]
    public List<ActorTrait> pot_traits_combat = new List<ActorTrait>();
}
using System;
using System.Collections;
using System.Collections.Generic;
using LayoutGroupExt;
using UnityEngine;

// Token: 0x02000724 RID: 1828
public class TraitsContainer<TTrait, TTraitButton> : MonoBehaviour where TTrait : BaseTrait<TTrait> where TTraitButton : TraitButton<TTrait>
{
    // Token: 0x06003973 RID: 14707 RVA: 0x001A4158 File Offset: 0x001A2358
    private void Awake()
    {
        this._trait_window = base.GetComponentInParent<ITraitWindow<TTrait, TTraitButton>>();
        this._pool_traits = new ObjectPoolGenericMono<TTraitButton>(this._prefab_trait, this._grid);
        this._layout_grid = this._grid.GetComponent<LayoutGroupExtended>();
        this._grid.gameObject.AddOrGetComponent<TraitsGrid>().on_change = new OnChange(this.sortTraits);
    }

    // Token: 0x06003974 RID: 14708 RVA: 0x001A41BC File Offset: 0x001A23BC
    private void OnEnable()
    {
        if (this._regular_title != null)
        {
            if (this._unlocked_title.gameObject.activeSelf)
            {
                this._regular_title.gameObject.SetActive(false);
            }
            else
            {
                this._regular_title.gameObject.SetActive(true);
            }
        }
        base.StartCoroutine(this.loadActiveTraits(true));
    }

    // Token: 0x06003975 RID: 14709 RVA: 0x001A421B File Offset: 0x001A241B
    private void OnDisable()
    {
        this._traits.Clear();
        this._pool_traits.clear(true);
    }

    // Token: 0x06003976 RID: 14710 RVA: 0x001A4234 File Offset: 0x001A2434
    public void reloadTraits(bool pAnimated)
    {
        base.StopAllCoroutines();
        base.StartCoroutine(this.loadActiveTraits(pAnimated));
    }

    // Token: 0x06003977 RID: 14711 RVA: 0x001A424A File Offset: 0x001A244A
    protected IEnumerator loadActiveTraits(bool pAnimated = true)
    {
        using (ListPool<TTrait> tListPool = new ListPool<TTrait>(this._trait_window.getTraits()))
        {
            this._traits.Clear();
            this._pool_traits.clear(true);
            foreach (TTrait ptr in tListPool)
            {
                TTrait tTrait = ptr;
                this.loadActiveTrait(tTrait);
            }
            yield break;
        }
        yield break;
    }

    // Token: 0x06003978 RID: 14712 RVA: 0x001A425C File Offset: 0x001A245C
    private void loadActiveTrait(TTrait pTraitAsset)
    {
        TTraitButton tButton = this._pool_traits.getNext();
        tButton.load(pTraitAsset);
        this._traits[pTraitAsset] = tButton;
        AugmentationUnlockedAction tAction = new AugmentationUnlockedAction(this._trait_window.getEditor().reloadButtons);
        tButton.removeElementUnlockedAction(tAction);
        tButton.addElementUnlockedAction(tAction);
        ITraitsEditor<TTrait> tEditor = this._trait_window.getEditor();
        tButton.removeClickAction(new AugmentationButtonClickAction(tEditor.scrollToGroupStarter));
        tButton.addClickAction(new AugmentationButtonClickAction(tEditor.scrollToGroupStarter));
    }

    // Token: 0x06003979 RID: 14713 RVA: 0x001A42FC File Offset: 0x001A24FC
    public void sortTraits()
    {
        using (ListPool<TTrait> tListPool = new ListPool<TTrait>(this._traits.Keys))
        {
            tListPool.Sort((TTrait a, TTrait b) => this._traits[a].transform.GetSiblingIndex().CompareTo(this._traits[b].transform.GetSiblingIndex()));
            this._trait_window.sortTraits(tListPool);
        }
    }

    // Token: 0x0600397A RID: 14714 RVA: 0x001A4354 File Offset: 0x001A2554
    public ObjectPoolGenericMono<TTraitButton> getTraitPool()
    {
        return this._pool_traits;
    }

    // Token: 0x0600397B RID: 14715 RVA: 0x001A435C File Offset: 0x001A255C
    public IReadOnlyCollection<TTraitButton> getTraitButtons()
    {
        return this._traits.Values;
    }

    // Token: 0x04002ABD RID: 10941
    [SerializeField]
    private TTraitButton _prefab_trait;

    // Token: 0x04002ABE RID: 10942
    [SerializeField]
    private Transform _regular_title;

    // Token: 0x04002ABF RID: 10943
    [SerializeField]
    private Transform _unlocked_title;

    // Token: 0x04002AC0 RID: 10944
    [SerializeField]
    private Transform _grid;

    // Token: 0x04002AC1 RID: 10945
    private LayoutGroupExtended _layout_grid;

    // Token: 0x04002AC2 RID: 10946
    private ObjectPoolGenericMono<TTraitButton> _pool_traits;

    // Token: 0x04002AC3 RID: 10947
    private ITraitWindow<TTrait, TTraitButton> _trait_window;

    // Token: 0x04002AC4 RID: 10948
    private Dictionary<TTrait, TTraitButton> _traits = new Dictionary<TTrait, TTraitButton>();
}
using System;
using System.Collections.Generic;
using UnityEngine;

// Token: 0x02000205 RID: 517
public class AllianceManager : MetaSystemManager<Alliance, AllianceData>
{
    // Token: 0x0600125A RID: 4698 RVA: 0x000D0590 File Offset: 0x000CE790
    public AllianceManager()
    {
        this.type_id = "alliance";
    }

    // Token: 0x0600125B RID: 4699 RVA: 0x000D05B0 File Offset: 0x000CE7B0
    public override void update(float pElapsed)
    {
        base.update(pElapsed);
        foreach (Alliance tAlliance in this)
        {
            tAlliance.clearCursorOver();
            if (!tAlliance.checkActive())
            {
                this._to_dissolve.Add(tAlliance);
            }
            else
            {
                tAlliance.update();
            }
        }
        foreach (Alliance tAlliance2 in this._to_dissolve)
        {
            this.dissolveAlliance(tAlliance2);
        }
        this._to_dissolve.Clear();
    }

    // Token: 0x0600125C RID: 4700 RVA: 0x000D0668 File Offset: 0x000CE868
    public void dissolveAlliance(Alliance pAlliance)
    {
        World.world.game_stats.data.alliancesDissolved += 1L;
        World.world.map_stats.alliancesDissolved += 1L;
        WorldLog.logAllianceDisolved(pAlliance);
        pAlliance.dissolve();
        this.removeObject(pAlliance);
    }

    // Token: 0x0600125D RID: 4701 RVA: 0x000D06BD File Offset: 0x000CE8BD
    private void addTest()
    {
    }

    // Token: 0x0600125E RID: 4702 RVA: 0x000D06C0 File Offset: 0x000CE8C0
    public bool forceAlliance(Kingdom pKingdom1, Kingdom pKingdom2)
    {
        Alliance tCurAlliance = pKingdom1.getAlliance();
        if (tCurAlliance == null)
        {
            tCurAlliance = pKingdom2.getAlliance();
        }
        bool tNew = false;
        if (tCurAlliance == null)
        {
            tCurAlliance = this.newAlliance(pKingdom1, pKingdom2);
            tNew = true;
        }
        else
        {
            tCurAlliance.join(pKingdom1, true, true);
            tCurAlliance.join(pKingdom2, true, true);
        }
        tCurAlliance.setType(AllianceType.Forced);
        return tNew;
    }

    // Token: 0x0600125F RID: 4703 RVA: 0x000D070C File Offset: 0x000CE90C
    public void useDiscordPower(Alliance pAlliance, City pCity)
    {
        Kingdom tKingdom = pCity.kingdom;
        pAlliance.leave(tKingdom, true);
        EffectsLibrary.highlightKingdomZones(tKingdom, Color.white, 0.3f);
        if (pAlliance.kingdoms_hashset.Count == 0)
        {
            this.dissolveAlliance(pAlliance);
        }
    }

    // Token: 0x06001260 RID: 4704 RVA: 0x000D074C File Offset: 0x000CE94C
    public Alliance newAlliance(Kingdom pKingdom, Kingdom pKingdom2)
    {
        World.world.game_stats.data.alliancesMade += 1L;
        World.world.map_stats.alliancesMade += 1L;
        Alliance alliance = base.newObject();
        alliance.createNewAlliance();
        alliance.addFounders(pKingdom, pKingdom2);
        WorldLog.logAllianceCreated(alliance);
        return alliance;
    }

    // Token: 0x06001261 RID: 4705 RVA: 0x000D07A8 File Offset: 0x000CE9A8
    public Sprite[] getBackgroundsList()
    {
        if (this._cached_banner_backgrounds == null)
        {
            this._cached_banner_backgrounds = SpriteTextureLoader.getSpriteList("alliances/backgrounds/", false);
        }
        return this._cached_banner_backgrounds;
    }

    // Token: 0x06001262 RID: 4706 RVA: 0x000D07C9 File Offset: 0x000CE9C9
    public Sprite[] getIconsList()
    {
        if (this._cached_banner_icons == null)
        {
            this._cached_banner_icons = SpriteTextureLoader.getSpriteList("alliances/icons/", false);
        }
        return this._cached_banner_icons;
    }

    // Token: 0x06001263 RID: 4707 RVA: 0x000D07EA File Offset: 0x000CE9EA
    public bool anyAlliances()
    {
        return this.Count > 0;
    }

    // Token: 0x06001264 RID: 4708 RVA: 0x000D07F5 File Offset: 0x000CE9F5
    public override void clear()
    {
        base.clear();
    }

    // Token: 0x06001265 RID: 4709 RVA: 0x000D07FD File Offset: 0x000CE9FD
    protected override void updateDirtyUnits()
    {
    }

    // Token: 0x04001104 RID: 4356
    public Sprite[] _cached_banner_backgrounds;

    // Token: 0x04001105 RID: 4357
    public Sprite[] _cached_banner_icons;

    // Token: 0x04001106 RID: 4358
    private List<Alliance> _to_dissolve = new List<Alliance>();
}
using System;
using System.Collections.Generic;
using UnityEngine;

// Token: 0x0200025E RID: 606
public class DiplomacyManager : CoreSystemManager<DiplomacyRelation, DiplomacyRelationData>
{
    // Token: 0x06001619 RID: 5657 RVA: 0x000DED53 File Offset: 0x000DCF53
    public DiplomacyManager()
    {
        this.type_id = "diplomacy";
    }

    // Token: 0x0600161A RID: 5658 RVA: 0x000DED74 File Offset: 0x000DCF74
    public override List<DiplomacyRelationData> save(List<DiplomacyRelation> pList = null)
    {
        List<DiplomacyRelationData> tSavingList = new List<DiplomacyRelationData>();
        foreach (DiplomacyRelation tRel in this)
        {
            tRel.kingdom1 = World.world.kingdoms.get(tRel.data.kingdom1_id);
            tRel.kingdom2 = World.world.kingdoms.get(tRel.data.kingdom2_id);
            if (tRel.kingdom1 != null && tRel.kingdom2 != null)
            {
                tSavingList.Add(tRel.data);
            }
        }
        return tSavingList;
    }

    // Token: 0x0600161B RID: 5659 RVA: 0x000DEE18 File Offset: 0x000DD018
    public override void loadFromSave(List<DiplomacyRelationData> pList)
    {
        for (int i = 0; i < pList.Count; i++)
        {
            DiplomacyRelationData tData = pList[i];
            bool flag = World.world.kingdoms.get(tData.kingdom1_id) != null;
            Kingdom tK2 = World.world.kingdoms.get(tData.kingdom2_id);
            if (flag && tK2 != null)
            {
                if (tData.id == -1L)
                {
                    tData.id = World.world.map_stats.getNextId(this.type_id);
                }
                this.loadObject(tData);
            }
        }
    }

    // Token: 0x0600161C RID: 5660 RVA: 0x000DEE9C File Offset: 0x000DD09C
    public override DiplomacyRelation loadObject(DiplomacyRelationData pData)
    {
        Kingdom tK = World.world.kingdoms.get(pData.kingdom1_id);
        Kingdom tK2 = World.world.kingdoms.get(pData.kingdom2_id);
        pData.rel_id = pData.kingdom1_id.ToString() + "_" + pData.kingdom2_id.ToString();
        DiplomacyRelation tNewRelation = base.loadObject(pData);
        this._dict.Add(pData.rel_id, tNewRelation);
        tNewRelation.kingdom1 = tK;
        tNewRelation.kingdom2 = tK2;
        return tNewRelation;
    }

    // Token: 0x0600161D RID: 5661 RVA: 0x000DEF24 File Offset: 0x000DD124
    public override void update(float pElapsed)
    {
        base.update(pElapsed);
        if (World.world.isPaused())
        {
            return;
        }
        if (this.diplomacyTick > 0f)
        {
            this.diplomacyTick -= pElapsed;
            return;
        }
        this.diplomacyTick = 2f;
        this.newDiplomacyTick();
    }

    // Token: 0x0600161E RID: 5662 RVA: 0x000DEF72 File Offset: 0x000DD172
    public void newDiplomacyTick()
    {
        this.findSupremeKingdom();
        this.checkAchievements();
    }

    // Token: 0x0600161F RID: 5663 RVA: 0x000DEF80 File Offset: 0x000DD180
    private void checkAchievements()
    {
        AchievementLibrary.achievementWorldWar.check(null, null, null);
    }

    // Token: 0x06001620 RID: 5664 RVA: 0x000DEF90 File Offset: 0x000DD190
    private void findSupremeKingdom()
    {
        DiplomacyManager.kingdom_supreme = null;
        DiplomacyManager.kingdom_second = null;
        if (World.world.kingdoms.Count == 0)
        {
            return;
        }
        List<Kingdom> tKingdoms = DiplomacyManager._kingdom_sorter;
        tKingdoms.AddRange(World.world.kingdoms);
        for (int i = 0; i < tKingdoms.Count; i++)
        {
            Kingdom tKingdom = tKingdoms[i];
            tKingdom.power = tKingdom.countTotalWarriors() * 2 + tKingdom.cities.Count * 5 + 1;
        }
        tKingdoms.Sort(new Comparison<Kingdom>(this.sortByPower));
        DiplomacyManager.kingdom_supreme = tKingdoms[0];
        if (tKingdoms.Count > 1)
        {
            DiplomacyManager.kingdom_second = tKingdoms[1];
        }
        else
        {
            DiplomacyManager.kingdom_second = null;
        }
        tKingdoms.Clear();
    }

    // Token: 0x06001621 RID: 5665 RVA: 0x000DF049 File Offset: 0x000DD249
    public int sortByPower(Kingdom o1, Kingdom o2)
    {
        return o2.power.CompareTo(o1.power);
    }

    // Token: 0x06001622 RID: 5666 RVA: 0x000DF05C File Offset: 0x000DD25C
    private War startTotalWar(Kingdom pAttacker, WarTypeAsset pType)
    {
        if (World.world.kingdoms.Count == 1)
        {
            return null;
        }
        foreach (War tWar in pAttacker.getWars(false))
        {
            if (tWar.isMainAttacker(pAttacker) && tWar.isTotalWar())
            {
                return null;
            }
        }
        if (pAttacker.hasAlliance())
        {
            pAttacker.getAlliance().leave(pAttacker, true);
        }
        War tNewWar = World.world.wars.newWar(pAttacker, null, pType);
        War result;
        using (ListPool<War> tWars = new ListPool<War>(pAttacker.getWars(false)))
        {
            foreach (War ptr in tWars)
            {
                War tWar2 = ptr;
                if (!tWar2.isTotalWar())
                {
                    if (tWar2.isAttacker(pAttacker))
                    {
                        if (!tWar2.isMainAttacker(pAttacker))
                        {
                            tWar2.leaveWar(pAttacker);
                        }
                        else
                        {
                            World.world.wars.endWar(tWar2, WarWinner.Merged);
                        }
                    }
                    else if (tWar2.isDefender(pAttacker))
                    {
                        if (!tWar2.isMainDefender(pAttacker))
                        {
                            tWar2.leaveWar(pAttacker);
                        }
                        else
                        {
                            tWar2.lostWar(pAttacker);
                        }
                    }
                }
            }
            result = tNewWar;
        }
        return result;
    }

    // Token: 0x06001623 RID: 5667 RVA: 0x000DF1BC File Offset: 0x000DD3BC
    internal War startWar(Kingdom pAttacker, Kingdom pDefender, WarTypeAsset pAsset, bool pLog = true)
    {
        if (pAsset.total_war)
        {
            return this.startTotalWar(pAttacker, pAsset);
        }
        if (pAttacker == pDefender)
        {
            return null;
        }
        if (World.world.wars.getWar(pAttacker, pDefender, true) != null)
        {
            return null;
        }
        if (pLog)
        {
            WorldLog.logNewWar(pAttacker, pDefender);
        }
        War tNewWar = World.world.wars.newWar(pAttacker, pDefender, pAsset);
        if (pAsset.alliance_join)
        {
            Alliance tAllianceAttackers = pAttacker.getAlliance();
            Alliance tAllianceDefenders = pDefender.getAlliance();
            if (tAllianceAttackers != null)
            {
                foreach (Kingdom tKingdom in tAllianceAttackers.kingdoms_hashset)
                {
                    tNewWar.joinAttackers(tKingdom);
                }
            }
            if (tAllianceDefenders != null)
            {
                foreach (Kingdom tKingdom2 in tAllianceDefenders.kingdoms_hashset)
                {
                    tNewWar.joinDefenders(tKingdom2);
                }
            }
        }
        return tNewWar;
    }

    // Token: 0x06001624 RID: 5668 RVA: 0x000DF2C0 File Offset: 0x000DD4C0
    public void eventSpite(Kingdom pKingdom)
    {
        if (World.world.kingdoms.Count <= 1)
        {
            return;
        }
        using (ListPool<Kingdom> toHighlight = new ListPool<Kingdom>(World.world.kingdoms.Count))
        {
            War tWar = this.startWar(pKingdom, null, WarTypeLibrary.spite, true);
            if (tWar != null)
            {
                pKingdom.affectKingByPowers();
                toHighlight.AddRange(tWar.getAttackers());
                toHighlight.AddRange(tWar.getDefenders());
                foreach (Kingdom ptr in toHighlight)
                {
                    EffectsLibrary.highlightKingdomZones(ptr, Color.red, 0.3f);
                }
            }
        }
    }

    // Token: 0x06001625 RID: 5669 RVA: 0x000DF388 File Offset: 0x000DD588
    public void eventFriendship(Kingdom pKingdom)
    {
        War tWar = World.world.wars.getRandomWarFor(pKingdom);
        if (tWar == null)
        {
            return;
        }
        using (ListPool<Kingdom> toHighlight = new ListPool<Kingdom>(World.world.kingdoms.Count))
        {
            if (tWar.isTotalWar() || tWar.isMainAttacker(pKingdom) || tWar.isMainDefender(pKingdom))
            {
                toHighlight.AddRange(tWar.getAttackers());
                toHighlight.AddRange(tWar.getDefenders());
            }
            Alliance tAlliance = pKingdom.getAlliance();
            if (tAlliance == null)
            {
                tWar.leaveWar(pKingdom);
                toHighlight.Add(pKingdom);
                pKingdom.affectKingByPowers();
            }
            else
            {
                foreach (Kingdom tAllianceKingdom in tAlliance.kingdoms_hashset)
                {
                    tWar.leaveWar(tAllianceKingdom);
                    toHighlight.Add(tAllianceKingdom);
                    tAllianceKingdom.affectKingByPowers();
                }
            }
            if (tWar.isTotalWar())
            {
                World.world.wars.endWar(tWar, WarWinner.Peace);
            }
            foreach (Kingdom ptr in toHighlight)
            {
                EffectsLibrary.highlightKingdomZones(ptr, Color.green, 0.3f);
            }
        }
    }

    // Token: 0x06001626 RID: 5670 RVA: 0x000DF4E0 File Offset: 0x000DD6E0
    public KingdomOpinion getOpinion(Kingdom k1, Kingdom k2)
    {
        return this.getRelation(k1, k2).getOpinion(k1, k2);
    }

    // Token: 0x06001627 RID: 5671 RVA: 0x000DF4F4 File Offset: 0x000DD6F4
    public int sortID(Kingdom o1, Kingdom o2)
    {
        return o1.id.CompareTo(o2.id);
    }

    // Token: 0x06001628 RID: 5672 RVA: 0x000DF518 File Offset: 0x000DD718
    public DiplomacyRelation getRelation(Kingdom pK1, Kingdom pK2)
    {
        Kingdom tOrder;
        Kingdom tOrder2;
        if (pK1.id.CompareTo(pK2.id) > 0)
        {
            tOrder = pK1;
            tOrder2 = pK2;
        }
        else
        {
            tOrder = pK2;
            tOrder2 = pK1;
        }
        string tID = tOrder.id.ToString() + "_" + tOrder2.id.ToString();
        DiplomacyRelation tRelation;
        if (this.tryGet(tID, out tRelation))
        {
            return tRelation;
        }
        tRelation = base.newObject();
        tRelation.data.rel_id = tID;
        this._dict.Add(tID, tRelation);
        tRelation.data.kingdom1_id = tOrder.id;
        tRelation.data.kingdom2_id = tOrder2.id;
        tRelation.kingdom1 = tOrder;
        tRelation.kingdom2 = tOrder2;
        return tRelation;
    }

    // Token: 0x06001629 RID: 5673 RVA: 0x000DF5D0 File Offset: 0x000DD7D0
    public void removeRelationsFor(Kingdom pKingdom)
    {
        foreach (DiplomacyRelation tRelation in this)
        {
            if (tRelation.kingdom1 == pKingdom || tRelation.kingdom2 == pKingdom)
            {
                DiplomacyManager._relations_remover.Add(tRelation);
            }
        }
        foreach (DiplomacyRelation tRelation2 in DiplomacyManager._relations_remover)
        {
            this.removeObject(tRelation2);
        }
        DiplomacyManager._relations_remover.Clear();
    }

    // Token: 0x0600162A RID: 5674 RVA: 0x000DF67C File Offset: 0x000DD87C
    public bool tryGet(string pID, out DiplomacyRelation pObject)
    {
        return this._dict.TryGetValue(pID, out pObject);
    }

    // Token: 0x0600162B RID: 5675 RVA: 0x000DF68C File Offset: 0x000DD88C
    public DiplomacyRelation get(string pID)
    {
        if (string.IsNullOrEmpty(pID))
        {
            return null;
        }
        DiplomacyRelation tObject;
        this.tryGet(pID, out tObject);
        return tObject;
    }

    // Token: 0x0600162C RID: 5676 RVA: 0x000DF6AE File Offset: 0x000DD8AE
    public override void removeObject(DiplomacyRelation pObject)
    {
        this._dict.Remove(pObject.data.rel_id);
        base.removeObject(pObject);
    }

    // Token: 0x0600162D RID: 5677 RVA: 0x000DF6CE File Offset: 0x000DD8CE
    public override void clear()
    {
        this.diplomacyTick = 0f;
        DiplomacyManager.kingdom_supreme = null;
        DiplomacyManager.kingdom_second = null;
        this._dict.Clear();
        base.clear();
    }

    // Token: 0x04001280 RID: 4736
    public static Kingdom kingdom_supreme;

    // Token: 0x04001281 RID: 4737
    public static Kingdom kingdom_second;

    // Token: 0x04001282 RID: 4738
    public static List<Kingdom> superpowers = new List<Kingdom>();

    // Token: 0x04001283 RID: 4739
    private float diplomacyTick;

    // Token: 0x04001284 RID: 4740
    private static List<Kingdom> _kingdom_sorter = new List<Kingdom>();

    // Token: 0x04001285 RID: 4741
    private static List<DiplomacyRelation> _relations_remover = new List<DiplomacyRelation>();

    // Token: 0x04001286 RID: 4742
    protected readonly Dictionary<string, DiplomacyRelation> _dict = new Dictionary<string, DiplomacyRelation>();
}
using System;
using System.Collections.Generic;
using UnityEngine;

// Token: 0x020003DB RID: 987
public static class MapGenerator
{
    // Token: 0x170001D8 RID: 472
    // (get) Token: 0x06002181 RID: 8577 RVA: 0x0011A671 File Offset: 0x00118871
    private static MapGenValues gen_values
    {
        get
        {
            return MapGenerator.template.values;
        }
    }

    // Token: 0x06002182 RID: 8578 RVA: 0x0011A67D File Offset: 0x0011887D
    public static void clear()
    {
        MapGenerator._tilesMap = null;
        MapGenerator._rooms.Clear();
    }

    // Token: 0x06002183 RID: 8579 RVA: 0x0011A690 File Offset: 0x00118890
    public static void prepare()
    {
        MapGenerator.template = AssetManager.map_gen_templates.get(Config.current_map_template);
        MapGenerator._width = MapBox.width;
        MapGenerator._height = MapBox.height;
        MapGenerator._tilesMap = World.world.tiles_map;
        MapGenerator.schedulePerlinNoiseMap();
        MapGenerator.scheduleUpdateTileTypes();
        if (MapGenerator.gen_values.forbidden_knowledge_start)
        {
            World.world.world_laws.enable("world_law_cursed_world");
            CursedSacrifice.loadAlreadyCursedState();
        }
        if (MapGenerator.gen_values.remove_mountains)
        {
            SmoothLoader.add(delegate
            {
                MapGenerator.removeMountains();
            }, "Normalize Ground", false, 0.001f, false);
        }
        if (MapGenerator.template.special_anthill)
        {
            SmoothLoader.add(delegate
            {
                MapGenerator.specialAnthill();
            }, "Anthill", false, 0.001f, false);
        }
        if (MapGenerator.template.special_checkerboard)
        {
            SmoothLoader.add(delegate
            {
                MapGenerator.specialCheckerBoard();
            }, "Checkerboard", false, 0.001f, false);
        }
        if (MapGenerator.template.special_cubicles)
        {
            SmoothLoader.add(delegate
            {
                MapGenerator.specialCubicles();
            }, "Cubicles", false, 0.001f, false);
        }
        MapGenerator.scheduleRandomShapes(Randy.randomBool());
        if (MapGenerator.template.perlin_replace.Count > 0)
        {
            using (List<PerlinReplaceContainer>.Enumerator enumerator = MapGenerator.template.perlin_replace.GetEnumerator())
            {
                while (enumerator.MoveNext())
                {
                    PerlinReplaceContainer tOption = enumerator.Current;
                    SmoothLoader.add(delegate
                    {
                        GeneratorTool.ApplyPerlinReplace(tOption);
                    }, "Perlin Replace", false, 0.001f, false);
                }
            }
        }
        SmoothLoader.add(delegate
        {
            World.world.map_chunk_manager.allDirty();
        }, "Map Chunk Manager (1/2)", false, 0.1f, false);
        SmoothLoader.add(delegate
        {
            World.world.map_chunk_manager.update(0f, true);
        }, "Map Chunk Manager (2/2)", false, 0.1f, false);
        if (MapGenerator.gen_values.random_biomes)
        {
            SmoothLoader.add(delegate
            {
                MapGenerator.generateBiomes();
            }, "Add Random Biome", false, 0.001f, false);
        }
        if (MapGenerator.gen_values.add_mountain_edges)
        {
            SmoothLoader.add(delegate
            {
                MapGenerator.addMountainEdges();
            }, "Add Mountain Edges", false, 0.001f, false);
        }
        if (MapGenerator.template.freeze_mountains)
        {
            SmoothLoader.add(delegate
            {
                MapGenerator.freezeMountainTops();
            }, "Freeze Mountain Tops", false, 0.001f, false);
        }
        if (MapGenerator.gen_values.add_vegetation)
        {
            int vegTimes = 12;
            int vegSpread = World.world.tiles_list.Length / 20;
            MapLoaderAction<>9__11;
            for (int i = 0; i < vegTimes; i++)
            {
                MapLoaderAction pAction;
                if ((pAction = <> 9__11) == null)
                {
                    pAction = (<> 9__11 = delegate ()
                    {
                        AssetManager.tiles.setListTo(DepthGeneratorType.Gameplay);
                        MapGenerator.spawnVegetation(vegSpread);
                    });
                }
                SmoothLoader.add(pAction, string.Concat(new string[]
                {
                    "Add Vegetation (",
                    (i + 1).ToString(),
                    "/",
                    vegTimes.ToString(),
                    ")"
                }), false, 0.001f, false);
            }
        }
        if (MapGenerator.gen_values.add_resources)
        {
            SmoothLoader.add(delegate
            {
                MapGenerator.spawnResources();
            }, "Add Resources", false, 0.001f, false);
        }
    }

    // Token: 0x06002184 RID: 8580 RVA: 0x0011AA6C File Offset: 0x00118C6C
    private static void scheduleUpdateTileTypes()
    {
        int tileTypesSplit = 4;
        int tilesLoadedPerFrame = World.world.tiles_list.Length / tileTypesSplit;
        int loadedTiles = 0;
        for (int i = 0; i < tileTypesSplit; i++)
        {
            int tileAmount = Mathf.Min(World.world.tiles_list.Length - loadedTiles, tilesLoadedPerFrame);
            int startIndex = loadedTiles;
            loadedTiles += tileAmount;
            SmoothLoader.add(delegate
            {
                GeneratorTool.UpdateTileTypes(true, startIndex, tileAmount);
            }, string.Concat(new string[]
            {
                "Generate Tiles (",
                loadedTiles.ToString(),
                "/",
                World.world.tiles_list.Length.ToString(),
                ")"
            }), true, 0.001f, false);
        }
    }

    // Token: 0x06002185 RID: 8581 RVA: 0x0011AB30 File Offset: 0x00118D30
    private static void scheduleRandomShapes(bool pSubstract)
    {
        if (MapGenerator.gen_values.random_shapes_amount == 0)
        {
            return;
        }
        SmoothLoader.add(delegate
        {
            GeneratorTool.Init();
        }, "Perlin Random Shapes (Init)", false, 0.001f, false);
        MapLoaderAction<>9__1;
        for (int i = 0; i < MapGenerator.gen_values.random_shapes_amount; i++)
        {
            MapLoaderAction pAction;
            if ((pAction = <> 9__1) == null)
            {
                pAction = (<> 9__1 = delegate ()
                {
                    GeneratorTool.ApplyRandomShape("height", 2f, 0.7f, pSubstract);
                });
            }
            SmoothLoader.add(pAction, string.Concat(new string[]
            {
                "Perlin Random Shapes (",
                (i + 1).ToString(),
                "/",
                MapGenerator.gen_values.random_shapes_amount.ToString(),
                ")"
            }), false, 0.001f, false);
        }
    }

    // Token: 0x06002186 RID: 8582 RVA: 0x0011AC0C File Offset: 0x00118E0C
    private static void specialCubicles()
    {
        HashSet<MapChunk> chunks_used = new HashSet<MapChunk>();
        List<MapChunk> chunks_left = new List<MapChunk>();
        foreach (MapChunk tChunk in World.world.map_chunk_manager.chunks)
        {
            chunks_left.Add(tChunk);
        }
        MapGenerator._rooms.Clear();
        while (chunks_left.Count > 0)
        {
            MapChunk tChunk2 = chunks_left.GetRandom<MapChunk>();
            MapGenerator.startCubicle(chunks_used, chunks_left, tChunk2);
        }
        MapGenerator.createDoors();
    }

    // Token: 0x06002187 RID: 8583 RVA: 0x0011AC7C File Offset: 0x00118E7C
    private static void startCubicle(HashSet<MapChunk> pChunksUsed, List<MapChunk> pListLeft, MapChunk pStartRoomChunk)
    {
        MapChunk tNextChunk = pStartRoomChunk;
        List<MapChunk> tNewRoom = new List<MapChunk>();
        MapGenerator.rememberChunk(tNextChunk, pChunksUsed, pListLeft, tNewRoom);
        int tMin = 2;
        int tMax = MapGenerator.gen_values.cubicle_size + 2;
        int tWidth = Randy.randomInt(tMin, tMax);
        int i = 0;
        while (i < tWidth && tNextChunk != null)
        {
            tNextChunk = tNextChunk.chunk_right;
            if (tNextChunk != null && !pChunksUsed.Contains(tNextChunk))
            {
                MapGenerator.rememberChunk(tNextChunk, pChunksUsed, pListLeft, tNewRoom);
            }
            i++;
        }
        tNextChunk = pStartRoomChunk;
        tWidth = Randy.randomInt(tMin, tMax);
        int j = 0;
        while (j < tWidth && tNextChunk != null)
        {
            tNextChunk = tNextChunk.chunk_left;
            if (tNextChunk != null && !pChunksUsed.Contains(tNextChunk))
            {
                MapGenerator.rememberChunk(tNextChunk, pChunksUsed, pListLeft, tNewRoom);
            }
            j++;
        }
        List<MapChunk> tInitialLine = new List<MapChunk>();
        tInitialLine.AddRange(tNewRoom);
        List<MapChunk> tPrevLine = new List<MapChunk>();
        tPrevLine.AddRange(tInitialLine);
        int tHeight = Randy.randomInt(tMin, tMax);
        for (int k = 0; k < tHeight; k++)
        {
            List<MapChunk> tNewLine = new List<MapChunk>();
            bool tCanAddBottom = true;
            foreach (MapChunk tChunk in tPrevLine)
            {
                if (tChunk.chunk_down == null)
                {
                    tCanAddBottom = false;
                    k = tHeight;
                    break;
                }
                if (pChunksUsed.Contains(tChunk.chunk_down))
                {
                    tCanAddBottom = false;
                    k = tHeight;
                    break;
                }
                tNewLine.Add(tChunk);
            }
            if (tCanAddBottom)
            {
                tPrevLine.Clear();
                foreach (MapChunk tChunk2 in tNewLine)
                {
                    MapGenerator.rememberChunk(tChunk2.chunk_down, pChunksUsed, pListLeft, tNewRoom);
                    tPrevLine.Add(tChunk2.chunk_down);
                }
            }
        }
        tPrevLine.Clear();
        tPrevLine.AddRange(tInitialLine);
        tHeight = Randy.randomInt(tMin, tMax);
        for (int l = 0; l < tHeight; l++)
        {
            List<MapChunk> tNewLine2 = new List<MapChunk>();
            bool tCanAddBottom2 = true;
            foreach (MapChunk tChunk3 in tPrevLine)
            {
                if (tChunk3.chunk_up == null)
                {
                    tCanAddBottom2 = false;
                    l = tHeight;
                    break;
                }
                if (pChunksUsed.Contains(tChunk3.chunk_up))
                {
                    tCanAddBottom2 = false;
                    l = tHeight;
                    break;
                }
                tNewLine2.Add(tChunk3);
            }
            if (tCanAddBottom2)
            {
                tPrevLine.Clear();
                foreach (MapChunk tChunk4 in tNewLine2)
                {
                    MapGenerator.rememberChunk(tChunk4.chunk_up, pChunksUsed, pListLeft, tNewRoom);
                    tPrevLine.Add(tChunk4.chunk_up);
                }
            }
        }
        MapGenerator.finishRoom(tNewRoom);
    }

    // Token: 0x06002188 RID: 8584 RVA: 0x0011AF44 File Offset: 0x00119144
    private static void rememberChunk(MapChunk pChunk, HashSet<MapChunk> pChunksUsed, List<MapChunk> pListLeft, List<MapChunk> pNewRoom)
    {
        pChunksUsed.Add(pChunk);
        pListLeft.Remove(pChunk);
        pNewRoom.Add(pChunk);
    }

    // Token: 0x06002189 RID: 8585 RVA: 0x0011AF60 File Offset: 0x00119160
    private static void finishRoom(List<MapChunk> pChunks)
    {
        BiomeAsset tBiome = BiomeLibrary.pool_biomes.GetRandom<BiomeAsset>();
        TileType tType = TileLibrary.soil_high;
        if (Randy.randomBool())
        {
            tType = TileLibrary.soil_low;
        }
        WorldTile t_u_l = World.world.GetTileSimple(0, 0);
        WorldTile t_u_r = World.world.GetTileSimple(MapBox.width - 1, 0);
        WorldTile t_d_l = World.world.GetTileSimple(0, MapBox.height - 1);
        WorldTile t_d_r = World.world.GetTileSimple(MapBox.width - 1, MapBox.height - 1);
        WorldTile tRoom_u_l = null;
        WorldTile tRoom_u_r = null;
        WorldTile tRoom_d_l = null;
        WorldTile tRoom_d_r = null;
        float best_dist_u_l = 0f;
        float best_dist_u_r = 0f;
        float best_dist_d_l = 0f;
        float best_dist_d_r = 0f;
        for (int i = 0; i < pChunks.Count; i++)
        {
            WorldTile[] tTiles = pChunks[i].tiles;
            int tCount = tTiles.Length;
            for (int j = 0; j < tCount; j++)
            {
                WorldTile tTile = tTiles[j];
                MapAction.terraformTile(tTile, tType, null, null);
                if (MapGenerator.gen_values.random_biomes)
                {
                    DropsLibrary.useSeedOn(tTile, tBiome.getTileLow(), tBiome.getTileHigh());
                }
                float dist_u_l = Toolbox.DistTile(t_u_l, tTile);
                float dist_u_r = Toolbox.DistTile(t_u_r, tTile);
                float dist_d_l = Toolbox.DistTile(t_d_l, tTile);
                float dist_d_r = Toolbox.DistTile(t_d_r, tTile);
                if (tRoom_u_l == null || dist_u_l < best_dist_u_l)
                {
                    tRoom_u_l = tTile;
                    best_dist_u_l = dist_u_l;
                }
                if (tRoom_u_r == null || dist_u_r < best_dist_u_r)
                {
                    tRoom_u_r = tTile;
                    best_dist_u_r = dist_u_r;
                }
                if (tRoom_d_l == null || dist_d_l < best_dist_d_l)
                {
                    tRoom_d_l = tTile;
                    best_dist_d_l = dist_d_l;
                }
                if (tRoom_d_r == null || dist_d_r < best_dist_d_r)
                {
                    tRoom_d_r = tTile;
                    best_dist_d_r = dist_d_r;
                }
            }
        }
        GeneratedRoom tRoomObject = new GeneratedRoom();
        tRoomObject.id_debug = MapGenerator._rooms.Count;
        MapGenerator._rooms.Add(tRoomObject);
        tRoomObject.edges_up = MapGenerator.fillTiles(tRoom_u_l, tRoom_u_r, TileLibrary.mountains);
        tRoomObject.edges_down = MapGenerator.fillTiles(tRoom_d_l, tRoom_d_r, TileLibrary.mountains);
        tRoomObject.edges_left = MapGenerator.fillTiles(tRoom_u_l, tRoom_d_l, TileLibrary.mountains);
        tRoomObject.edges_right = MapGenerator.fillTiles(tRoom_d_r, tRoom_u_r, TileLibrary.mountains);
    }

    // Token: 0x0600218A RID: 8586 RVA: 0x0011B164 File Offset: 0x00119364
    private static void createDoors()
    {
        foreach (GeneratedRoom generatedRoom in MapGenerator._rooms)
        {
            MapGenerator.makeDoor(generatedRoom.edges_down);
            MapGenerator.makeDoor(generatedRoom.edges_left);
            MapGenerator.makeDoor(generatedRoom.edges_right);
            MapGenerator.makeDoor(generatedRoom.edges_up);
        }
    }

    // Token: 0x0600218B RID: 8587 RVA: 0x0011B1DC File Offset: 0x001193DC
    private static void makeDoor(List<WorldTile> pTiles)
    {
        using (List<WorldTile>.Enumerator enumerator = pTiles.GetEnumerator())
        {
            while (enumerator.MoveNext())
            {
                if (enumerator.Current.main_type != TileLibrary.mountains)
                {
                    return;
                }
            }
        }
        WorldTile tDoorTile;
        if (pTiles.Count > 3)
        {
            int tRandomIndex = Randy.randomInt(3, pTiles.Count - 3);
            tDoorTile = pTiles[tRandomIndex];
        }
        else
        {
            int tIndex = pTiles.Count / 2;
            tDoorTile = pTiles[tIndex];
        }
        MapAction.terraformTile(tDoorTile, TileLibrary.hills, null, null);
        foreach (WorldTile tNTile in tDoorTile.neighboursAll)
        {
            if (tNTile.main_type == TileLibrary.mountains)
            {
                MapAction.terraformTile(tNTile, TileLibrary.hills, null, null);
            }
        }
    }

    // Token: 0x0600218C RID: 8588 RVA: 0x0011B2B4 File Offset: 0x001194B4
    private static void specialCheckerBoard()
    {
        BiomeAsset tBiome = BiomeLibrary.pool_biomes.GetRandom<BiomeAsset>();
        BiomeAsset tBiome2 = BiomeLibrary.pool_biomes.GetRandom<BiomeAsset>();
        foreach (MapChunk tChunk in World.world.map_chunk_manager.chunks)
        {
            WorldTile[] tTiles = tChunk.tiles;
            if ((tChunk.x + tChunk.y) % 2 == 0)
            {
                int tCount = tTiles.Length;
                for (int j = 0; j < tCount; j++)
                {
                    WorldTile tTile = tTiles[j];
                    MapAction.terraformTile(tTile, TileLibrary.soil_high, null, null);
                    if (MapGenerator.gen_values.random_biomes)
                    {
                        DropsLibrary.useSeedOn(tTile, tBiome.getTileLow(), tBiome.getTileHigh());
                    }
                }
            }
            else
            {
                int tCount2 = tTiles.Length;
                for (int k = 0; k < tCount2; k++)
                {
                    WorldTile tTile2 = tTiles[k];
                    MapAction.terraformTile(tTile2, TileLibrary.soil_low, null, null);
                    if (MapGenerator.gen_values.random_biomes)
                    {
                        DropsLibrary.useSeedOn(tTile2, tBiome2.getTileLow(), tBiome2.getTileHigh());
                    }
                }
            }
        }
    }

    // Token: 0x0600218D RID: 8589 RVA: 0x0011B3B8 File Offset: 0x001195B8
    private static void specialAnthill()
    {
        WorldTile[] tiles_list = World.world.tiles_list;
        for (int i = 0; i < tiles_list.Length; i++)
        {
            MapAction.terraformTile(tiles_list[i], TileLibrary.mountains, null, null);
        }
        List<TileZone> list = new List<TileZone>();
        List<WorldTile> tTunnels = new List<WorldTile>();
        ZoneCalculator tZones = World.world.zone_calculator;
        int tOffset_x = tZones.zones_total_x / 10 + 1;
        int tOffset_y = tZones.zones_total_y / 10 + 1;
        TileZone t_U_L = tZones.map[tOffset_x, tOffset_y];
        TileZone t_U_R = tZones.map[tZones.zones_total_x - tOffset_x, tOffset_y];
        TileZone t_D_R = tZones.map[tZones.zones_total_x - tOffset_x, tZones.zones_total_y - tOffset_y];
        TileZone t_D_L = tZones.map[tOffset_x, tZones.zones_total_y - tOffset_y];
        MapGenerator.makeJailRoom(list, tZones.map[tZones.zones_total_x / 2, tZones.zones_total_y / 2]);
        MapGenerator.makeJailRoom(list, tZones.map[tZones.zones_total_x / 2, tZones.zones_total_y / 2]);
        MapGenerator.makeJailRoom(list, t_U_L);
        MapGenerator.makeJailRoom(list, t_U_L);
        MapGenerator.makeJailRoom(list, t_U_R);
        MapGenerator.makeJailRoom(list, t_U_R);
        MapGenerator.makeJailRoom(list, t_D_R);
        MapGenerator.makeJailRoom(list, t_D_R);
        MapGenerator.makeJailRoom(list, t_D_L);
        MapGenerator.makeJailRoom(list, t_D_L);
        MapGenerator.makeWay(t_U_L, t_U_R, tTunnels);
        MapGenerator.makeWay(t_D_L, t_D_R, tTunnels);
        MapGenerator.makeWay(t_U_L, t_D_L, tTunnels);
        MapGenerator.makeWay(t_D_R, t_U_R, tTunnels);
        MapGenerator.makeWay(t_D_R, t_U_L, tTunnels);
        foreach (TileZone pZone in list)
        {
            MapGenerator.carveZone(pZone);
        }
        foreach (WorldTile pTile in tTunnels)
        {
            MapGenerator.carveTunnel(pTile);
        }
    }

    // Token: 0x0600218E RID: 8590 RVA: 0x0011B5A8 File Offset: 0x001197A8
    private static List<WorldTile> fillTiles(WorldTile pTile1, WorldTile pTile2, TileType pType)
    {
        List<WorldTile> list = PathfinderTools.raycast(pTile1, pTile2, 1f);
        List<WorldTile> tNewList = new List<WorldTile>(list);
        list.Clear();
        foreach (WorldTile pTile3 in tNewList)
        {
            MapAction.terraformTile(pTile3, pType, null, null);
        }
        return tNewList;
    }

    // Token: 0x0600218F RID: 8591 RVA: 0x0011B610 File Offset: 0x00119810
    private static void makeWay(TileZone tZone1, TileZone tZone2, List<WorldTile> pTunnels)
    {
        List<WorldTile> tRaycastResult = PathfinderTools.raycast(tZone1.centerTile, tZone2.centerTile, 0.99f);
        foreach (WorldTile worldTile in tRaycastResult)
        {
            foreach (WorldTile tNeighbour in worldTile.neighboursAll)
            {
                MapAction.terraformTile(tNeighbour, TileLibrary.soil_high, null, null);
                pTunnels.Add(tNeighbour);
            }
        }
        tRaycastResult.Clear();
    }

    // Token: 0x06002190 RID: 8592 RVA: 0x0011B6A4 File Offset: 0x001198A4
    private static void carveTunnel(WorldTile pTile)
    {
        for (int i = 0; i < 10; i++)
        {
            WorldTile tTile = pTile.neighbours.GetRandom<WorldTile>();
            for (int tN = 10; tN > 0; tN--)
            {
                WorldTile tNeighbour = tTile.neighbours.GetRandom<WorldTile>();
                if (tNeighbour.Type.rocks)
                {
                    MapAction.terraformTile(tTile, TileLibrary.soil_high, null, null);
                    tTile = tNeighbour;
                }
            }
        }
    }

    // Token: 0x06002191 RID: 8593 RVA: 0x0011B700 File Offset: 0x00119900
    private static void carveZone(TileZone pZone)
    {
        for (int i = 0; i < 20; i++)
        {
            WorldTile tTile = pZone.tiles.GetRandom<WorldTile>();
            for (int tN = 15; tN > 0; tN--)
            {
                WorldTile tNeighbour = tTile.neighbours.GetRandom<WorldTile>();
                if (tNeighbour.Type.rocks)
                {
                    MapAction.terraformTile(tTile, TileLibrary.soil_high, null, null);
                    tTile = tNeighbour;
                }
            }
        }
    }

    // Token: 0x06002192 RID: 8594 RVA: 0x0011B75C File Offset: 0x0011995C
    private static void makeJailRoom(List<TileZone> pZones, TileZone pStartZone)
    {
        int tRoomSize = World.world.zone_calculator.zones.Count / 10;
        TileZone tZone = pStartZone;
        if (tZone.world_edge)
        {
            return;
        }
        for (int i = 0; i < tRoomSize; i++)
        {
            if (tZone.world_edge)
            {
                tZone = tZone.neighbours.GetRandom<TileZone>();
            }
            else
            {
                WorldTile[] tTiles = tZone.tiles;
                int tCount = tTiles.Length;
                for (int j = 0; j < tCount; j++)
                {
                    MapAction.terraformTile(tTiles[j], TileLibrary.soil_high, null, null);
                }
                pZones.Add(tZone);
                tZone = tZone.neighbours.GetRandom<TileZone>();
            }
        }
    }

    // Token: 0x06002193 RID: 8595 RVA: 0x0011B7F0 File Offset: 0x001199F0
    private static void schedulePerlinNoiseMap()
    {
        MapGenerator.scheduleRandomShapes(true);
        if (MapGenerator.gen_values.main_perlin_noise_stage && MapGenerator.gen_values.perlin_scale_stage_1 > 0)
        {
            SmoothLoader.add(delegate
            {
                int tPerlinX = Randy.randomInt(0, 1000000);
                int tPerlinY = Randy.randomInt(0, 1000000);
                GeneratorTool.ApplyPerlinNoise(MapGenerator._tilesMap, MapGenerator._width, MapGenerator._height, (float)tPerlinX, (float)tPerlinY, 1f, 1f * (float)MapGenerator.gen_values.perlin_scale_stage_1, false, GeneratorTarget.Height);
            }, "Perlin Noise", true, 0.001f, false);
        }
        if (MapGenerator.template.force_height_to > 0)
        {
            SmoothLoader.add(delegate
            {
                MapGenerator.forceHeight();
            }, "Add Height", false, 0.001f, false);
        }
        if (MapGenerator.gen_values.add_center_gradient_land)
        {
            SmoothLoader.add(delegate
            {
                MapGenerator.addCenterGradient();
            }, "Center Gradient", false, 0.001f, false);
        }
        if (MapGenerator.gen_values.center_gradient_mountains)
        {
            SmoothLoader.add(delegate
            {
                MapGenerator.addCenterMountains();
            }, "Center Mountains", false, 0.001f, false);
        }
        if (MapGenerator.gen_values.add_center_lake)
        {
            SmoothLoader.add(delegate
            {
                MapGenerator.addCenterLake();
            }, "Center Lake", false, 0.001f, false);
        }
        if (MapGenerator.gen_values.perlin_noise_stage_2 && MapGenerator.gen_values.perlin_scale_stage_2 > 0)
        {
            SmoothLoader.add(delegate
            {
                float tScale = (float)MapGenerator.gen_values.perlin_scale_stage_2;
                int tRandomX = Randy.randomInt(0, 1000000);
                int tRandomY = Randy.randomInt(0, 1000000);
                GeneratorTool.ApplyPerlinNoise(MapGenerator._tilesMap, MapGenerator._width, MapGenerator._height, (float)tRandomX, (float)tRandomY, 0.2f, 4f * tScale, true, GeneratorTarget.Height);
            }, "Perlin Noise (1)", false, 0.001f, false);
        }
        if (MapGenerator.gen_values.perlin_noise_stage_3 && MapGenerator.gen_values.perlin_scale_stage_3 > 0)
        {
            SmoothLoader.add(delegate
            {
                float tScale = (float)MapGenerator.gen_values.perlin_scale_stage_3;
                int tRandomX = Randy.randomInt(0, 1000000);
                int tRandomY = Randy.randomInt(0, 1000000);
                GeneratorTool.ApplyPerlinNoise(MapGenerator._tilesMap, MapGenerator._width, MapGenerator._height, (float)tRandomX, (float)tRandomY, 0.1f, tScale * 10f, true, GeneratorTarget.Height);
            }, "Perlin Noise (2)", false, 0.001f, false);
        }
        if (MapGenerator.gen_values.low_ground)
        {
            SmoothLoader.add(delegate
            {
                MapGenerator.lowGround();
            }, "Lower Ground", false, 0.001f, false);
        }
        if (MapGenerator.gen_values.high_ground)
        {
            SmoothLoader.add(delegate
            {
                MapGenerator.highGround();
            }, "High Ground", false, 0.001f, false);
        }
        MapGenerator.scheduleRandomShapes(true);
        if (MapGenerator.gen_values.ring_effect)
        {
            SmoothLoader.add(delegate
            {
                GeneratorTool.ApplyRingEffect();
            }, "Perlin Ring", true, 0.001f, false);
        }
        if (MapGenerator.gen_values.gradient_round_edges)
        {
            SmoothLoader.add(delegate
            {
                MapEdges.AddEdgeGradientCircle(World.world.tiles_map, "height");
            }, "Gradient Circle Edges", true, 0.001f, false);
        }
        if (MapGenerator.gen_values.square_edges)
        {
            SmoothLoader.add(delegate
            {
                MapEdges.AddEdgeSquare(World.world.tiles_map, "height");
            }, "Gradient Circle Edges", true, 0.001f, false);
        }
    }

    // Token: 0x06002194 RID: 8596 RVA: 0x0011BB04 File Offset: 0x00119D04
    private static void forceHeight()
    {
        WorldTile[] tiles_list = World.world.tiles_list;
        for (int i = 0; i < tiles_list.Length; i++)
        {
            tiles_list[i].Height = MapGenerator.template.force_height_to;
        }
    }

    // Token: 0x06002195 RID: 8597 RVA: 0x0011BB3C File Offset: 0x00119D3C
    private static void removeMountains()
    {
        foreach (WorldTile tTile in World.world.tiles_list)
        {
            if (tTile.Type.rocks)
            {
                MapAction.decreaseTile(tTile, false, "flash");
            }
            if (tTile.Type.rocks)
            {
                MapAction.decreaseTile(tTile, false, "flash");
            }
        }
    }

    // Token: 0x06002196 RID: 8598 RVA: 0x0011BB98 File Offset: 0x00119D98
    private static void lowGround()
    {
        foreach (WorldTile tTile in World.world.tiles_list)
        {
            if (tTile.Height > 150)
            {
                tTile.Height -= 50;
            }
            if (tTile.Height > 130)
            {
                tTile.Height -= 20;
            }
        }
    }

    // Token: 0x06002197 RID: 8599 RVA: 0x0011BBFC File Offset: 0x00119DFC
    private static void highGround()
    {
        foreach (WorldTile tTile in World.world.tiles_list)
        {
            if (tTile.Height < 20)
            {
                tTile.Height += 80;
            }
            else if (tTile.Height < 120)
            {
                tTile.Height += 40;
            }
        }
    }

    // Token: 0x06002198 RID: 8600 RVA: 0x0011BC5C File Offset: 0x00119E5C
    private static void addCenterGradient()
    {
        WorldTile tCenter = World.world.tiles_map[MapBox.width / 2, MapBox.height / 2];
        float tMaxMod = 0.9f;
        float tGradientMod = 0.6f;
        float tMaxCenter = (float)(MapBox.width / 2) * tMaxMod;
        float tGradient = (float)(MapBox.width / 2) * tGradientMod;
        float tDiff = tMaxCenter - tGradient;
        foreach (WorldTile tTile in World.world.tiles_list)
        {
            float tDist = Toolbox.DistTile(tTile, tCenter);
            if (tDist <= tMaxCenter)
            {
                float tMod = (tMaxCenter - tDist) / tDiff;
                int tNewHeight = (int)(45f * tMod);
                tTile.Height += tNewHeight;
            }
        }
    }

    // Token: 0x06002199 RID: 8601 RVA: 0x0011BD0C File Offset: 0x00119F0C
    private static void addCenterLake()
    {
        WorldTile tCenter = World.world.tiles_map[MapBox.width / 2, MapBox.height / 2];
        float tMaxMod = 0.6f;
        float tGradientMod = 0.2f;
        float tMaxCenter = (float)(MapBox.width / 2) * tMaxMod;
        float tGradient = (float)(MapBox.width / 2) * tGradientMod;
        float tDiff = tMaxCenter - tGradient;
        foreach (WorldTile tTile in World.world.tiles_list)
        {
            float tDist = Toolbox.DistTile(tTile, tCenter);
            if (tDist <= tMaxCenter)
            {
                float tVal = tMaxCenter - tDist;
                float tMod = 1f - tVal / tDiff;
                int tNewHeight = (int)((float)tTile.Height * tMod);
                tTile.Height = tNewHeight;
            }
        }
    }

    // Token: 0x0600219A RID: 8602 RVA: 0x0011BDC0 File Offset: 0x00119FC0
    private static void addCenterMountains()
    {
        WorldTile tCenter = World.world.tiles_map[MapBox.width / 2, MapBox.height / 2];
        float tMaxMod = 0.3f;
        float tGradientMod = 0f;
        float tMaxCenter = (float)(MapBox.width / 2) * tMaxMod;
        float tGradient = (float)(MapBox.width / 2) * tGradientMod;
        float tDiff = tMaxCenter - tGradient;
        foreach (WorldTile worldTile in World.world.tiles_list)
        {
            float tDist = Toolbox.DistTile(worldTile, tCenter);
            float tMod = (tMaxCenter - tDist) / tDiff;
            int tNewHeight = (int)(75f * tMod);
            worldTile.Height -= tNewHeight;
        }
    }

    // Token: 0x0600219B RID: 8603 RVA: 0x0011BE64 File Offset: 0x0011A064
    private static void generateBiomes()
    {
        HashSetWorldTile tTilesSoilHashset = new HashSetWorldTile();
        for (int i = 0; i < World.world.tiles_list.Length; i++)
        {
            WorldTile tTile = World.world.tiles_list[i];
            if (tTile.Type.soil)
            {
                tTilesSoilHashset.Add(tTile);
            }
        }
        using (ListPool<WorldTile> tTempSoilTiles = new ListPool<WorldTile>(tTilesSoilHashset.Count))
        {
            bool tRecreateList = true;
            while (tTilesSoilHashset.Count > 0)
            {
                if (tRecreateList)
                {
                    tRecreateList = false;
                    MapGenerator.recreateSoilList(tTilesSoilHashset, tTempSoilTiles);
                }
                WorldTile tStartTile = tTempSoilTiles.Last<WorldTile>();
                BiomeAsset tBiome = BiomeLibrary.pool_biomes.GetRandom<BiomeAsset>();
                int tMaxSteps = MapGenerator.tryMakeBiomeSteps(tStartTile, tBiome);
                if (tMaxSteps == 0)
                {
                    tTempSoilTiles.Pop<WorldTile>();
                }
                else
                {
                    MapGenerator.tryMakeBiome(tStartTile, tTilesSoilHashset, tMaxSteps, tBiome);
                    tRecreateList = true;
                }
            }
        }
    }

    // Token: 0x0600219C RID: 8604 RVA: 0x0011BF30 File Offset: 0x0011A130
    private static void recreateSoilList(HashSetWorldTile pHashSet, ListPool<WorldTile> pTempSoilTiles)
    {
        pTempSoilTiles.Clear();
        pTempSoilTiles.AddRange(pHashSet);
        pTempSoilTiles.Shuffle<WorldTile>();
    }

    // Token: 0x0600219D RID: 8605 RVA: 0x0011BF48 File Offset: 0x0011A148
    private static int tryMakeBiomeSteps(WorldTile pStartTile, BiomeAsset pBiome)
    {
        if (!MapGenerator.reported_tryMakeBiomeSteps)
        {
            if (pBiome == null)
            {
                Debug.Log("pBiome is null");
                MapGenerator.reported_tryMakeBiomeSteps = true;
            }
            if (pStartTile == null)
            {
                Debug.Log("pStartTile is null");
                MapGenerator.reported_tryMakeBiomeSteps = true;
            }
            if (pStartTile.region == null)
            {
                Debug.Log("pStartTile.region is null");
                MapGenerator.reported_tryMakeBiomeSteps = true;
            }
            if (pStartTile.region.island == null)
            {
                Debug.Log("pStartTile.region.island is null");
                MapGenerator.reported_tryMakeBiomeSteps = true;
            }
        }
        int tIslandTileCount = pStartTile.region.island.getTileCount();
        int tMaxSteps;
        if (tIslandTileCount < 400)
        {
            tMaxSteps = tIslandTileCount;
        }
        else if (tIslandTileCount < 600)
        {
            tMaxSteps = tIslandTileCount / 2;
        }
        else
        {
            tMaxSteps = tIslandTileCount / 3;
        }
        if (tMaxSteps > pBiome.generator_max_size && pBiome.generator_max_size != 0)
        {
            tMaxSteps = pBiome.generator_max_size;
        }
        return tMaxSteps;
    }

    // Token: 0x0600219E RID: 8606 RVA: 0x0011C000 File Offset: 0x0011A200
    private static void tryMakeBiome(WorldTile pStartTile, HashSetWorldTile pSoilTiles, int pMaxSteps, BiomeAsset pBiome)
    {
        int tCurrentSteps = 0;
        using (ListPool<WorldTile> tWave = new ListPool<WorldTile>(pMaxSteps))
        {
            HashSetWorldTile tCheckedTiles = new HashSetWorldTile();
            tWave.Add(pStartTile);
            tCheckedTiles.Add(pStartTile);
            while (tWave.Count > 0 && tCurrentSteps < pMaxSteps)
            {
                tWave.ShuffleLast<WorldTile>();
                WorldTile tNewTile = tWave.Pop<WorldTile>();
                if (tNewTile.isTileRank(TileRank.Low))
                {
                    tNewTile.setTopTileType(pBiome.getTileLow(), true);
                }
                else
                {
                    tNewTile.setTopTileType(pBiome.getTileHigh(), true);
                }
                pSoilTiles.Remove(tNewTile);
                tCurrentSteps++;
                for (int i = 0; i < tNewTile.neighboursAll.Length; i++)
                {
                    WorldTile tTile = tNewTile.neighboursAll[i];
                    if (!tCheckedTiles.Contains(tTile) && tTile.Type.soil)
                    {
                        tWave.Add(tTile);
                        tCheckedTiles.Add(tTile);
                    }
                }
            }
            if (tCurrentSteps <= 10)
            {
                MapGenerator.removeSmallBiomePatches(tCheckedTiles, pStartTile);
            }
        }
    }

    // Token: 0x0600219F RID: 8607 RVA: 0x0011C0F4 File Offset: 0x0011A2F4
    private static void removeSmallBiomePatches(HashSetWorldTile pTiles, WorldTile pStartTile)
    {
        WorldTile tCopyFrom = null;
        foreach (WorldTile tTile in pStartTile.neighboursAll)
        {
            if (tTile.Type.is_biome && !tTile.Type.biome_asset.special_biome && tTile.Type.biome_asset != pStartTile.Type.biome_asset)
            {
                tCopyFrom = tTile;
                break;
            }
        }
        if (tCopyFrom == null)
        {
            return;
        }
        BiomeAsset tBiome = tCopyFrom.top_type.biome_asset;
        foreach (WorldTile tCheckedTile in pTiles)
        {
            TopTileType tBiomeTileType = tBiome.getTile(tCheckedTile);
            tCheckedTile.setTopTileType(tBiomeTileType, true);
        }
    }

    // Token: 0x060021A0 RID: 8608 RVA: 0x0011C1BC File Offset: 0x0011A3BC
    private static void addMountainEdges()
    {
        int tOffset_x = 0;
        int tOffset_y = 0;
        WorldTile tileSimple = World.world.GetTileSimple(tOffset_x, tOffset_y);
        WorldTile t_U_R = World.world.GetTileSimple(MapBox.width - tOffset_x - 1, tOffset_y);
        WorldTile t_D_R = World.world.GetTileSimple(MapBox.width - tOffset_x - 1, MapBox.height - tOffset_y - 1);
        WorldTile t_D_L = World.world.GetTileSimple(tOffset_x, MapBox.height - tOffset_y - 1);
        MapGenerator.fillTiles(tileSimple, t_U_R, TileLibrary.mountains);
        MapGenerator.fillTiles(t_D_L, t_D_R, TileLibrary.mountains);
        MapGenerator.fillTiles(tileSimple, t_D_L, TileLibrary.mountains);
        MapGenerator.fillTiles(t_D_R, t_U_R, TileLibrary.mountains);
    }

    // Token: 0x060021A1 RID: 8609 RVA: 0x0011C258 File Offset: 0x0011A458
    private static void freezeMountainTops()
    {
        for (int i = 0; i < World.world.tiles_list.Length; i++)
        {
            WorldTile tTile = World.world.tiles_list[i];
            if (tTile.Type.IsType("mountains") && tTile.Height > 220)
            {
                tTile.freeze(1);
            }
        }
    }

    // Token: 0x060021A2 RID: 8610 RVA: 0x0011C2B0 File Offset: 0x0011A4B0
    private static void spawnVegetation(int pAmount)
    {
        for (int i = 0; i < pAmount; i++)
        {
            WorldTile tObjTile = World.world.tiles_list.GetRandom<WorldTile>();
            if (tObjTile.Type.ground && tObjTile.zone.countBuildingsType(BuildingList.Trees) < 3)
            {
                BiomeAsset tBiomeAsset = tObjTile.Type.biome_asset;
                if (tBiomeAsset != null && tBiomeAsset.grow_vegetation_auto)
                {
                    switch (Randy.randomInt(0, 3))
                    {
                        case 0:
                            BuildingActions.tryGrowVegetationRandom(tObjTile, VegetationType.Plants, true, true, true);
                            break;
                        case 1:
                            BuildingActions.tryGrowVegetationRandom(tObjTile, VegetationType.Trees, true, true, true);
                            break;
                        case 2:
                            BuildingActions.tryGrowVegetationRandom(tObjTile, VegetationType.Bushes, true, true, true);
                            break;
                    }
                }
            }
        }
    }

    // Token: 0x060021A3 RID: 8611 RVA: 0x0011C350 File Offset: 0x0011A550
    private static void spawnResources()
    {
        int num = World.world.tiles_list.Length / 1000 / 2 / 2;
        BuildingActions.spawnResource(num, "fruit_bush", false);
        BuildingActions.spawnBeehives(num / 2);
    }

    // Token: 0x040018E2 RID: 6370
    public static MapGenTemplate template;

    // Token: 0x040018E3 RID: 6371
    private static int _width = 0;

    // Token: 0x040018E4 RID: 6372
    private static int _height = 0;

    // Token: 0x040018E5 RID: 6373
    private static WorldTile[,] _tilesMap;

    // Token: 0x040018E6 RID: 6374
    private static List<GeneratedRoom> _rooms = new List<GeneratedRoom>();

    // Token: 0x040018E7 RID: 6375
    private static bool reported_tryMakeBiomeSteps = false;
}
using System;

// Token: 0x02000056 RID: 86
public class MapGenSettingsLibrary : AssetLibrary<MapGenSettingsAsset>
{
    // Token: 0x06000330 RID: 816 RVA: 0x0001D754 File Offset: 0x0001B954
    public override void init()
    {
        base.init();
        MapGenSettingsAsset mapGenSettingsAsset = new MapGenSettingsAsset();
        mapGenSettingsAsset.id = "gen_perlin_scale_stage_1";
        mapGenSettingsAsset.allowed_check = (MapGenTemplate pAsset) => pAsset.allow_edit_perlin_scale_stage_1;
        mapGenSettingsAsset.max_value = 30;
        mapGenSettingsAsset.action_get = () => this.gen_values.perlin_scale_stage_1;
        mapGenSettingsAsset.action_set = delegate (int pValue)
        {
            this.gen_values.perlin_scale_stage_1 = pValue;
        };
        this.add(mapGenSettingsAsset);
        MapGenSettingsAsset mapGenSettingsAsset2 = new MapGenSettingsAsset();
        mapGenSettingsAsset2.id = "gen_perlin_scale_stage_2";
        mapGenSettingsAsset2.allowed_check = (MapGenTemplate pAsset) => pAsset.allow_edit_perlin_scale_stage_1;
        mapGenSettingsAsset2.max_value = 30;
        mapGenSettingsAsset2.action_get = () => this.gen_values.perlin_scale_stage_2;
        mapGenSettingsAsset2.action_set = delegate (int pValue)
        {
            this.gen_values.perlin_scale_stage_2 = pValue;
        };
        this.add(mapGenSettingsAsset2);
        MapGenSettingsAsset mapGenSettingsAsset3 = new MapGenSettingsAsset();
        mapGenSettingsAsset3.id = "gen_perlin_scale_stage_3";
        mapGenSettingsAsset3.allowed_check = (MapGenTemplate pAsset) => pAsset.allow_edit_perlin_scale_stage_1;
        mapGenSettingsAsset3.max_value = 30;
        mapGenSettingsAsset3.action_get = () => this.gen_values.perlin_scale_stage_3;
        mapGenSettingsAsset3.action_set = delegate (int pValue)
        {
            this.gen_values.perlin_scale_stage_3 = pValue;
        };
        this.add(mapGenSettingsAsset3);
        MapGenSettingsAsset mapGenSettingsAsset4 = new MapGenSettingsAsset();
        mapGenSettingsAsset4.id = "gen_random_shapes";
        mapGenSettingsAsset4.allowed_check = (MapGenTemplate pAsset) => pAsset.allow_edit_random_shapes;
        mapGenSettingsAsset4.max_value = 40;
        mapGenSettingsAsset4.action_get = () => this.gen_values.random_shapes_amount;
        mapGenSettingsAsset4.action_set = delegate (int pValue)
        {
            this.gen_values.random_shapes_amount = pValue;
        };
        this.add(mapGenSettingsAsset4);
        MapGenSettingsAsset mapGenSettingsAsset5 = new MapGenSettingsAsset();
        mapGenSettingsAsset5.id = "gen_cubicles_sizes";
        mapGenSettingsAsset5.allowed_check = (MapGenTemplate pAsset) => pAsset.allow_edit_cubicles;
        mapGenSettingsAsset5.min_value = 2;
        mapGenSettingsAsset5.max_value = 15;
        mapGenSettingsAsset5.action_get = () => this.gen_values.cubicle_size;
        mapGenSettingsAsset5.action_set = delegate (int pValue)
        {
            this.gen_values.cubicle_size = pValue;
        };
        this.add(mapGenSettingsAsset5);
        MapGenSettingsAsset mapGenSettingsAsset6 = new MapGenSettingsAsset();
        mapGenSettingsAsset6.id = "gen_random_biomes";
        mapGenSettingsAsset6.allowed_check = (MapGenTemplate pAsset) => pAsset.allow_edit_random_biomes;
        mapGenSettingsAsset6.is_switch = true;
        mapGenSettingsAsset6.action_get = delegate ()
        {
            if (!this.gen_values.random_biomes)
            {
                return 0;
            }
            return 1;
        };
        mapGenSettingsAsset6.action_set = delegate (int pValue)
        {
            this.gen_values.random_biomes = pValue == 1;
        };
        this.add(mapGenSettingsAsset6);
        MapGenSettingsAsset mapGenSettingsAsset7 = new MapGenSettingsAsset();
        mapGenSettingsAsset7.id = "gen_mountain_edges";
        mapGenSettingsAsset7.allowed_check = (MapGenTemplate pAsset) => pAsset.allow_edit_mountain_edges;
        mapGenSettingsAsset7.is_switch = true;
        mapGenSettingsAsset7.action_get = delegate ()
        {
            if (!this.gen_values.add_mountain_edges)
            {
                return 0;
            }
            return 1;
        };
        mapGenSettingsAsset7.action_set = delegate (int pValue)
        {
            this.gen_values.add_mountain_edges = pValue == 1;
        };
        this.add(mapGenSettingsAsset7);
        MapGenSettingsAsset mapGenSettingsAsset8 = new MapGenSettingsAsset();
        mapGenSettingsAsset8.id = "gen_add_vegetation";
        mapGenSettingsAsset8.allowed_check = (MapGenTemplate pAsset) => pAsset.allow_edit_random_vegetation;
        mapGenSettingsAsset8.is_switch = true;
        mapGenSettingsAsset8.action_get = delegate ()
        {
            if (!this.gen_values.add_vegetation)
            {
                return 0;
            }
            return 1;
        };
        mapGenSettingsAsset8.action_set = delegate (int pValue)
        {
            this.gen_values.add_vegetation = pValue == 1;
        };
        this.add(mapGenSettingsAsset8);
        MapGenSettingsAsset mapGenSettingsAsset9 = new MapGenSettingsAsset();
        mapGenSettingsAsset9.id = "gen_add_resources";
        mapGenSettingsAsset9.allowed_check = (MapGenTemplate pAsset) => pAsset.allow_edit_random_resources;
        mapGenSettingsAsset9.is_switch = true;
        mapGenSettingsAsset9.action_get = delegate ()
        {
            if (!this.gen_values.add_resources)
            {
                return 0;
            }
            return 1;
        };
        mapGenSettingsAsset9.action_set = delegate (int pValue)
        {
            this.gen_values.add_resources = pValue == 1;
        };
        this.add(mapGenSettingsAsset9);
        MapGenSettingsAsset mapGenSettingsAsset10 = new MapGenSettingsAsset();
        mapGenSettingsAsset10.id = "gen_add_center_lake";
        mapGenSettingsAsset10.allowed_check = (MapGenTemplate pAsset) => pAsset.allow_edit_center_lake;
        mapGenSettingsAsset10.is_switch = true;
        mapGenSettingsAsset10.action_get = delegate ()
        {
            if (!this.gen_values.add_center_lake)
            {
                return 0;
            }
            return 1;
        };
        mapGenSettingsAsset10.action_set = delegate (int pValue)
        {
            this.gen_values.add_center_lake = pValue == 1;
        };
        this.add(mapGenSettingsAsset10);
        MapGenSettingsAsset mapGenSettingsAsset11 = new MapGenSettingsAsset();
        mapGenSettingsAsset11.id = "gen_add_center_land";
        mapGenSettingsAsset11.allowed_check = (MapGenTemplate pAsset) => pAsset.allow_edit_center_land;
        mapGenSettingsAsset11.is_switch = true;
        mapGenSettingsAsset11.action_get = delegate ()
        {
            if (!this.gen_values.add_center_gradient_land)
            {
                return 0;
            }
            return 1;
        };
        mapGenSettingsAsset11.action_set = delegate (int pValue)
        {
            this.gen_values.add_center_gradient_land = pValue == 1;
        };
        this.add(mapGenSettingsAsset11);
        MapGenSettingsAsset mapGenSettingsAsset12 = new MapGenSettingsAsset();
        mapGenSettingsAsset12.id = "gen_round_edges";
        mapGenSettingsAsset12.allowed_check = (MapGenTemplate pAsset) => pAsset.allow_edit_round_edges;
        mapGenSettingsAsset12.is_switch = true;
        mapGenSettingsAsset12.action_get = delegate ()
        {
            if (!this.gen_values.gradient_round_edges)
            {
                return 0;
            }
            return 1;
        };
        mapGenSettingsAsset12.action_set = delegate (int pValue)
        {
            this.gen_values.gradient_round_edges = pValue == 1;
        };
        this.add(mapGenSettingsAsset12);
        MapGenSettingsAsset mapGenSettingsAsset13 = new MapGenSettingsAsset();
        mapGenSettingsAsset13.id = "gen_square_edges";
        mapGenSettingsAsset13.allowed_check = (MapGenTemplate pAsset) => pAsset.allow_edit_square_edges;
        mapGenSettingsAsset13.is_switch = true;
        mapGenSettingsAsset13.action_get = delegate ()
        {
            if (!this.gen_values.square_edges)
            {
                return 0;
            }
            return 1;
        };
        mapGenSettingsAsset13.action_set = delegate (int pValue)
        {
            this.gen_values.square_edges = pValue == 1;
        };
        this.add(mapGenSettingsAsset13);
        MapGenSettingsAsset mapGenSettingsAsset14 = new MapGenSettingsAsset();
        mapGenSettingsAsset14.id = "gen_ring_effect";
        mapGenSettingsAsset14.allowed_check = (MapGenTemplate pAsset) => pAsset.allow_edit_ring_effect;
        mapGenSettingsAsset14.is_switch = true;
        mapGenSettingsAsset14.action_get = delegate ()
        {
            if (!this.gen_values.ring_effect)
            {
                return 0;
            }
            return 1;
        };
        mapGenSettingsAsset14.action_set = delegate (int pValue)
        {
            this.gen_values.ring_effect = pValue == 1;
        };
        this.add(mapGenSettingsAsset14);
        MapGenSettingsAsset mapGenSettingsAsset15 = new MapGenSettingsAsset();
        mapGenSettingsAsset15.id = "gen_low_ground";
        mapGenSettingsAsset15.allowed_check = (MapGenTemplate pAsset) => pAsset.allow_edit_low_ground;
        mapGenSettingsAsset15.is_switch = true;
        mapGenSettingsAsset15.action_set = delegate (int pValue)
        {
            this.gen_values.low_ground = pValue == 1;
        };
        mapGenSettingsAsset15.action_get = delegate ()
        {
            if (!this.gen_values.low_ground)
            {
                return 0;
            }
            return 1;
        };
        this.add(mapGenSettingsAsset15);
        MapGenSettingsAsset mapGenSettingsAsset16 = new MapGenSettingsAsset();
        mapGenSettingsAsset16.id = "gen_high_ground";
        mapGenSettingsAsset16.allowed_check = (MapGenTemplate pAsset) => pAsset.allow_edit_high_ground;
        mapGenSettingsAsset16.is_switch = true;
        mapGenSettingsAsset16.action_set = delegate (int pValue)
        {
            this.gen_values.high_ground = pValue == 1;
        };
        mapGenSettingsAsset16.action_get = delegate ()
        {
            if (!this.gen_values.high_ground)
            {
                return 0;
            }
            return 1;
        };
        this.add(mapGenSettingsAsset16);
        MapGenSettingsAsset mapGenSettingsAsset17 = new MapGenSettingsAsset();
        mapGenSettingsAsset17.id = "gen_remove_mountains";
        mapGenSettingsAsset17.allowed_check = (MapGenTemplate pAsset) => pAsset.allow_edit_remove_mountains;
        mapGenSettingsAsset17.is_switch = true;
        mapGenSettingsAsset17.action_set = delegate (int pValue)
        {
            this.gen_values.remove_mountains = pValue == 1;
        };
        mapGenSettingsAsset17.action_get = delegate ()
        {
            if (!this.gen_values.remove_mountains)
            {
                return 0;
            }
            return 1;
        };
        this.add(mapGenSettingsAsset17);
        MapGenSettingsAsset mapGenSettingsAsset18 = new MapGenSettingsAsset();
        mapGenSettingsAsset18.id = "gen_forbidden_knowledge";
        mapGenSettingsAsset18.allowed_check = (MapGenTemplate _) => Config.hasPremium && AchievementLibrary.achievementCursedWorld.isUnlocked();
        mapGenSettingsAsset18.is_switch = true;
        mapGenSettingsAsset18.action_get = delegate ()
        {
            if (!this.gen_values.forbidden_knowledge_start)
            {
                return 0;
            }
            return 1;
        };
        mapGenSettingsAsset18.action_set = delegate (int pValue)
        {
            this.gen_values.forbidden_knowledge_start = pValue == 1;
        };
        this.add(mapGenSettingsAsset18);
    }

    // Token: 0x06000331 RID: 817 RVA: 0x0001DEB4 File Offset: 0x0001C0B4
    public override MapGenSettingsAsset add(MapGenSettingsAsset pAsset)
    {
        pAsset2.increase = delegate (MapGenSettingsAsset pAsset)
        {
            int tTemp = pAsset.action_get();
            int tVal = 1;
            if (HotkeyLibrary.many_mod.isHolding())
            {
                tVal = 5;
            }
            tTemp += tVal;
            if (tTemp > pAsset.max_value)
            {
                tTemp = pAsset.min_value;
            }
            pAsset.action_set(tTemp);
        };
        pAsset2.decrease = delegate (MapGenSettingsAsset pAsset)
        {
            int tTemp = pAsset.action_get();
            int tVal = 1;
            if (HotkeyLibrary.many_mod.isHolding())
            {
                tVal = 5;
            }
            tTemp -= tVal;
            if (tTemp < pAsset.min_value)
            {
                tTemp = pAsset.max_value;
            }
            pAsset.action_set(tTemp);
        };
        pAsset2.action_switch = delegate (MapGenSettingsAsset pAsset)
        {
            int tVal;
            if (pAsset.action_get() == 0)
            {
                tVal = 1;
            }
            else
            {
                tVal = 0;
            }
            pAsset.action_set(tVal);
        };
        return base.add(pAsset2);
    }

    // Token: 0x17000012 RID: 18
    // (get) Token: 0x06000332 RID: 818 RVA: 0x0001DF37 File Offset: 0x0001C137
    private MapGenValues gen_values
    {
        get
        {
            return AssetManager.map_gen_templates.get(Config.current_map_template).values;
        }
    }

    // Token: 0x06000333 RID: 819 RVA: 0x0001DF50 File Offset: 0x0001C150
    public override void editorDiagnosticLocales()
    {
        base.editorDiagnosticLocales();
        foreach (MapGenSettingsAsset tAsset in this.list)
        {
            this.checkLocale(tAsset, tAsset.getLocaleID());
        }
    }
}
using System;
using System.Collections.Generic;
using System.Globalization;
using System.IO;
using Assets.SimpleZip;
using db;
using Ionic.Zlib;
using Newtonsoft.Json;
using UnityEngine;

// Token: 0x0200055F RID: 1375
public class SaveManager : MonoBehaviour
{
    // Token: 0x17000262 RID: 610
    // (get) Token: 0x06002CF0 RID: 11504 RVA: 0x0016B4AF File Offset: 0x001696AF
    private static JsonSerializerSettings _settings
    {
        get
        {
            return JsonHelper.read_settings;
        }
    }

    // Token: 0x17000263 RID: 611
    // (get) Token: 0x06002CF1 RID: 11505 RVA: 0x0016B4B6 File Offset: 0x001696B6
    private static JsonSerializer _reader
    {
        get
        {
            return JsonHelper.reader;
        }
    }

    // Token: 0x06002CF2 RID: 11506 RVA: 0x0016B4BD File Offset: 0x001696BD
    private void Start()
    {
        SaveManager.persistentDataPath = Application.persistentDataPath;
    }

    // Token: 0x06002CF3 RID: 11507 RVA: 0x0016B4C9 File Offset: 0x001696C9
    public static void clearCurrentSelectedWorld()
    {
        SaveManager.currentWorkshopMapData = null;
        SaveManager.currentSavePath = string.Empty;
        SaveManager.currentSlot = 0;
    }

    // Token: 0x06002CF4 RID: 11508 RVA: 0x0016B4E4 File Offset: 0x001696E4
    public void clickSaveSlot()
    {
        try
        {
            this.saveToCurrentPath();
            ScrollWindow.hideAllEvent(true);
        }
        catch (Exception message)
        {
            Debug.Log("Error during saving");
            Debug.LogError(message);
            ScrollWindow.showWindow("error_happened");
        }
    }

    // Token: 0x06002CF5 RID: 11509 RVA: 0x0016B52C File Offset: 0x0016972C
    public SavedMap saveToCurrentPath()
    {
        return SaveManager.saveWorldToDirectory(SaveManager.currentSavePath, true, true);
    }

    // Token: 0x06002CF6 RID: 11510 RVA: 0x0016B53A File Offset: 0x0016973A
    public static SavedMap saveWorldToDirectory(string pFolder, bool pCompress = true, bool pCheckFolder = true)
    {
        pFolder = SaveManager.folderPath(pFolder);
        if (pCheckFolder)
        {
            if (!Directory.Exists(pFolder))
            {
                Directory.CreateDirectory(pFolder);
            }
        }
        else
        {
            Directory.CreateDirectory(pFolder);
        }
        SaveManager.saveImagePreview(pFolder);
        return SaveManager.saveMapData(pFolder, pCompress);
    }

    // Token: 0x06002CF7 RID: 11511 RVA: 0x0016B56C File Offset: 0x0016976C
    public static SavedMap currentWorldToSavedMap()
    {
        World.world.items.diagnostic();
        SavedMap savedMap = new SavedMap();
        savedMap.create();
        return savedMap;
    }

    // Token: 0x06002CF8 RID: 11512 RVA: 0x0016B588 File Offset: 0x00169788
    public static void deleteSavePath(string pPath)
    {
        if (Directory.Exists(pPath))
        {
            Directory.Delete(pPath, true);
        }
    }

    // Token: 0x06002CF9 RID: 11513 RVA: 0x0016B599 File Offset: 0x00169799
    public static void deleteCurrentSave()
    {
        SaveManager.deleteSavePath(SaveManager.currentSavePath);
        FavoriteWorld.checkFavoriteWorld();
        ScrollWindow.hideAllEvent(true);
    }

    // Token: 0x06002CFA RID: 11514 RVA: 0x0016B5B0 File Offset: 0x001697B0
    public static SavedMap saveMapData(string pFolder, bool pCompress = true)
    {
        SavedMap tSave = SaveManager.currentWorldToSavedMap();
        pFolder = SaveManager.folderPath(pFolder);
        bool hasError = false;
        string tPathSaveData = "";
        string tTempPath = "";
        string tWhat = "Map";
        SaveManager.saveMetaData(tSave.getMeta(), pFolder);
        SaveManager.saveStatsIn(pFolder);
        try
        {
            if (pCompress)
            {
                tPathSaveData = pFolder + "map.wbox";
                tTempPath = tPathSaveData + ".tmp";
                tSave.toZip(tTempPath);
            }
            else
            {
                tPathSaveData = pFolder + "map.wbax";
                tTempPath = tPathSaveData + ".tmp";
                tSave.toJson(tTempPath);
            }
        }
        catch (IOException e)
        {
            if (Toolbox.IsDiskFull(e))
            {
                WorldTip.showNow("Error saving " + tWhat + " : Disk full!", false, "top", 3f, "#F3961F");
            }
            else
            {
                Debug.Log("Could not save " + tWhat + " due to hard drive / IO Error : ");
                Debug.Log(e);
                WorldTip.showNow("Error saving " + tWhat + " due to IOError! Check console for details", false, "top", 3f, "#F3961F");
            }
            hasError = true;
        }
        catch (Exception message)
        {
            Debug.Log("Could not save " + tWhat + " due to error : ");
            Debug.Log(message);
            WorldTip.showNow("Error saving " + tWhat + "! Check console for errors", false, "top", 3f, "#F3961F");
            hasError = true;
        }
        if (hasError)
        {
            if (File.Exists(tTempPath))
            {
                File.Delete(tTempPath);
            }
        }
        else
        {
            Toolbox.MoveSafely(tTempPath, tPathSaveData);
        }
        return tSave;
    }

    // Token: 0x06002CFB RID: 11515 RVA: 0x0016B734 File Offset: 0x00169934
    public static void saveMetaData(MapMetaData pMetaData, string pPath)
    {
        pMetaData.prepareForSave();
        SaveManager.saveMetaIn(pPath, pMetaData);
    }

    // Token: 0x06002CFC RID: 11516 RVA: 0x0016B743 File Offset: 0x00169943
    public static MapMetaData getCurrentMeta()
    {
        return SaveManager.getMetaFor(SaveManager.currentSavePath);
    }

    // Token: 0x06002CFD RID: 11517 RVA: 0x0016B74F File Offset: 0x0016994F
    public static MapMetaData getMetaFor(int pSlot)
    {
        return SaveManager.getMetaFor(SaveManager.getSlotSavePath(pSlot));
    }

    // Token: 0x06002CFE RID: 11518 RVA: 0x0016B75C File Offset: 0x0016995C
    public static MapMetaData getMetaFor(string pFolder)
    {
        pFolder = SaveManager.folderPath(pFolder);
        if (!SaveManager.doesSaveExist(pFolder))
        {
            return null;
        }
        string tPath = SaveManager.generateMetaPath(pFolder);
        if (!File.Exists(tPath))
        {
            SavedMap mData = SaveManager.getMapFromPath(pFolder, false);
            if (mData != null)
            {
                mData.check();
                SaveManager.saveMetaData(mData.getMeta(), pFolder);
                Config.scheduleGC("getMetaFor", false);
            }
        }
        if (File.Exists(tPath))
        {
            try
            {
                using (FileStream fs = new FileStream(tPath, FileMode.Open, FileAccess.Read))
                {
                    using (StreamReader sr = new StreamReader(fs))
                    {
                        using (JsonReader reader = new JsonTextReader(sr))
                        {
                            MapMetaData mapMetaData = SaveManager._reader.Deserialize<MapMetaData>(reader);
                            if (mapMetaData == null)
                            {
                                throw new Exception("Meta data was null");
                            }
                            return mapMetaData;
                        }
                    }
                }
            }
            catch (Exception message)
            {
                Debug.LogWarning(message);
                try
                {
                    File.Delete(tPath);
                }
                catch (Exception message2)
                {
                    Debug.Log(message2);
                }
                return null;
            }
        }
        return null;
    }

    // Token: 0x06002CFF RID: 11519 RVA: 0x0016B870 File Offset: 0x00169A70
    public static bool loadStatsFrom(string pFolder)
    {
        return SaveManager.doesStatsDBExist(pFolder) && DBManager.loadDBFrom(SaveManager.generateStatsPath(pFolder));
    }

    // Token: 0x06002D00 RID: 11520 RVA: 0x0016B887 File Offset: 0x00169A87
    public static bool doesStatsDBExist(string pFolder)
    {
        pFolder = SaveManager.folderPath(pFolder);
        return SaveManager.doesSaveExist(pFolder) && File.Exists(SaveManager.generateStatsPath(pFolder));
    }

    // Token: 0x06002D01 RID: 11521 RVA: 0x0016B8A8 File Offset: 0x00169AA8
    public static string getMapCreationTime(string pFolder)
    {
        string tPath = SaveManager.getSavePath(pFolder);
        if (!File.Exists(tPath))
        {
            return "??";
        }
        DateTime tFutureTime = DateTime.UtcNow.AddDays(7.0);
        DateTime tTime = File.GetLastWriteTime(tPath);
        if (tTime.Year < 2017)
        {
            return "GREG";
        }
        if (tTime > tFutureTime)
        {
            return "DREDD";
        }
        CultureInfo tCulture = LocalizedTextManager.getCulture(null);
        string tShortDatePattern = tCulture.DateTimeFormat.ShortDatePattern;
        return tTime.ToString(tShortDatePattern, tCulture);
    }

    // Token: 0x06002D02 RID: 11522 RVA: 0x0016B92C File Offset: 0x00169B2C
    public static void saveMetaIn(string pFolder, MapMetaData pMetaData)
    {
        string tPath = SaveManager.generateMetaPath(pFolder);
        string mapMeta = pMetaData.toJson();
        Toolbox.WriteSafely("Map Meta", tPath, ref mapMeta);
    }

    // Token: 0x06002D03 RID: 11523 RVA: 0x0016B955 File Offset: 0x00169B55
    public static void saveStatsIn(string pFolder)
    {
        DBManager.saveToPath(SaveManager.generateStatsPath(pFolder));
    }

    // Token: 0x06002D04 RID: 11524 RVA: 0x0016B964 File Offset: 0x00169B64
    public static bool doesSaveExist(string pFolder)
    {
        return Directory.Exists(pFolder) && (File.Exists(pFolder + "map.wbox") || File.Exists(pFolder + "map.wbax") || File.Exists(pFolder + "map.json"));
    }

    // Token: 0x06002D05 RID: 11525 RVA: 0x0016B9B8 File Offset: 0x00169BB8
    public static string getSavePath(string pFolder)
    {
        if (!Directory.Exists(pFolder))
        {
            return null;
        }
        string tPathToFile = pFolder + "map.wbox";
        if (File.Exists(tPathToFile))
        {
            return tPathToFile;
        }
        tPathToFile = pFolder + "map.wbax";
        if (File.Exists(tPathToFile))
        {
            return tPathToFile;
        }
        tPathToFile = pFolder + "map.json";
        if (File.Exists(tPathToFile))
        {
            return tPathToFile;
        }
        return null;
    }

    // Token: 0x06002D06 RID: 11526 RVA: 0x0016BA12 File Offset: 0x00169C12
    public static bool slotExists(int pSlot)
    {
        return File.Exists(SaveManager.getSlotPathWbox(pSlot)) || File.Exists(SaveManager.getOldSlotPath(pSlot));
    }

    // Token: 0x06002D07 RID: 11527 RVA: 0x0016BA33 File Offset: 0x00169C33
    public static bool slotMetaExists(int pSlot = -1)
    {
        return File.Exists(SaveManager.getMetaSlotPath(pSlot));
    }

    // Token: 0x06002D08 RID: 11528 RVA: 0x0016BA45 File Offset: 0x00169C45
    public static void copyDataToClipboard()
    {
    }

    // Token: 0x06002D09 RID: 11529 RVA: 0x0016BA48 File Offset: 0x00169C48
    private static void saveImagePreview(string pFolder)
    {
        Texture2D tImagePreviewMain = PreviewHelper.convertMapToTexture();
        Texture2D tImagePreviewSmall = new Texture2D(tImagePreviewMain.width, tImagePreviewMain.height);
        Graphics.CopyTexture(tImagePreviewMain, tImagePreviewSmall);
        byte[] tBytes = tImagePreviewMain.EncodeToPNG();
        Toolbox.WriteSafely("PNG Preview", SaveManager.generatePngPreviewPath(pFolder), tBytes);
        Object.Destroy(tImagePreviewMain);
        TextureScale.Point(tImagePreviewSmall, 32, 32);
        byte[] tBytes2 = tImagePreviewSmall.EncodeToPNG();
        Toolbox.WriteSafely("PNG Small Preview", SaveManager.generatePngSmallPreviewPath(pFolder), tBytes2);
        Object.Destroy(tImagePreviewSmall);
    }

    // Token: 0x06002D0A RID: 11530 RVA: 0x0016BAC0 File Offset: 0x00169CC0
    public static int getCurrentSlot()
    {
        return SaveManager.currentSlot;
    }

    // Token: 0x06002D0B RID: 11531 RVA: 0x0016BAC7 File Offset: 0x00169CC7
    public static string getSlotSavePath(int pSlot)
    {
        return SaveManager.generateMainPath("saves") + SaveManager.folderPath("save" + pSlot.ToString());
    }

    // Token: 0x06002D0C RID: 11532 RVA: 0x0016BAEE File Offset: 0x00169CEE
    public static string generateMainPath(string pFolder)
    {
        return SaveManager.folderPath(SaveManager.persistentDataPath) + SaveManager.folderPath(pFolder);
    }

    // Token: 0x06002D0D RID: 11533 RVA: 0x0016BB05 File Offset: 0x00169D05
    public static string generateAutosavesPath(string pFolder = "")
    {
        return SaveManager.generateMainPath("autosaves") + SaveManager.folderPath(pFolder);
    }

    // Token: 0x06002D0E RID: 11534 RVA: 0x0016BB1C File Offset: 0x00169D1C
    public static string generateWorkshopPath(string pFolder = "")
    {
        return SaveManager.generateMainPath("workshop_upload") + SaveManager.folderPath(pFolder);
    }

    // Token: 0x06002D0F RID: 11535 RVA: 0x0016BB33 File Offset: 0x00169D33
    public static string generatePngPreviewPath(string pFolder)
    {
        return SaveManager.folderPath(pFolder) + "preview.png";
    }

    // Token: 0x06002D10 RID: 11536 RVA: 0x0016BB45 File Offset: 0x00169D45
    public static string generatePngSmallPreviewPath(string pFolder)
    {
        return SaveManager.folderPath(pFolder) + "preview_small.png";
    }

    // Token: 0x06002D11 RID: 11537 RVA: 0x0016BB57 File Offset: 0x00169D57
    public static string generateMetaPath(string pFolder)
    {
        return SaveManager.folderPath(pFolder) + "map.meta";
    }

    // Token: 0x06002D12 RID: 11538 RVA: 0x0016BB69 File Offset: 0x00169D69
    public static string generateStatsPath(string pFolder)
    {
        return SaveManager.folderPath(pFolder) + "map_stats.s3db";
    }

    // Token: 0x06002D13 RID: 11539 RVA: 0x0016BB7B File Offset: 0x00169D7B
    public static string getSlotPathWbox(int pSlot)
    {
        return SaveManager.getSlotSavePath(pSlot) + "map.wbox";
    }

    // Token: 0x06002D14 RID: 11540 RVA: 0x0016BB8D File Offset: 0x00169D8D
    public static string getMetaSlotPath(int pSlot)
    {
        return SaveManager.getSlotSavePath(pSlot) + "map.meta";
    }

    // Token: 0x06002D15 RID: 11541 RVA: 0x0016BB9F File Offset: 0x00169D9F
    public static string getOldSlotPath(int pSlot)
    {
        return SaveManager.getSlotSavePath(pSlot) + "map.json";
    }

    // Token: 0x06002D16 RID: 11542 RVA: 0x0016BBB1 File Offset: 0x00169DB1
    public static string getPngSlotPath(int pSlot = -1)
    {
        return SaveManager.getSlotSavePath(pSlot) + "preview.png";
    }

    // Token: 0x06002D17 RID: 11543 RVA: 0x0016BBC3 File Offset: 0x00169DC3
    public static void setCurrentSlot(int pSlotID)
    {
        SaveManager.currentSlot = pSlotID;
        SaveManager.currentSavePath = SaveManager.generateMainPath("saves") + SaveManager.folderPath("save" + pSlotID.ToString());
    }

    // Token: 0x06002D18 RID: 11544 RVA: 0x0016BBF5 File Offset: 0x00169DF5
    public static void setCurrentPath(string pPath)
    {
        SaveManager.currentSavePath = SaveManager.folderPath(pPath);
    }

    // Token: 0x06002D19 RID: 11545 RVA: 0x0016BC02 File Offset: 0x00169E02
    public static void setCurrentPathAndId(string pPath, int pSlotID)
    {
        SaveManager.currentSlot = pSlotID;
        SaveManager.currentSavePath = SaveManager.folderPath(pPath);
    }

    // Token: 0x06002D1A RID: 11546 RVA: 0x0016BC15 File Offset: 0x00169E15
    public static string getCurrentPreviewPath()
    {
        return SaveManager.currentSavePath + "preview.png";
    }

    // Token: 0x06002D1B RID: 11547 RVA: 0x0016BC26 File Offset: 0x00169E26
    public static bool currentSlotExists()
    {
        return SaveManager.doesSaveExist(SaveManager.currentSavePath);
    }

    // Token: 0x06002D1C RID: 11548 RVA: 0x0016BC32 File Offset: 0x00169E32
    public static bool currentPreviewExists()
    {
        return File.Exists(SaveManager.currentSavePath + "preview.png");
    }

    // Token: 0x06002D1D RID: 11549 RVA: 0x0016BC48 File Offset: 0x00169E48
    public static bool currentMetaExists()
    {
        return File.Exists(SaveManager.currentSavePath + "map.meta");
    }

    // Token: 0x06002D1E RID: 11550 RVA: 0x0016BC5E File Offset: 0x00169E5E
    internal void loadWorld()
    {
        if (SaveManager.currentWorkshopMapData != null)
        {
            this.loadWorld(SaveManager.currentWorkshopMapData.main_path, true);
            SaveManager.currentWorkshopMapData = null;
            return;
        }
        this.loadWorld(SaveManager.currentSavePath, false);
    }

    // Token: 0x06002D1F RID: 11551 RVA: 0x0016BC8C File Offset: 0x00169E8C
    internal void loadWorld(string pPath, bool pLoadWorkshop = false)
    {
        SmoothLoader.prepare();
        try
        {
            SavedMap tSave = SaveManager.getMapFromPath(pPath, pLoadWorkshop);
            if (tSave == null)
            {
                throw new Exception("Save file not found - has it been deleted?");
            }
            Debug.Log("World Loaded");
            tSave.check();
            Debug.Log("World Laws Loaded");
            Config.scheduleGC("load world", false);
            this.loadData(tSave, pPath);
        }
        catch (Exception e)
        {
            Debug.Log("Error during loading of slot " + pPath);
            try
            {
                MapMetaData tData = SaveManager.getMetaFor(pPath);
                if (tData != null)
                {
                    Debug.Log(JsonUtility.ToJson(tData));
                }
                else
                {
                    Debug.Log("No meta data");
                }
            }
            catch (Exception)
            {
                Debug.Log("Failed to load meta data");
            }
            Debug.LogError(e);
            ScrollWindow.showWindow("error_happened");
            MapBox.instance.startTheGame(true);
        }
    }

    // Token: 0x06002D20 RID: 11552 RVA: 0x0016BD60 File Offset: 0x00169F60
    public static void loadMapFromResources(string pPath)
    {
        SmoothLoader.prepare();
        SavedMap tSave = JsonConvert.DeserializeObject<SavedMap>(Zip.Decompress((Resources.Load(pPath) as TextAsset).bytes), SaveManager._settings);
        tSave.check();
        World.world.save_manager.loadData(tSave, null);
    }

    // Token: 0x06002D21 RID: 11553 RVA: 0x0016BDAC File Offset: 0x00169FAC
    public static void loadMapFromBytes(byte[] pMapData)
    {
        SmoothLoader.prepare();
        SavedMap tSave = JsonConvert.DeserializeObject<SavedMap>(Zip.Decompress(pMapData), SaveManager._settings);
        tSave.check();
        World.world.save_manager.loadData(tSave, null);
    }

    // Token: 0x06002D22 RID: 11554 RVA: 0x0016BDE8 File Offset: 0x00169FE8
    public static SavedMap getMapFromPath(string pMainPath, bool pLoadWorkshop = false)
    {
        if (pLoadWorkshop)
        {
            return JsonConvert.DeserializeObject<SavedMap>(Zip.Decompress(File.ReadAllBytes(SaveManager.folderPath(SaveManager.currentWorkshopMapData.main_path) + "map.wbox")), SaveManager._settings);
        }
        pMainPath = SaveManager.folderPath(pMainPath);
        if (!Directory.Exists(pMainPath))
        {
            Debug.Log("Directory does not exist : " + pMainPath);
            return null;
        }
        string tPathToFile = pMainPath + "map.wbox";
        if (File.Exists(tPathToFile))
        {
            SaveManager.fileInfo(tPathToFile);
            using (FileStream fs = new FileStream(tPathToFile, FileMode.Open, FileAccess.Read))
            {
                using (ZlibStream zs = new ZlibStream(fs, CompressionMode.Decompress))
                {
                    using (StreamReader sr = new StreamReader(zs))
                    {
                        using (JsonReader reader = new JsonTextReader(sr))
                        {
                            return SaveManager._reader.Deserialize<SavedMap>(reader);
                        }
                    }
                }
            }
        }
        Debug.Log("Does not exist : " + tPathToFile);
        tPathToFile = pMainPath + "map.wbax";
        if (File.Exists(tPathToFile))
        {
            SaveManager.fileInfo(tPathToFile);
            using (FileStream fs2 = new FileStream(tPathToFile, FileMode.Open, FileAccess.Read))
            {
                using (StreamReader sr2 = new StreamReader(fs2))
                {
                    using (JsonReader reader2 = new JsonTextReader(sr2))
                    {
                        return SaveManager._reader.Deserialize<SavedMap>(reader2);
                    }
                }
            }
        }
        Debug.Log("Does not exist : " + tPathToFile);
        tPathToFile = pMainPath + "map.json";
        if (File.Exists(tPathToFile))
        {
            SaveManager.fileInfo(tPathToFile);
            return JsonConvert.DeserializeObject<SavedMap>(Zip.Decompress(File.ReadAllText(tPathToFile)), SaveManager._settings);
        }
        Debug.Log("Does not exist : " + tPathToFile);
        return null;
    }

    // Token: 0x06002D23 RID: 11555 RVA: 0x0016BFE8 File Offset: 0x0016A1E8
    private static void fileInfo(string full_path)
    {
        try
        {
            FileInfo fi = new FileInfo(full_path);
            Debug.Log("Loading          : " + fi.Name);
            Debug.Log("Size             : " + fi.Length.ToString());
            Debug.Log("Creation time    : " + fi.CreationTime.ToString());
            Debug.Log("Last access time : " + fi.LastAccessTime.ToString());
            Debug.Log("Last write time  : " + fi.LastWriteTime.ToString());
            string str = "Folder           : ";
            DirectoryInfo directory = fi.Directory;
            Debug.Log(str + ((directory != null) ? directory.Name : null));
        }
        catch (Exception message)
        {
            Debug.Log("Error when getting file info for");
            Debug.Log(full_path);
            Debug.Log(message);
        }
    }

    // Token: 0x06002D24 RID: 11556 RVA: 0x0016C0D0 File Offset: 0x0016A2D0
    public void startLoadSlot()
    {
        World.world.transition_screen.startTransition(new LoadingScreen.TransitionAction(this.loadWorld));
    }

    // Token: 0x06002D25 RID: 11557 RVA: 0x0016C0F0 File Offset: 0x0016A2F0
    private void loadTiles(string pString)
    {
        string[] tSaveAllTiles = pString.Split(',', StringSplitOptions.None);
        int width = Config.ZONE_AMOUNT_X;
        int zone_AMOUNT_Y = Config.ZONE_AMOUNT_Y;
        if (this.data.saveVersion < 7)
        {
            string[] tString = new string[World.world.tiles_list.Length];
            int tSkip = 0;
            int iX = 0;
            int iY = 0;
            for (int i = 0; i < tSaveAllTiles.Length; i++)
            {
                if (iX >= 50 * width)
                {
                    iX = 0;
                    iY++;
                    tSkip += 14 * width;
                }
                int tNewId = i + tSkip;
                if (tNewId <= tString.Length)
                {
                    tString[tNewId] = tSaveAllTiles[i];
                    iX++;
                }
            }
            tSaveAllTiles = tString;
        }
        for (int j = 0; j < World.world.tiles_list.Length; j++)
        {
            WorldTile tTile = World.world.tiles_list[j];
            if (tTile.data.tile_id >= tSaveAllTiles.Length || tSaveAllTiles[tTile.data.tile_id] == null)
            {
                tTile.setTileType("deep_ocean");
            }
            else
            {
                string[] tSaveTile = tSaveAllTiles[tTile.data.tile_id].Split(':', StringSplitOptions.None);
                string tTileData;
                if (tSaveTile.Length != 2)
                {
                    tTileData = null;
                }
                else
                {
                    tTileData = tSaveTile[1];
                }
                this._tile_id_main = tSaveTile[0];
                this._tile_id_top = string.Empty;
                this.convertOldTilesToNewOnes();
                if (string.IsNullOrEmpty(this._tile_id_top))
                {
                    tTile.setTileType(this._tile_id_main);
                }
                else
                {
                    tTile.setTileTypes(this._tile_id_main, AssetManager.top_tiles.get(this._tile_id_top));
                }
                tTile.Height = tTile.Type.height_min;
                if (tTileData != null)
                {
                    if (tTileData.Contains("fire"))
                    {
                        tTile.setFireData(true);
                    }
                    if (tTileData.Contains("conv0"))
                    {
                        tTile.data.conwayType = ConwayType.Eater;
                        World.world.conway_layer.add(tTile, "conway");
                    }
                    if (tTileData.Contains("conv1"))
                    {
                        tTile.data.conwayType = ConwayType.Creator;
                        World.world.conway_layer.add(tTile, "conway_inverse");
                    }
                }
            }
        }
    }

    // Token: 0x06002D26 RID: 11558 RVA: 0x0016C2F0 File Offset: 0x0016A4F0
    private void convertPermafrost()
    {
        string tile_id_top = this._tile_id_top;
        if (tile_id_top == "snow_low")
        {
            this._tile_id_top = "permafrost_low";
            return;
        }
        if (tile_id_top == "snow_high")
        {
            this._tile_id_top = "permafrost_high";
            return;
        }
        if (!(tile_id_top == "snow_sand") && !(tile_id_top == "ice") && !(tile_id_top == "snow_hills") && !(tile_id_top == "snow_block"))
        {
            return;
        }
        this._tile_id_top = string.Empty;
    }

    // Token: 0x06002D27 RID: 11559 RVA: 0x0016C378 File Offset: 0x0016A578
    private void convertOldTilesToNewOnes()
    {
        if (this._tile_id_main.Contains("road"))
        {
            this._tile_id_main = "soil_low";
            this._tile_id_top = "road";
        }
        string tile_id_main = this._tile_id_main;
        uint num = < PrivateImplementationDetails >.ComputeStringHash(tile_id_main);
        if (num <= 3134936370U)
        {
            if (num <= 1332360248U)
            {
                if (num <= 624473654U)
                {
                    if (num != 164218702U)
                    {
                        if (num != 174734082U)
                        {
                            if (num != 624473654U)
                            {
                                goto IL_525;
                            }
                            if (!(tile_id_main == "hills_frozen"))
                            {
                                goto IL_525;
                            }
                            this._tile_id_main = "mountains";
                            this._tile_id_top = "snow_block";
                            return;
                        }
                        else
                        {
                            if (!(tile_id_main == "soil"))
                            {
                                goto IL_525;
                            }
                            this._tile_id_main = "soil_low";
                            return;
                        }
                    }
                    else
                    {
                        if (!(tile_id_main == "deep_ocean"))
                        {
                            goto IL_525;
                        }
                        return;
                    }
                }
                else if (num != 1309421833U)
                {
                    if (num != 1328097888U)
                    {
                        if (num != 1332360248U)
                        {
                            goto IL_525;
                        }
                        if (!(tile_id_main == "soil_creep"))
                        {
                            goto IL_525;
                        }
                        this._tile_id_main = "soil_low";
                        this._tile_id_top = "tumor_low";
                        return;
                    }
                    else
                    {
                        if (!(tile_id_main == "forest"))
                        {
                            goto IL_525;
                        }
                        goto IL_449;
                    }
                }
                else
                {
                    if (!(tile_id_main == "soil_frozen"))
                    {
                        goto IL_525;
                    }
                    this._tile_id_main = "soil_low";
                    this._tile_id_top = "permafrost_low";
                    return;
                }
            }
            else if (num <= 2043630411U)
            {
                if (num != 1584873562U)
                {
                    if (num != 1736598119U)
                    {
                        if (num != 2043630411U)
                        {
                            goto IL_525;
                        }
                        if (!(tile_id_main == "shallow_waters_frozen"))
                        {
                            goto IL_525;
                        }
                        this._tile_id_main = "shallow_waters";
                        this._tile_id_top = "ice";
                        return;
                    }
                    else
                    {
                        if (!(tile_id_main == "field"))
                        {
                            goto IL_525;
                        }
                        this._tile_id_main = "soil_low";
                        this._tile_id_top = "field";
                        return;
                    }
                }
                else
                {
                    if (!(tile_id_main == "forest_soil"))
                    {
                        goto IL_525;
                    }
                    this._tile_id_main = "soil_high";
                    return;
                }
            }
            else if (num <= 2795768366U)
            {
                if (num != 2740153745U)
                {
                    if (num != 2795768366U)
                    {
                        goto IL_525;
                    }
                    if (!(tile_id_main == "mountains_frozen"))
                    {
                        goto IL_525;
                    }
                    this._tile_id_main = "mountains";
                    this._tile_id_top = "snow_block";
                    return;
                }
                else
                {
                    if (!(tile_id_main == "forest_soil_frozen"))
                    {
                        goto IL_525;
                    }
                    this._tile_id_main = "soil_high";
                    this._tile_id_top = "permafrost_high";
                    return;
                }
            }
            else if (num != 2993663101U)
            {
                if (num != 3134936370U)
                {
                    goto IL_525;
                }
                if (!(tile_id_main == "close_ocean"))
                {
                    goto IL_525;
                }
                return;
            }
            else if (!(tile_id_main == "grass"))
            {
                goto IL_525;
            }
        }
        else if (num <= 3365615729U)
        {
            if (num <= 3315282872U)
            {
                if (num != 3185372622U)
                {
                    if (num != 3189014883U)
                    {
                        if (num != 3315282872U)
                        {
                            goto IL_525;
                        }
                        if (!(tile_id_main == "lava3"))
                        {
                            goto IL_525;
                        }
                        return;
                    }
                    else
                    {
                        if (!(tile_id_main == "sand"))
                        {
                            goto IL_525;
                        }
                        this._tile_id_main = "sand";
                        return;
                    }
                }
                else
                {
                    if (!(tile_id_main == "sand_frozen"))
                    {
                        goto IL_525;
                    }
                    this._tile_id_main = "sand";
                    this._tile_id_top = "snow_sand";
                    return;
                }
            }
            else if (num != 3332060491U)
            {
                if (num != 3348838110U)
                {
                    if (num != 3365615729U)
                    {
                        goto IL_525;
                    }
                    if (!(tile_id_main == "lava0"))
                    {
                        goto IL_525;
                    }
                    return;
                }
                else
                {
                    if (!(tile_id_main == "lava1"))
                    {
                        goto IL_525;
                    }
                    return;
                }
            }
            else
            {
                if (!(tile_id_main == "lava2"))
                {
                    goto IL_525;
                }
                return;
            }
        }
        else if (num <= 3635428898U)
        {
            if (num != 3517725693U)
            {
                if (num != 3632974288U)
                {
                    if (num != 3635428898U)
                    {
                        goto IL_525;
                    }
                    if (!(tile_id_main == "grass_flowers"))
                    {
                        goto IL_525;
                    }
                }
                else
                {
                    if (!(tile_id_main == "shallow_waters"))
                    {
                        goto IL_525;
                    }
                    return;
                }
            }
            else
            {
                if (!(tile_id_main == "sand_creep"))
                {
                    goto IL_525;
                }
                this._tile_id_main = "sand";
                this._tile_id_top = "tumor_low";
                return;
            }
        }
        else if (num <= 4171135248U)
        {
            if (num != 4022750299U)
            {
                if (num != 4171135248U)
                {
                    goto IL_525;
                }
                if (!(tile_id_main == "fuse"))
                {
                    goto IL_525;
                }
                this._tile_id_main = "soil_low";
                this._tile_id_top = "fuse";
                return;
            }
            else
            {
                if (!(tile_id_main == "hills"))
                {
                    goto IL_525;
                }
                return;
            }
        }
        else if (num != 4227381031U)
        {
            if (num != 4243777795U)
            {
                goto IL_525;
            }
            if (!(tile_id_main == "mountains"))
            {
                goto IL_525;
            }
            return;
        }
        else
        {
            if (!(tile_id_main == "forest_flowers"))
            {
                goto IL_525;
            }
            goto IL_449;
        }
        this._tile_id_main = "soil_low";
        this._tile_id_top = "grass_low";
        return;
    IL_449:
        this._tile_id_main = "soil_high";
        this._tile_id_top = "grass_high";
        return;
    IL_525:
        this._tile_id_main = "soil_low";
    }

    // Token: 0x06002D28 RID: 11560 RVA: 0x0016C8B8 File Offset: 0x0016AAB8
    private void loadTileArray(SavedMap pData)
    {
        if (pData.tileAmounts.Length == 0)
        {
            return;
        }
        int maxTiles = pData.width * pData.height * 64 * 64;
        int tTileIndex = 0;
        for (int i = 0; i < pData.tileArray.Length; i++)
        {
            for (int j = 0; j < pData.tileArray[i].Length; j++)
            {
                this._tile_id_top = string.Empty;
                this._tile_id_main = pData.tileMap[pData.tileArray[i][j]] ?? "deep_ocean";
                if (this._tile_id_main.Contains(":"))
                {
                    string[] tSplitID = this._tile_id_main.Split(':', StringSplitOptions.None);
                    this._tile_id_main = tSplitID[0];
                    this._tile_id_top = tSplitID[1];
                }
                if (pData.saveVersion < 9)
                {
                    this.convertOldTilesToNewOnes();
                }
                if (pData.saveVersion < 10)
                {
                    this.convertPermafrost();
                }
                for (int k = 0; k < pData.tileAmounts[i][j]; k++)
                {
                    WorldTile tTile = World.world.tiles_list[tTileIndex++];
                    if (string.IsNullOrEmpty(this._tile_id_top))
                    {
                        tTile.setTileType(this._tile_id_main);
                    }
                    else
                    {
                        tTile.setTileTypes(this._tile_id_main, AssetManager.top_tiles.get(this._tile_id_top));
                    }
                    tTile.Height = tTile.Type.height_min;
                }
            }
        }
        while (tTileIndex + 1 < maxTiles)
        {
            World.world.tiles_list[tTileIndex++].setTileType("deep_ocean");
        }
    }

    // Token: 0x06002D29 RID: 11561 RVA: 0x0016CA3C File Offset: 0x0016AC3C
    private void loadConway(List<int> conv0, List<int> conv1)
    {
        if (conv0.Count == 0 && conv1.Count == 0)
        {
            return;
        }
        for (int i = 0; i < conv0.Count; i++)
        {
            World.world.tiles_list[conv0[i]].data.conwayType = ConwayType.Eater;
            World.world.conway_layer.add(World.world.tiles_list[conv0[i]], "conway");
        }
        for (int j = 0; j < conv1.Count; j++)
        {
            World.world.tiles_list[conv1[j]].data.conwayType = ConwayType.Creator;
            World.world.conway_layer.add(World.world.tiles_list[conv1[j]], "conway_inverse");
        }
    }

    // Token: 0x06002D2A RID: 11562 RVA: 0x0016CB04 File Offset: 0x0016AD04
    private void loadFrozen(List<int> pTileList)
    {
        if (pTileList.Count == 0)
        {
            return;
        }
        for (int i = 0; i < pTileList.Count; i++)
        {
            int tId = pTileList[i];
            World.world.tiles_list[tId].freeze(10);
        }
    }

    // Token: 0x06002D2B RID: 11563 RVA: 0x0016CB48 File Offset: 0x0016AD48
    private void loadFire(List<int> pTileList)
    {
        if (pTileList.Count == 0)
        {
            return;
        }
        for (int i = 0; i < pTileList.Count; i++)
        {
            int tId = pTileList[i];
            World.world.tiles_list[tId].setFireData(true);
        }
    }

    // Token: 0x06002D2C RID: 11564 RVA: 0x0016CB8C File Offset: 0x0016AD8C
    public void loadData(SavedMap pData, string pPath = null)
    {
        this.data = pData;
        Debug.Log("Save Version " + this.data.saveVersion.ToString());
        SaveConverter.convert(this.data);
        World.world.addClearWorld(pData.width, pData.height);
        SmoothLoader.add(delegate
        {
            World.world.setMapSize(pData.width, pData.height);
            World.world.map_stats = pData.mapStats;
            World.world.map_stats.load();
            World.world.world_laws = pData.worldLaws;
            this.checkWorldLawsLoad();
            AssetManager.gene_library.regenerateBasicDNACodesWithLifeSeed(pData.mapStats.life_dna);
            World.world.era_manager.loadAge();
        }, "Setting Map Size", false, 0.001f, false);
        if (!Config.disable_db)
        {
            bool flag = string.IsNullOrEmpty(pPath) || !SaveManager.doesStatsDBExist(pPath);
            if (!flag)
            {
                SmoothLoader.add(delegate
                {
                    if (!SaveManager.loadStatsFrom(pPath))
                    {
                        DBManager.createDB();
                    }
                }, "Loading Stats DB", false, 0.001f, false);
            }
            else
            {
                SmoothLoader.add(delegate
                {
                    DBManager.createDB();
                }, "Creating Stats DB", false, 0.001f, false);
            }
            SmoothLoader.add(delegate
            {
                DBTables.checkTablesOK(true);
            }, "Checking Stats DB", false, 0.001f, false);
            DBTables.createOrMigrateTablesLoader(flag);
        }
        WindowPreloader.addWaitForWindowResources();
        if (pData.saveVersion < 8)
        {
            if (pData.saveVersion == 0)
            {
                SmoothLoader.add(new MapLoaderAction(this.loadAncientTiles), "LOADING ANCIENT TILES", false, 0.001f, false);
            }
            SmoothLoader.add(delegate
            {
                this.loadTiles(pData.tileString);
            }, "Loading Very Old Tiles. Like super old. Maybe you should like, re-save your world?", false, 0.001f, false);
        }
        else if (pData.saveVersion > 7)
        {
            SmoothLoader.add(delegate
            {
                this.loadTileArray(pData);
            }, "Loading Tiles", false, 0.001f, false);
            SmoothLoader.add(delegate
            {
                this.loadFrozen(pData.frozen_tiles);
            }, "Loading Frozen", false, 0.001f, false);
            SmoothLoader.add(delegate
            {
                this.loadFire(pData.fire);
            }, "Loading Fires", false, 0.001f, false);
            SmoothLoader.add(delegate
            {
                this.loadConway(pData.conwayEater, pData.conwayCreator);
            }, "Loading Conway", false, 0.001f, false);
        }
        SmoothLoader.add(new MapLoaderAction(this.loadSubspecies), "Loading Subspecies", false, 0.001f, false);
        SmoothLoader.add(new MapLoaderAction(this.loadFamilies), "Loading Families", false, 0.001f, false);
        SmoothLoader.add(new MapLoaderAction(this.loadLanguages), "Loading Languages", false, 0.001f, false);
        SmoothLoader.add(new MapLoaderAction(this.loadReligions), "Loading Religions", false, 0.001f, false);
        SmoothLoader.add(new MapLoaderAction(this.loadItems), "Loading Items", false, 0.001f, false);
        SmoothLoader.add(new MapLoaderAction(this.loadBooks), "Loading Books", false, 0.001f, false);
        SmoothLoader.add(new MapLoaderAction(this.loadCultures), "Loading Cultures", false, 0.001f, false);
        SmoothLoader.add(new MapLoaderAction(this.loadClans), "Loading Clans", false, 0.001f, false);
        SmoothLoader.add(new MapLoaderAction(this.loadKingdoms), "Loading Kingdoms", false, 0.001f, false);
        SmoothLoader.add(new MapLoaderAction(this.loadCities), "Loading Cities", false, 0.001f, false);
        SmoothLoader.add(new MapLoaderAction(this.loadWars), "Loading Wars", false, 0.001f, false);
        SmoothLoader.add(new MapLoaderAction(this.loadArmies), "Loading Armies", false, 0.001f, false);
        SmoothLoader.add(new MapLoaderAction(this.loadAlliances), "Loading Alliances", false, 0.001f, false);
        SmoothLoader.add(new MapLoaderAction(this.loadPlots), "Loading Plots", false, 0.001f, false);
        SmoothLoader.add(new MapLoaderAction(this.loadActors), "Finish Loading Actors", false, 0.001f, false);
        SmoothLoader.add(new MapLoaderAction(this.loadActorLovers), "Loading Lovers", false, 0.001f, false);
        SmoothLoader.add(new MapLoaderAction(this.loadArmyCaptain), "Loading Army Captains", false, 0.001f, false);
        SmoothLoader.add(new MapLoaderAction(this.loadPlotAuthors), "Loading Plot Authors", false, 0.001f, false);
        SmoothLoader.add(delegate
        {
            SaveConverter.checkOldCityZones(this.data);
        }, "Check Old City Zones", false, 0.001f, false);
        SmoothLoader.add(new MapLoaderAction(this.loadBuildings), "Loading Buildings", false, 0.001f, false);
        SmoothLoader.add(delegate
        {
            World.world.checkSimManagerLists();
        }, "Check Meta List Stuff", false, 0.001f, false);
        SmoothLoader.add(new MapLoaderAction(this.setHomeBuildings), "Set Home Buildings", false, 0.001f, false);
        SmoothLoader.add(new MapLoaderAction(this.loadCivs02), "Loading Civs", false, 0.001f, false);
        SmoothLoader.add(new MapLoaderAction(this.loadLeaders), "Loading Leaders", false, 0.001f, false);
        SmoothLoader.add(new MapLoaderAction(this.loadDiplomacy), "Loading Diplomacy", false, 0.001f, false);
        World.world.addUnloadResources();
        SmoothLoader.add(delegate
        {
            World.world.map_chunk_manager.allDirty();
        }, "Map Chunk Manager (1/2)", false, 0.001f, false);
        SmoothLoader.add(delegate
        {
            World.world.map_chunk_manager.update(0f, true);
        }, "Map Chunk Manager (2/2)", false, 0.001f, false);
        SmoothLoader.add(new MapLoaderAction(this.loadBoatStates), "Loading Boats. Ahoy Ahoy", false, 0.001f, false);
        SmoothLoader.add(delegate
        {
            World.world.cleanUpWorld(true);
        }, "Cleaning Up The World", true, 0.001f, false);
        SmoothLoader.add(delegate
        {
            foreach (Subspecies subspecies in World.world.subspecies)
            {
                subspecies.checkPhenotypeColor();
            }
        }, "Checking Phenotypes", true, 0.001f, false);
        SmoothLoader.add(delegate
        {
            World.world.redrawTiles();
        }, "Drawing Up The World", true, 0.001f, false);
        SmoothLoader.add(delegate
        {
            World.world.preloadRenderedSprites();
        }, "Preload rendered sprites...", false, 0.2f, false);
        SmoothLoader.add(delegate
        {
            World.world.finishMakingWorld();
        }, "Tidying Up The World", true, 0.001f, false);
        SmoothLoader.add(delegate
        {
            World.world.lastGC();
        }, "Rewriting The World", true, 0.001f, false);
        World.world.addLoadAutoTester();
        World.world.addKillAllUnits();
        World.world.addLoadWorldCallbacks();
        SmoothLoader.add(delegate
        {
            this.data = null;
            World.world.finishingUpLoading();
        }, "Finishing up...", false, 0.2f, false);
    }

    // Token: 0x06002D2D RID: 11565 RVA: 0x0016D284 File Offset: 0x0016B484
    private void checkWorldLawsLoad()
    {
        foreach (WorldLawAsset worldLawAsset in AssetManager.world_laws_library.list)
        {
            OnWorldLoadAction on_world_load = worldLawAsset.on_world_load;
            if (on_world_load != null)
            {
                on_world_load();
            }
        }
    }

    // Token: 0x06002D2E RID: 11566 RVA: 0x0016D2E4 File Offset: 0x0016B4E4
    private void loadBoatStates()
    {
        foreach (Actor tActor in World.world.units)
        {
            if (tActor.data.transportID.hasValue())
            {
                Actor tTransport = World.world.units.get(tActor.data.transportID);
                if (tTransport != null)
                {
                    tActor.embarkInto(tTransport.getSimpleComponent<Boat>());
                    tActor.setTask("sit_inside_boat", true, false, false);
                    tActor.ai.update();
                }
            }
        }
    }

    // Token: 0x06002D2F RID: 11567 RVA: 0x0016D384 File Offset: 0x0016B584
    private void loadDiplomacy()
    {
        World.world.diplomacy.loadFromSave(this.data.relations);
    }

    // Token: 0x06002D30 RID: 11568 RVA: 0x0016D3A0 File Offset: 0x0016B5A0
    private void loadLeaders()
    {
        foreach (City city in World.world.cities)
        {
            city.loadLeader();
        }
    }

    // Token: 0x06002D31 RID: 11569 RVA: 0x0016D3F0 File Offset: 0x0016B5F0
    private void loadCivs02()
    {
        foreach (Kingdom kingdom in World.world.kingdoms)
        {
            kingdom.load2();
        }
    }

    // Token: 0x06002D32 RID: 11570 RVA: 0x0016D440 File Offset: 0x0016B640
    private void setHomeBuildings()
    {
        foreach (Actor tActor in World.world.units)
        {
            long tID = tActor.data.homeBuildingID;
            if (tID.hasValue())
            {
                Building tBuilding = World.world.buildings.get(tID);
                if (tBuilding != null && tBuilding.isUsable())
                {
                    if (tActor.asset.is_boat)
                    {
                        tBuilding.component_docks.addBoatToDock(tActor);
                    }
                    else if (tBuilding.component_unit_spawner != null)
                    {
                        tBuilding.component_unit_spawner.setUnitFromHere(tActor);
                    }
                    else
                    {
                        tActor.setHomeBuilding(tBuilding);
                    }
                }
            }
        }
    }

    // Token: 0x06002D33 RID: 11571 RVA: 0x0016D4F4 File Offset: 0x0016B6F4
    private void loadBuildings()
    {
        World.world.buildings.loadFromSave(this.data.buildings);
    }

    // Token: 0x06002D34 RID: 11572 RVA: 0x0016D510 File Offset: 0x0016B710
    private void loadActors()
    {
        World.world.units.loadFromSave(this.data.actors_data);
        this.data.actors_data.Clear();
    }

    // Token: 0x06002D35 RID: 11573 RVA: 0x0016D53C File Offset: 0x0016B73C
    private void loadPlotAuthors()
    {
        foreach (Plot plot in World.world.plots)
        {
            plot.loadAuthors();
        }
    }

    // Token: 0x06002D36 RID: 11574 RVA: 0x0016D58C File Offset: 0x0016B78C
    private void loadActorLovers()
    {
        foreach (Actor tActor in World.world.units)
        {
            if (tActor.data.lover.hasValue())
            {
                Actor tLover = World.world.units.get(tActor.data.lover);
                if (tLover != null)
                {
                    tActor.setLover(tLover);
                }
            }
        }
    }

    // Token: 0x06002D37 RID: 11575 RVA: 0x0016D610 File Offset: 0x0016B810
    private void loadActorsOld(int startIndex = 0, int pAmount = 0)
    {
    }

    // Token: 0x06002D38 RID: 11576 RVA: 0x0016D612 File Offset: 0x0016B812
    private void loadCities()
    {
        if (this.data.cities == null)
        {
            return;
        }
        World.world.cities.loadCities(this.data);
    }

    // Token: 0x06002D39 RID: 11577 RVA: 0x0016D637 File Offset: 0x0016B837
    private void loadWars()
    {
        if (this.data.wars == null)
        {
            return;
        }
        World.world.wars.loadFromSave(this.data.wars);
    }

    // Token: 0x06002D3A RID: 11578 RVA: 0x0016D661 File Offset: 0x0016B861
    private void loadPlots()
    {
        if (this.data.plots == null)
        {
            return;
        }
        World.world.plots.loadFromSave(this.data.plots);
    }

    // Token: 0x06002D3B RID: 11579 RVA: 0x0016D68B File Offset: 0x0016B88B
    private void loadAlliances()
    {
        if (this.data.alliances == null)
        {
            return;
        }
        World.world.alliances.loadFromSave(this.data.alliances);
    }

    // Token: 0x06002D3C RID: 11580 RVA: 0x0016D6B5 File Offset: 0x0016B8B5
    private void loadClans()
    {
        if (this.data.clans == null)
        {
            return;
        }
        World.world.clans.loadFromSave(this.data.clans);
    }

    // Token: 0x06002D3D RID: 11581 RVA: 0x0016D6DF File Offset: 0x0016B8DF
    private void loadKingdoms()
    {
        if (this.data.kingdoms == null)
        {
            return;
        }
        World.world.kingdoms.loadFromSave(this.data.kingdoms);
    }

    // Token: 0x06002D3E RID: 11582 RVA: 0x0016D709 File Offset: 0x0016B909
    private void loadCultures()
    {
        if (this.data.cultures == null)
        {
            return;
        }
        World.world.cultures.loadFromSave(this.data.cultures);
    }

    // Token: 0x06002D3F RID: 11583 RVA: 0x0016D733 File Offset: 0x0016B933
    private void loadBooks()
    {
        if (this.data.books == null)
        {
            return;
        }
        World.world.books.loadFromSave(this.data.books);
    }

    // Token: 0x06002D40 RID: 11584 RVA: 0x0016D75D File Offset: 0x0016B95D
    private void loadSubspecies()
    {
        if (this.data.subspecies == null)
        {
            return;
        }
        World.world.subspecies.loadFromSave(this.data.subspecies);
    }

    // Token: 0x06002D41 RID: 11585 RVA: 0x0016D787 File Offset: 0x0016B987
    private void loadLanguages()
    {
        if (this.data.languages == null)
        {
            return;
        }
        World.world.languages.loadFromSave(this.data.languages);
    }

    // Token: 0x06002D42 RID: 11586 RVA: 0x0016D7B1 File Offset: 0x0016B9B1
    private void loadReligions()
    {
        if (this.data.religions == null)
        {
            return;
        }
        World.world.religions.loadFromSave(this.data.religions);
    }

    // Token: 0x06002D43 RID: 11587 RVA: 0x0016D7DB File Offset: 0x0016B9DB
    private void loadItems()
    {
        if (this.data.items == null)
        {
            return;
        }
        World.world.items.loadFromSave(this.data.items);
    }

    // Token: 0x06002D44 RID: 11588 RVA: 0x0016D805 File Offset: 0x0016BA05
    private void loadFamilies()
    {
        if (this.data.families == null)
        {
            return;
        }
        World.world.families.loadFromSave(this.data.families);
    }

    // Token: 0x06002D45 RID: 11589 RVA: 0x0016D82F File Offset: 0x0016BA2F
    private void loadArmies()
    {
        if (this.data.armies == null)
        {
            return;
        }
        World.world.armies.loadFromSave(this.data.armies);
    }

    // Token: 0x06002D46 RID: 11590 RVA: 0x0016D85C File Offset: 0x0016BA5C
    private void loadArmyCaptain()
    {
        foreach (Army army in World.world.armies)
        {
            army.loadDataCaptains();
        }
    }

    // Token: 0x06002D47 RID: 11591 RVA: 0x0016D8AC File Offset: 0x0016BAAC
    private void loadAncientTiles()
    {
        using (StringBuilderPool tString = new StringBuilderPool())
        {
            for (int i = 0; i < this.data.tiles.Count; i++)
            {
                if (i > 0)
                {
                    tString.Append(",");
                }
                WorldTileData tTileData = this.data.tiles[i];
                tString.Append(tTileData.type);
            }
            this.data.tileString = tString.ToString();
            this.data.tiles = new List<WorldTileData>();
        }
    }

    // Token: 0x06002D48 RID: 11592 RVA: 0x0016D948 File Offset: 0x0016BB48
    public static string folderPath(string pFolder)
    {
        if (string.IsNullOrEmpty(pFolder))
        {
            return string.Empty;
        }
        string sepChar = Path.DirectorySeparatorChar.ToString();
        string altChar = Path.AltDirectorySeparatorChar.ToString();
        if (!pFolder.EndsWith(sepChar) && !pFolder.EndsWith(altChar))
        {
            pFolder += sepChar;
        }
        return pFolder;
    }

    // Token: 0x0400226B RID: 8811
    public static int currentSlot = 0;

    // Token: 0x0400226C RID: 8812
    public static string currentSavePath = string.Empty;

    // Token: 0x0400226D RID: 8813
    public static WorkshopMapData currentWorkshopMapData;

    // Token: 0x0400226E RID: 8814
    private const string saveslot_base = "saves";

    // Token: 0x0400226F RID: 8815
    private const string workshop_base = "workshop_upload";

    // Token: 0x04002270 RID: 8816
    private const string autosaves_base = "autosaves";

    // Token: 0x04002271 RID: 8817
    internal const string name_main_data_old = "map.json";

    // Token: 0x04002272 RID: 8818
    internal const string name_main_data = "map.wbox";

    // Token: 0x04002273 RID: 8819
    internal const string name_main_data_non_zip = "map.wbax";

    // Token: 0x04002274 RID: 8820
    internal const string name_meta_data = "map.meta";

    // Token: 0x04002275 RID: 8821
    internal const string name_stats_data = "map_stats.s3db";

    // Token: 0x04002276 RID: 8822
    public const string name_png_preview_main = "preview.png";

    // Token: 0x04002277 RID: 8823
    public const string name_png_preview_small = "preview_small.png";

    // Token: 0x04002278 RID: 8824
    private SavedMap data;

    // Token: 0x04002279 RID: 8825
    private static string persistentDataPath;

    // Token: 0x0400227A RID: 8826
    private string _tile_id_main;

    // Token: 0x0400227B RID: 8827
    private string _tile_id_top;
}
using System;
using System.Collections.Generic;
using UnityEngine;

// Token: 0x0200055C RID: 1372
public static class SaveConverter
{
    // Token: 0x06002CDC RID: 11484 RVA: 0x00168E08 File Offset: 0x00167008
    public static void convert(SavedMap pData)
    {
        if (pData.saveVersion == 15)
        {
            throw new Exception("saveVersion 15 is not supported");
        }
        if (pData.saveVersion < 12)
        {
            SaveConverter.convertOldAges(pData);
        }
        if (pData.saveVersion < 15)
        {
            SaveConverter.checkOldBuildingID(pData);
        }
        if (pData.saveVersion <= 15)
        {
            SaveConverter.convertTo15(pData);
        }
        if (pData.saveVersion <= 16)
        {
            SaveConverter.convertTo16(pData);
        }
        if (pData.saveVersion <= 17)
        {
            SaveConverter.convertTo17(pData);
        }
    }

    // Token: 0x06002CDD RID: 11485 RVA: 0x00168E7C File Offset: 0x0016707C
    public static long kingdomIDFixer(SavedMap pData, long pKingdomID)
    {
        if (pKingdomID != 0L)
        {
            return pKingdomID;
        }
        if (SaveConverter._kingdom_0 == 0L)
        {
            MapStats mapStats = pData.mapStats;
            long id_kingdom = mapStats.id_kingdom;
            mapStats.id_kingdom = id_kingdom + 1L;
            SaveConverter._kingdom_0 = id_kingdom;
        }
        Debug.LogWarning("found kingdom with id 0, changing to " + SaveConverter._kingdom_0.ToString());
        return SaveConverter._kingdom_0;
    }

    // Token: 0x06002CDE RID: 11486 RVA: 0x00168ED0 File Offset: 0x001670D0
    public static string assetIDFixer(string pAssetID)
    {
        if (pAssetID.StartsWith("unit_"))
        {
            pAssetID = pAssetID.Replace("unit_", "");
        }
        if (pAssetID.StartsWith("baby_"))
        {
            pAssetID = pAssetID.Replace("baby_", "");
        }
        if (pAssetID == "chick")
        {
            pAssetID = "chicken";
        }
        if (pAssetID == "skeleton_cursed")
        {
            pAssetID = "skeleton";
        }
        if (pAssetID == "whiteMage")
        {
            pAssetID = "white_mage";
        }
        if (pAssetID == "evilMage")
        {
            pAssetID = "evil_mage";
        }
        if (pAssetID == "godFinger")
        {
            pAssetID = "god_finger";
        }
        if (pAssetID == "livingPlants")
        {
            pAssetID = "living_plants";
        }
        if (pAssetID == "livingHouse")
        {
            pAssetID = "living_house";
        }
        if (pAssetID == "walker")
        {
            pAssetID = "cold_one";
        }
        if (pAssetID == "lemon_man")
        {
            pAssetID = "lemon_snail";
        }
        if (pAssetID == "lemon_boi")
        {
            pAssetID = "lemon_snail";
        }
        if (pAssetID == "enchanted_fairy")
        {
            pAssetID = "fairy";
        }
        if (pAssetID == "crystal_golem")
        {
            pAssetID = "crystal_sword";
        }
        return pAssetID;
    }

    // Token: 0x06002CDF RID: 11487 RVA: 0x0016900C File Offset: 0x0016720C
    public static void checkMaxValues(SavedMap pData)
    {
        if (pData.mapStats != null)
        {
            if (pData.mapStats.id_unit <= 1L && pData.actors_data != null)
            {
                bool tIncreased = false;
                foreach (ActorData tData in pData.actors_data)
                {
                    if (tData.id >= pData.mapStats.id_unit)
                    {
                        pData.mapStats.id_unit = tData.id + 1L;
                        tIncreased = true;
                    }
                }
                if (tIncreased)
                {
                    Debug.LogWarning("increased id_unit to " + pData.mapStats.id_unit.ToString());
                }
            }
            if (pData.mapStats.id_building <= 1L && pData.buildings != null)
            {
                bool tIncreased2 = false;
                foreach (BuildingData tData2 in pData.buildings)
                {
                    if (tData2.id >= pData.mapStats.id_building)
                    {
                        pData.mapStats.id_building = tData2.id + 1L;
                        tIncreased2 = true;
                    }
                }
                if (tIncreased2)
                {
                    Debug.LogWarning("increased id_building to " + pData.mapStats.id_building.ToString());
                }
            }
            if (pData.mapStats.id_kingdom <= 1L && pData.kingdoms != null)
            {
                bool tIncreased3 = false;
                foreach (KingdomData tData3 in pData.kingdoms)
                {
                    if (tData3.id >= pData.mapStats.id_kingdom)
                    {
                        pData.mapStats.id_kingdom = tData3.id + 1L;
                        tIncreased3 = true;
                    }
                }
                if (tIncreased3)
                {
                    Debug.LogWarning("increased id_kingdom to " + pData.mapStats.id_kingdom.ToString());
                }
            }
            if (pData.mapStats.id_city <= 1L && pData.cities != null)
            {
                bool tIncreased4 = false;
                foreach (CityData tData4 in pData.cities)
                {
                    if (tData4.id >= pData.mapStats.id_city)
                    {
                        pData.mapStats.id_city = tData4.id + 1L;
                        tIncreased4 = true;
                    }
                }
                if (tIncreased4)
                {
                    Debug.LogWarning("increased id_city to " + pData.mapStats.id_city.ToString());
                }
            }
            if (pData.mapStats.id_culture <= 1L && pData.cultures != null)
            {
                bool tIncreased5 = false;
                foreach (CultureData tData5 in pData.cultures)
                {
                    if (tData5.id >= pData.mapStats.id_culture)
                    {
                        pData.mapStats.id_culture = tData5.id + 1L;
                        tIncreased5 = true;
                    }
                }
                if (tIncreased5)
                {
                    Debug.LogWarning("increased id_culture to " + pData.mapStats.id_culture.ToString());
                }
            }
            if (pData.mapStats.id_clan <= 1L && pData.clans != null)
            {
                bool tIncreased6 = false;
                foreach (ClanData tData6 in pData.clans)
                {
                    if (tData6.id >= pData.mapStats.id_clan)
                    {
                        pData.mapStats.id_clan = tData6.id + 1L;
                        tIncreased6 = true;
                    }
                }
                if (tIncreased6)
                {
                    Debug.LogWarning("increased id_clan to " + pData.mapStats.id_clan.ToString());
                }
            }
            if (pData.mapStats.id_alliance <= 1L && pData.alliances != null)
            {
                bool tIncreased7 = false;
                foreach (AllianceData tData7 in pData.alliances)
                {
                    if (tData7.id >= pData.mapStats.id_alliance)
                    {
                        pData.mapStats.id_alliance = tData7.id + 1L;
                        tIncreased7 = true;
                    }
                }
                if (tIncreased7)
                {
                    Debug.LogWarning("increased id_alliance to " + pData.mapStats.id_alliance.ToString());
                }
            }
            if (pData.mapStats.id_war <= 1L && pData.wars != null)
            {
                bool tIncreased8 = false;
                foreach (WarData tData8 in pData.wars)
                {
                    if (tData8.id >= pData.mapStats.id_war)
                    {
                        pData.mapStats.id_war = tData8.id + 1L;
                        tIncreased8 = true;
                    }
                }
                if (tIncreased8)
                {
                    Debug.LogWarning("increased id_war to " + pData.mapStats.id_war.ToString());
                }
            }
            if (pData.mapStats.id_plot <= 1L && pData.plots != null)
            {
                bool tIncreased9 = false;
                foreach (PlotData tData9 in pData.plots)
                {
                    if (tData9.id >= pData.mapStats.id_plot)
                    {
                        pData.mapStats.id_plot = tData9.id + 1L;
                        tIncreased9 = true;
                    }
                }
                if (tIncreased9)
                {
                    Debug.LogWarning("increased id_plot to " + pData.mapStats.id_plot.ToString());
                }
            }
            if (pData.mapStats.id_book <= 1L && pData.books != null)
            {
                bool tIncreased10 = false;
                foreach (BookData tData10 in pData.books)
                {
                    if (tData10.id >= pData.mapStats.id_book)
                    {
                        pData.mapStats.id_book = tData10.id + 1L;
                        tIncreased10 = true;
                    }
                }
                if (tIncreased10)
                {
                    Debug.LogWarning("increased id_book to " + pData.mapStats.id_book.ToString());
                }
            }
            if (pData.mapStats.id_subspecies <= 1L && pData.subspecies != null)
            {
                bool tIncreased11 = false;
                foreach (SubspeciesData tData11 in pData.subspecies)
                {
                    if (tData11.id >= pData.mapStats.id_subspecies)
                    {
                        pData.mapStats.id_subspecies = tData11.id + 1L;
                        tIncreased11 = true;
                    }
                }
                if (tIncreased11)
                {
                    Debug.LogWarning("increased id_subspecies to " + pData.mapStats.id_subspecies.ToString());
                }
            }
            if (pData.mapStats.id_family <= 1L && pData.families != null)
            {
                bool tIncreased12 = false;
                foreach (FamilyData tData12 in pData.families)
                {
                    if (tData12.id >= pData.mapStats.id_family)
                    {
                        pData.mapStats.id_family = tData12.id + 1L;
                        tIncreased12 = true;
                    }
                }
                if (tIncreased12)
                {
                    Debug.LogWarning("increased id_family to " + pData.mapStats.id_family.ToString());
                }
            }
            if (pData.mapStats.id_army <= 1L && pData.armies != null)
            {
                bool tIncreased13 = false;
                foreach (ArmyData tData13 in pData.armies)
                {
                    if (tData13.id >= pData.mapStats.id_army)
                    {
                        pData.mapStats.id_army = tData13.id + 1L;
                        tIncreased13 = true;
                    }
                }
                if (tIncreased13)
                {
                    Debug.LogWarning("increased id_army to " + pData.mapStats.id_army.ToString());
                }
            }
            if (pData.mapStats.id_language <= 1L && pData.languages != null)
            {
                bool tIncreased14 = false;
                foreach (LanguageData tData14 in pData.languages)
                {
                    if (tData14.id >= pData.mapStats.id_language)
                    {
                        pData.mapStats.id_language = tData14.id + 1L;
                        tIncreased14 = true;
                    }
                }
                if (tIncreased14)
                {
                    Debug.LogWarning("increased id_language to " + pData.mapStats.id_language.ToString());
                }
            }
            if (pData.mapStats.id_religion <= 1L && pData.religions != null)
            {
                bool tIncreased15 = false;
                foreach (ReligionData tData15 in pData.religions)
                {
                    if (tData15.id >= pData.mapStats.id_religion)
                    {
                        pData.mapStats.id_religion = tData15.id + 1L;
                        tIncreased15 = true;
                    }
                }
                if (tIncreased15)
                {
                    Debug.LogWarning("increased id_religion to " + pData.mapStats.id_religion.ToString());
                }
            }
            if (pData.mapStats.id_item <= 1L && pData.items != null)
            {
                bool tIncreased16 = false;
                foreach (ItemData tData16 in pData.items)
                {
                    if (tData16.id >= pData.mapStats.id_item)
                    {
                        pData.mapStats.id_item = tData16.id + 1L;
                        tIncreased16 = true;
                    }
                }
                if (tIncreased16)
                {
                    Debug.LogWarning("increased id_item to " + pData.mapStats.id_item.ToString());
                }
            }
            if (pData.mapStats.id_diplomacy <= 1L && pData.relations != null)
            {
                long tMax = pData.mapStats.id_diplomacy;
                foreach (DiplomacyRelationData tData17 in pData.relations)
                {
                    if (tData17.id < 100000000L && tData17.id >= tMax)
                    {
                        tMax = tData17.id + 1L;
                    }
                }
                foreach (DiplomacyRelationData tData18 in pData.relations)
                {
                    if (tData18.id >= 100000000L)
                    {
                        BaseSystemData baseSystemData = tData18;
                        long num = tMax;
                        tMax = num + 1L;
                        baseSystemData.id = num;
                    }
                }
                pData.mapStats.id_diplomacy = tMax;
            }
        }
    }

    // Token: 0x06002CE0 RID: 11488 RVA: 0x00169BD0 File Offset: 0x00167DD0
    public static void convertTo17(SavedMap pData)
    {
        if (pData.subspecies != null)
        {
            foreach (SubspeciesData tData in pData.subspecies)
            {
                for (int i = 0; i < tData.saved_traits.Count; i++)
                {
                    if (tData.saved_traits[i] == "water_creature")
                    {
                        tData.saved_traits[i] = "aquatic";
                    }
                    if (tData.saved_traits[i] == "aquatic_adaptation")
                    {
                        tData.saved_traits[i] = "fins";
                    }
                }
            }
        }
    }

    // Token: 0x06002CE1 RID: 11489 RVA: 0x00169C90 File Offset: 0x00167E90
    public static void convertTo16(SavedMap pData)
    {
        if (pData.buildings != null)
        {
            foreach (BuildingData buildingData in pData.buildings)
            {
                buildingData.asset_id = buildingData.asset_id.Replace("mapple_plant", "maple_plant");
                buildingData.asset_id = buildingData.asset_id.Replace("mapple_tree", "maple_tree");
            }
        }
        if (pData.tileMap != null)
        {
            for (int i = 0; i < pData.tileMap.Count; i++)
            {
                if (pData.tileMap[i].Contains("mapple_"))
                {
                    pData.tileMap[i] = pData.tileMap[i].Replace("mapple_", "maple_");
                }
            }
        }
        if (pData.subspecies != null)
        {
            foreach (SubspeciesData tData in pData.subspecies)
            {
                if (tData.biome_variant.Contains("biome_mapple"))
                {
                    tData.biome_variant = tData.biome_variant.Replace("biome_mapple", "biome_maple");
                }
            }
        }
    }

    // Token: 0x06002CE2 RID: 11490 RVA: 0x00169DE8 File Offset: 0x00167FE8
    public static void convertTo15(SavedMap pData)
    {
        SaveConverter._kingdom_0 = 0L;
        SaveConverter.checkMaxValues(pData);
        if (pData.kingdoms != null)
        {
            foreach (KingdomData tData in pData.kingdoms)
            {
                tData.id = SaveConverter.kingdomIDFixer(pData, tData.id);
                tData.original_actor_asset = SaveConverter.assetIDFixer(tData.original_actor_asset);
            }
        }
        if (pData.actors_data != null)
        {
            foreach (ActorData tData2 in pData.actors_data)
            {
                tData2.asset_id = SaveConverter.assetIDFixer(tData2.asset_id);
                tData2.civ_kingdom_id = SaveConverter.kingdomIDFixer(pData, tData2.civ_kingdom_id);
                if (tData2.profession == UnitProfession.Baby)
                {
                    tData2.profession = UnitProfession.Nothing;
                }
                if (tData2.saved_traits != null)
                {
                    for (int i = 0; i < tData2.saved_traits.Count; i++)
                    {
                        if (tData2.saved_traits[i] == "mushSpores")
                        {
                            tData2.saved_traits[i] = "mush_spores";
                        }
                        if (tData2.saved_traits[i] == "tumorInfection")
                        {
                            tData2.saved_traits[i] = "tumor_infection";
                        }
                    }
                }
            }
        }
        if (pData.cities != null)
        {
            foreach (CityData tData3 in pData.cities)
            {
                tData3.kingdomID = SaveConverter.kingdomIDFixer(pData, tData3.kingdomID);
                tData3.original_actor_asset = SaveConverter.assetIDFixer(tData3.original_actor_asset);
            }
        }
        if (pData.books != null)
        {
            foreach (BookData tData4 in pData.books)
            {
                tData4.author_kingdom_id = SaveConverter.kingdomIDFixer(pData, tData4.author_kingdom_id);
            }
        }
        if (pData.cultures != null)
        {
            foreach (CultureData tData5 in pData.cultures)
            {
                tData5.creator_kingdom_id = SaveConverter.kingdomIDFixer(pData, tData5.creator_kingdom_id);
            }
        }
        if (pData.religions != null)
        {
            foreach (ReligionData tData6 in pData.religions)
            {
                tData6.creator_kingdom_id = SaveConverter.kingdomIDFixer(pData, tData6.creator_kingdom_id);
            }
        }
        if (pData.alliances != null)
        {
            foreach (AllianceData tData7 in pData.alliances)
            {
                tData7.founder_kingdom_id = SaveConverter.kingdomIDFixer(pData, tData7.founder_kingdom_id);
                List<long> kingdoms = tData7.kingdoms;
                if (kingdoms != null && kingdoms.Contains(0L))
                {
                    tData7.kingdoms[tData7.kingdoms.IndexOf(0L)] = SaveConverter.kingdomIDFixer(pData, 0L);
                }
            }
        }
        if (pData.wars != null)
        {
            foreach (WarData tData8 in pData.wars)
            {
                tData8.started_by_kingdom_id = SaveConverter.kingdomIDFixer(pData, tData8.started_by_kingdom_id);
                tData8.main_attacker = SaveConverter.kingdomIDFixer(pData, tData8.main_attacker);
                tData8.main_defender = SaveConverter.kingdomIDFixer(pData, tData8.main_defender);
                List<long> list_attackers = tData8.list_attackers;
                if (list_attackers != null && list_attackers.Contains(0L))
                {
                    tData8.list_attackers[tData8.list_attackers.IndexOf(0L)] = SaveConverter.kingdomIDFixer(pData, 0L);
                }
                List<long> list_defenders = tData8.list_defenders;
                if (list_defenders != null && list_defenders.Contains(0L))
                {
                    tData8.list_defenders[tData8.list_defenders.IndexOf(0L)] = SaveConverter.kingdomIDFixer(pData, 0L);
                }
            }
        }
        if (pData.clans != null)
        {
            foreach (ClanData tData9 in pData.clans)
            {
                tData9.founder_kingdom_id = SaveConverter.kingdomIDFixer(pData, tData9.founder_kingdom_id);
                tData9.original_actor_asset = SaveConverter.assetIDFixer(tData9.original_actor_asset);
            }
        }
        if (pData.cultures != null)
        {
            foreach (CultureData tData10 in pData.cultures)
            {
                tData10.creator_kingdom_id = SaveConverter.kingdomIDFixer(pData, tData10.creator_kingdom_id);
                tData10.original_actor_asset = SaveConverter.assetIDFixer(tData10.original_actor_asset);
            }
        }
        if (pData.families != null)
        {
            foreach (FamilyData tData11 in pData.families)
            {
                tData11.species_id = SaveConverter.assetIDFixer(tData11.species_id);
                tData11.founder_kingdom_id = SaveConverter.kingdomIDFixer(pData, tData11.founder_kingdom_id);
            }
        }
        if (pData.subspecies != null)
        {
            foreach (SubspeciesData subspeciesData in pData.subspecies)
            {
                subspeciesData.species_id = SaveConverter.assetIDFixer(subspeciesData.species_id);
            }
        }
        if (pData.plots != null)
        {
            foreach (PlotData tData12 in pData.plots)
            {
                if (tData12.plot_type_id == "stop_war")
                {
                    tData12.plot_type_id = "attacker_stop_war";
                }
            }
        }
        if (pData.relations != null)
        {
            foreach (DiplomacyRelationData tData13 in pData.relations)
            {
                tData13.kingdom1_id = SaveConverter.kingdomIDFixer(pData, tData13.kingdom1_id);
                tData13.kingdom2_id = SaveConverter.kingdomIDFixer(pData, tData13.kingdom2_id);
            }
        }
    }

    // Token: 0x06002CE3 RID: 11491 RVA: 0x0016A4D0 File Offset: 0x001686D0
    public static void convertOldAges(SavedMap data)
    {
        if (data.actors != null)
        {
            foreach (ActorDataObsolete pOldData in data.actors)
            {
                ActorData tData = SaveConverter.getNewActorData(pOldData);
                if (tData != null)
                {
                    data.actors_data.Add(tData);
                }
            }
            foreach (ActorData tData2 in data.actors_data)
            {
                if (data.saveVersion < 11 && tData2.created_time < 0.0)
                {
                    tData2.created_time = data.mapStats.world_time + tData2.created_time + (double)Randy.randomFloat(0f, 360f);
                }
            }
            data.actors = null;
        }
        if (data.kingdoms != null)
        {
            foreach (KingdomData tKingdom in data.kingdoms)
            {
                if (tKingdom.created_time < 0.0)
                {
                    tKingdom.created_time = data.mapStats.world_time + tKingdom.created_time + (double)Randy.randomFloat(0f, 360f);
                }
            }
        }
        if (data.cities != null)
        {
            foreach (CityData tCity in data.cities)
            {
                if (tCity.created_time < 0.0)
                {
                    tCity.created_time = data.mapStats.world_time + tCity.created_time + (double)Randy.randomFloat(0f, 360f);
                }
            }
        }
        if (data.cultures != null)
        {
            foreach (CultureData tCulture in data.cultures)
            {
                if (tCulture.created_time == 0.0 && tCulture.year_obsolete > 0)
                {
                    tCulture.created_time = data.mapStats.world_time - (double)((float)tCulture.year_obsolete * 60f) + (double)Randy.randomFloat(0f, 360f);
                }
            }
        }
    }

    // Token: 0x06002CE4 RID: 11492 RVA: 0x0016A75C File Offset: 0x0016895C
    public static void checkOldCityZones(SavedMap pData)
    {
        if (pData.saveVersion < 7)
        {
            for (int i = 0; i < pData.buildings.Count; i++)
            {
                BuildingData tData = pData.buildings[i];
                City tCity = World.world.cities.get(tData.cityID);
                if (tCity != null)
                {
                    WorldTile tTile = World.world.GetTile(tData.mainX, tData.mainY);
                    tCity.addZone(tTile.zone);
                }
            }
        }
    }

    // Token: 0x06002CE5 RID: 11493 RVA: 0x0016A7D4 File Offset: 0x001689D4
    public static void checkOldBuildingID(SavedMap pData)
    {
        if (SaveConverter._buildings_old_id_dictionary == null)
        {
            SaveConverter._buildings_old_id_dictionary = new Dictionary<string, string[]>();
            SaveConverter._buildings_old_id_dictionary.Add("geyserAcid", new string[] { "geyser_acid" });
            SaveConverter._buildings_old_id_dictionary.Add("tree", new string[] { "tree_green_1", "tree_green_2", "tree_green_3" });
            SaveConverter._buildings_old_id_dictionary.Add("mushroom", new string[] { "mushroom_red" });
            SaveConverter._buildings_old_id_dictionary.Add("savanna_tree", new string[] { "savanna_tree_1", "savanna_tree_2" });
            SaveConverter._buildings_old_id_dictionary.Add("savanna_tree_big", new string[] { "savanna_tree_big_1", "savanna_tree_big_2" });
            SaveConverter._buildings_old_id_dictionary.Add("cacti", new string[] { "cacti_tree" });
            SaveConverter._buildings_old_id_dictionary.Add("iron", new string[] { "mineral_metals" });
            SaveConverter._buildings_old_id_dictionary.Add("iron_m", new string[] { "mineral_metals" });
            SaveConverter._buildings_old_id_dictionary.Add("iron_s", new string[] { "mineral_metals" });
            SaveConverter._buildings_old_id_dictionary.Add("gold", new string[] { "mineral_gold" });
            SaveConverter._buildings_old_id_dictionary.Add("gold_m", new string[] { "mineral_gold" });
            SaveConverter._buildings_old_id_dictionary.Add("gold_s", new string[] { "mineral_gold" });
            SaveConverter._buildings_old_id_dictionary.Add("ore_deposit", new string[] { "mineral_metals" });
            SaveConverter._buildings_old_id_dictionary.Add("ore_deposit_m", new string[] { "mineral_metals" });
            SaveConverter._buildings_old_id_dictionary.Add("ore_deposit_s", new string[] { "mineral_metals" });
            SaveConverter._buildings_old_id_dictionary.Add("palm", new string[] { "palm_tree" });
            SaveConverter._buildings_old_id_dictionary.Add("pine", new string[] { "pine_tree" });
            SaveConverter._buildings_old_id_dictionary.Add("stone", new string[] { "mineral_stone" });
            SaveConverter._buildings_old_id_dictionary.Add("stone_m", new string[] { "mineral_stone" });
            SaveConverter._buildings_old_id_dictionary.Add("stone_s", new string[] { "mineral_stone" });
            SaveConverter._buildings_old_id_dictionary.Add("ruins_small", new string[] { "poop" });
            SaveConverter._buildings_old_id_dictionary.Add("ruins_medium", new string[] { "poop" });
            SaveConverter._buildings_old_id_dictionary.Add("house_human", new string[] { "house_human_0" });
            SaveConverter._buildings_old_id_dictionary.Add("1house_human", new string[] { "house_human_1" });
            SaveConverter._buildings_old_id_dictionary.Add("2house_human", new string[] { "house_human_2" });
            SaveConverter._buildings_old_id_dictionary.Add("3house_human", new string[] { "house_human_3" });
            SaveConverter._buildings_old_id_dictionary.Add("4house_human", new string[] { "house_human_4" });
            SaveConverter._buildings_old_id_dictionary.Add("5house_human", new string[] { "house_human_5" });
            SaveConverter._buildings_old_id_dictionary.Add("hall_human", new string[] { "hall_human_0" });
            SaveConverter._buildings_old_id_dictionary.Add("1hall_human", new string[] { "hall_human_1" });
            SaveConverter._buildings_old_id_dictionary.Add("2hall_human", new string[] { "hall_human_2" });
            SaveConverter._buildings_old_id_dictionary.Add("windmill_human", new string[] { "windmill_human_0" });
            SaveConverter._buildings_old_id_dictionary.Add("1windmill_human", new string[] { "windmill_human_1" });
            SaveConverter._buildings_old_id_dictionary.Add("house_elf", new string[] { "house_elf_0" });
            SaveConverter._buildings_old_id_dictionary.Add("1house_elf", new string[] { "house_elf_1" });
            SaveConverter._buildings_old_id_dictionary.Add("2house_elf", new string[] { "house_elf_2" });
            SaveConverter._buildings_old_id_dictionary.Add("3house_elf", new string[] { "house_elf_3" });
            SaveConverter._buildings_old_id_dictionary.Add("4house_elf", new string[] { "house_elf_4" });
            SaveConverter._buildings_old_id_dictionary.Add("5house_elf", new string[] { "house_elf_5" });
            SaveConverter._buildings_old_id_dictionary.Add("hall_elf", new string[] { "hall_elf_0" });
            SaveConverter._buildings_old_id_dictionary.Add("1hall_elf", new string[] { "hall_elf_1" });
            SaveConverter._buildings_old_id_dictionary.Add("2hall_elf", new string[] { "hall_elf_2" });
            SaveConverter._buildings_old_id_dictionary.Add("windmill_elf", new string[] { "windmill_elf_0" });
            SaveConverter._buildings_old_id_dictionary.Add("1windmill_elf", new string[] { "windmill_elf_1" });
            SaveConverter._buildings_old_id_dictionary.Add("house_orc", new string[] { "house_orc_0" });
            SaveConverter._buildings_old_id_dictionary.Add("1house_orc", new string[] { "house_orc_1" });
            SaveConverter._buildings_old_id_dictionary.Add("2house_orc", new string[] { "house_orc_2" });
            SaveConverter._buildings_old_id_dictionary.Add("3house_orc", new string[] { "house_orc_3" });
            SaveConverter._buildings_old_id_dictionary.Add("4house_orc", new string[] { "house_orc_4" });
            SaveConverter._buildings_old_id_dictionary.Add("5house_orc", new string[] { "house_orc_5" });
            SaveConverter._buildings_old_id_dictionary.Add("hall_orc", new string[] { "hall_orc_0" });
            SaveConverter._buildings_old_id_dictionary.Add("1hall_orc", new string[] { "hall_orc_1" });
            SaveConverter._buildings_old_id_dictionary.Add("2hall_orc", new string[] { "hall_orc_2" });
            SaveConverter._buildings_old_id_dictionary.Add("windmill_orc", new string[] { "windmill_orc_0" });
            SaveConverter._buildings_old_id_dictionary.Add("1windmill_orc", new string[] { "windmill_orc_1" });
            SaveConverter._buildings_old_id_dictionary.Add("house_dwarf", new string[] { "house_dwarf_0" });
            SaveConverter._buildings_old_id_dictionary.Add("1house_dwarf", new string[] { "house_dwarf_1" });
            SaveConverter._buildings_old_id_dictionary.Add("2house_dwarf", new string[] { "house_dwarf_2" });
            SaveConverter._buildings_old_id_dictionary.Add("3house_dwarf", new string[] { "house_dwarf_3" });
            SaveConverter._buildings_old_id_dictionary.Add("4house_dwarf", new string[] { "house_dwarf_4" });
            SaveConverter._buildings_old_id_dictionary.Add("5house_dwarf", new string[] { "house_dwarf_5" });
            SaveConverter._buildings_old_id_dictionary.Add("hall_dwarf", new string[] { "hall_dwarf_0" });
            SaveConverter._buildings_old_id_dictionary.Add("1hall_dwarf", new string[] { "hall_dwarf_1" });
            SaveConverter._buildings_old_id_dictionary.Add("2hall_dwarf", new string[] { "hall_dwarf_2" });
            SaveConverter._buildings_old_id_dictionary.Add("windmill_dwarf", new string[] { "windmill_dwarf_0" });
            SaveConverter._buildings_old_id_dictionary.Add("1windmill_dwarf", new string[] { "windmill_dwarf_1" });
            SaveConverter._buildings_old_id_dictionary.Add("0wheat", new string[] { "wheat" });
            SaveConverter._buildings_old_id_dictionary.Add("1wheat", new string[] { "wheat" });
            SaveConverter._buildings_old_id_dictionary.Add("2wheat", new string[] { "wheat" });
            SaveConverter._buildings_old_id_dictionary.Add("3wheat", new string[] { "wheat" });
            SaveConverter._buildings_old_id_dictionary.Add("4wheat", new string[] { "wheat" });
            SaveConverter._buildings_old_id_dictionary.Add("wheat_0", new string[] { "wheat" });
            SaveConverter._buildings_old_id_dictionary.Add("wheat_1", new string[] { "wheat" });
            SaveConverter._buildings_old_id_dictionary.Add("wheat_2", new string[] { "wheat" });
            SaveConverter._buildings_old_id_dictionary.Add("wheat_3", new string[] { "wheat" });
            SaveConverter._buildings_old_id_dictionary.Add("wheat_4", new string[] { "wheat" });
            SaveConverter._buildings_old_id_dictionary.Add("goldenBrain", new string[] { "golden_brain" });
            SaveConverter._buildings_old_id_dictionary.Add("corruptedBrain", new string[] { "corrupted_brain" });
            SaveConverter._buildings_old_id_dictionary.Add("flameTower", new string[] { "flame_tower" });
            SaveConverter._buildings_old_id_dictionary.Add("iceTower", new string[] { "ice_tower" });
            SaveConverter._buildings_old_id_dictionary.Add("superPumpkin", new string[] { "super_pumpkin" });
        }
        if (pData.buildings == null)
        {
            return;
        }
        foreach (BuildingData tData in pData.buildings)
        {
            if (SaveConverter._buildings_old_id_dictionary.ContainsKey(tData.asset_id))
            {
                tData.asset_id = SaveConverter._buildings_old_id_dictionary[tData.asset_id].GetRandom<string>();
            }
            if (tData.state == BuildingState.None)
            {
                tData.state = BuildingState.Normal;
            }
            if (tData.state == BuildingState.CivKingdom)
            {
                tData.state = BuildingState.Normal;
            }
            if (tData.state == BuildingState.CivAbandoned)
            {
                tData.state = BuildingState.Normal;
            }
        }
    }

    // Token: 0x06002CE6 RID: 11494 RVA: 0x0016B1E8 File Offset: 0x001693E8
    private static ActorData getNewActorData(ActorDataObsolete pOldData)
    {
        ActorData tData = pOldData.status;
        if (string.IsNullOrEmpty(tData.asset_id))
        {
            Debug.Log("skipping unit because it's missing an asset_id");
            return null;
        }
        tData.x = pOldData.x;
        tData.y = pOldData.y;
        tData.cityID = pOldData.cityID;
        List<long> saved_items = pOldData.saved_items;
        if (saved_items != null && saved_items.Count > 0)
        {
            tData.saved_items = pOldData.saved_items;
        }
        tData.inventory = pOldData.inventory;
        if (tData.inventory.isEmpty())
        {
            tData.inventory.empty();
        }
        return tData;
    }

    // Token: 0x04002261 RID: 8801
    private static Dictionary<string, string[]> _buildings_old_id_dictionary;

    // Token: 0x04002262 RID: 8802
    private static long _kingdom_0;
}
